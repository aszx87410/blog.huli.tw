<!DOCTYPE html>
<html class="has-navbar-fixed-top" lang="en">
<head>
    <meta charset="utf-8">
<title>[Android] APK Decompilation for Everyone - Huli&#39;s blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1">


<link href="https://blog.huli.tw/2016/03/20/en/android-apk-decompile/" rel="alternate" hreflang="en" />


<link href="https://blog.huli.tw/2016/03/20/android-apk-decompile/" rel="alternate" hreflang="x-default" />


            
<link href="https://blog.huli.tw/2016/03/20/android-apk-decompile/" rel="alternate" hreflang="zh-TW" />
            





    
<link rel="canonical" href="https://blog.huli.tw/2016/03/20/en/android-apk-decompile/">
    





    <meta name="description" content="IntroductionFor Android engineers, understanding how to decompile can enhance their understanding of the Android system and also consider how to protect their APK from being decompiled. For the genera">
<meta property="og:type" content="article">
<meta property="og:title" content="[Android] APK Decompilation for Everyone">
<meta property="og:url" content="https://blog.huli.tw/2016/03/20/en/android-apk-decompile/index.html">
<meta property="og:site_name" content="Huli&#39;s blog">
<meta property="og:description" content="IntroductionFor Android engineers, understanding how to decompile can enhance their understanding of the Android system and also consider how to protect their APK from being decompiled. For the genera">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://blog.huli.tw/img/old-articles/android-p1.png">
<meta property="og:image" content="https://blog.huli.tw/img/old-articles/android-p2.png">
<meta property="og:image" content="https://blog.huli.tw/img/old-articles/android-p3.png">
<meta property="og:image" content="https://blog.huli.tw/img/old-articles/android-p4.png">
<meta property="article:published_time" content="2016-03-20T06:11:00.000Z">
<meta property="article:modified_time" content="2023-06-20T05:10:49.041Z">
<meta property="article:author" content="Huli">
<meta property="article:tag" content="Android">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://blog.huli.tw/img/old-articles/android-p1.png">



<link rel="alternative" href="/atom.xml" title="[Android] APK Decompilation for Everyone" type="application/atom+xml">



<link rel="icon" href="/img/lidemy_logo.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">


<link rel="stylesheet" href="/css/bulma.css?v=2.css">



<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" />


<link rel="stylesheet" href="/css/style.css?v=4.css">





    
    
    
    
    
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1393J2EVCZ"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1393J2EVCZ');
</script>


    


<meta name="generator" content="Hexo 6.3.0"></head>
<body>
    <script>
        if (localStorage.getItem('dark-mode')) {
            if (localStorage.getItem('dark-mode') === 'true') {
                document.body.classList.add('dark-mode')
            }
        } else {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark-mode')
            }
        }
    </script>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/en">
                
                    
                    Huli&#39;s blog
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/en/archives">Archive</a>
            
            <a class="navbar-item "
               href="/en/categories">Categories</a>
            
            <a class="navbar-item "
               href="/en/about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            
            <div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc">
                <a class="navbar-item" title="Table of Contents">
                    Table of Contents
                </a>
                <div class="navbar-dropdown">
                    
                    
                    
                    
                    <a class="navbar-item" href="#introduction">1&nbsp;&nbsp;<b>Introduction</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#preparations">2&nbsp;&nbsp;<b>Preparations</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#hands-on">3&nbsp;&nbsp;<b>Hands-on</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#modification">4&nbsp;&nbsp;<b>Modification</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#summary">5&nbsp;&nbsp;<b>Summary</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#further-reading">6&nbsp;&nbsp;<b>Further reading</b></a>
                    
                </div>
            </div>
            
            
            <a class="navbar-item" target="_blank" title="Twitter" href="https://twitter.com/aszx87410">
                
                <i class="fab fa-twitter"></i>
                
            </a>
               
            <a class="navbar-item" target="_blank" title="RSS" href="/atom-en.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
               
            
            <a class="navbar-item btn-dark-mode" title="dark-mode" href="#">
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="15" height="15" viewBox="0 0 256 256" xml:space="preserve">
                    <defs>
                    </defs>
                    <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)" >
                        <path d="M 87.823 60.7 c -0.463 -0.423 -1.142 -0.506 -1.695 -0.214 c -15.834 8.398 -35.266 2.812 -44.232 -12.718 c -8.966 -15.53 -4.09 -35.149 11.101 -44.665 c 0.531 -0.332 0.796 -0.963 0.661 -1.574 c -0.134 -0.612 -0.638 -1.074 -1.259 -1.153 c -9.843 -1.265 -19.59 0.692 -28.193 5.66 C 13.8 12.041 6.356 21.743 3.246 33.35 S 1.732 57.08 7.741 67.487 c 6.008 10.407 15.709 17.851 27.316 20.961 C 38.933 89.486 42.866 90 46.774 90 c 7.795 0 15.489 -2.044 22.42 -6.046 c 8.601 -4.966 15.171 -12.43 18.997 -21.586 C 88.433 61.79 88.285 61.123 87.823 60.7 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: #ffa716; fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                    </g>
                    </svg>
                </div>
            </a>
            
               <a class="navbar-item" href="/2016/03/20/android-apk-decompile/">中文</a>
            
            

        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
      
      <div data-nosnippet class="self-notice">
        If you have any thoughts on my blog or articles and you want to let me know, you can either post a comment below(public) or tell me via this <a href="https://forms.gle/SjJZ4cnNs6NnjXQG8" target="_blank">feedback form</a>
      </div>
      
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            [Android] APK Decompilation for Everyone
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2016-03-20T06:11:00.000Z" itemprop="datePublished">20 March 2016</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/en/categories/Android/">Android</a>
        </span>
        
        
        
        <spen data-nosnippet class="column is-narrow">(Translated by ChatGPT)</span>
        
    </div>
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2><span id="introduction">Introduction</span></h2><p>For Android engineers, understanding how to decompile can enhance their understanding of the Android system and also consider how to protect their APK from being decompiled.</p>
<p>For the general public, many ready-made tools can help us easily decompile APKs and see Java source code, satisfying our curiosity.</p>
<p>This article only introduces the use of some tools, suitable for beginners to watch. If you want to understand more underlying knowledge, you can refer to the extended reading attached at the end of the article.</p>
<span id="more"></span>

<h2><span id="preparations">Preparations</span></h2><p>First, we need an APK to be cracked. Simply build one with any tool you are familiar with.</p>
<p>The structure is very simple, just a <code>MainActivity</code> and two <code>TextViews</code>.</p>
<pre class="line-numbers language-java" data-language="java"><div class="caption"><span>MainActivity.java</span></div><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token keyword">extends</span> <span class="token class-name">Activity</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TextView</span> text <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">TextView</span><span class="token punctuation">)</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
        text<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"Taiwan No1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-markup" data-language="markup"><div class="caption"><span>activity_main.xml</span></div><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vertical<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@string/hello_world<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/text<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>After installing it on the phone, you will see this screen:</p>
<p><img src="/img/old-articles/android-p1.png" alt="device-2016-03-20-152510.png"></p>
<h2><span id="hands-on">Hands-on</span></h2><p>Okay, this is the APK we want to test.</p>
<p>Then you need some very useful tools:</p>
<ol>
<li><a target="_blank" rel="noopener" href="http://ibotpeaches.github.io/Apktool/">apktool</a></li>
<li><a target="_blank" rel="noopener" href="http://jd.benow.ca/">jd-gui</a></li>
<li><a target="_blank" rel="noopener" href="https://sourceforge.net/projects/dex2jar/">dex2jar</a></li>
</ol>
<p>I won’t go into how to install them. You can read the documentation or search the internet for a bunch of answers.</p>
<p><code>apktool</code> is used to unpack the APK, which can decompile the APK and see the <code>smali</code> files and <code>resource</code>.</p>
<p><code>dex2jar</code> can convert the APK to a jar, and then use <code>jd-gui</code> to view the Java code.</p>
<p>Then we open the terminal, go to the directory of the demo APK just now, and execute <code>apktool d APKNAME.apk</code></p>
<p><img src="/img/old-articles/android-p2.png" alt="螢幕快照 2016-03-20 下午3.32.47.png"></p>
<p>After execution, a <code>APKNAME</code> folder will be automatically generated, which contains the decompiled things.</p>
<pre class="line-numbers language-none"><code class="language-none">.
├── AndroidManifest.xml
├── apktool.yml
├── original
├── res
└── smali<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>One of the more noteworthy folders is the <code>smali</code> folder, which is actually your source code, just in a different format. You can find your <code>MainActivity.java</code> in the <code>smali</code> folder, with the following contents: (It may look strange, but if you look closely, you’ll find that it’s not that difficult to understand.)</p>
<pre class="line-numbers language-java" data-language="java"><div class="caption"><span>MainActivity.java</span></div><code class="language-java"><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token keyword">public</span> <span class="token class-name">Lapktest</span><span class="token operator">/</span>huli<span class="token operator">/</span>com<span class="token operator">/</span>apkdecompile<span class="token operator">/</span><span class="token class-name">MainActivity</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token keyword">super</span> <span class="token class-name">Landroid</span><span class="token operator">/</span>app<span class="token operator">/</span><span class="token class-name">Activity</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span>source <span class="token string">"MainActivity.java"</span>

# direct methods
<span class="token punctuation">.</span>method <span class="token keyword">public</span> constructor <span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span>
    <span class="token punctuation">.</span>locals <span class="token number">0</span>

    <span class="token punctuation">.</span>prologue
    <span class="token punctuation">.</span>line <span class="token number">8</span>
    invoke<span class="token operator">-</span>direct <span class="token punctuation">&#123;</span>p0<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token class-name">Landroid</span><span class="token operator">/</span>app<span class="token operator">/</span><span class="token class-name">Activity</span><span class="token punctuation">;</span><span class="token operator">-></span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span>

    <span class="token keyword">return</span><span class="token operator">-</span><span class="token keyword">void</span>
<span class="token punctuation">.</span>end method

# virtual methods
<span class="token punctuation">.</span>method <span class="token keyword">protected</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Landroid</span><span class="token operator">/</span>os<span class="token operator">/</span><span class="token class-name">Bundle</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span>
    <span class="token punctuation">.</span>locals <span class="token number">2</span>
    <span class="token punctuation">.</span>param p1<span class="token punctuation">,</span> <span class="token string">"savedInstanceState"</span>    # <span class="token class-name">Landroid</span><span class="token operator">/</span>os<span class="token operator">/</span><span class="token class-name">Bundle</span><span class="token punctuation">;</span>

    <span class="token punctuation">.</span>prologue
    <span class="token punctuation">.</span>line <span class="token number">12</span>
    invoke<span class="token operator">-</span><span class="token keyword">super</span> <span class="token punctuation">&#123;</span>p0<span class="token punctuation">,</span> p1<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token class-name">Landroid</span><span class="token operator">/</span>app<span class="token operator">/</span><span class="token class-name">Activity</span><span class="token punctuation">;</span><span class="token operator">-></span><span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Landroid</span><span class="token operator">/</span>os<span class="token operator">/</span><span class="token class-name">Bundle</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span>

    <span class="token punctuation">.</span>line <span class="token number">13</span>
    <span class="token keyword">const</span> v1<span class="token punctuation">,</span> <span class="token number">0x7f040019</span>

    invoke<span class="token operator">-</span>virtual <span class="token punctuation">&#123;</span>p0<span class="token punctuation">,</span> v1<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token class-name">Lapktest</span><span class="token operator">/</span>huli<span class="token operator">/</span>com<span class="token operator">/</span>apkdecompile<span class="token operator">/</span><span class="token class-name">MainActivity</span><span class="token punctuation">;</span><span class="token operator">-></span><span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">I</span><span class="token punctuation">)</span><span class="token class-name">V</span>

    <span class="token punctuation">.</span>line <span class="token number">14</span>
    <span class="token keyword">const</span> v1<span class="token punctuation">,</span> <span class="token number">0x7f0c0050</span>

    invoke<span class="token operator">-</span>virtual <span class="token punctuation">&#123;</span>p0<span class="token punctuation">,</span> v1<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token class-name">Lapktest</span><span class="token operator">/</span>huli<span class="token operator">/</span>com<span class="token operator">/</span>apkdecompile<span class="token operator">/</span><span class="token class-name">MainActivity</span><span class="token punctuation">;</span><span class="token operator">-></span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">I</span><span class="token punctuation">)</span><span class="token class-name">Landroid</span><span class="token operator">/</span>view<span class="token operator">/</span><span class="token class-name">View</span><span class="token punctuation">;</span>

    move<span class="token operator">-</span>result<span class="token operator">-</span>object v0

    check<span class="token operator">-</span>cast v0<span class="token punctuation">,</span> <span class="token class-name">Landroid</span><span class="token operator">/</span>widget<span class="token operator">/</span><span class="token class-name">TextView</span><span class="token punctuation">;</span>

    <span class="token punctuation">.</span>line <span class="token number">15</span>
    <span class="token punctuation">.</span>local v0<span class="token punctuation">,</span> <span class="token string">"text"</span><span class="token operator">:</span><span class="token class-name">Landroid</span><span class="token operator">/</span>widget<span class="token operator">/</span><span class="token class-name">TextView</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span><span class="token operator">-</span>string v1<span class="token punctuation">,</span> <span class="token string">"Taiwan No1"</span>

    invoke<span class="token operator">-</span>virtual <span class="token punctuation">&#123;</span>v0<span class="token punctuation">,</span> v1<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token class-name">Landroid</span><span class="token operator">/</span>widget<span class="token operator">/</span><span class="token class-name">TextView</span><span class="token punctuation">;</span><span class="token operator">-></span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">CharSequence</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span>

    <span class="token punctuation">.</span>line <span class="token number">16</span>
    <span class="token keyword">return</span><span class="token operator">-</span><span class="token keyword">void</span>
<span class="token punctuation">.</span>end method<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>You can compare this with the Java code you wrote earlier and see that it’s just a different format.</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Is actually equivalent to:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token punctuation">.</span>line <span class="token number">13</span>
<span class="token keyword">const</span> v1<span class="token punctuation">,</span> <span class="token number">0x7f040019</span>
invoke<span class="token operator">-</span>virtual <span class="token punctuation">&#123;</span>p0<span class="token punctuation">,</span> v1<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token class-name">Lapktest</span><span class="token operator">/</span>huli<span class="token operator">/</span>com<span class="token operator">/</span>apkdecompile<span class="token operator">/</span><span class="token class-name">MainActivity</span><span class="token punctuation">;</span><span class="token operator">-></span><span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">I</span><span class="token punctuation">)</span><span class="token class-name">V</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>You may wonder where <code>0x7f040019</code> comes from. In fact, you can find the answer in the <code>res/values/public.xml</code> file:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>public</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layout<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>activity_main<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0x7f040019<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>At this point, you should have a rough idea of the Android compilation process:</p>
<ol>
<li>Compress and process all resource files and package them together to generate an <code>id-to-memory-location mapping</code> table.</li>
<li>Replace all <code>R.xx.xxx</code> in the code with actual memory locations using the table generated earlier.</li>
<li>Convert Java code to smali code (similar to converting C code to assembly code).</li>
</ol>
<h2><span id="modification">Modification</span></h2><p>In the <code>smali</code> code above, there is the following section:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token punctuation">.</span>line <span class="token number">15</span>
<span class="token punctuation">.</span>local v0<span class="token punctuation">,</span> <span class="token string">"text"</span><span class="token operator">:</span><span class="token class-name">Landroid</span><span class="token operator">/</span>widget<span class="token operator">/</span><span class="token class-name">TextView</span><span class="token punctuation">;</span>
<span class="token keyword">const</span><span class="token operator">-</span>string v1<span class="token punctuation">,</span> <span class="token string">"Taiwan No1"</span>

invoke<span class="token operator">-</span>virtual <span class="token punctuation">&#123;</span>v0<span class="token punctuation">,</span> v1<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token class-name">Landroid</span><span class="token operator">/</span>widget<span class="token operator">/</span><span class="token class-name">TextView</span><span class="token punctuation">;</span><span class="token operator">-></span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">CharSequence</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Let’s replace <code>Taiwan No1</code> with <code>T@iw@n n0!</code>.<br>Do you remember the other <code>TextView</code> that used <code>R.string.hello_world</code>?<br>In <code>res/values/strings.xml</code>, you can find the definition of this string:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hello_world<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Hello world!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Change it to:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hello_world<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>HELLO WORLD<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>After making sure everything has been changed, you can “assemble” the code again.<br>Do you remember the decompilation command we used earlier? <code>apktool d APK_NAME.apk</code><br>Here, <code>d</code> means <code>decompile</code>, so if you want to reverse assemble it, it’s <code>b</code>, <code>build</code>.</p>
<p><code>apktool b APK_NAME</code></p>
<p>After executing it, you can find an apk in <code>APK_NAME/dist</code>.<br>Note that this apk has not been signed, so it cannot be installed.<br>You can generate a keystore or find an existing one to sign it.<br><code>jarsigner -verbose -digestalg SHA1 -keystore ~/KEY.keystore APK_NAME.apk KEY_ALIAS</code></p>
<p>After installation, you will see this screen:</p>
<p><img src="/img/old-articles/android-p3.png" alt="device-2016-03-20-160501.png"></p>
<p>Yes! It’s that simple. An apk has been modified like this.</p>
<p>But <code>smali</code> code is hard to understand. Can we directly see the java code?</p>
<p>This is where the recommended tools <code>dex2jar</code> and <code>jd-gui</code> come in handy.</p>
<p>The former can turn an apk into a jar, and the latter can open a jar and display the java code.</p>
<p>The combination of the two allows you to see the original code directly.</p>
<p>After downloading <code>dex2jar</code>, there will be a bunch of shell scripts. <code>dex2jar</code> is the one we want.</p>
<p><code>./d2j-dex2jar.sh app.apk</code></p>
<p>After execution, there will be a jar. Open it with jd-gui, and you will see your code at a glance.</p>
<p><img src="/img/old-articles/android-p4.png" alt="螢幕快照 2016-03-20 下午4.10.15.png"></p>
<h2><span id="summary">Summary</span></h2><p>People who have not touched decompilation may be surprised: What! It’s so easy to modify an apk!</p>
<p>Yes, it’s that simple, and this is just a very basic example.</p>
<p>In fact, you can also add new code and resources (images, sounds, etc.).</p>
<p>That is to say, you can not only modify but also extend the original apk.</p>
<p>But there are also methods to prevent unscrupulous people from decompiling apk.</p>
<p>For example, shell, obfuscation, dynamic loading, etc.</p>
<p>I will introduce them later if there is a chance.</p>
<h2><span id="further-reading">Further reading</span></h2><ol>
<li><a target="_blank" rel="noopener" href="https://magiclen.org/android-decompiler/">Android Decompilation and Anti-Decompilation</a></li>
<li><a target="_blank" rel="noopener" href="http://aiur3908.blogspot.tw/2015/07/android-proguard.html">[Android] Code Obfuscation (ProGuard) and Decompilation</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.davidou.org/archives/553">[Android] Decompilation Cracking Android’s apk installation file</a></li>
<li><a target="_blank" rel="noopener" href="http://www.wangchenlong.org/2016/03/19/reverse-analyze-apk/">Common tools and usage methods for decompilation</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/wdaming1986/article/details/8299996">Smali–Dalvik virtual machine instruction language–&gt;[android_smali syntax learning one]</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.isming.me/2015/01/14/android-decompile-smali/">android decompilation-smali syntax</a></li>
</ol>

    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/en/tags/Android/">#Android</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/2016/03/28/en/cs50-programming-course-like-ocean/">An Ocean-like Programming Course: CS50</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/2016/01/19/en/my-ideal-interview-process/">My Ideal Interview Process</a>
            
        </span>
    </div>
    
</article>




<div class="comments">
    <h3 class="title is-4">Comments</h3>
    <script src="https://utteranc.es/client.js"
        repo="aszx87410/huli-blog"
        issue-term="title"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>

    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2025 Huli&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow" title="GitHub" target="_blank" rel="noopener" href="https://github.com/ppoffice/hexo-theme-minos">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
<div class="column is-narrow has-text-centered">
    <div class="dropdown is-up is-right is-hoverable" style="margin-top: -0.2em;">
        <div class="dropdown-trigger">
            <button class="button is-small" aria-haspopup="true">
                <span class="icon">
                    <i class="fas fa-globe"></i>
                </span>
                <span>English</span>
                <span class="icon is-small">
            <i class="fas fa-angle-down" aria-hidden="true"></i>
          </span>
            </button>
        </div>
        <div class="dropdown-menu has-text-left" role="menu" style="top:100%">
            <div class="dropdown-content">
            <!-- NOTE: 永遠回到首頁 -->
            
                <a href="/2016/03/20/android-apk-decompile/" class="dropdown-item">
                    繁體中文
                </a>
            
            </div>
        </div>
    </div>
</div>

        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>



    
    
    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    



<script src="/js/script.js?v=3.js"></script>


    
</body>
</html>