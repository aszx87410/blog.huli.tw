<!DOCTYPE html>
<html class="has-navbar-fixed-top" lang="en">
<head>
    <meta charset="utf-8">
<title>AWS Lambda + GitHub API + Google Sheet = Automated Sign-in System - Huli&#39;s blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1">


            
<link href="https://blog.huli.tw/2018/09/14/aws-lambda-and-github-api/" rel="alternate" hreflang="zh-TW" />
            
    




    
<link rel="canonical" href="https://blog.huli.tw/2018/09/14/en/aws-lambda-and-github-api/">
    





    <meta name="description" content="IntroductionDuring the past year, I have conducted several teaching experiments in my spare time, hoping to improve my teaching materials through continuous teaching and gain some insights from studen">
<meta property="og:type" content="article">
<meta property="og:title" content="AWS Lambda + GitHub API + Google Sheet &#x3D; Automated Sign-in System">
<meta property="og:url" content="https://blog.huli.tw/2018/09/14/en/aws-lambda-and-github-api/index.html">
<meta property="og:site_name" content="Huli&#39;s blog">
<meta property="og:description" content="IntroductionDuring the past year, I have conducted several teaching experiments in my spare time, hoping to improve my teaching materials through continuous teaching and gain some insights from studen">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://user-images.githubusercontent.com/2755720/49351914-7fb5b980-f6f0-11e8-8c5d-7e9f9df77998.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/2755720/49351926-85130400-f6f0-11e8-90ad-b1416aa916db.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/2755720/49351930-880df480-f6f0-11e8-8a83-100215a6748c.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/2755720/49351931-88a68b00-f6f0-11e8-9b5b-b848c17f45e3.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/2755720/49351935-8e03d580-f6f0-11e8-9219-d2c45b499596.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/2755720/49351938-90fec600-f6f0-11e8-9fa8-5686d09a9276.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/2755720/49351947-9c51f180-f6f0-11e8-894d-0b10d4b85b2d.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/2755720/49351952-9eb44b80-f6f0-11e8-949a-81248d45316f.png">
<meta property="article:published_time" content="2018-09-14T14:10:00.000Z">
<meta property="article:modified_time" content="2023-06-20T05:10:49.043Z">
<meta property="article:author" content="Huli">
<meta property="article:tag" content="Back-end">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://user-images.githubusercontent.com/2755720/49351914-7fb5b980-f6f0-11e8-8c5d-7e9f9df77998.png">



<link rel="alternative" href="/atom.xml" title="AWS Lambda + GitHub API + Google Sheet = Automated Sign-in System" type="application/atom+xml">



<link rel="icon" href="/img/lidemy_logo.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">


<link rel="stylesheet" href="/css/bulma.css?v=2.css">



<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" />


<link rel="stylesheet" href="/css/style.css?v=4.css">





    
    
    
    
    
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1393J2EVCZ"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1393J2EVCZ');
</script>


    


<meta name="generator" content="Hexo 6.3.0"></head>
<body>
    <script>
        if (localStorage.getItem('dark-mode')) {
            if (localStorage.getItem('dark-mode') === 'true') {
                document.body.classList.add('dark-mode')
            }
        } else {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark-mode')
            }
        }
    </script>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/en">
                
                    
                    Huli&#39;s blog
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/en/archives">Archive</a>
            
            <a class="navbar-item "
               href="/en/categories">Categories</a>
            
            <a class="navbar-item "
               href="/en/about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            
            <div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc">
                <a class="navbar-item" title="Table of Contents">
                    Table of Contents
                </a>
                <div class="navbar-dropdown">
                    
                    
                    
                    
                    <a class="navbar-item" href="#introduction">1&nbsp;&nbsp;<b>Introduction</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#why-do-we-need-a-sign-in-system">2&nbsp;&nbsp;<b>Why do we need a sign-in system?</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#how-to-make-this-sign-in-system">3&nbsp;&nbsp;<b>How to make this sign-in system?</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#1-open-a-github-issue-every-day-with-todays-date-as-the-title">4&nbsp;&nbsp;<b>1. Open a GitHub issue every day with today’s date as the title.</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#2-synchronize-every-comment-under-each-issue-to-slack">5&nbsp;&nbsp;<b>2. Synchronize every comment under each issue to Slack.</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#3-integrate-github-webhook-to-synchronize-records-to-a-spreadsheet">6&nbsp;&nbsp;<b>3. Integrate GitHub Webhook to synchronize records to a spreadsheet.</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#how-to-debug-on-lambda">7&nbsp;&nbsp;<b>How to debug on Lambda?</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#summary">8&nbsp;&nbsp;<b>Summary</b></a>
                    
                </div>
            </div>
            
            
            <a class="navbar-item" target="_blank" title="Twitter" href="https://twitter.com/aszx87410">
                
                <i class="fab fa-twitter"></i>
                
            </a>
               
            <a class="navbar-item" target="_blank" title="RSS" href="/atom-en.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
               
            
            <a class="navbar-item btn-dark-mode" title="dark-mode" href="#">
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="15" height="15" viewBox="0 0 256 256" xml:space="preserve">
                    <defs>
                    </defs>
                    <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)" >
                        <path d="M 87.823 60.7 c -0.463 -0.423 -1.142 -0.506 -1.695 -0.214 c -15.834 8.398 -35.266 2.812 -44.232 -12.718 c -8.966 -15.53 -4.09 -35.149 11.101 -44.665 c 0.531 -0.332 0.796 -0.963 0.661 -1.574 c -0.134 -0.612 -0.638 -1.074 -1.259 -1.153 c -9.843 -1.265 -19.59 0.692 -28.193 5.66 C 13.8 12.041 6.356 21.743 3.246 33.35 S 1.732 57.08 7.741 67.487 c 6.008 10.407 15.709 17.851 27.316 20.961 C 38.933 89.486 42.866 90 46.774 90 c 7.795 0 15.489 -2.044 22.42 -6.046 c 8.601 -4.966 15.171 -12.43 18.997 -21.586 C 88.433 61.79 88.285 61.123 87.823 60.7 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: #ffa716; fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                    </g>
                    </svg>
                </div>
            </a>
            
               <a class="navbar-item" href="/2018/09/14/aws-lambda-and-github-api/">中文</a>
            
            

        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
      
      <div data-nosnippet class="self-notice">
        If you have any thoughts on my blog or articles and you want to let me know, you can either post a comment below(public) or tell me via this <a href="https://forms.gle/SjJZ4cnNs6NnjXQG8" target="_blank">feedback form</a>
      </div>
      
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            AWS Lambda + GitHub API + Google Sheet = Automated Sign-in System
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2018-09-14T14:10:00.000Z" itemprop="datePublished">14 September 2018</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/en/categories/Back-end/">Back-end</a>
        </span>
        
        
        
        <spen data-nosnippet class="column is-narrow">(Translated by ChatGPT)</span>
        
    </div>
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2><span id="introduction">Introduction</span></h2><p>During the past year, I have conducted several <a target="_blank" rel="noopener" href="https://medium.com/hulis-blog/mentor-program-s2-f876c4e13d3b">teaching experiments</a> in my spare time, hoping to improve my teaching materials through continuous teaching and gain some insights from student feedback.</p>
<p>When conducting these teaching experiments, I often think about which existing services can reduce my workload. After all, as an engineer, I want to automate some trivial tasks, and the time saved in the long run is considerable.</p>
<p>Half a year ago, I made my first attempt and shared my experience here: <a target="_blank" rel="noopener" href="https://blog.techbridge.cc/2018/02/03/github-classroom-and-travis-ci/">Using Github Classroom and Travis CI to Build a Homework Grading System</a>. After having an automated homework grading system, it did save me a lot of trouble.</p>
<p>This time, I want to share an automated sign-in system that I implemented in about one or two days two weeks ago.</p>
<span id="more"></span>

<h2><span id="why-do-we-need-a-sign-in-system">Why do we need a sign-in system?</span></h2><p>In order to grasp the progress of students and ensure that students are really interested in continuing to attend classes, I introduced the Daily Stand-up meeting that I do every day in the company during the last teaching experiment. Everyone quickly shares what they did yesterday, what they will do today, and if there is anything that prevents them from completing these tasks.</p>
<p>At that time, I used a fixed format for everyone to post these things in the Slack channel:</p>
<p><img src="https://user-images.githubusercontent.com/2755720/49351914-7fb5b980-f6f0-11e8-8c5d-7e9f9df77998.png" alt="daily"></p>
<p>The advantage is that it is concentrated in one place and is very convenient to view, but the disadvantage is that I can only see it with my own eyes and cannot record it. That is to say, if I want to make a form of which students did not post, I can only fill it out one by one.</p>
<p>Last time, because there were few students and posting was not mandatory, it was not a problem, but in this teaching experiment, I introduced the elimination system. If a student fails to submit a progress report too many times within a certain period, he or she will be eliminated from the course.</p>
<p>Since I have this mechanism, I must record these progress reports, and record which people and which days have no reports. In this way, I must have a more complete sign-in system. The goals I want to achieve are:</p>
<ol>
<li>I want to see everyone’s progress report in the slack channel</li>
<li>I want a place to record whether each student has posted a progress report every day (called sign-in)</li>
</ol>
<h2><span id="how-to-make-this-sign-in-system">How to make this sign-in system?</span></h2><p>My first idea is to use Google Sheets, after all, this thing is the most convenient. Fill in each student’s account on the horizontal axis and the date on the vertical axis. If there is a report, give a mark, otherwise leave it blank. In this way, I can clearly see the sign-in record. The finished product looks like this:</p>
<p><img src="https://user-images.githubusercontent.com/2755720/49351926-85130400-f6f0-11e8-90ad-b1416aa916db.png" alt="sheet"></p>
<p>In this way, the second requirement is completed, and the remaining is to think about how to complete the first requirement. The easiest way is to let students post by themselves in a certain channel, and then I write a program to connect to Slack’s webhook, and write the data into the Google Sheet when receiving the data.</p>
<p>This solution seems good, but there is a problem that the workspace used in the course is the free version, and the message will be eaten up after a certain amount, and the previous progress reports cannot be seen. I think this is a bit regrettable, so this solution is not feasible.</p>
<p>Then I thought of another better solution:</p>
<ol>
<li>Let students leave a message under the GitHub Issue</li>
<li>Synchronize the message to the Slack channel</li>
<li>Connect to the GitHub Webhook and synchronize the record to the Google Sheet</li>
</ol>
<p>The advantage of this is that the record can be permanently saved, and it can be divided by day! It is easy to find all the progress reports of everyone on a certain day, which cannot be done by directly posting in Slack.</p>
<p>Let me show you the finished product first. The finished product looks like this:</p>
<p><img src="https://user-images.githubusercontent.com/2755720/49351930-880df480-f6f0-11e8-8a83-100215a6748c.png" alt="issue"><br><img src="https://user-images.githubusercontent.com/2755720/49351931-88a68b00-f6f0-11e8-9b5b-b848c17f45e3.png" alt="comment"></p>
<p>After having a concept of the entire sign-in system, we can divide the technical tasks into the following three items:</p>
<ol>
<li>Open a GitHub issue every day with today’s date as the title.</li>
<li>Synchronize every comment under each issue to Slack.</li>
<li>Integrate GitHub Webhook to synchronize records to a spreadsheet.</li>
</ol>
<p>Now it’s time to implement!</p>
<h2><span id="1-open-a-github-issue-every-day-with-todays-date-as-the-title">1. Open a GitHub issue every day with today’s date as the title.</span></h2><p>When I saw the keyword “every day,” I knew this was something that could be done with a Cron Job. Originally, I wanted to write a simple program on my own machine to run it every day, but then a keyword popped up in my mind: AWS Lambda.</p>
<p>If you don’t know what it is, let me explain briefly. It is one of the popular concepts of Serverless in recent years. It doesn’t mean there is no server, but it means you don’t have to manage the server yourself. All you have to do is write your application, and you don’t have to worry about anything related to the server or the machine.</p>
<p>AWS Lambda is such a service. All you have to do is put your code up there, and you don’t have to worry about anything else. The billing is based on the execution time of the program. Maybe because it is still in the promotion period, it is free for a certain amount of time per month.</p>
<p>If I don’t use Lambda, I have to send the files to my server and set up a Cron Job to run them. If something goes wrong with the host, I have to fix it myself. But what I want to do is just such a simple thing! Using Lambda can save me a lot of trouble and is definitely the best choice.</p>
<p>After deciding to use Lambda, the next step is to write the code according to its requirements. Actually, the requirements are very simple. Just export the function you want to execute with <code>exports.handler</code>.</p>
<p>Here is the code:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> moment <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'moment'</span><span class="token punctuation">)</span>
  
<span class="token keyword">var</span> token <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>token
<span class="token keyword">var</span> endpoint <span class="token operator">=</span> <span class="token string">'https://api.github.com/repos/Lidemy/mentor-daily-report/issues?access_token='</span> <span class="token operator">+</span> token
<span class="token keyword">var</span> today <span class="token operator">=</span> <span class="token function">moment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'YYYY-MM-DD'</span><span class="token punctuation">)</span>
  
<span class="token keyword">var</span> content <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">'在下面請按照此格式提供本日進度報告：'</span><span class="token punctuation">,</span>
  <span class="token string">'```'</span><span class="token punctuation">,</span>
  <span class="token string">'## 昨天'</span><span class="token punctuation">,</span>
  <span class="token string">'- 寫作業 hw2-1'</span><span class="token punctuation">,</span>
  <span class="token string">'- 練習 JavaScript 迴圈使用'</span><span class="token punctuation">,</span>
  <span class="token string">'## 今天'</span><span class="token punctuation">,</span>
  <span class="token string">'- 研究什麼是 callback'</span><span class="token punctuation">,</span>
  <span class="token string">'- 寫作業 hw2-1（繼續）'</span><span class="token punctuation">,</span>
  <span class="token string">'```'</span>
<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
  
<span class="token keyword">const</span> <span class="token function-variable function">createIssue</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'[進度報告] '</span> <span class="token operator">+</span> today<span class="token punctuation">,</span>
      <span class="token literal-property property">body</span><span class="token operator">:</span> content
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token string-property property">'Accept'</span><span class="token operator">:</span> <span class="token string">'application/vnd.github.v3+json'</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">'success'</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> err<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
  
exports<span class="token punctuation">.</span>handler <span class="token operator">=</span> createIssue
  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>It is a very simple program that will use the GitHub API to create a new issue with today’s date as the title.</p>
<p>One thing to note is that other npm libraries are used here. There should be a way to only send the package.json, and Lambda will help you execute <code>npm install</code> to get those packages. But I’m too lazy to check, so I just packed <code>node_modules</code> into the compressed file and uploaded it.</p>
<p>The last time I used Lambda was about two or three years ago when this service was just launched. I played with it out of curiosity and found that the interface was very simple and I didn’t know how to set many things.</p>
<p>After many years, when I saw its interface again this time, I was really shocked. It has made great progress!</p>
<p>First of all, the trigger condition is clear at a glance:</p>
<p><img src="https://user-images.githubusercontent.com/2755720/49351935-8e03d580-f6f0-11e8-9219-d2c45b499596.png" alt="l1"></p>
<p>Because I want to run it every day at a fixed time, you can use CloudWatch to set a schedule on AWS. Note that the time of this schedule on Lambda will be based on UTC, which is the +0 time zone. So if you say it runs at 00:00 every day, it actually means it runs at 08:00 in the morning in Taiwan.</p>
<p>The expression I set here is: <code>5 0 ? * MON-FRI *</code>, and Lambda will be triggered at 08:05 on weekdays in Taiwan time to execute the function of creating an issue.</p>
<p>Then, if your code is not very large, you can edit it directly on the Lambda interface, which has a fully functional editor (I always feel very familiar with it, and later I realized that it should be because Amazon bought Cloud9. I used Cloud9’s IDE when I took CS50 before, no wonder it’s so familiar):</p>
<p><img src="https://user-images.githubusercontent.com/2755720/49351938-90fec600-f6f0-11e8-9fa8-5686d09a9276.png" alt="l2"></p>
<p>Finally, after setting the environment variable token, it is completed. After testing, I found that the issue was successfully created. The first task was completed easily. Thanks to Lambda’s efforts.</p>
<h2><span id="2-synchronize-every-comment-under-each-issue-to-slack">2. Synchronize every comment under each issue to Slack.</span></h2><p>This is the simplest of the three tasks because Slack’s original advantage is that it can be integrated with many ready-made things. You can install the GitHub App on Slack and use commands to subscribe to a specific repo and event.</p>
<p>Because this is too simple, I don’t need to introduce it anymore. I’ll show you the result directly:</p>
<p><img src="https://user-images.githubusercontent.com/2755720/49351947-9c51f180-f6f0-11e8-894d-0b10d4b85b2d.png" alt="github"></p>
<h2><span id="3-integrate-github-webhook-to-synchronize-records-to-a-spreadsheet">3. Integrate GitHub Webhook to synchronize records to a spreadsheet.</span></h2><p>We can easily implement this task by using Lambda with other AWS services. The process is as follows:</p>
<ol>
<li>The student leaves a message, triggering the GitHub Webhook.</li>
<li>The GitHub Webhook hits AWS API Gateway.</li>
<li>Trigger the Lambda function through API Gateway.</li>
<li>The Lambda function writes to the spreadsheet via the Google Sheet API.</li>
</ol>
<p>Let’s first prepare the API to be sent to the webhook. Here, we use API Gateway to trigger Lambda, like this:</p>
<p><img src="https://user-images.githubusercontent.com/2755720/49351952-9eb44b80-f6f0-11e8-949a-81248d45316f.png" alt="api"></p>
<p>API Gateway configuration is also super convenient. You just need to set what HTTP method to use, and it will give you a URL. For example, if I set it to GET, you can trigger Lambda by using GET to call this API. It can create a webhook in a very short time, which is much more convenient than building your own server and setting up domain and https.</p>
<p>Next is to integrate with the Google Sheet API. After looking at the official API, I found that it still maintains the usual style, which is that the document is very complete but the explanation is very complicated. I couldn’t figure out how to implement the functionality I needed at a glance, so I found a package that someone else had wrapped: <a target="_blank" rel="noopener" href="https://github.com/theoephraim/node-google-spreadsheet">Simple Google Spreadsheet Access (node.js)</a>, which is much easier to use.</p>
<p>The most troublesome permission management also teaches you how to implement it. Basically, you need to create a <code>Service Account</code>, set it to have permission to the Google Drive API, and then generate a token for this account. You can use that token.</p>
<p>What the main program needs to do is basically to filter the data, then find the account from the data sent over from GitHub, and pass the account and date to another function I wrote separately. Finally, return the result to end:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> updateSheet <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./lib'</span><span class="token punctuation">)</span>
  
exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> context<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>event<span class="token punctuation">.</span>body<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">'no body'</span>
    <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>body<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>body <span class="token operator">||</span> body<span class="token punctuation">.</span>action <span class="token operator">!==</span> <span class="token string">'created'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
    <span class="token keyword">const</span> title <span class="token operator">=</span> body<span class="token punctuation">.</span>issue<span class="token punctuation">.</span>title<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>title<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
    <span class="token keyword">const</span> date <span class="token operator">=</span> title<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">const</span> account <span class="token operator">=</span> body<span class="token punctuation">.</span>comment<span class="token punctuation">.</span>user<span class="token punctuation">.</span>login
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'log:'</span><span class="token punctuation">,</span> date<span class="token punctuation">,</span> account<span class="token punctuation">)</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">await</span> <span class="token function">updateSheet</span><span class="token punctuation">(</span>date<span class="token punctuation">,</span> account<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">statusCode</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
            <span class="token literal-property property">body</span><span class="token operator">:</span> date <span class="token operator">+</span> account
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
      
    <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
<span class="token keyword">const</span> <span class="token function-variable function">response</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">statusCode</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
        <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token string">'ok'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>The <code>updateSheet</code> function does a simple job, which is to find the correct position based on the date and account, and change the value of that cell to O. Here is some sample code for your reference:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">searchAccount</span><span class="token punctuation">(</span><span class="token parameter">sheet<span class="token punctuation">,</span> account</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> firstRow <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getCells</span><span class="token punctuation">(</span>sheet<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    <span class="token string-property property">'min-row'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string-property property">'max-row'</span><span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> length <span class="token operator">=</span> firstRow<span class="token punctuation">.</span>length
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>firstRow<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">===</span> account<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">col</span><span class="token operator">:</span> firstRow<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>col<span class="token punctuation">,</span>
        <span class="token literal-property property">batchId</span><span class="token operator">:</span> firstRow<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>batchId
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token keyword">null</span>
<span class="token punctuation">&#125;</span>
  
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">setValue</span><span class="token punctuation">(</span><span class="token parameter">sheet<span class="token punctuation">,</span> row<span class="token punctuation">,</span> col<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> cells <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getCells</span><span class="token punctuation">(</span>sheet<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    <span class="token string-property property">'min-row'</span><span class="token operator">:</span> row<span class="token punctuation">,</span>
    <span class="token string-property property">'max-row'</span><span class="token operator">:</span> row<span class="token punctuation">,</span>
    <span class="token string-property property">'min-col'</span><span class="token operator">:</span> col<span class="token punctuation">,</span>
    <span class="token string-property property">'max-col'</span><span class="token operator">:</span> col<span class="token punctuation">,</span>
    <span class="token string-property property">'return-empty'</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cells <span class="token operator">&amp;&amp;</span> cells<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    cells<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
    cells<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'err'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
  
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">updateSheet</span><span class="token punctuation">(</span><span class="token parameter">date<span class="token punctuation">,</span> account</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> sheet <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> accountPosition <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">searchAccount</span><span class="token punctuation">(</span>sheet<span class="token punctuation">,</span> account<span class="token punctuation">)</span>
    <span class="token keyword">const</span> datePosition <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">searchDate</span><span class="token punctuation">(</span>sheet<span class="token punctuation">,</span> date<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'position:'</span><span class="token punctuation">,</span> accountPosition<span class="token punctuation">,</span> datePosition<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>accountPosition <span class="token operator">||</span> <span class="token operator">!</span>datePosition<span class="token punctuation">)</span> <span class="token keyword">return</span>
    <span class="token keyword">await</span> <span class="token function">setValue</span><span class="token punctuation">(</span>sheet<span class="token punctuation">,</span> datePosition<span class="token punctuation">.</span>row<span class="token punctuation">,</span> accountPosition<span class="token punctuation">.</span>col<span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'err'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>  
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Finally, just set the webhook URL on GitHub, and everything is done!</p>
<h2><span id="how-to-debug-on-lambda">How to debug on Lambda?</span></h2><p>Although I wrote it lightly above, I actually encountered a few small problems during development. The first is that debugging is not as straightforward as on a computer, and webhooks are usually harder to debug.</p>
<p>Regarding this part, Lambda will actually send the log to CloudWatch, so you need to write logs in the app yourself, and then analyze those logs in CloudWatch. If it is a simple application, it should be quite easy. If it is more complex, the function should be divided into smaller ones, otherwise debugging will be quite troublesome.</p>
<p>Another problem I encountered is that the Google Sheet API is slower, and the entire process takes about 5 seconds. The default timeout is about 3 seconds, so remember to increase the timeout yourself, otherwise it will keep failing.</p>
<h2><span id="summary">Summary</span></h2><p>This time, the experience of using AWS Lambda was pretty good. I didn’t encounter any major difficulties during the development process, which may be related to the fact that what I wanted to implement was relatively simple. But I think this kind of simple thing is super suitable for this kind of serverless solution, because it is really convenient without a server, and it saves a lot of trouble.</p>
<p>In the future, if there are similar simple requirements, I think I will still use this solution, just connect one ready-made service to another, and everything will be done. I also recommend that if you want to do some small things, you might as well try to use these ready-made services to get things done, which can save a lot of time.</p>

    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/en/tags/Back-end/">#Back-end</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/2018/10/13/en/pwa-in-action/">PWA Practical Experience Sharing</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/2018/08/18/en/cors-is-hard/">CORS is not as simple as I thought</a>
            
        </span>
    </div>
    
</article>




<div class="comments">
    <h3 class="title is-4">Comments</h3>
    <script src="https://utteranc.es/client.js"
        repo="aszx87410/huli-blog"
        issue-term="title"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>

    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2024 Huli&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow" title="GitHub" target="_blank" rel="noopener" href="https://github.com/ppoffice/hexo-theme-minos">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
<div class="column is-narrow has-text-centered">
    <div class="dropdown is-up is-right is-hoverable" style="margin-top: -0.2em;">
        <div class="dropdown-trigger">
            <button class="button is-small" aria-haspopup="true">
                <span class="icon">
                    <i class="fas fa-globe"></i>
                </span>
                <span>English</span>
                <span class="icon is-small">
            <i class="fas fa-angle-down" aria-hidden="true"></i>
          </span>
            </button>
        </div>
        <div class="dropdown-menu has-text-left" role="menu" style="top:100%">
            <div class="dropdown-content">
            <!-- NOTE: 永遠回到首頁 -->
            
                <a href="/2018/09/14/aws-lambda-and-github-api/" class="dropdown-item">
                    繁體中文
                </a>
            
            </div>
        </div>
    </div>
</div>

        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>



    
    
    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    



<script src="/js/script.js?v=3.js"></script>


    
</body>
</html>