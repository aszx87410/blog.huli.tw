<!DOCTYPE html>
<html class="has-navbar-fixed-top" lang="en">
<head>
    <meta charset="utf-8">
<title>Synchronous and Asynchronous in JavaScript (Part 1): Become a Callback Master! - Huli&#39;s blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="google-adsense-account" content="ca-pub-1121865251398741">



            
<link href="https://blog.huli.tw/2019/10/04/javascript-async-sync-and-callback/" rel="alternate" hreflang="zh-TW" />
            
    




    
<link rel="canonical" href="https://blog.huli.tw/2019/10/04/en/javascript-async-sync-and-callback/">
    





    <meta name="description" content="IntroductionIf there is one concept in JavaScript that is important and commonly used but often confused by beginners, it is undoubtedly “Asynchronous”. Compared to other concepts such as this, closur">
<meta property="og:type" content="article">
<meta property="og:title" content="Synchronous and Asynchronous in JavaScript (Part 1): Become a Callback Master!">
<meta property="og:url" content="https://blog.huli.tw/2019/10/04/en/javascript-async-sync-and-callback/index.html">
<meta property="og:site_name" content="Huli&#39;s blog">
<meta property="og:description" content="IntroductionIf there is one concept in JavaScript that is important and commonly used but often confused by beginners, it is undoubtedly “Asynchronous”. Compared to other concepts such as this, closur">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://blog.huli.tw/img/js-async/p1.png">
<meta property="og:image" content="https://blog.huli.tw/img/js-async/p2.png">
<meta property="og:image" content="https://blog.huli.tw/img/js-async/fre.gif">
<meta property="og:image" content="https://blog.huli.tw/img/js-async/event.png">
<meta property="og:image" content="https://blog.huli.tw/img/js-async/e.png">
<meta property="og:image" content="https://blog.huli.tw/img/js-async/p2.png">
<meta property="og:image" content="https://blog.huli.tw/img/js-async/eventloop.png">
<meta property="article:published_time" content="2019-10-04T14:07:00.000Z">
<meta property="article:modified_time" content="2023-06-20T05:10:49.062Z">
<meta property="article:author" content="Huli">
<meta property="article:tag" content="Front-end">
<meta property="article:tag" content="JavaScript">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://blog.huli.tw/img/js-async/p1.png">



<link rel="alternative" href="/atom.xml" title="Synchronous and Asynchronous in JavaScript (Part 1): Become a Callback Master!" type="application/atom+xml">



<link rel="icon" href="/img/lidemy_logo.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">


<link rel="stylesheet" href="/css/bulma.css?v=2.css">



<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" />


<link rel="stylesheet" href="/css/style.css?v=4.css">





    
    
    
    
    
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1393J2EVCZ"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1393J2EVCZ');
</script>


    


<meta name="generator" content="Hexo 6.3.0"></head>
<body>
    <script>
        if (localStorage.getItem('dark-mode')) {
            if (localStorage.getItem('dark-mode') === 'true') {
                document.body.classList.add('dark-mode')
            }
        } else {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark-mode')
            }
        }
    </script>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/en">
                
                    
                    Huli&#39;s blog
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/en/archives">Archive</a>
            
            <a class="navbar-item "
               href="/en/categories">Categories</a>
            
            <a class="navbar-item "
               href="/en/about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            
            <div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc">
                <a class="navbar-item" title="Table of Contents">
                    Table of Contents
                </a>
                <div class="navbar-dropdown">
                    
                    
                    
                    
                    <a class="navbar-item" href="#introduction">1&nbsp;&nbsp;<b>Introduction</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#basic-introduction-to-nodejs">2&nbsp;&nbsp;<b>Basic Introduction to Node.js</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#blocking-and-non-blocking">3&nbsp;&nbsp;<b>Blocking and Non-Blocking</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#synchronous-and-asynchronous">4&nbsp;&nbsp;<b>Synchronous and Asynchronous</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#synchronous-and-asynchronous-in-browsers">5&nbsp;&nbsp;<b>Synchronous and Asynchronous in Browsers</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#the-callback-that-is-strange-but-familiar-to-you">6&nbsp;&nbsp;<b>The callback that is strange but familiar to you</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#parameters-of-the-callback-function">7&nbsp;&nbsp;<b>Parameters of the Callback Function</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#error-first-convention-of-callbacks">8&nbsp;&nbsp;<b>Error First Convention of Callbacks</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#understanding-the-last-puzzle-of-asynchronous-event-loop">9&nbsp;&nbsp;<b>Understanding the last puzzle of asynchronous: Event loop</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#asynchronous-quiz">10&nbsp;&nbsp;<b>Asynchronous Quiz</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#1-event-website">10.1&nbsp;&nbsp;1. Event Website</a>
                    
                    
                    
                    <a class="navbar-item" href="#2-waiting-slowly">10.2&nbsp;&nbsp;2. Waiting Slowly</a>
                    
                    
                    
                    <a class="navbar-item" href="#3-strange-timer">10.3&nbsp;&nbsp;3. Strange Timer</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-execution-order-test">10.4&nbsp;&nbsp;4. Execution Order Test</a>
                    
                    
                    
                    <a class="navbar-item" href="#answer-1-event-website">10.5&nbsp;&nbsp;Answer: 1. Event Website</a>
                    
                    
                    
                    <a class="navbar-item" href="#answer-2-wait-slowly">10.6&nbsp;&nbsp;Answer: 2. Wait Slowly</a>
                    
                    
                    
                    <a class="navbar-item" href="#answer-3-strange-timer">10.7&nbsp;&nbsp;Answer: 3. Strange Timer</a>
                    
                    
                    
                    <a class="navbar-item" href="#answer-4-execution-order-test">10.8&nbsp;&nbsp;Answer: 4. Execution Order Test</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#conclusion">11&nbsp;&nbsp;<b>Conclusion</b></a>
                    
                </div>
            </div>
            
            
            <a class="navbar-item" target="_blank" title="Twitter" href="https://twitter.com/aszx87410">
                
                <i class="fab fa-twitter"></i>
                
            </a>
               
            <a class="navbar-item" target="_blank" title="RSS" href="/atom-en.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
               
            
            <a class="navbar-item btn-dark-mode" title="dark-mode" href="#">
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="15" height="15" viewBox="0 0 256 256" xml:space="preserve">
                    <defs>
                    </defs>
                    <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)" >
                        <path d="M 87.823 60.7 c -0.463 -0.423 -1.142 -0.506 -1.695 -0.214 c -15.834 8.398 -35.266 2.812 -44.232 -12.718 c -8.966 -15.53 -4.09 -35.149 11.101 -44.665 c 0.531 -0.332 0.796 -0.963 0.661 -1.574 c -0.134 -0.612 -0.638 -1.074 -1.259 -1.153 c -9.843 -1.265 -19.59 0.692 -28.193 5.66 C 13.8 12.041 6.356 21.743 3.246 33.35 S 1.732 57.08 7.741 67.487 c 6.008 10.407 15.709 17.851 27.316 20.961 C 38.933 89.486 42.866 90 46.774 90 c 7.795 0 15.489 -2.044 22.42 -6.046 c 8.601 -4.966 15.171 -12.43 18.997 -21.586 C 88.433 61.79 88.285 61.123 87.823 60.7 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: #ffa716; fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                    </g>
                    </svg>
                </div>
            </a>
            
               <a class="navbar-item" href="/2019/10/04/javascript-async-sync-and-callback/">中文</a>
            
            

        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
      
      <div data-nosnippet class="self-notice">
        If you have any thoughts on my blog or articles and you want to let me know, you can either post a comment below(public) or tell me via this <a href="https://forms.gle/SjJZ4cnNs6NnjXQG8" target="_blank">feedback form</a>
      </div>
      
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            Synchronous and Asynchronous in JavaScript (Part 1): Become a Callback Master!
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-10-04T14:07:00.000Z" itemprop="datePublished">4 October 2019</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/en/categories/JavaScript/">JavaScript</a>
        </span>
        
        
        
        <spen data-nosnippet class="column is-narrow">(Translated by ChatGPT)</span>
        
    </div>
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2><span id="introduction">Introduction</span></h2><p>If there is one concept in JavaScript that is important and commonly used but often confused by beginners, it is undoubtedly “Asynchronous”. Compared to other concepts such as <a href="https://blog.huli.tw/2019/02/23/javascript-what-is-this/">this</a>, <a href="https://blog.huli.tw/2018/12/08/javascript-closure/">closure</a>, <a href="https://blog.huli.tw/2017/08/27/the-javascripts-prototype-chain/">prototype</a>, or <a href="https://blog.huli.tw/2018/11/10/javascript-hoisting-and-tdz/">hoisting</a>, asynchronous is used much more frequently in practical development and is often a pitfall for beginners.</p>
<p>Is asynchronous really that difficult?</p>
<p>I don’t think so. As long as you follow a correct context, you can gradually understand why asynchronous is needed and how it is handled in JavaScript.</p>
<p>I actually wrote about a similar topic four years ago, but looking back now, it was not well written. Therefore, four years later, I am revisiting this topic and hoping to write a better quality article to clarify the concept of asynchronous.</p>
<p>Before writing this article, I referred to the official documentation of <a target="_blank" rel="noopener" href="https://nodejs.org/en/docs/guides/">Node.js</a> and found that it actually explains asynchronous quite well. Therefore, this article will start with a similar approach to discuss this issue. If you don’t know Node.js, it’s okay, I will provide a brief introduction below.</p>
<p>It is recommended that you have a basic understanding of JavaScript, know how to use JavaScript to manipulate the DOM, and know what ajax is before reading this article.</p>
<p>Let’s get started!</p>
<span id="more"></span>

<h2><span id="basic-introduction-to-nodejs">Basic Introduction to Node.js</span></h2><p>JavaScript is a programming language with its own specifications, such as using <code>var</code> to declare variables, using <code>if else</code> for conditional statements, or using <code>function</code> to declare functions. These are all parts of the JavaScript language itself.</p>
<p>Since I mentioned “parts of the programming language itself” above, it means that there are also things that “do not belong to the JavaScript language”.</p>
<p>For example, <code>document.querySelector(&#39;body&#39;)</code> allows you to get the DOM object of the body and manipulate it, and the changes will be immediately reflected on the browser screen.</p>
<p>Where does this <code>document</code> come from? It is actually provided by the browser to JavaScript, so that <code>JavaScript</code> can communicate with the browser through this <code>document</code> object to manipulate the DOM.</p>
<p>If you look at the <a target="_blank" rel="noopener" href="https://www.ecma-international.org/publications/standards/Ecma-262.htm">ECMAScript</a> documentation, you will find that there is no mention of <code>document</code> at all, because it is not part of the programming language itself, but is provided by the browser.</p>
<p>If you run JavaScript on a browser, we can call the browser the “runtime environment” of JavaScript, because JavaScript runs on it, which is very reasonable.</p>
<p>In addition to <code>document</code>, things like <code>setTimeout</code> and <code>setInterval</code> for timing, <code>XMLHttpRequest</code> and <code>fetch</code> for ajax, are all provided by the browser runtime environment.</p>
<p>If you switch to another runtime environment, will there be different things to use? In addition to the browser, are there other JavaScript runtime environments?</p>
<p>As it happens, there is, and you have heard of it, it’s called Node.js.</p>
<p>Many people think that it is a JavaScript library, but it is not, but it is easy to misunderstand because of the last two letters <code>.js</code>. If you feel that those two letters have been misleading you, you can temporarily call it Node.</p>
<p>Node.js is actually a runtime environment for JavaScript, as it says on its official website:</p>
<blockquote>
<p>Node.js® is a JavaScript runtime built on Chrome’s V8 JavaScript engine.</p>
</blockquote>
<p>So JavaScript code can choose to run in the browser, which can manipulate the screen or send requests through the environment provided by the browser, or it can choose to run on the Node.js environment, which provides different things.</p>
<p>So what does Node.js provide? For example, <code>fs</code>, which stands for file system, is an interface for controlling files, so JavaScript can read and write files on the computer! It also provides the <code>http</code> module, which allows JavaScript to write a server!</p>
<p>Please refer to the diagram below for details:</p>
<p><img src="/img/js-async/p1.png" alt="Execution environment diagram"></p>
<p>It can be seen clearly that when JavaScript is executed in different environments, the things that can be used are also different, depending on what the execution environment provides. Sharp-eyed people may notice that <code>setTimeout</code> appears in both environments in the above figure. Why is that?</p>
<p>Because both environments consider the timer function important, they both provide the <code>setTimeout</code> function for developers to use. Although the functions on the two environments are exactly the same, it should be noted that because the execution environments are different, the implementation and principles behind them are also different.</p>
<p>In addition, different execution environments will have different execution methods. For example, for browsers, you can use <code>&lt;script src=&quot;index.js&quot;&gt;</code> to import a JavaScript file and execute it in the browser. For Node.js, you must first install the Node.js execution environment on your computer, and then use the <code>node index.js</code> command in the CLI to execute it.</p>
<p>Let’s summarize the current key points:</p>
<ol>
<li>JavaScript is just a programming language and needs to be used with things provided by the execution environment, such as <code>setTimeout</code>, <code>document</code>, etc.</li>
<li>The two most common JavaScript execution environments are browsers and Node.js.</li>
<li>Different execution environments provide different things. For example, Node.js provides the http module, which allows JavaScript to write a server, but browsers do not provide such things.</li>
</ol>
<p>Next, we will start to introduce synchronous and asynchronous from the perspective of Node.js.</p>
<h2><span id="blocking-and-non-blocking">Blocking and Non-Blocking</span></h2><p>As mentioned earlier, Node.js provides an interface for controlling files, allowing us to write JavaScript to read and write files. Let’s take a look at some actual code:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span> <span class="token comment">// 引入內建 file system 模組</span>
<span class="token keyword">const</span> file <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./README.md'</span><span class="token punctuation">)</span> <span class="token comment">// 讀取檔案</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token comment">// 印出內容</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>The above code first imports the built-in module <code>fs</code> provided by Node.js, and then uses <code>fs.readFileSync</code> to read the file, and finally prints the contents of the file using <code>console.log</code>.</p>
<p>(Note: Actually, what is printed above is a <code>Buffer</code>. The complete code should be <code>file.toString(&#39;utf8&#39;)</code> to print the file content. But because this small detail does not affect understanding, it is deliberately ignored in the sample code.)</p>
<p>It seems like there is no problem… right?</p>
<p>If the file is small, there is indeed no problem, but what if the file is very large? For example, the file is 777 MB, and it may take a few seconds or even longer to read such a large file into memory.</p>
<p>When reading the file, the program will stop at the second line, wait for the file to be read, and then put the contents of the file into the <code>file</code> variable and execute the third line <code>console.log(file)</code>.</p>
<p>In other words, the <code>fs.readFileSync</code> method “blocks” the execution of subsequent instructions. At this time, we say that this method is blocking, because the execution of the program will block here until it is executed and the return value is obtained.</p>
<p>If some subsequent instructions are completely unrelated to reading the file, such as finding a certain string in the file, etc., then this method is actually not suitable. </p>
<p>For example, if we want to read a file and find even numbers between 1 and 99999999:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> file <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./README.md'</span><span class="token punctuation">)</span> <span class="token comment">// 在這邊等好幾秒才往下執行</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
  
<span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">99999999</span><span class="token punctuation">;</span> i<span class="token operator">+=</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
  
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>The above code will wait for a few seconds on the line that reads the file, and then execute the next part below, calculate the even numbers between 1 and 99999999, and print them out.</p>
<p>These two things have nothing to do with each other. Why should printing even numbers wait for the file to be read? Can’t these two things be done at the same time? Isn’t that more efficient?</p>
<p>There is indeed such a thing. There is another way to perform these two things at the same time.</p>
<p>The problem with <code>readFileSync</code> is that it will block the execution of subsequent code, just like when I go to a nearby braised food stall to buy braised food, I have to wait there after ordering, and I can’t go anywhere because I want to eat hot braised food. If I go home and come back every ten minutes, the braised food may have cooled down. I don’t want that. I didn’t buy ice braised food.</p>
<p>So I can only stand there and wait, feeling cold, in order to get the freshly cooked braised food as soon as possible.</p>
<p>The opposite of blocking is called non-blocking, which means that it will not block the execution of subsequent code, just like when I order food in the food court of a department store, the store will give me a pager (the fast food restaurant that is the main body of the red tea also has it). After I get the pager, I can go back to my seat and wait, or I can go shopping if I want to. When the meal is ready, the pager will ring, and I can go to the store to pick up the meal without waiting in place.</p>
<p>When it comes to reading files, how is it done in a non-blocking way? If subsequent code execution is not blocked, how can I get the contents of the file?</p>
<p>Just like how food delivery apps need to use a notification system to inform customers when their orders are ready, in JavaScript, to achieve non-blocking behavior, you need to provide a callback function to the file reading method so that it can notify you when the file has finished reading. In JavaScript, functions are suitable as callback functions!</p>
<p>This means “when the file has finished reading, please execute this function and pass the result into it”, and this function is called a callback function. Doesn’t the name sound perfect?</p>
<p>In addition to the blocking method <code>readFileSync</code>, the fs module in Node.js also provides another method called <code>readFile</code>, which is the non-blocking version of reading files that we mentioned earlier. Let’s take a look at what the code looks like:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 讀取內建 fs 模組</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
  
<span class="token comment">// 定義讀取檔案完成以後，要執行的 function</span>
<span class="token keyword">function</span> <span class="token function">readFileFinished</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
  
<span class="token comment">// 讀取檔案，第二個參數是 callback function</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./README.md'</span><span class="token punctuation">,</span> readFileFinished<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>It can be seen that the usage of <code>readFile</code> is similar to that of <code>readFileSync</code>, but the difference is:</p>
<ol>
<li><code>readFile</code> has an additional parameter, which is a function that needs to be passed in.</li>
<li><code>readFileSync</code> has a return value, which is the file content, but <code>readFile</code> does not seem to have one.</li>
</ol>
<p>This corresponds to what I said earlier, that the difference between blocking and non-blocking is that blocking methods will directly return results (and that’s why they block), but non-blocking methods can jump to the next line after executing the function, and the result will be passed into the callback function after the file has finished reading.</p>
<p>In the above code, <code>readFileFinished</code> is the callback function, which is the notification system for food delivery. “When the order is ready, let the notification system ring” is the same as “when the file has finished reading, call the callback function”.</p>
<p>Therefore, the explanation of the line <code>fs.readFile(&#39;./README.md&#39;, readFileFinished)</code> is simple: “Please read the file <code>./README.md</code>, and call <code>readFileFinished</code> after reading is complete, and pass the result into it.”</p>
<p>How do I know how the result will be passed in? This depends on the API documentation. For each method, the parameters passed in are different. For <code>readFile</code>, the official documentation is written like this:</p>
<p><img src="/img/js-async/p2.png" alt="readFile API documentation"></p>
<p>It clearly states that the first parameter of the callback is <code>err</code>, and the second parameter is <code>data</code>, which is the file content.</p>
<p>Therefore, <code>fs.readFile</code> simply reads the file in a non-blocking way and calls the callback function after reading is complete, passing the result into it.</p>
<p>Usually, callback functions use the anonymous function syntax to make them simpler. So the more common form is like this:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 讀取內建 fs 模組</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
  
<span class="token comment">// 讀取檔案</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./README.md'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>You can think of it as declaring a function directly at the second parameter, without a name, so it is called an anonymous function.</p>
<p>Since <code>readFile</code> is non-blocking, the subsequent code will be executed immediately, so let’s rewrite the even number version we found earlier to be non-blocking:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
  
<span class="token comment">/*
  原來的阻塞版本：
  
  const file = fs.readFileSync('./README.md') // 在這邊等好幾秒才往下執行
*/</span>
  
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./README.md'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
<span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">99999999</span><span class="token punctuation">;</span> i<span class="token operator">+=</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
  
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>This way, the system can do other things while waiting for the file to be read, without getting stuck there.</p>
<p>To summarize:</p>
<ol>
<li>Blocking means that the program will be stuck on that line until there is a result, such as <code>readFileSync</code>, which needs to wait for the file to finish reading before executing the next line.</li>
<li>Non-blocking means that the program will not be stuck, but the execution result will not be returned in the return value, but needs to be received through the callback function.</li>
</ol>
<h2><span id="synchronous-and-asynchronous">Synchronous and Asynchronous</span></h2><p>You may be wondering, “Didn’t you say you were going to talk about synchronous and asynchronous? Why hasn’t it been mentioned yet?”</p>
<p>Actually, we’ve already covered it.</p>
<p>According to the <a target="_blank" rel="noopener" href="https://nodejs.org/en/docs/guides/blocking-vs-non-blocking/">official Node.js documentation</a>:</p>
<blockquote>
<p>Blocking methods execute synchronously and non-blocking methods execute asynchronously.</p>
</blockquote>
<p><code>Sync</code> at the end of <code>readFileSync</code> means that this method is synchronous, indicating that it is a synchronous method. <code>readFile</code>, on the other hand, is asynchronous.</p>
<p>If you try to explain it literally in Chinese, it will be very painful, and you will think: “Isn’t synchronization simultaneous? It feels more like non-blocking, but why is it reversed?”</p>
<p>I got inspired from <a target="_blank" rel="noopener" href="https://www.ithome.com.tw/node/74544">Should programming be synchronous or asynchronous?</a>, which suggests that we just need to explain what “synchronization” means in the field of computers in a different way.</p>
<p>Now, imagine a group of people playing a three-legged race with their feet tied together. If we want them to “move in unison”, that is, to have everyone’s steps synchronized, how do we do it? Of course, everyone needs to coordinate and wait for each other. Those with faster feet need to slow down, and those with slower feet need to speed up. If you have already taken the first step, you have to wait for those who have not taken the first step yet. You can only start taking the second step after everyone has taken the first step.</p>
<p>Therefore, in order for different people to coordinate their steps and try to make everyone’s steps consistent, they must wait for each other, and this is synchronization.</p>
<p>Asynchronous is simple, it means the opposite. Although they are playing a three-legged race, they do not want to wait for each other. Everyone moves at their own pace, so it is possible that the person at the front has already reached the finish line, while the person at the back is still in the middle, because everyone’s steps are not synchronized.</p>
<p>Programming is the same. In the example mentioned earlier, which involves reading files and printing even numbers, synchronization means that everyone needs to coordinate and wait for each other. Therefore, you cannot print even numbers when the file is not yet read. You must wait until the file is read before you can print even numbers.</p>
<p>Asynchronous means that everyone does their own thing. You read your file, and I continue to print my even numbers. It doesn’t matter if everyone’s steps are not synchronized, because we are not synchronized in the first place.</p>
<p>In short, when discussing the issue of synchronous and asynchronous in JavaScript, you can basically equate asynchronous with non-blocking and synchronous with blocking. If you execute a synchronous method (such as <code>readFileSync</code>), it will definitely block; if you execute an asynchronous method (<code>readFile</code>), it will definitely not block.</p>
<p>However, let me add a little bit for you. If you are not discussing this issue in JavaScript but in other contexts, the answer will be different. For example, when you are looking up blocking and non-blocking as well as synchronous and asynchronous, you will definitely come across some information related to system I&#x2F;O, which I think is a discussion at a different level.</p>
<p>When you are discussing system or network I&#x2F;O, asynchronous and non-blocking are two different things, and synchronous and blocking are also two different things, with different meanings.</p>
<p>But if our context is limited to discussing the issue of synchronous and asynchronous in JavaScript, blocking is basically synchronous, and non-blocking is asynchronous. The <a target="_blank" rel="noopener" href="https://nodejs.org/en/docs/guides/blocking-vs-non-blocking/">official documentation of Node.js</a> mentioned earlier also mixes these two concepts.</p>
<p>Once we equate these two things, it is easy to understand what is synchronous and what is asynchronous. I will just summarize the key points of the previous paragraph:</p>
<ol>
<li>Synchronous means that the program will be stuck on that line until there is a result, such as <code>readFileSync</code>, which needs to wait for the file to be read before executing the next line.</li>
<li>Asynchronous means that it will not be stuck during execution, but the execution result will not be returned in the return value. Instead, it needs to be received through a callback function.</li>
</ol>
<h2><span id="synchronous-and-asynchronous-in-browsers">Synchronous and Asynchronous in Browsers</span></h2><p>So far, we have been using Node.js as an example, and now we are finally returning to the more familiar front-end browser.</p>
<p>When writing JavaScript in the front-end, there is a very common need, which is to connect with the backend API to retrieve data. Suppose we have a function called <code>getAPIResponse</code>, which can call the API to retrieve data.</p>
<p>The synchronous version looks like this:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token function">getAPIResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>What happens when it is synchronous? It will block the subsequent execution. Therefore, if the API server specification is poor and it takes 10 seconds to retrieve data, the entire JavaScript engine must wait for 10 seconds before executing the next instruction. When we use Node.js as an example, sometimes waiting for 10 seconds is acceptable, because only the person executing this program needs to wait for 10 seconds. I can go and browse Instagram and come back.</p>
<p>But can the browser accept waiting for 10 seconds?</p>
<p>Think about it. If the execution of JavaScript is frozen there for 10 seconds, it means that the thread that executes JavaScript (thread) is frozen for 10 seconds. In the browser, the main thread responsible for executing JavaScript is called the main thread, and the main thread responsible for processing and rendering the screen is also the main thread. In other words, if this thread is frozen for 10 seconds, it means that no matter how you click the screen, there will be no response, because the browser does not have the resources to handle these other things.</p>
<p>In other words, your screen looks like it has crashed.</p>
<p>(If you don’t know what a thread is, please refer to: <a target="_blank" rel="noopener" href="https://developers.google.com/web/updates/2018/09/inside-browser-part1">Inside look at modern web browser</a>, it is recommended to start reading from part1, and the main thread is in part3.)</p>
<p>Take a real-life example to illustrate: if you go to a store near your house to order a chicken cutlet, you have to wait on-site after ordering. If your friend comes to visit you and rings your doorbell, you won’t be able to respond because you’re not at home. Your friend will have to wait until you come back with the chicken cutlet to open the door for them.</p>
<p>However, if the store introduces an online queuing system, you can check the status of the chicken cutlet production through an app after ordering. You can go home and wait for the chicken cutlet while watching TV. If your friend comes and rings the doorbell, you can open the door for them directly, and they don’t have to wait.</p>
<p>“Waiting for the chicken cutlet” refers to “waiting for the response,” “opening the door for your friend” refers to “responding to the screen,” and “you” refer to the “main thread.” When you are busy waiting for the chicken cutlet, you cannot open the door for your friend.</p>
<p>You can create a simple demo to verify the frozen screen part yourself. Just create an HTML file like this:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>凍結那時間，凍結初遇那一天<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">var</span> delay <span class="token operator">=</span> <span class="token number">3000</span> <span class="token comment">// 凍結 3 秒</span>
    <span class="token keyword">var</span> end <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> delay
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'delay start'</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> end<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token punctuation">&#125;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'delay end'</span><span class="token punctuation">)</span>

  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>The principle is that the while loop inside will continuously check whether the time has arrived. If it hasn’t, it will continue to wait, so it will block the entire main thread. You can also refer to the gif below. Before the “delay end” appears, no matter how you highlight the text, it won’t work until the “delay end” appears:</p>
<p><img src="/img/js-async/fre.gif" alt="delay gif"></p>
<p>Can you accept a frozen screen? Even if you can, your boss or client cannot accept it. Therefore, it is impossible to perform such time-consuming operations synchronously in the front-end. Since it needs to be changed to asynchronous, according to what we learned before, it needs to be changed to use a callback function to receive the result:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 底下會有三個範例，都在做一模一樣的事情</span>
<span class="token comment">// 主要是想讓初學者知道底下三個是一樣的，只是寫法不同</span>
  
<span class="token comment">// 範例一</span>
<span class="token comment">// 最初學者友善的版本，額外宣告函式</span>
<span class="token keyword">function</span> <span class="token function">handleResponst</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token function">getAPIResponse</span><span class="token punctuation">(</span>handleResponst<span class="token punctuation">)</span>
  
<span class="token comment">// 範例二</span>
<span class="token comment">// 比較常看到的匿名函式版本，功能跟上面完全一樣</span>
<span class="token function">getAPIResponse</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  
<span class="token comment">// 範例三</span>
<span class="token comment">// 利用 ES6 箭頭函式簡化過後的版本</span>
<span class="token function">getAPIResponse</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>The full name of AJAX is “Asynchronous JavaScript and XML.” Asynchronous means sending the request asynchronously.</p>
<p>Here, we used a hypothetical function <code>getAPIResponse</code> for demonstration purposes, mainly to illustrate that “network operations cannot be performed synchronously in the front-end.” Next, let’s take a look at what the actual code for calling the backend API in the front-end will look like:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'https://jsonplaceholder.typicode.com/users/1'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
request<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">>=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>response<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
request<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>You may wonder: “Huh? Why does it look different? Where is the callback function?”</p>
<p>The callback function here is the function after <code>request.onload = </code>, and the meaning of this line is: “When the response comes back, please execute this function.”</p>
<p>At this point, sharp-eyed people may notice: “Huh? Why does <code>request.onload</code> look familiar?”</p>
<h2><span id="the-callback-that-is-strange-but-familiar-to-you">The callback that is strange but familiar to you</span></h2><p>The meaning of the callback function is actually: “When something happens, please use this function to notify me.” Although it may seem unfamiliar at first, you have been using it for a long time.</p>
<p>For example:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.btn_alert'</span><span class="token punctuation">)</span>
btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> handleClick<span class="token punctuation">)</span>
  
<span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'click!'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>“When something (someone clicks the .btn_alert button) happens, please use this function (handleClick) to notify me.” Isn’t <code>handleClick</code> a callback function?</p>
<p>Or:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'load!'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>“When something (the webpage finishes loading) happens, please use this function (anonymous function) to notify me.” Isn’t this also a callback function?</p>
<p>Here’s one last example:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">setTimeout</span><span class="token punctuation">(</span>tick<span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'時間到！'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>“When something (two seconds have passed) happens, please use this function (tick) to notify me.” It’s the same pattern.</p>
<p>When using a callback function, there is a common mistake that beginners often make, which must be paid special attention to. It has been said that the parameter passed in is a callback function, which is a “function,” not the result of executing the function (unless your function will return a function after execution, which is another matter).</p>
<p>For example, the standard error example would look like this:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'時間到！'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
  
<span class="token comment">// 或者是這樣</span>
window<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'load!'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>tick</code> is a function, and <code>tick()</code> executes a function and uses the return result as a callback function. In short, it’s like this:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 錯誤範例</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'時間到！'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
  
<span class="token comment">// 上面的錯誤範例等同於</span>
<span class="token keyword">let</span> fn <span class="token operator">=</span> <span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'時間到！'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Since <code>tick</code> will return undefined after execution, the setTimeout line can be seen as <code>setTimeout(undefined, 2000)</code>, which has no effect at all.</p>
<p>Writing a function as a function call will result in the screen still displaying the words “Time’s up!” but two seconds have not yet passed. Because writing it this way is equivalent to executing the tick function first.</p>
<p>The example of <code>window.onload</code> is the same and can be seen as follows:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 錯誤範例</span>
window<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'load!'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
  
<span class="token comment">// 上面的錯誤範例等同於</span>
<span class="token keyword">let</span> fn <span class="token operator">=</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
window<span class="token punctuation">.</span>onload <span class="token operator">=</span> fn<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>So the <code>load</code> function will be executed before the webpage is fully loaded.</p>
<p>To reiterate, <code>tick</code> is a function, and <code>tick()</code> is executing the function. These two have completely different meanings.</p>
<p>Let’s review the key points:</p>
<ol>
<li>The main thread that executes JavaScript in the browser is also responsible for rendering the screen. Therefore, asynchronous is more important and necessary, otherwise the screen will freeze while waiting.</li>
<li>The meaning of the callback function is actually: “When something happens, please use this function to notify me.”</li>
<li><code>fn</code> is a function, and <code>fn()</code> is executing the function.</li>
</ol>
<h2><span id="parameters-of-the-callback-function">Parameters of the Callback Function</span></h2><p>As mentioned earlier, you need to refer to the documentation to know what parameters the callback function needs. Let’s take the following button click as an example:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.btn_alert'</span><span class="token punctuation">)</span>
btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> handleClick<span class="token punctuation">)</span>
  
<span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'click!'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>From the <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/EventListener/handleEvent">MDN</a> documentation, you can see that it is written like this:</p>
<p><img src="/img/js-async/event.png"></p>
<p>An object called <code>event</code> will be passed in, and this object describes the event that occurred. It sounds abstract, but we can actually experiment with it:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.btn_alert'</span><span class="token punctuation">)</span>
btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> handleClick<span class="token punctuation">)</span>
  
<span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>When we click this button, we can see that the console prints an object with a lot of properties:</p>
<p><img src="/img/js-async/e.png"></p>
<p>If you look closely, you will find that this object actually describes the “click” just now, for example, <code>clientX</code> and <code>clientY</code> actually represent the coordinates of the click just now. The most commonly used one, which you must have heard of, is <code>e.target</code>, which can get the DOM object where the click event occurred.</p>
<p>However, at this point, beginners may have a question: “The documentation clearly states that the parameter passed in is called <code>event</code>, why can you use <code>e</code>?”</p>
<p>This is because when a function sends and receives parameters, it only cares about the “order”, not the name in the documentation. The name in the documentation is only for reference, and does not mean that you must use that name to receive it. The function is not so intelligent and will not judge which parameter it is based on the variable name.</p>
<p>So you can name your callback function parameters whatever you want, <code>handleClick(e)</code>, <code>handleClick(evt)</code>, <code>handleClick(event)</code>, or <code>handleClick(yoooooo)</code> can all get the <code>event</code> object passed by the browser, just different names.</p>
<p>What parameters the callback function will receive depends on the documentation. If there is no documentation, no one knows what parameters the callback will receive.</p>
<p>Although this is the case, in many places, parameters follow a convention.</p>
<h2><span id="error-first-convention-of-callbacks">Error First Convention of Callbacks</span></h2><p>In addition to callbacks, there is another huge difference between synchronous and asynchronous, which is error handling.</p>
<p>Going back to the synchronous file reading example we mentioned at the beginning:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span> <span class="token comment">// 引入內建 file system 模組</span>
<span class="token keyword">const</span> file <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./README.md'</span><span class="token punctuation">)</span> <span class="token comment">// 讀取檔案</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token comment">// 印出內容</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>If the file <code>./README.md</code> does not exist, an error message will be printed in the console after execution:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">fs<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">115</span>
    <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    <span class="token operator">^</span>
  
<span class="token literal-property property">Error</span><span class="token operator">:</span> <span class="token constant">ENOENT</span><span class="token operator">:</span> no such file or directory<span class="token punctuation">,</span> open <span class="token string">'./README.md'</span>
    at Object<span class="token punctuation">.</span><span class="token function">openSync</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">436</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>
    at Object<span class="token punctuation">.</span><span class="token function">readFileSync</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">341</span><span class="token operator">:</span><span class="token number">35</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>To handle this kind of error, you can use the <code>try...catch</code> syntax to wrap it:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span> <span class="token comment">// 引入內建 file system 模組</span>
  
<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> file <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./README.md'</span><span class="token punctuation">)</span> <span class="token comment">// 讀取檔案</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token comment">// 印出內容</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'讀檔失敗'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>When we wrap it with <code>try...catch</code>, we can handle the error. In the example above, “Reading file failed” will be output.</p>
<p>But if we switch to the asynchronous version, things are a bit different. Please take a look at the example code below first:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span> <span class="token comment">// 引入內建 file system 模組</span>
  
<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 讀取檔案</span>
  fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./README.md'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment">// 印出內容</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'讀檔失敗'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>After execution, the console has no response at all! Obviously, an error occurred, but it was not caught. Why is this?</p>
<p>This is another huge difference between synchronous and asynchronous.</p>
<p>In the synchronous version, we wait for the file to be read before executing the next line, so if there is an error when reading the file, the error will be thrown out, and we can try…catch to handle it.</p>
<p>But in the asynchronous version, the <code>fs.readFile</code> function only does one thing, which is to tell Node.js: “Go read the file, call the callback function after reading.” After doing this, it continues to execute the next line.</p>
<p>So we have no idea what happened when reading the file.</p>
<p>For example, this is like the inside and outside of a restaurant. Suppose I am responsible for the outside, and someone orders a bowl of beef noodles. I will shout to the kitchen: “A bowl of beef noodles!” and continue to serve the next customer. Did the kitchen really start making beef noodles? I don’t know, but it should. If the beef is sold out and cannot be made, I will not know when I shout.</p>
<p>So how will I know?</p>
<p>Assuming the beef is really sold out, the back kitchen will come to me proactively and tell me that the beef is sold out. Only then will I know that the beef is sold out.</p>
<p>This is just like the asynchronous example. That line is only responsible for telling the system to “read the file”. If something happens, you must actively tell it and use the callback method to pass it.</p>
<p>Let’s review the Node.js readFile document mentioned at the beginning:</p>
<p><img src="/img/js-async/p2.png" alt="readFile API documentation"></p>
<p>The callback will have two parameters, the first is err, and the second is data, so you know how err came about. Whenever there is an error in reading the file, such as the file does not exist, the file exceeds the memory size, or the file does not have permission to open, etc., it will be passed in through this err parameter. You cannot catch this error with try…catch.</p>
<p>Therefore, when we perform something asynchronously, there are two things we will definitely want to know:</p>
<ol>
<li>Whether there is an error, and if so, what is the error</li>
<li>The return value of this thing</li>
</ol>
<p>For example, when reading a file, we want to know if there is an error and also want to know the file content. Or when operating a database, we want to know if the command is wrong and also want to know what the returned data is.</p>
<p>Since we always want to know these two things asynchronously, it means that there will be at least two parameters, one is an error, and the other is a return value. The “error first” in the subtitle means that the error is usually placed in the first parameter “according to convention”, and other return values are placed in the second and subsequent parameters.</p>
<p>Why?</p>
<p>Because there is only one error, but there may be many return values.</p>
<p>For example, suppose there is a function called <code>getFileStats</code> that will asynchronously fetch the file status and return the file name, file size, file permissions, and file owner. If err is placed as the last parameter, our callback will look like this: <code>function cb(fileName, fileSize, fileMod, fileOwner, err)</code></p>
<p>I have to write out all the parameters clearly to get <code>err</code>. In other words, if I only want the file name and file size today, and I don’t care about the others, what should I do? There is nothing to do. I still have to write it so long because <code>err</code> is the last one.</p>
<p>If err is placed first, I only need to write: <code>function cb(err, fileName, fileSize)</code>, and I don’t need to write the later parameters if I don’t want to take them.</p>
<p>This is why err should be placed at the beginning, because we will always need err, but we may not need all the later parameters. Therefore, whenever you see a callback function, the first parameter usually represents an error message.</p>
<p>So it is very common to see this processing method, first check if there is an error and then do other things:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./README.md'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 如果錯誤發生，處理錯誤然後返回，就不會繼續執行下去</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">&#125;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Finally, there are three points to supplement. The first point is that “error first” is just a “convention”. The actual parameters passed depend on the document. You can also write an API that puts the error as the last parameter (but you shouldn’t do that).</p>
<p>The second point is that although it is asynchronous, it is still possible to catch errors using try catch, but the “type” of the error is different, for example:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
  
<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 讀取檔案</span>
  fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./README.md'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'讀檔失敗'</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token comment">// TypeError [ERR_INVALID_CALLBACK]: Callback must be a function</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>The error caught here is not the error generated by “reading the file”, but the error generated by “calling the read file this function”. Using the restaurant example mentioned earlier, it is like you know that the beef noodles are sold out when the customer orders, so you don’t need to ask the back kitchen, you can directly tell the customer: “Sorry, our beef noodles are sold out. Would you like to consider ordering something else?”</p>
<p>The last point I want to add is that some people may ask: “Then why don’t setTimeout or event listeners have the err parameter?”</p>
<p>That’s because the application scenarios of these few things are different.</p>
<p>The meaning of setTimeout is: “After n seconds, please call this function”, and the meaning of the event listener is: “When someone clicks the button, please call this function”.</p>
<p>These two things will not cause errors.</p>
<p>But when using readFile to read a file, errors may occur when reading the file; and XMLHttpRequest has onerror to catch asynchronous errors.</p>
<p>To summarize:</p>
<ol>
<li>The parameters of the callback function are the same as those of the general function, and they are based on “order” rather than name, and they are not so smart.</li>
<li>According to convention, the first parameter of the callback function is usually err, which is used to tell you whether an error has occurred (according to the first point, you can call it e, error, or fxxkingError).</li>
<li>Although it is asynchronous, it is still possible to catch errors using try catch, but that means that an error occurred when “calling the asynchronous function”.</li>
</ol>
<h2><span id="understanding-the-last-puzzle-of-asynchronous-event-loop">Understanding the last puzzle of asynchronous: Event loop</span></h2><p>We have talked so much about asynchronous, have you ever thought about how asynchronous is done?</p>
<p>Isn’t it often heard that JavaScript is single-threaded and only one thread is running? But if it is really single-threaded, how can it achieve asynchronous?</p>
<p>If you want to understand how asynchronous operations work, I highly recommend this video: <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=8aGhZQkoFbQ">What the heck is the event loop anyway? | Philip Roberts | JSConf EU</a>. Everyone who has watched it has praised it.</p>
<p>Once you’ve watched the video, you’ll understand how asynchronous operations work. Since the video is so well done, I’ll just summarize the key points below. Please watch the video before reading on. If you haven’t watched it yet, please do so.</p>
<p>In the execution of a program, there is something called the <code>call stack</code>, which basically records the resources needed for each function to execute, as well as the order in which functions are executed.</p>
<p>For example, consider the following code:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token number">1</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>We first call c, so the call stack looks like this (the example below will grow upwards):</p>
<pre class="line-numbers language-none"><code class="language-none">c<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>c calls b:</p>
<pre class="line-numbers language-none"><code class="language-none">b
c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>b calls a:</p>
<pre class="line-numbers language-none"><code class="language-none">a
b
c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>After a is executed, which function should it return to? It’s simple, remove a from the call stack, and the one on top is the one to return to:</p>
<pre class="line-numbers language-none"><code class="language-none">b
c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>Then b is executed and removed from the call stack:</p>
<pre class="line-numbers language-none"><code class="language-none">c<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Finally, c is executed, the call stack is cleared, and the program ends.</p>
<p>The call stack is where the order of function execution and other necessary things are recorded, and the well-known error stack overflow refers to when the stack is too full, such as when you recursively call a function 100,000 times and the stack can’t store so many things, resulting in a stack overflow error.</p>
<p>JavaScript’s “only one thread” means that there is only one call stack, so only one thing can be executed at a time.</p>
<p>So how does asynchronous programming work?</p>
<p>I only said that “JavaScript can only do one thing at a time,” but I didn’t say that “the execution environment is the same.”</p>
<p>For example, when reading a file, we can explain the asynchronous file reading code as “ask the system to read the file, and after the file is read, pass the result back through the callback function.” Behind the scenes, Node.js can use another thread to read the file, which is completely fine.</p>
<p>setTimeout is also the same. <code>setTimeout(fn, 2000)</code> just tells the browser, “Call the function fn after 2 seconds,” and the browser can use another thread to time it, rather than using the main thread.</p>
<p>The key is, when these other threads are done, how do they get back to the main thread? Because only the main thread can execute JavaScript, it must be returned, otherwise it won’t run.</p>
<p>This is what the event loop does.</p>
<p>Let’s start with a classic picture:</p>
<p><img src="/img/js-async/eventloop.png"><br>(Image source: <a target="_blank" rel="noopener" href="https://medium.com/@Rahulx1/understanding-event-loop-call-stack-event-job-queue-in-javascript-63dcd2c71ecd">Understanding Event Loop, Call Stack, Event &amp; Job Queue in Javascript</a> with a screenshot of codepen)</p>
<p>Let’s first explain the right side. Suppose we execute the code <code>setTimeout(fn, 2000)</code>. We first put <code>setTimeout(fn, 2000)</code> into the call stack to execute, and then <code>setTimeout</code> belongs to the Web API, so it will tell the browser, “Hey, set a timer for me, call fn after 2000 milliseconds,” and then it ends and is popped out of the call stack.</p>
<p>When the browser’s timer is up, it will put <code>fn</code> into the callback queue. Why is there a queue here? Because there may be many callback functions waiting to be executed, so there needs to be a queuing mechanism for everyone to line up here, one by one, so it’s called a callback queue, not a callback array or callback stack.</p>
<p>Then comes the key event loop, which plays a very simple role, which can be explained in plain language:</p>
<blockquote>
<p>Continuously detect whether the call stack is empty. If it is empty, put the things in the callback queue into the call stack.</p>
</blockquote>
<p>From a programming perspective, the reason why the event loop is called a loop is because it can be represented like this:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>callStack<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> callbackQueue<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 拿出 callbackQueue 的第一個元素，並放到 callStack 去</span>
    callStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>callbackQueue<span class="token punctuation">.</span><span class="token function">dequeue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>That’s it, it’s that simple.</p>
<p>It’s like many famous museums have crowd control. You have to buy a ticket first and then queue up. Then the guard at the door will let the people in the queue in when they see that the people in front have already moved on to the next attraction.</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>博物館入口沒有人 <span class="token operator">&amp;&amp;</span> 排隊的隊伍有人<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">放人進去博物館</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>The key point to remember here is that “asynchronous callback functions are first placed in the callback queue and are only thrown into the call stack by the event loop when the call stack is empty.”</p>
<p>The event loop is like a person who only talks and doesn’t do anything. It is not responsible for executing the callback function, it only helps you throw the function into the call stack, and the main thread of JavaScript is the one that actually executes it.</p>
<p>After understanding the event loop mechanism, we can explain asynchronous behavior. The video has already explained it clearly, so I won’t go into too much detail. I’ll just give a common example:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'0ms'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>Will “hello” be printed first, or will “0ms” be printed first, or is it uncertain?</p>
<p>If your answer is not “hello will be printed first”, it means that you haven’t understood the event loop mechanism, so please go back and watch the video again.</p>
<p>The callback function in the above example will be placed in the callback queue after 0ms, but please note that the call stack is not empty at this time, so <code>console.log(&#39;hello&#39;)</code> will be executed first. After it is executed, the call stack is cleared, and then the event loop throws the callback into the call stack and then executes <code>console.log(&#39;0ms&#39;)</code> inside the callback.</p>
<p>So the output order is guaranteed to be “hello” first, followed by “0ms”.</p>
<p>Finally, a few small supplements. The first is that passing 0 to <code>setTimeout</code> means “execute as soon as possible”, but it may not trigger after 0ms, it may be 4ms or longer. For details, please refer to: <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout#Reasons_for_delays_longer_than_specified">MDN: Reasons for delays longer than specified</a></p>
<p>The second supplement is that the event loop actually has a small detail, which is that the callback queue is also divided into two types: macro tasks and micro tasks, but this is a bit complicated, so I’ll talk about it later.</p>
<p>The third supplement is that although both Node.js and browsers have event loops, just like they both have <code>setTimeout</code>, the underlying principles and implementations are different. They are generally the same, but the details are different.</p>
<p>The fourth supplement is that the statement “only the main thread can execute JavaScript” is not correct, because there is a <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-TW/docs/Web/API/Web_Workers_API/Using_web_workers">Web Worker</a> in the browser that can be used.</p>
<h2><span id="asynchronous-quiz">Asynchronous Quiz</span></h2><p>After understanding the principle of the event loop for asynchronous operations, you should be quite familiar with the execution of asynchronous operations. Below, I will give some questions to verify whether you really understand:</p>
<h3><span id="1-event-website">1. Event Website</span></h3><p>Xiao Ming is a front-end engineer at a website that specializes in events. He was assigned a task by his supervisor to add a piece of code to call the backend API to get whether the event has started, and only go to the event page if it has started, otherwise do nothing.</p>
<p>Assuming that <code>getAPIResponse</code> is an asynchronous function that uses ajax to call the API and then gets the result, and the <code>/event</code> API returns JSON format data, where the <code>started</code> boolean field represents whether the event has started.</p>
<p>So Xiao Ming wrote the following code:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 先設一個 flag 並且設為 false，表示活動沒開始</span>
<span class="token keyword">let</span> isEventStarted <span class="token operator">=</span> <span class="token boolean">false</span>
  
<span class="token comment">// call API 並取得結果</span>
<span class="token function">getAPIResponse</span><span class="token punctuation">(</span><span class="token string">'/event'</span><span class="token punctuation">,</span> <span class="token parameter">response</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 判斷活動是否開始並設置 flag</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>started<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    isEventStarted <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  
<span class="token comment">// 根據 flag 決定是否前往活動頁面</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>isEventStarted<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">goToEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Question: Is there any problem with this code? If so, where is the problem?</p>
<h3><span id="2-waiting-slowly">2. Waiting Slowly</span></h3><p>After completing the event website, Xiao Ming felt that he still wasn’t very familiar with asynchronous operations, so he wanted to practice and wrote the following code:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> gotResponse <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token function">getAPIResponse</span><span class="token punctuation">(</span><span class="token string">'/check'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  gotResponse <span class="token operator">=</span> <span class="token boolean">true</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Received response!'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>gotResponse<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Waiting...'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>The meaning is that “waiting” will be continuously printed before the ajax response comes back, and it will stop only after receiving the response.</p>
<p>Question: Can the above code meet Xiao Ming’s needs? If not, please explain why.</p>
<h3><span id="3-strange-timer">3. Strange Timer</span></h3><p>The supervisor assigned Xiao Ming to fix a bug in the company’s code. He found this code block:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Welcome!'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token comment">// 後面還有其他程式碼，這邊先略過</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>What is the bug? The timer is supposed to display a message after 1 second, but after executing this code block (note that there is other code below, which is skipped for now), the alert only appears after 2 seconds.</p>
<p>Question: Is this possible? Regardless of whether you think it is possible or not, please try to explain why.</p>
<h3><span id="4-execution-order-test">4. Execution Order Test</span></h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">a</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>Question: What is the final output order? Is it “hello” then “a”, or “a” then “hello”, or is it uncertain?</p>
<hr>
<h3><span id="answer-1-event-website">Answer: 1. Event Website</span></h3><p>The answer is problematic. This code block mixes synchronous and asynchronous code, which is the most common mistake.</p>
<p>The event loop will only put the callback into the call stack when the call stack is empty. Therefore, the code that checks <code>isEventStarted</code> will be executed first. When this code is executed, even though the response has returned, the callback function is still waiting in the callback queue. Therefore, when checking <code>isEventStarted</code>, it will always be false.</p>
<p>The correct method is to put the logic for checking whether the event is started inside the callback, which ensures that the response is received before checking:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// call API 並取得結果</span>
<span class="token function">getAPIResponse</span><span class="token punctuation">(</span><span class="token string">'/event'</span><span class="token punctuation">,</span> <span class="token parameter">response</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 判斷活動是否開始並設置 flag</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>started<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">goToEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3><span id="answer-2-wait-slowly">Answer: 2. Wait Slowly</span></h3><p>The answer is no.</p>
<p>Remember the condition of the event loop? “When the call stack is empty, put the callback into the call stack.”</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>gotResponse<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Waiting...'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>This code block will execute continuously, becoming an infinite loop. Therefore, the call stack is always occupied, and the things in the callback queue cannot be put into the call stack.</p>
<p>Therefore, regardless of whether Xiao Ming’s original code has received a response or not, it will only print “waiting” continuously.</p>
<h3><span id="answer-3-strange-timer">Answer: 3. Strange Timer</span></h3><p>The answer is possible.</p>
<p>WebAPI will put the callback into the callback queue after one second. So why does it take two seconds to execute? Because the call stack is occupied for one second.</p>
<p>As long as the code below setTimeout does a lot of things and occupies one second, the callback will be put into the call stack after one second, for example:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Welcome!'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  
<span class="token comment">// 底下這段程式碼會在 call stack 佔用一秒鐘</span>
<span class="token keyword">const</span> end <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1000</span>
<span class="token keyword">while</span><span class="token punctuation">(</span>end <span class="token operator">></span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Therefore, setTimeout can only guarantee that it will execute “at least” after 1 second, but cannot guarantee that it will execute exactly after 1 second.</p>
<h3><span id="answer-4-execution-order-test">Answer: 4. Execution Order Test</span></h3><p>The answer is uncertain.</p>
<p>Because I didn’t say whether <code>a</code> is synchronous or asynchronous, don’t assume it’s asynchronous just because there is a callback.</p>
<p>My <code>a</code> can be implemented like this:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 同步執行 fn</span>
<span class="token punctuation">&#125;</span>
  
<span class="token function">a</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>The output will be “a” then “hello”.</p>
<p>It can also be implemented like this:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 非同步執行 fn</span>
<span class="token punctuation">&#125;</span>
  
<span class="token function">a</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>The output will be “hello” then “a”.</p>
<h2><span id="conclusion">Conclusion</span></h2><p>To understand asynchronous programming, you must take it step by step and not try to rush it.</p>
<p>This is also why the title is called “Become a Callback Master First”, because you must have a certain level of proficiency with callbacks before moving on to the next stage, which will make it much easier.</p>
<p>This article mainly aims to establish several important concepts for everyone:</p>
<ol>
<li>What is blocking? What is non-blocking?</li>
<li>What is synchronous? What is asynchronous?</li>
<li>What is the difference between synchronous and asynchronous?</li>
<li>Why do we need asynchronous programming?</li>
<li>What is a callback?</li>
<li>Why do we need callbacks?</li>
<li>The error-first convention of callbacks</li>
<li>What is the event loop? What does it do?</li>
<li>What are the common pitfalls of asynchronous programming?</li>
</ol>
<p>If you can fully understand this article and thoroughly understand the quiz at the end, I believe you should have no problem understanding asynchronous programming, and implementation will be much smoother. After understanding the basics of asynchronous programming and callbacks, the next article will discuss the problems and solutions encountered when using callback functions: Promises, and also briefly mention the newer syntax async&#x2F;await.</p>
<p>(There is currently no sequel, but I will add it when it is available.)</p>
<p>References:</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://nodejs.org/en/docs/guides/blocking-vs-non-blocking/">Overview of Blocking vs Non-Blocking</a></li>
<li><a target="_blank" rel="noopener" href="https://nodejs.org/en/knowledge/getting-started/control-flow/what-are-callbacks/">What are callbacks?</a></li>
<li><a target="_blank" rel="noopener" href="https://nodejs.org/en/knowledge/errors/what-are-the-error-conventions/">What are the error conventions?</a></li>
<li><a target="_blank" rel="noopener" href="https://cythilya.github.io/2018/10/30/callback/">你懂 JavaScript 嗎？#23 Callback</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=8aGhZQkoFbQ">What the heck is the event loop anyway? | Philip Roberts | JSConf EU</a></li>
</ol>

    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/en/tags/Front-end/">#Front-end</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/en/tags/JavaScript/">#JavaScript</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/2019/11/01/en/before-start-leetcode/">Tips for Beginners in Solving Programming Problems</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/2019/09/25/en/why-move-from-github-issue/">Moving from GitHub Issues back to Hexo</a>
            
        </span>
    </div>
    
</article>




<div class="comments">
    <h3 class="title is-4">Comments</h3>
    <script src="https://utteranc.es/client.js"
        repo="aszx87410/huli-blog"
        issue-term="title"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>

    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2024 Huli&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow" title="GitHub" target="_blank" rel="noopener" href="https://github.com/ppoffice/hexo-theme-minos">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
<div class="column is-narrow has-text-centered">
    <div class="dropdown is-up is-right is-hoverable" style="margin-top: -0.2em;">
        <div class="dropdown-trigger">
            <button class="button is-small" aria-haspopup="true">
                <span class="icon">
                    <i class="fas fa-globe"></i>
                </span>
                <span>English</span>
                <span class="icon is-small">
            <i class="fas fa-angle-down" aria-hidden="true"></i>
          </span>
            </button>
        </div>
        <div class="dropdown-menu has-text-left" role="menu" style="top:100%">
            <div class="dropdown-content">
            <!-- NOTE: 永遠回到首頁 -->
            
                <a href="/2019/10/04/javascript-async-sync-and-callback/" class="dropdown-item">
                    繁體中文
                </a>
            
            </div>
        </div>
    </div>
</div>

        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>



    
    
    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    



<script src="/js/script.js?v=3.js"></script>


    
</body>
</html>