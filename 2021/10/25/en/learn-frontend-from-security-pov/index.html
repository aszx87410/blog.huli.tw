<!DOCTYPE html>
<html class="has-navbar-fixed-top" lang="en">
<head>
    <meta charset="utf-8">
<title>Discovering My Lack of Front-end Knowledge through Cybersecurity - Huli&#39;s blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1">


<link href="https://blog.huli.tw/2021/10/25/en/learn-frontend-from-security-pov/" rel="alternate" hreflang="en" />


<link href="https://blog.huli.tw/2021/10/25/learn-frontend-from-security-pov/" rel="alternate" hreflang="x-default" />


            
<link href="https://blog.huli.tw/2021/10/25/learn-frontend-from-security-pov/" rel="alternate" hreflang="zh-TW" />
            





    
<link rel="canonical" href="https://blog.huli.tw/2021/10/25/en/learn-frontend-from-security-pov/">
    





    <meta name="description" content="This article is the text version of my presentation “Discovering the Depth of Front-end through Cybersecurity” at Modern Web 2021. The video of the talk is not yet available, but if you want to see th">
<meta property="og:type" content="article">
<meta property="og:title" content="Discovering My Lack of Front-end Knowledge through Cybersecurity">
<meta property="og:url" content="https://blog.huli.tw/2021/10/25/en/learn-frontend-from-security-pov/index.html">
<meta property="og:site_name" content="Huli&#39;s blog">
<meta property="og:description" content="This article is the text version of my presentation “Discovering the Depth of Front-end through Cybersecurity” at Modern Web 2021. The video of the talk is not yet available, but if you want to see th">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://blog.huli.tw/img/learn-frontend-from-security-pov/cover-en.png">
<meta property="article:published_time" content="2021-10-24T15:00:00.000Z">
<meta property="article:modified_time" content="2025-02-28T13:05:15.759Z">
<meta property="article:author" content="Huli">
<meta property="article:tag" content="Front-end">
<meta property="article:tag" content="Security">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://blog.huli.tw/img/learn-frontend-from-security-pov/cover-en.png">



<link rel="alternative" href="/atom.xml" title="Discovering My Lack of Front-end Knowledge through Cybersecurity" type="application/atom+xml">



<link rel="icon" href="/img/lidemy_logo.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">


<link rel="stylesheet" href="/css/bulma.css?v=2.css">



<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" />


<link rel="stylesheet" href="/css/style.css?v=4.css">





    
    
    
    
    
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1393J2EVCZ"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1393J2EVCZ');
</script>


    


<meta name="generator" content="Hexo 6.3.0"></head>
<body>
    <script>
        if (localStorage.getItem('dark-mode')) {
            if (localStorage.getItem('dark-mode') === 'true') {
                document.body.classList.add('dark-mode')
            }
        } else {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark-mode')
            }
        }
    </script>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/en">
                
                    
                    Huli&#39;s blog
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/en/archives">Archive</a>
            
            <a class="navbar-item "
               href="/en/categories">Categories</a>
            
            <a class="navbar-item "
               href="/en/about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            
            <div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc">
                <a class="navbar-item" title="Table of Contents">
                    Table of Contents
                </a>
                <div class="navbar-dropdown">
                    
                    
                    
                    
                    <a class="navbar-item" href="#i-didnt-know-front-end">1&nbsp;&nbsp;<b>I Didn’t Know Front-end</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#word-limit">1.1&nbsp;&nbsp;Word Limit</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#xs-leaks">2&nbsp;&nbsp;<b>XS leaks</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#search-and-download">2.1&nbsp;&nbsp;Search and Download</a>
                    
                    
                    
                    <a class="navbar-item" href="#the-mystery-of-id">2.2&nbsp;&nbsp;The mystery of id</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#other-features-you-might-not-know">3&nbsp;&nbsp;<b>Other Features You Might Not Know</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#reading-cookies-from-different-paths">3.1&nbsp;&nbsp;Reading Cookies from Different Paths</a>
                    
                    
                    
                    <a class="navbar-item" href="#reading-pdf-content">3.2&nbsp;&nbsp;Reading PDF Content</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#conclusion">4&nbsp;&nbsp;<b>Conclusion</b></a>
                    
                </div>
            </div>
            
            
            <a class="navbar-item" target="_blank" title="Twitter" href="https://twitter.com/aszx87410">
                
                <i class="fab fa-twitter"></i>
                
            </a>
               
            <a class="navbar-item" target="_blank" title="RSS" href="/atom-en.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
               
            
            <a class="navbar-item btn-dark-mode" title="dark-mode" href="#">
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="15" height="15" viewBox="0 0 256 256" xml:space="preserve">
                    <defs>
                    </defs>
                    <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)" >
                        <path d="M 87.823 60.7 c -0.463 -0.423 -1.142 -0.506 -1.695 -0.214 c -15.834 8.398 -35.266 2.812 -44.232 -12.718 c -8.966 -15.53 -4.09 -35.149 11.101 -44.665 c 0.531 -0.332 0.796 -0.963 0.661 -1.574 c -0.134 -0.612 -0.638 -1.074 -1.259 -1.153 c -9.843 -1.265 -19.59 0.692 -28.193 5.66 C 13.8 12.041 6.356 21.743 3.246 33.35 S 1.732 57.08 7.741 67.487 c 6.008 10.407 15.709 17.851 27.316 20.961 C 38.933 89.486 42.866 90 46.774 90 c 7.795 0 15.489 -2.044 22.42 -6.046 c 8.601 -4.966 15.171 -12.43 18.997 -21.586 C 88.433 61.79 88.285 61.123 87.823 60.7 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: #ffa716; fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                    </g>
                    </svg>
                </div>
            </a>
            
               <a class="navbar-item" href="/2021/10/25/learn-frontend-from-security-pov/">中文</a>
            
            

        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
      
      <div data-nosnippet class="self-notice">
        If you have any thoughts on my blog or articles and you want to let me know, you can either post a comment below(public) or tell me via this <a href="https://forms.gle/SjJZ4cnNs6NnjXQG8" target="_blank">feedback form</a>
      </div>
      
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            Discovering My Lack of Front-end Knowledge through Cybersecurity
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2021-10-24T15:00:00.000Z" itemprop="datePublished">25 October 2021</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/en/categories/Security/">Security</a>
        </span>
        
        
        
        <spen data-nosnippet class="column is-narrow">(Translated by ChatGPT)</span>
        
    </div>
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>This article is the text version of my presentation “Discovering the Depth of Front-end through Cybersecurity” at Modern Web 2021. The video of the talk is not yet available, but if you want to see the slides, you can find them here: <a target="_blank" rel="noopener" href="https://speakerdeck.com/aszx87410/jie-chu-zi-an-cai-fa-xian-qian-duan-de-shui-zhen-shen-modern-web-2021">slides</a></p>
<p>I personally think that the combination of video and slides would be better than text alone, but I thought it would be nice to have a written record, so I wrote this article. The content may differ slightly from the video, as it’s like rewriting it.</p>
<span id="more"></span>
<h2><span id="i-didnt-know-front-end">I Didn’t Know Front-end</span></h2>
<p>This title is my most genuine thought after entering the world of cybersecurity.</p>
<p>As a front-end engineer, I thought I was quite familiar with front-end development. I have used or heard of native JavaScript, as well as some frameworks or libraries. I wasn’t too surprised when I saw many strange JavaScript questions, and I thought there was nothing that could make me say “Wow!”.</p>
<p>It wasn’t until I came into contact with cybersecurity-related things that I realized how naive I was.</p>
<p><img src="/img/learn-frontend-from-security-pov/p1-ice.jpg" alt></p>
<p>The front-end that front-end engineers encounter is different from the front-end that cybersecurity engineers see. The focus of cybersecurity is on various attack methods, finding ways to bypass existing restrictions and finding a new path. But front-end engineers don’t need to know those things because they write code in an unrestricted environment.</p>
<!-- summary -->
<p>Recently, I played some CTF and looked at front-end from another perspective. I learned a lot of new front-end knowledge. In other words, I re-learned the knowledge of my familiar field (front-end) in a new field (cybersecurity). This feeling is very special, so I want to share with you some of the things I learned in this article, hoping to make you feel the same surprise I felt at the beginning.</p>
<!-- summary -->
<p>This article is divided into three main topics:</p>
<ol>
<li>Bypassing various restrictions</li>
<li>XS leaks</li>
<li>Other features you may not know</li>
</ol>
<p>A simplest and most intuitive XSS payload would look like this:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>However, this form of XSS is not interesting enough and is easily defendable, so let’s not talk about it for now and look at some more interesting ones, such as this:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>non_exist</span> <span class="token special-attr"><span class="token attr-name">onerror</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span></span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>This HTML uses event handlers to execute JavaScript. We load a non-existent image, which triggers the onerror event and executes the code inside. It is also worth noting that the attribute does not need to be enclosed in <code>&quot;&quot;</code>.</p>
<p>We can go further and make it look like this:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token special-attr"><span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span></span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>This time, we don’t even need a src, we just use <code>&lt;svg&gt;</code> with the <code>onload</code> event to execute the code.</p>
<p>Suppose Xiaoming is a backend engineer responsible for filtering these input strings to prevent XSS vulnerabilities. In addition to filtering <code>&lt;script&gt;</code>, Xiaoming also filters spaces. The reason is simple: for XSS that uses attributes to execute, there must be a space between the attribute and the tag, right? Once the spaces are filtered out, it is impossible to use attributes for XSS, right?</p>
<p>Naive Xiaoming hit a wall because it can be done like this:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">&lt;svg/onload=alert(1)>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span>    <span class="token special-attr"><span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span></span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span>
<span class="token special-attr"><span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span></span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>In addition to spaces, <code>/</code>, tabs, and line breaks are all valid separators, so replacing only spaces is useless.</p>
<p>After Xiaoming learned this rule, he realized that the real problem was not spaces, but event handlers starting with <code>onxxx</code>. So he filtered out all attributes starting with on, thinking, “If there is no event handler, there is no XSS, right?”</p>
<p>It sounds very reasonable, but what he didn’t know was that even without event handlers, it can still be done like this:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">&lt;iframe/src="javascript:alert(1)"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>The string starting with <code>javascript:</code> is called a JavaScript pseudo protocol, which can be used in some places to execute code. We mentioned this feature in our previous post, “Open Redirect: What to Watch Out for When Implementing Redirect Functionality.”</p>
<p>Little Ming’s defense failed again, so he had to strengthen it again. He replaced the seemingly dangerous string <code>javascript</code> with something else. Shouldn’t that be enough to fix it?</p>
<p>Little did he know that inserting a tab between the letters of <code>javascript</code> still worked:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">&lt;iframe/src="javas    cript:alert(1)"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Little Ming fixed the code by replacing all the unnecessary things like spaces, blank lines, or tabs with empty strings, and then checked again for <code>javascript</code>. If it was found, it was filtered out. This way, the payload above would not work.</p>
<p>But Little Ming forgot that information on web pages can be encoded. For example, if you want to display <code>&lt;h1&gt;</code> on the screen, you need to encode it as <code>&amp;lt;h1&amp;gt;</code>. This way, the screen displays what you want, rather than interpreting it as an h1 tag. In addition to those special symbols, regular text can also be encoded using <code>&amp;#&#123;ascii_code&#125;;</code>. For example, the ascii code for <code>j</code> is 106, so it can be encoded as <code>&amp;#106;</code>:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">&lt;iframe/src="<span class="token entity" title="&#106;">&amp;#106;</span>avascript:alert(1)"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>If you want, you can encode the entire string, leaving only some symbols and numbers.</p>
<p>Annoyed Little Ming gave up and disabled the <code>src</code> attribute, thinking, “If I disable src, everything will be fine, right? Don’t bother me anymore!”</p>
<p>But he forgot that <code>&lt;a&gt;</code> can also use this attribute:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">&lt;a/href="<span class="token entity" title="&#106;">&amp;#106;</span>avascript:alert(1)">Click me<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>This time, it won’t trigger automatically. The user needs to click it to trigger it.</p>
<p>Finally, Little Ming couldn’t take it anymore, so he covered it with <a target="_blank" rel="noopener" href="https://github.com/cure53/DOMPurify">DOMPurify</a> and ended this round.</p>
<p>In addition to these tag and attribute bypasses, JavaScript itself is also quite interesting to bypass. For example, “Is there a way to execute a function without using <code>()</code>?”</p>
<p>If you’ve used React’s styled-components or something similar, you’ve probably written code like this:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> Box <span class="token operator">=</span> styled<span class="token punctuation">.</span>div<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  background: red;
</span><span class="token template-punctuation string">`</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>Why does this generate a component? This is because backticks can be used not only as template strings, but also as function calls. I mentioned this in <a href="https://blog.huli.tw/2021/06/07/xss-challenge-by-intigriti-writeup-may/">Intigriti’s 0521 XSS Challenge Solution: Limited Character Combination Code</a>.</p>
<p>So you can write it like this:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">alert<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">1</span><span class="token template-punctuation string">`</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>But what if you can’t even use backticks now? Is there any other way?</p>
<p>There is a method that I admired for a long time when I first saw it:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">onerror<span class="token operator">=</span>alert<span class="token punctuation">;</span><span class="token keyword">throw</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>It rewrites <code>window.onerror</code> to <code>alert</code>, and then throws an error. This error is caught by <code>window.onerror</code> because it is not caught, and finally executed in the alert.</p>
<p>In addition to alert, any code can be executed by rewriting it:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">onerror<span class="token operator">=</span>eval<span class="token punctuation">;</span>
<span class="token keyword">throw</span> <span class="token string">"=alert\x281\x29"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>The first line is the same as before, except that this time <code>onerror</code> is changed to <code>eval</code>. But what is the second line doing? Let’s talk about the encoding of <code>()</code> first, which are <code>\x28</code> and <code>\x29</code>, respectively.</p>
<p>But why is there an <code>=</code> in front?</p>
<p>This is because when the error is thrown, if it is Chrome, the string it finally generates is: <code>Uncaught &#123;err_message&#125;</code>, such as <code>throw 1</code>, which will generate <code>Uncaught 1</code>. But this is not a JavaScript code, and it will directly throw an error when thrown into <code>eval</code>.</p>
<p>So we throw <code>&quot;=alert\x281\x29&quot;</code>, which becomes <code>Uncaught=alert\x281\x29</code>, and the whole sentence becomes an expression. <code>Uncaught</code> is treated as an undeclared global variable, and its value is the return value of <code>alert(1)</code>. In this way, the entire error message becomes legal JavaScript code! Using this method to throw to <code>eval</code>, it can be executed normally.</p>
<p>In fact, there are some more amazing methods, but the space is limited and some of them I am still trying to understand, so let’s stop here. The following figure summarizes:</p>
<p><img src="/img/learn-frontend-from-security-pov/p2-explosion.jpg" alt></p>
<h3><span id="word-limit">Word Limit</span></h3>
<p>In addition to the above attribute and character restrictions, there is another restriction called word limit.</p>
<p>For example, if a website’s nickname has an XSS vulnerability, but can only enter up to 25 characters, in this case, only popping up an alert is not powerful. Can you execute any code?</p>
<p>The shortest XSS payload <code>&lt;svg/onload=&gt;</code> already has 13 characters, leaving us with only 12 characters to execute the code. At this point, we need to use a technique called “using existing information,” like this:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 13 + 18 = 31 characters</span>
<span class="token operator">&lt;</span>svg<span class="token operator">/</span>onload<span class="token operator">=</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">'</span><span class="token template-punctuation string">`</span></span><span class="token operator">+</span>location<span class="token punctuation">)</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>This short code hides a lot of details. First of all, if you want to get the URL, how would you do it? <code>location.href</code>? A shorter way is to convert <code>location</code> to a string, and you can still get the URL. But the URL itself is not valid code, so we need to add a single quote in front of it, and then use the <code>#</code> on the URL, like this: <code>https://example.com#';alert(1)</code>. Concatenate it with a single quote, and it becomes:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token string">'https://example.com#'</span><span class="token punctuation">;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>This is a valid JavaScript code because it becomes a string followed by a command!</p>
<p>In addition to <code>location</code>, <code>document.URL</code> can also get the URL, but it has more characters than <code>location</code>. However, did you know that <code>document</code> can be omitted, like this:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 13 + 13 = 26 characters</span>
<span class="token operator">&lt;</span>svg<span class="token operator">/</span>onload<span class="token operator">=</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">'</span><span class="token template-punctuation string">`</span></span><span class="token operator">+</span><span class="token constant">URL</span><span class="token punctuation">)</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>Why don’t we need to write <code>document</code>? This is because there is a hidden specification. In the inline code of the event handler, the default scope will have <code>document</code>:</p>
<p><img src="/img/learn-frontend-from-security-pov/p3-spec.jpg" alt></p>
<p>It is also obvious when viewed with a debugger. Therefore, even if we only enter URL, we can still find <code>document.URL</code> due to the scope and the relationship with <code>with</code>.</p>
<p><img src="/img/learn-frontend-from-security-pov/p4-debugger.jpg" alt></p>
<p>We are only one character away from being under 25 characters. Are there any other tricks? Yes, please take a look at the code below. What do you expect the output to be?</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">name <span class="token operator">=</span> <span class="token number">123</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> name <span class="token operator">===</span> <span class="token string">'number'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>It should be true, right? 123 is a number, which is very reasonable! But if you actually run it on a browser, you will find that the output is false because <code>typeof name</code> is a string!</p>
<p>This is because <code>name</code> is a special attribute that represents the name of the window or, simply put, the name of the page. In other words, even if the content is different, the same page will still share the same name!</p>
<p>Suppose the website I want to attack is <a target="_blank" rel="noopener" href="http://example.com">example.com</a> and my website is <a target="_blank" rel="noopener" href="http://huli.tw">huli.tw</a>. I can write it like this on my website:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
  name <span class="token operator">=</span> <span class="token string">'alert(1)'</span>
  window<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">'http://example.com'</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>After setting the name, jump to the target website and then enter this payload:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 13 + 10 = 23 characters</span>
<span class="token operator">&lt;</span>svg<span class="token operator">/</span>onload<span class="token operator">=</span><span class="token function">eval</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>Because of the sharing of <code>name</code>, I can successfully execute the code I want. This time, it only takes 23 characters, successfully compressed within 25 characters.</p>
<p>There is a website called <a target="_blank" rel="noopener" href="https://tinyxss.terjanq.me/">Tiny XSS Payloades</a>, which specializes in collecting these short payloads. There are more strange payloads inside. If necessary, you can refer to them. The payloads I know are also from this website.</p>
<h2><span id="xs-leaks">XS leaks</span></h2>
<p>After talking about some bypasses of restrictions, let’s take a look at another topic called Cross-Site Leaks (abbreviated as XS Leaks). This attack is actually a side-channel attack on the webpage. Regarding side-channel attacks, I mentioned it before in <a href="https://blog.huli.tw/2021/02/19/cors-guide-5/">CORS Complete Manual (5): Security Issues of Cross-Origin</a>, using the well-known Spectre as an example.</p>
<p>What is a side-channel attack? It means that you indirectly obtain information through some methods. For example, suppose you have a light bulb in front of you, but you can’t see it at all, and you can’t even feel the light source. How do you know if the light bulb is on or off?</p>
<p>One way is through “temperature”, because if the light bulb is on, it will emit light and may generate heat (assuming this premise is true and ignoring some edge cases, just for example). Therefore, when you touch the light bulb, you can feel the heat, which indirectly tells you whether the light bulb is on or off.</p>
<p>If we apply this concept to a webpage, it is similar. We can indirectly obtain information on the webpage through some methods. Let’s look at two examples.</p>
<h3><span id="search-and-download">Search and Download</span></h3>
<p>Suppose there is a website with a search and download function, and you can directly enter the string you want to search in the query string, for example, <code>https://example.com/download?q=example</code>. If there is no matching data in the database, a “No user found” page will appear:</p>
<p><img src="/img/learn-frontend-from-security-pov/p5-search1.png" alt></p>
<p>On the other hand, if there is data, the native file download window will pop up directly, allowing you to download the corresponding file:</p>
<p><img src="/img/learn-frontend-from-security-pov/p6-search2.png" alt></p>
<p>As an attacker, what can we do with this information?</p>
<p>Suppose I have my own website with the URL <code>https://huli.tw</code>, and then I embed the example website just now using an iframe on my website:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> iframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span>
iframe<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"https://example.com/download?q=user01"</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>At this critical moment, if the data of <code>user01</code> does not exist in the database, an error will occur when I try to access <code>iframe.contentWindow.origin</code>. This is because <code>huli.tw</code> and <code>example.com</code> are not the same origin websites, so they are blocked by the browser’s Same-Origin Policy.</p>
<p>But! If the data of <code>user01</code> exists in the database, won’t the download screen pop up directly? At this time, if I try to access <code>iframe.contentWindow.origin</code>, there will be no error because I will get the result of <code>null</code>.</p>
<p>Therefore, based on the result of accessing <code>iframe.contentWindow.origin</code>, we can know whether a certain keyword exists in the database:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> iframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span>
iframe<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"https://example.com/download?q=user01"</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span>

<span class="token comment">// 先假設一秒後會載入完畢，可以做到更精確但先跳過</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        iframe<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span>origin
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'使用者存在'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'使用者不存在'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>This is XS leaks. We are clearly on website A, but we can use some techniques to obtain information from website B.</p>
<p>The complete attack implementation will extend the above attack script, for example, testing <code>a</code> first and then testing <code>b</code>, and so on. If <code>b</code> is found to exist, then repeat the above process to test <code>ba</code>, <code>bb</code>, etc., in this way, at least one set of user accounts can be leaked. Then, just send the link of this webpage to someone who has permission to access the <code>https://example.com/download</code> page and is logged in, and the attack will be launched when they click on it.</p>
<p>Although the pre-steps may sound a bit complicated, it is indeed a feasible attack method.</p>
<h3><span id="the-mystery-of-id">The mystery of id</span></h3>
<p>Suppose there is a social networking site that boasts extremely high privacy. You cannot see who your friends’ friends are, cannot see mutual friends, so you don’t know who is friends with whom, only know who your friends are.</p>
<p>You and David, whose user id is 123, are good friends, so when you click on his profile page: <code>http://example.com/users/123</code>, you will see a “Send Message” button, and the id of the button is message:</p>
<p><img src="/img/learn-frontend-from-security-pov/p7-id1.png" alt></p>
<p>And you and Peter, whose user id is 210, are not friends, so when you click on his page, you will see another button called “Add Friend”, and the id is add:</p>
<p><img src="/img/learn-frontend-from-security-pov/p8-id2.png" alt></p>
<p>This sounds reasonable, and the implementation of elements with id on the webpage is perfectly reasonable. However, this also poses a risk of XS leaks.</p>
<p>The browser has a user-friendly feature that you may or may not have noticed. When you add <code>#id</code> to the end of a URL, the browser automatically jumps to the paragraph with that id and focuses on the element (if it can be focused). The anchor function of the article relies on this to jump to a specific paragraph.</p>
<p>Therefore, when I connect to <code>http://example.com/users/123#message</code>, if I am friends with the person with id 123, the “Send Message” button will appear on the page, and the browser will jump to the button and focus on it. What if I am not friends with 123? Then nothing will happen. So we can use this difference to know whether the person with id 123 is a friend of the current user.</p>
<p>The method is similar to the search and download just now. We need to embed the target webpage in an iframe. If this id exists, the iframe will focus, and the original body will blur:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">window<span class="token punctuation">.</span><span class="token function-variable function">onblur</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'是好友'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> iframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span>
iframe<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'https://example.com/users/123#message'</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Then send this webpage to someone who wants to know their friend status. When they open the webpage, you can know whether they are good friends with 123. If the id of this website is a serial number, you can traverse each id and find out who is in their friend list.</p>
<p>The above are two examples of XS leaks, both achieved through some browser or JS features. If you are interested in these, you can refer to: <a target="_blank" rel="noopener" href="https://xsleaks.dev/">XS-Leaks Wiki</a>, where there are more interesting cases (these I know are also from this website).</p>
<p>If you want to see actual examples of XS leaks, there are many here: <a target="_blank" rel="noopener" href="https://terjanq.github.io/Bug-Bounty/Google/cache-attack-06jd2d2mz2r0/index.html">Mass XS-Search using Cache Attack</a>, and this recent one is also interesting: <a target="_blank" rel="noopener" href="https://jub0bs.com/posts/2021-10-12-xsleak-stack/">Abusing Slack’s file-sharing functionality to de-anonymise fellow workspace members</a></p>
<h2><span id="other-features-you-might-not-know">Other Features You Might Not Know</span></h2>
<p>In the last paragraph, I want to share some “you might not know” features, or more precisely, features that surprised me when I found out about them. I never thought they could be done.</p>
<h3><span id="reading-cookies-from-different-paths">Reading Cookies from Different Paths</span></h3>
<p>When setting cookies, there are many parameters that can be set, one of which is called path. For example, if I set the cookie’s path to <code>/siteA</code>, then when I’m on <code>/siteB</code>, I can’t read the cookie from <code>/siteA</code> because the paths are different, so I can’t get it.</p>
<p>But actually, it’s not necessarily true. If your website doesn’t block iframe embedding and the cookie isn’t set to HttpOnly, you can use an iframe to read cookies from different paths:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 假設我們在 https://example.com/siteA</span>
<span class="token keyword">const</span> iframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span>
iframe<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'https://example.com/siteB'</span>
iframe<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> 
  <span class="token function">alert</span><span class="token punctuation">(</span>iframe<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>This is because <code>https://example.com/siteA</code> and <code>https://example.com/siteB</code> are the same origin even though their paths are different. Therefore, you can directly access the document of other same-origin web pages through an iframe and use this feature to get <code>document.cookie</code>.</p>
<p>If iframe is not supported, <code>window.open</code> can achieve the same effect:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> win <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'//example.com/siteB'</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>win<span class="token punctuation">.</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>However, it should be noted that <code>window.open</code> is blocked by default and requires user permission to open, or the user needs to perform an action to execute it (such as putting the above code in a button onclick).</p>
<p>Later, I found that section 8.5: Weak Confidentiality of <a target="_blank" rel="noopener" href="https://datatracker.ietf.org/doc/html/rfc6265#section-8.5">RFC 6265</a> also mentioned this (strange, I didn’t notice it when I read it before):</p>
<blockquote>
<p>Cookies do not always provide isolation by path. Although the network-level protocol does not send cookies stored for one path to another, some user agents expose cookies via non-HTTP APIs, such as HTML’s document.cookie API.  Because some of these user agents (e.g., web browsers) do not isolate resources received from different paths, a resource retrieved from one path might be able to access cookies stored for another path.</p>
</blockquote>
<h3><span id="reading-pdf-content">Reading PDF Content</span></h3>
<p>Suppose your website embeds a same-origin PDF file, like this:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>embed</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/test.pdf<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>How do you use JS to read the content inside this PDF? The answer must be fetch or xhr:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"/test.pdf"</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'pdf'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>But what if fetch doesn’t work? For example, the server blocks requests from fetch on the backend (using <a target="_blank" rel="noopener" href="https://web.dev/fetch-metadata/">Fetch Metadata</a>). What should you do then? Is there any way to read the content of the PDF?</p>
<p>I used to think it was impossible until I learned about a hidden <a target="_blank" rel="noopener" href="https://source.chromium.org/chromium/chromium/src/+/master:chrome/browser/resources/pdf/pdf_viewer.js;l=770">Chrome API</a>:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** @override */</span>
<span class="token function">handleScriptingMessage</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">handleScriptingMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">delayScriptingMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">switch</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span>data<span class="token punctuation">.</span>type<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token string">'getSelectedText'</span><span class="token operator">:</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>pluginController_<span class="token punctuation">.</span><span class="token function">getSelectedText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleSelectedTextReply</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'getThumbnail'</span><span class="token operator">:</span>
      <span class="token keyword">const</span> getThumbnailData <span class="token operator">=</span>
          <span class="token comment">/** @type &#123;GetThumbnailMessageData&#125; */</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> page <span class="token operator">=</span> getThumbnailData<span class="token punctuation">.</span>page<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>pluginController_<span class="token punctuation">.</span><span class="token function">requestThumbnail</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendScriptingMessage</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'print'</span><span class="token operator">:</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>pluginController_<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'selectAll'</span><span class="token operator">:</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>pluginController_<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>From this code, you can see two commands, <code>selectAll</code> and <code>getSelectedText</code>. The former can select all the content of the PDF, and the latter can get the selected text. Therefore, by combining these two, you can get the text content inside the PDF:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// HTML: &lt;embed id="f" onload="loaded()" src="..."></span>

window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'getSelectedTextReply'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">.</span>selectedText<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">loaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  f<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'selectAll'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span>
  f<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'getSelectedText'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>A simple demo webpage: <a target="_blank" rel="noopener" href="https://aszx87410.github.io/demo/mw2021/05-pdf/index.html">https://aszx87410.github.io/demo/mw2021/05-pdf/index.html</a></p>
<p>Although this trick can only be used on text, this hidden feature is really exciting.</p>
<h2><span id="conclusion">Conclusion</span></h2>
<p>To supplement, some of the above attacks may not be applicable to all environments. For example, some attacks require that the website does not block iframes, and cookies used for authentication may not be set to SameSite, otherwise they will be invalid. The method of using name to pass payload may not be applicable in some browsers, but I think this does not affect the interestingness of these attacks.</p>
<p>Some of the bypass techniques mentioned in the article are not written in detail because my focus is on “finding at least one bypass method” rather than “writing all bypass methods”. For more complete bypass techniques, you can refer to: <a target="_blank" rel="noopener" href="https://netsec.expert/posts/xss-in-2021/">Cheatsheet: XSS that works in 2021</a>.</p>
<p>Many of the techniques mentioned in this article are what I learned through playing CTF, such as XS leaks for downloading files from <a target="_blank" rel="noopener" href="https://github.com/aszx87410/ctf-writeups/issues/25">LINE CTF 2021 - Your Note</a>, reading cookies from different paths from <a target="_blank" rel="noopener" href="https://github.com/aszx87410/ctf-writeups/issues/19">DiceCTF 2021 - Web IDE</a>, and Chrome’s hidden API from <a target="_blank" rel="noopener" href="https://github.com/aszx87410/ctf-writeups/issues/23">zer0pts CTF 2021 - PDF Generator</a>. Through CTF, I saw a different side of the web.</p>
<p>These are some of the front-end related knowledge I have learned recently, each of which has exceeded my imagination. I hope this article can make you feel the same surprise I felt at the beginning and think, “Wow, there are still so many things in front-end that I don’t know.”</p>

    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/en/tags/Front-end/">#Front-end</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/en/tags/Security/">#Security</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/2021/11/14/en/intigriti-xss-1021/">Learning HTML Again from Intigriti&#39;s October XSS Challenge</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/2021/10/11/en/xss-history/">XSS from scratch: history and origin</a>
            
        </span>
    </div>
    
</article>




<div class="comments">
    <h3 class="title is-4">Comments</h3>
    <script src="https://utteranc.es/client.js"
        repo="aszx87410/huli-blog"
        issue-term="title"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>

    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2025 huli&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow" title="GitHub" target="_blank" rel="noopener" href="https://github.com/ppoffice/hexo-theme-minos">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
<div class="column is-narrow has-text-centered">
    <div class="dropdown is-up is-right is-hoverable" style="margin-top: -0.2em;">
        <div class="dropdown-trigger">
            <button class="button is-small" aria-haspopup="true">
                <span class="icon">
                    <i class="fas fa-globe"></i>
                </span>
                <span>English</span>
                <span class="icon is-small">
            <i class="fas fa-angle-down" aria-hidden="true"></i>
          </span>
            </button>
        </div>
        <div class="dropdown-menu has-text-left" role="menu" style="top:100%">
            <div class="dropdown-content">
            <!-- NOTE: 永遠回到首頁 -->
            
                <a href="/2021/10/25/learn-frontend-from-security-pov/" class="dropdown-item">
                    繁體中文
                </a>
            
            </div>
        </div>
    </div>
</div>

        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>



    
    
    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    



<script src="/js/script.js?v=3.js"></script>


    
</body>
</html>