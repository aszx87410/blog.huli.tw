<!DOCTYPE html>
<html class="has-navbar-fixed-top" lang="en">
<head>
    <meta charset="utf-8">
<title>What is Clickjacking Attack - Huli&#39;s blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1">



            
<link href="https://blog.huli.tw/2021/09/26/what-is-clickjacking/" rel="alternate" hreflang="zh-TW" />
            
    




    
<link rel="canonical" href="https://blog.huli.tw/2021/09/26/en/what-is-clickjacking/">
    





    <meta name="description" content="IntroductionAmong various attack methods targeting front-end, I find clickjacking quite interesting. Its Chinese translation is usually “click hijacking”, which actually means that you think you click">
<meta property="og:type" content="article">
<meta property="og:title" content="What is Clickjacking Attack">
<meta property="og:url" content="https://blog.huli.tw/2021/09/26/en/what-is-clickjacking/index.html">
<meta property="og:site_name" content="Huli&#39;s blog">
<meta property="og:description" content="IntroductionAmong various attack methods targeting front-end, I find clickjacking quite interesting. Its Chinese translation is usually “click hijacking”, which actually means that you think you click">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://blog.huli.tw/img/what-is-clickjacking/cover-en.png">
<meta property="article:published_time" content="2021-09-26T01:55:26.000Z">
<meta property="article:modified_time" content="2023-06-20T05:46:56.933Z">
<meta property="article:author" content="Huli">
<meta property="article:tag" content="Front-end">
<meta property="article:tag" content="Security">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://blog.huli.tw/img/what-is-clickjacking/cover-en.png">



<link rel="alternative" href="/atom.xml" title="What is Clickjacking Attack" type="application/atom+xml">



<link rel="icon" href="/img/lidemy_logo.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">


<link rel="stylesheet" href="/css/bulma.css?v=2.css">



<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" />


<link rel="stylesheet" href="/css/style.css?v=3.css">





    
    
    
    
    
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1393J2EVCZ"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1393J2EVCZ');
</script>


    


<meta name="generator" content="Hexo 6.3.0"></head>
<body>
    <script>
        if (localStorage.getItem('dark-mode')) {
            if (localStorage.getItem('dark-mode') === 'true') {
                document.body.classList.add('dark-mode')
            }
        } else {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark-mode')
            }
        }
    </script>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/en">
                
                    
                    Huli&#39;s blog
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/en/archives">Archive</a>
            
            <a class="navbar-item "
               href="/en/categories">Categories</a>
            
            <a class="navbar-item "
               href="/en/about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            
            <div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc">
                <a class="navbar-item" title="Table of Contents">
                    Table of Contents
                </a>
                <div class="navbar-dropdown">
                    
                    
                    
                    
                    <a class="navbar-item" href="#introduction">1&nbsp;&nbsp;<b>Introduction</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#clickjacking-attack-principle">2&nbsp;&nbsp;<b>Clickjacking Attack Principle</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#clickjacking-defense-methods">3&nbsp;&nbsp;<b>Clickjacking Defense Methods</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#frame-busting">3.1&nbsp;&nbsp;Frame busting</a>
                    
                    
                    
                    <a class="navbar-item" href="#x-frame-options">3.2&nbsp;&nbsp;X-Frame-Options</a>
                    
                    
                    
                    <a class="navbar-item" href="#csp-frame-ancestors">3.3&nbsp;&nbsp;CSP: frame-ancestors</a>
                    
                    
                    
                    <a class="navbar-item" href="#defense-summary">3.4&nbsp;&nbsp;Defense Summary</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#actual-cases">4&nbsp;&nbsp;<b>Actual Cases</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#yelp">4.1&nbsp;&nbsp;Yelp</a>
                    
                    
                    
                    <a class="navbar-item" href="#twitter-periscope-clickjacking-vulnerability">4.2&nbsp;&nbsp;Twitter Periscope Clickjacking Vulnerability</a>
                    
                    
                    
                    <a class="navbar-item" href="#highly-wormable-clickjacking-in-player-card">4.3&nbsp;&nbsp;Highly wormable clickjacking in player card</a>
                    
                    
                    
                    <a class="navbar-item" href="#apitumblrcom-exploiting-clickjacking-vulnerability-to-trigger-self-dom-based-xss">4.4&nbsp;&nbsp;[api.tumblr.com] Exploiting clickjacking vulnerability to trigger self DOM-based XSS</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#unpreventable-clickjacking">5&nbsp;&nbsp;<b>Unpreventable clickjacking?</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#summary">6&nbsp;&nbsp;<b>Summary</b></a>
                    
                </div>
            </div>
            
            
            <a class="navbar-item" target="_blank" title="Twitter" href="https://twitter.com/aszx87410">
                
                <i class="fab fa-twitter"></i>
                
            </a>
               
            <a class="navbar-item" target="_blank" title="RSS" href="/atom-en.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
               
            
            <a class="navbar-item btn-dark-mode" title="dark-mode" href="#">
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="15" height="15" viewBox="0 0 256 256" xml:space="preserve">
                    <defs>
                    </defs>
                    <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)" >
                        <path d="M 87.823 60.7 c -0.463 -0.423 -1.142 -0.506 -1.695 -0.214 c -15.834 8.398 -35.266 2.812 -44.232 -12.718 c -8.966 -15.53 -4.09 -35.149 11.101 -44.665 c 0.531 -0.332 0.796 -0.963 0.661 -1.574 c -0.134 -0.612 -0.638 -1.074 -1.259 -1.153 c -9.843 -1.265 -19.59 0.692 -28.193 5.66 C 13.8 12.041 6.356 21.743 3.246 33.35 S 1.732 57.08 7.741 67.487 c 6.008 10.407 15.709 17.851 27.316 20.961 C 38.933 89.486 42.866 90 46.774 90 c 7.795 0 15.489 -2.044 22.42 -6.046 c 8.601 -4.966 15.171 -12.43 18.997 -21.586 C 88.433 61.79 88.285 61.123 87.823 60.7 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: #ffa716; fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                    </g>
                    </svg>
                </div>
            </a>
            
               <a class="navbar-item" href="/2021/09/26/what-is-clickjacking/">中文</a>
            
            

        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
      
      <div data-nosnippet class="self-notice">
        If you have any thoughts on my blog or articles and you want to let me know, you can either post a comment below(public) or tell me via this <a href="https://forms.gle/SjJZ4cnNs6NnjXQG8" target="_blank">feedback form</a>
      </div>
      
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            What is Clickjacking Attack
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2021-09-26T01:55:26.000Z" itemprop="datePublished">26 September 2021</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/en/categories/Security/">Security</a>
        </span>
        
        
        
        <spen data-nosnippet class="column is-narrow">(Translated by ChatGPT)</span>
        
    </div>
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2><span id="introduction">Introduction</span></h2><p>Among various attack methods targeting front-end, I find clickjacking quite interesting. Its Chinese translation is usually “click hijacking”, which actually means that you think you clicked something on website A, but in fact, you clicked on website B. Malicious websites hijack users’ clicks, making them click on unexpected places.</p>
<p>Just a click, what harm can it cause?</p>
<p>Suppose it is a bank transfer page in the background, and the account number and amount are filled in. Just press a button and the money will be transferred out. This is very dangerous (but usually unlikely, because transferring money still requires entering OTP and the like, this is just an example).</p>
<p>Or take a more common example. There is a page that looks like a page for unsubscribing from an email newsletter, so you click the “Confirm Unsubscribe” button, but actually, there is a Facebook Like button hidden underneath, so you not only did not unsubscribe, but also gave a Like (because the target of hijacking is Like, it is also called likejacking).</p>
<p>In this article, I will introduce the attack principle, defense methods, and practical cases of clickjacking, so that everyone can better understand this attack method.</p>
<span id="more"></span>

<h2><span id="clickjacking-attack-principle">Clickjacking Attack Principle</span></h2><p>The principle of clickjacking is to stack two web pages together, and use CSS to make the user see website A, but click on website B.</p>
<p>In more technical terms, it is to embed website B using iframe and set the transparency to 0.001, and then use CSS to stack its own content on top of it, and it’s done.</p>
<p>I think the most interesting way to understand clickjacking is to look at examples, so I made some simple examples.</p>
<p>In the following example, you can click the “Confirm Unsubscribe” button first, and then click “Switch Transparency” to see that the background is actually a page for modifying personal information and deleting the account button:</p>
<iframe src="https://aszx87410.github.io/demo/clickjacking/" width="320" height="430"></iframe>

<p>So I thought I clicked “Confirm Unsubscribe”, but in fact, I clicked “Delete Account”, this is clickjacking.</p>
<p>If the above iframe cannot be opened, you can play here: <a target="_blank" rel="noopener" href="https://aszx87410.github.io/demo/clickjacking/">clickjacking example</a>.</p>
<p>Some people may think that this example is too simple, and in actual applications, such simple attacks may rarely occur. Maybe more websites will be a little more complicated, such as requiring input of something first?</p>
<p>In the following example, “Change Email” function is designed for clickjacking. Compared with the previous example where the entire webpage is covered, this example deliberately leaves the input of the original webpage, and covers everything else with CSS. The button part uses <code>pointer-events:none</code> to let the event penetrate.</p>
<p>It seems to be a webpage for entering email subscription information, but after clicking OK, it pops up “Email modification successful”, because the background is actually a webpage for modifying email:</p>
<iframe src="https://aszx87410.github.io/demo/clickjacking/adv.html" width="340" height="450"></iframe>

<p>If you didn’t see the above example, you can play here: <a target="_blank" rel="noopener" href="https://aszx87410.github.io/demo/clickjacking/adv.html">Advanced clickjacking example</a>.</p>
<p>In addition, I also saw a very interesting example in <a target="_blank" rel="noopener" href="https://blog.miniasp.com/post/2008/10/11/The-latest-cross-browser-exploit-Clickjacking">The latest cross-browser exploit-Clickjacking</a>: <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=gxyLbpldmuU">Fake game, real hijacking (YouTube video)</a>, which seems to be a game but actually just wants you to click the button, super interesting!</p>
<p>To summarize clickjacking, the attack method is roughly:</p>
<ol>
<li>Embed the target webpage into the malicious webpage (through iframe or other similar tags)</li>
<li>Use CSS on the malicious webpage to cover the target webpage, making it invisible to the user</li>
<li>Induce the user to go to the malicious webpage and make an operation (input or click, etc.)</li>
<li>Trigger the behavior of the target webpage to achieve the attack</li>
</ol>
<p>Therefore, the difficulty of the actual attack depends on how well your malicious website is designed and how much interaction the target webpage requires. For example, clicking a button is much easier than entering information.</p>
<p>Also, it should be reminded that to achieve this kind of attack, the user must be logged in to the target website first. As long as the target webpage can be embedded in the malicious webpage, there will be a risk of clickjacking.</p>
<h2><span id="clickjacking-defense-methods">Clickjacking Defense Methods</span></h2><p>As mentioned earlier, any webpage that can be embedded in another webpage is at risk of clickjacking. In other words, if a webpage cannot be embedded, there will be no clickjacking issue. This is the way to solve clickjacking.</p>
<p>Generally, there are two ways to defend against clickjacking. One is to use JavaScript to check, and the other is to inform the browser whether the webpage can be embedded through the response header.</p>
<h3><span id="frame-busting">Frame busting</span></h3><p>There is a method called frame busting, which is the JavaScript check I mentioned earlier. The principle is very simple, and the code is also very simple:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span>top <span class="token operator">!==</span> self<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  top<span class="token punctuation">.</span>location <span class="token operator">=</span> self<span class="token punctuation">.</span>location
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>Each webpage has its own window object, and <code>window.self</code> points to its own window. <code>top</code> refers to the top window, which can be thought of as the top-level window of the entire browser “tab.”</p>
<p>If a webpage is opened independently, <code>top</code> and <code>self</code> will point to the same window. However, if the webpage is embedded in an iframe, <code>top</code> will refer to the window that uses the iframe.</p>
<p>For example, suppose I have an index.html on localhost that contains:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://example.com<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://onedegree.hk<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>Then the relationship diagram will be like this:</p>
<p><img src="/img/clickjacking-intro/top.png" alt="window relationship diagram"></p>
<p>The green and yellow colors are two webpages loaded in iframes, which are two different windows. If you access <code>top</code> in these two webpages, it will be the window object of <code>localhost/index.html</code>.</p>
<p>Therefore, by checking <code>if (top !== self)</code>, you can know whether you are in an iframe. If so, change <code>top.location</code> to redirect the top-level webpage to another location.</p>
<p>It sounds good and there doesn’t seem to be any problems, but it can actually be bypassed by the <code>sandbox</code> attribute of the iframe.</p>
<p>An iframe can set an attribute called <code>sandbox</code>, which means that the functionality of the iframe is restricted. If the restrictions need to be lifted, they must be explicitly specified. The values that can be specified include:</p>
<ol>
<li>allow-forms, allowing form submission</li>
<li>allow-scripts, allowing JS execution</li>
<li>allow-top-navigation, allowing changes to top location</li>
<li>allow-popups, allowing pop-ups</li>
</ol>
<p>(There are many more, please refer to <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/iframe">MDN: iframe</a> for details.)</p>
<p>That is to say, if I load the iframe like this:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./busting.html<span class="token punctuation">"</span></span> <span class="token attr-name">sandbox</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>allow-forms allow-scripts<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Even if <code>busting.html</code> has the protection I mentioned above, it will not work because JavaScript will not execute, so that script will not run. However, the user can still submit the form normally.</p>
<p>So someone proposed a more practical method, which is to make some improvements on the existing basis (code taken from: <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Framekiller">Wikipedia - Framekiller</a>):</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><span class="token selector">html</span><span class="token punctuation">&#123;</span><span class="token property">display</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
   <span class="token keyword">if</span> <span class="token punctuation">(</span>self <span class="token operator">==</span> top<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span> 
   <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
       top<span class="token punctuation">.</span>location <span class="token operator">=</span> self<span class="token punctuation">.</span>location<span class="token punctuation">;</span> 
   <span class="token punctuation">&#125;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>First, hide the entire webpage. JavaScript must be executed to open it, so if the sandbox is used to prevent script execution, only a blank webpage will be seen. If the sandbox is not used, the JS check will not pass, so a blank page will still be seen.</p>
<p>Although this can achieve more complete defense, there are also drawbacks. The drawback is that if the user turns off the JS function, they will not see anything. Therefore, for users who turn off the JS function, the experience is not very good.</p>
<p>When clickjacking first came out (in 2008), the relevant defense may not have been so complete, so these methods had to be used. However, in 2021, browsers have supported better ways to block webpages from being embedded.</p>
<h3><span id="x-frame-options">X-Frame-Options</span></h3><p>This HTTP response header was first implemented by IE8 in 2009, and other browsers followed suit. It became a complete <a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc7034.txt">RFC7034</a> in 2013.</p>
<p>This header has the following three values:</p>
<ol>
<li>X-Frame-Options: DENY</li>
<li>X-Frame-Options: SAMEORIGIN</li>
<li>X-Frame-Options: ALLOW-FROM <a target="_blank" rel="noopener" href="https://example.com/">https://example.com/</a></li>
</ol>
<p>The first one is to reject any webpage from embedding this webpage, including <code>&lt;iframe&gt;</code>, <code>&lt;frame&gt;</code>, <code>&lt;object&gt;</code>, <code>&lt;applet&gt;</code>, and <code>&lt;embed&gt;</code> tags.</p>
<p>The second one only allows same-origin webpages, while the last one only allows specific origins to be embedded. Other than that, nothing else is allowed (only one value can be put, not a list, so if you want multiple origins, you need to adjust the output dynamically on the server like the CORS header).</p>
<p>RFC also specifically mentions that the judgment of the last two methods may be different from what you think, and the implementation of each browser may vary.</p>
<p>For example, some browsers may only check the “previous layer” and the “top layer” instead of checking every layer. What does “layer” mean? Because theoretically, an iframe can have an infinite number of layers, A embeds B embeds C embeds D…</p>
<p>If this relationship is visualized as an HTML tag, it would look like this:</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;example.com&#x2F;A.html&gt;
  &lt;attacker.com&gt;
    &lt;example.com&#x2F;B.html&gt;
        &lt;example.com&#x2F;target.html&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>For the innermost target.html, if the browser only checks the previous layer (B.html) and the top layer (A.html), then even if it is set to <code>X-Frame-Options: SAMEORIGIN</code>, the check will still pass because these two layers are indeed the same origin. However, in reality, there is a malicious webpage sandwiched in between, so there is still a risk of being attacked.</p>
<p>In addition, <code>X-Frame-Options</code> has a second problem, which is that the support for <code>ALLOW-FROM</code> is not good. You can refer to the table below from <a target="_blank" rel="noopener" href="https://caniuse.com/?search=X-Frame-Options">caniuse</a>, where the yellow ones do not support <code>ALLOW-FROM</code>:</p>
<p><img src="/img/clickjacking-intro/caniuse.png"></p>
<p>The <code>X</code> at the beginning of <code>X-Frame-Options</code> indicates that it is more like a transitional thing, and its function will be replaced by CSP (Content Security Policy) in future new browsers, and the above-mentioned problems will be solved.</p>
<h3><span id="csp-frame-ancestors">CSP: frame-ancestors</span></h3><p>In a previous article: <a target="_blank" rel="noopener" href="https://tech-blog.cymetrics.io/posts/huli/xss-attack-and-defense/">A Brief Discussion on the Various Links in XSS Attacks and Defenses</a>, I briefly mentioned CSP, which is basically telling the browser some security-related settings, one of which is <code>frame-ancestors</code>, which is set up like this:</p>
<ol>
<li>Content-Security-Policy: frame-ancestors ‘none’</li>
<li>Content-Security-Policy: frame-ancestors ‘self’</li>
<li>Content-Security-Policy: frame-ancestors <a target="_blank" rel="noopener" href="https://a.example.com/">https://a.example.com</a> <a target="_blank" rel="noopener" href="https://b.example.com/">https://b.example.com</a></li>
</ol>
<p>These three correspond exactly to the three types of X-Frame-Options mentioned earlier: DENY, SAMEORIGIN, and ALLOW-FROM (but this time multiple origins are supported).</p>
<p>First, let’s talk about a place that may be confusing. The behavior restricted by <code>frame-ancestors</code> is the same as X-Frame-Options, which is “which webpages can embed me using iframe”, while another CSP rule <code>frame-src</code> is: “which sources of iframe can my webpage load”.</p>
<p>For example, if I set a rule in index.html as <code>frame-src: &#39;none&#39;</code>, then any webpage loaded with <code>&lt;iframe&gt;</code> in index.html will be blocked, regardless of whether that webpage has set anything.</p>
<p>Another example, if I set my index.html to <code>frame-src: https://example.com</code>, but example.com also sets <code>frame-ancestors: &#39;none&#39;</code>, then index.html still cannot load example.com with iframe because the other party refused.</p>
<p>In summary, <code>frame-src</code> is “are we getting along?”, while <code>frame-ancestors</code> is the answer to this request. I can set it to <code>frame-ancestors: &#39;none&#39;</code>, which means I don’t want anyone to confess to me. Both parties must agree for the browser to successfully display the iframe. </p>
<p>Also, it is worth noting that frame-ancestors is a rule supported by CSP level2, and it gradually began to be supported by mainstream browsers at the end of 2014.</p>
<h3><span id="defense-summary">Defense Summary</span></h3><p>Due to compatibility issues, it is recommended to use <code>X-Frame-Options</code> and CSP’s <code>frame-ancestors</code> together. If you don’t want your webpage to be loaded in an iframe, remember to add the HTTP response header:</p>
<pre class="line-numbers language-none"><code class="language-none">X-Frame-Options: DENY
Content-Security-Policy: frame-ancestors &#39;none&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>If you only allow loading from the same origin, set it to:</p>
<pre class="line-numbers language-none"><code class="language-none">X-Frame-Options: SAMEORIGIN
Content-Security-Policy: frame-ancestors &#39;self&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>If you want to specify an allow list of sources, it is:</p>
<pre class="line-numbers language-none"><code class="language-none">X-Frame-Options: ALLOW-FROM https:&#x2F;&#x2F;example.com&#x2F;
Content-Security-Policy: frame-ancestors https:&#x2F;&#x2F;example.com&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2><span id="actual-cases">Actual Cases</span></h2><p>Next, let’s take a look at some actual clickjacking cases, which will give you a better sense of this attack.</p>
<h3><span id="yelp">Yelp</span></h3><p>The largest restaurant review website in the United States, Yelp, has several reports on clickjacking:</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://hackerone.com/reports/305128">ClickJacking on IMPORTANT Functions of Yelp</a></li>
<li><a target="_blank" rel="noopener" href="https://hackerone.com/reports/355859">CRITICAL-CLICKJACKING at Yelp Reservations Resulting in exposure of victim Private Data (Email info) + Victim Credit Card MissUse.</a></li>
</ol>
<p>Although it cannot achieve serious attacks such as account theft, it can still cause some harm, such as stealing users’ emails by helping them make reservations, or causing financial losses by charging cancellation fees when users cancel reservations.</p>
<p>For restaurants that are disliked, this method can also be used to create many fake reservations, making it difficult for restaurants to distinguish (because they are all real users making reservations).</p>
<h3><span id="twitter-periscope-clickjacking-vulnerability">Twitter Periscope Clickjacking Vulnerability</span></h3><p>Original report: <a target="_blank" rel="noopener" href="https://hackerone.com/reports/591432">https://hackerone.com/reports/591432</a><br>Date: May 2019</p>
<p>This bug is due to compatibility issues. The webpage only sets <code>X-Frame-Options ALLOW-FROM</code> without setting CSP. This is actually useless because modern browsers do not support <code>ALLOW-FROM</code>.</p>
<p>The solution is simple, just add CSP’s frame-ancestors to make modern browsers also follow this rule.</p>
<h3><span id="highly-wormable-clickjacking-in-player-card">Highly wormable clickjacking in player card</span></h3><p>Original report: <a target="_blank" rel="noopener" href="https://hackerone.com/reports/85624">https://hackerone.com/reports/85624</a><br>Date: August 2015</p>
<p>This vulnerability is quite interesting and uses the browser implementation issues mentioned earlier. In this case, Twitter has already set <code>X-Frame-Options: SAMEORIGIN</code> and <code>Content-Security-Policy: frame-ancestors &#39;self&#39;</code>, but at that time, some browser implementations only checked whether the top window met the conditions.</p>
<p>In other words, if it is twitter.com &#x3D;&gt; attacker.com &#x3D;&gt; twitter.com, it will pass the check, so it can still be embedded in a malicious webpage.</p>
<p>In addition, this vulnerability occurred in Twitter’s timeline, so it can achieve the effect of a worm. After clickjacking, it will tweet, and then more people will see it and tweet the same thing.</p>
<p>The author’s writeup is great, but the blog is down, this is the archive: <a target="_blank" rel="noopener" href="http://web.archive.org/web/20190310161937/https://blog.innerht.ml/google-yolo/">Google YOLO</a></p>
<h3><span id="apitumblrcom-exploiting-clickjacking-vulnerability-to-trigger-self-dom-based-xss">[api.tumblr.com] Exploiting clickjacking vulnerability to trigger self DOM-based XSS</span></h3><p>Original report: <a target="_blank" rel="noopener" href="https://hackerone.com/reports/953579">https://hackerone.com/reports/953579</a><br>Date: August 2020</p>
<p>I specifically chose this case because it is a chain of attacks!</p>
<p>In XSS vulnerabilities, there is a type called self XSS, which means that usually users have to perform some operations themselves to be attacked, so the impact is very limited, and many programs do not accept self XSS vulnerabilities.</p>
<p>And this report links self XSS with clickjacking, allowing users to trigger self XSS through clickjacking, making the attack chain easier to achieve and more feasible.</p>
<p>The above are some practical examples related to clickjacking. It is worth noting that some of them are issues caused by compatibility issues, not lack of settings, so setting correctly is also important.</p>
<h2><span id="unpreventable-clickjacking">Unpreventable clickjacking?</span></h2><p>The way to defend against clickjacking is to not let others embed your webpage, but what if the purpose of this webpage is to let others embed it?</p>
<p>For example, the Facebook widget, the “like” and “share” buttons that we often see, are designed to be embedded by others using iframes. What should be done with this type of widget?</p>
<p>According to these two articles:</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://www.netsparker.com/blog/web-security/clickjacking-attack-on-facebook-how-tiny-attribute-save-corporation/">Clickjacking Attack on Facebook: How a Tiny Attribute Can Save the Corporation</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/61968091/facebook-like-button-click">Facebook like button click</a></li>
</ol>
<p>The information obtained inside may only reduce user experience a little in exchange for security. For example, after clicking the button, a popup will still appear for you to confirm. For users, there is one more click, but it also avoids the risk of likejacking.</p>
<p>Or I guess it may also decide whether to have this behavior based on the source of the website. For example, on some more reputable websites, this popup may not appear.</p>
<p>I have made a simple demo webpage: <a target="_blank" rel="noopener" href="https://aszx87410.github.io/demo/clickjacking/like.html">https://aszx87410.github.io/demo/clickjacking/like.html</a></p>
<p>If likejacking is successful, clicking the button will like the Facebook Developer Plugin fan page (I have successfully experimented with it myself). Everyone can try it out and click “Show original webpage” to see what the button looks like underneath, and also retract the like.</p>
<h2><span id="summary">Summary</span></h2><p>Compared to the era when browser support was not so complete in the past, we are now much happier. Browsers have also implemented more and more security features and new response headers to protect users from malicious attacks.</p>
<p>Although the difficulty, prerequisites, and impact of clickjacking attacks are usually lower than attacks such as XSS or CSRF on average, it is still one of the risks that cannot be ignored.</p>
<p>If your webpage does not allow other websites to be embedded, remember to set <code>X-Frame-Options: DENY</code> and <code>Content-Security-Policy: frame-ancestors &#39;none&#39;</code> to tell the browser that your webpage cannot be embedded, thereby preventing clickjacking attacks.</p>
<p>References:</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://github.com/reddelexc/hackerone-reports/blob/master/tops_by_bug_type/TOPCLICKJACKING.md">TOPCLICKJACKING.md</a></li>
<li><a target="_blank" rel="noopener" href="https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking_Defense_Cheat_Sheet.html#x-frame-options-header-types">Clickjacking Defense Cheat Sheet</a></li>
<li><a target="_blank" rel="noopener" href="https://content-security-policy.com/frame-ancestors/">CSP frame-ancestors</a></li>
</ol>

    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/en/tags/Front-end/">#Front-end</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/en/tags/Security/">#Security</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/2021/09/26/en/what-is-open-redirect/">Issues to be aware of when implementing redirect functionality: Open Redirect</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/2021/08/22/en/eleventy-over-hexo/">Consider Using Eleventy to Write Technical Blog Posts Besides Hexo</a>
            
        </span>
    </div>
    
</article>




<div class="comments">
    <h3 class="title is-4">Comments</h3>
    <script src="https://utteranc.es/client.js"
        repo="aszx87410/huli-blog"
        issue-term="title"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>

    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2023 Huli&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow" title="GitHub" target="_blank" rel="noopener" href="https://github.com/ppoffice/hexo-theme-minos">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
<div class="column is-narrow has-text-centered">
    <div class="dropdown is-up is-right is-hoverable" style="margin-top: -0.2em;">
        <div class="dropdown-trigger">
            <button class="button is-small" aria-haspopup="true">
                <span class="icon">
                    <i class="fas fa-globe"></i>
                </span>
                <span>English</span>
                <span class="icon is-small">
            <i class="fas fa-angle-down" aria-hidden="true"></i>
          </span>
            </button>
        </div>
        <div class="dropdown-menu has-text-left" role="menu" style="top:100%">
            <div class="dropdown-content">
            <!-- NOTE: 永遠回到首頁 -->
            
                <a href="/2021/09/26/what-is-clickjacking/" class="dropdown-item">
                    繁體中文
                </a>
            
            </div>
        </div>
    </div>
</div>

        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>



    
    
    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    



<script src="/js/script.js?v=3.js"></script>


    
</body>
</html>