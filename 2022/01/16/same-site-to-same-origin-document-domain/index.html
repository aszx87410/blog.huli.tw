<!DOCTYPE html>
<html class="has-navbar-fixed-top" lang="zh-tw">
<head>
    <meta charset="utf-8">
<title>忍術！把 same site 變 same origin 之術！ - Huli&#39;s blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="google-adsense-account" content="ca-pub-1121865251398741">



            
<link href="https://blog.huli.tw/2022/01/16/en/same-site-to-same-origin-document-domain/" rel="alternate" hreflang="en" />
            
    




    
<link rel="canonical" href="https://blog.huli.tw/2022/01/16/same-site-to-same-origin-document-domain/">
    





    <meta name="description" content="Same site 跟 same origin 雖然看起來有點像，但其實差別不小，而這個差別也會影響到瀏覽器如何看待這兩個網站的關係還有給予的權限。 這篇文章將會談到：  Origin 是什麼？怎樣是 same origin？ Site 是什麼？怎樣是 same site？ same origin 跟 same site 的差別是什麼？ 如何把 same site 變成 same origin？">
<meta property="og:type" content="article">
<meta property="og:title" content="忍術！把 same site 變 same origin 之術！">
<meta property="og:url" content="https://blog.huli.tw/2022/01/16/same-site-to-same-origin-document-domain/index.html">
<meta property="og:site_name" content="Huli&#39;s blog">
<meta property="og:description" content="Same site 跟 same origin 雖然看起來有點像，但其實差別不小，而這個差別也會影響到瀏覽器如何看待這兩個網站的關係還有給予的權限。 這篇文章將會談到：  Origin 是什麼？怎樣是 same origin？ Site 是什麼？怎樣是 same site？ same origin 跟 same site 的差別是什麼？ 如何把 same site 變成 same origin？">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://blog.huli.tw/img/same-site-to-same-origin/p1-schemelessly-same-site.png">
<meta property="og:image" content="https://blog.huli.tw/img/same-site-to-same-origin/p2-table.png">
<meta property="og:image" content="https://blog.huli.tw/img/same-site-to-same-origin/p3-note.png">
<meta property="og:image" content="https://blog.huli.tw/img/same-site-to-same-origin/p4-error.png">
<meta property="og:image" content="https://blog.huli.tw/img/same-site-to-same-origin/p5-success.png">
<meta property="og:image" content="https://blog.huli.tw/img/same-site-to-same-origin/p6-detail.png">
<meta property="article:published_time" content="2022-01-16T03:21:29.000Z">
<meta property="article:modified_time" content="2023-05-07T01:15:16.489Z">
<meta property="article:author" content="Huli">
<meta property="article:tag" content="Front-end">
<meta property="article:tag" content="JavaScript">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://blog.huli.tw/img/same-site-to-same-origin/p1-schemelessly-same-site.png">



<link rel="alternative" href="/atom.xml" title="忍術！把 same site 變 same origin 之術！" type="application/atom+xml">



<link rel="icon" href="/img/lidemy_logo.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">


<link rel="stylesheet" href="/css/bulma.css?v=2.css">



<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" />


<link rel="stylesheet" href="/css/style.css?v=4.css">





    
    
    
    
    
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1393J2EVCZ"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1393J2EVCZ');
</script>


    


<meta name="generator" content="Hexo 6.3.0"></head>
<body>
    <script>
        if (localStorage.getItem('dark-mode')) {
            if (localStorage.getItem('dark-mode') === 'true') {
                document.body.classList.add('dark-mode')
            }
        } else {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark-mode')
            }
        }
    </script>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                    
                    Huli&#39;s blog
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/archives">文章列表</a>
            
            <a class="navbar-item "
               href="/categories">分類</a>
            
            <a class="navbar-item "
               href="/recommend">推薦閱讀</a>
            
            <a class="navbar-item "
               href="/about">關於我</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            
            <div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc">
                <a class="navbar-item" title="目錄">
                    目錄
                </a>
                <div class="navbar-dropdown">
                    
                    
                    
                    
                    <a class="navbar-item" href="#初探-origin-與-site">1&nbsp;&nbsp;<b>初探 origin 與 site</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#細究-same-origin">2&nbsp;&nbsp;<b>細究 same origin</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#細究-same-site">3&nbsp;&nbsp;<b>細究 same site</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#same-origin-與-same-site">4&nbsp;&nbsp;<b>Same origin 與 same site</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#神奇的-documentdomain">5&nbsp;&nbsp;<b>神奇的 document.domain</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#案例一單方面改變">5.1&nbsp;&nbsp;案例一：單方面改變</a>
                    
                    
                    
                    <a class="navbar-item" href="#案例二消失的-port">5.2&nbsp;&nbsp;案例二：消失的 port</a>
                    
                    
                    
                    <a class="navbar-item" href="#案例三我不是原來的我">5.3&nbsp;&nbsp;案例三：我不是原來的我</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#documentdomain-的淡出及退場">6&nbsp;&nbsp;<b>document.domain 的淡出及退場</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#結語">7&nbsp;&nbsp;<b>結語</b></a>
                    
                </div>
            </div>
            
            
            <a class="navbar-item" target="_blank" title="Medium" href="https://hulitw.medium.com/">
                
                <i class="fab fa-medium"></i>
                
            </a>
               
            <a class="navbar-item" target="_blank" title="Facebook" href="https://www.facebook.com/huli.blog">
                
                <i class="fab fa-facebook"></i>
                
            </a>
               
            <a class="navbar-item" target="_blank" title="RSS" href="/atom-ch.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
               
            
            <a class="navbar-item btn-dark-mode" title="dark-mode" href="#">
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="15" height="15" viewBox="0 0 256 256" xml:space="preserve">
                    <defs>
                    </defs>
                    <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)" >
                        <path d="M 87.823 60.7 c -0.463 -0.423 -1.142 -0.506 -1.695 -0.214 c -15.834 8.398 -35.266 2.812 -44.232 -12.718 c -8.966 -15.53 -4.09 -35.149 11.101 -44.665 c 0.531 -0.332 0.796 -0.963 0.661 -1.574 c -0.134 -0.612 -0.638 -1.074 -1.259 -1.153 c -9.843 -1.265 -19.59 0.692 -28.193 5.66 C 13.8 12.041 6.356 21.743 3.246 33.35 S 1.732 57.08 7.741 67.487 c 6.008 10.407 15.709 17.851 27.316 20.961 C 38.933 89.486 42.866 90 46.774 90 c 7.795 0 15.489 -2.044 22.42 -6.046 c 8.601 -4.966 15.171 -12.43 18.997 -21.586 C 88.433 61.79 88.285 61.123 87.823 60.7 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: #ffa716; fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                    </g>
                    </svg>
                </div>
            </a>
            
                <a class="navbar-item" href="/2022/01/16/en/same-site-to-same-origin-document-domain/">English</a>
            
            

        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
      
      <div data-nosnippet class="self-notice">
        最近開了一個讀者回饋表單，無論是對文章的感想或是對部落格的感想，有什麼想回饋的都可以填表單跟我說：<a href="https://forms.gle/XuWyRC5qtSd2ANta8" target="_blank">表單連結</a>
      </div>
      
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            忍術！把 same site 變 same origin 之術！
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2022-01-16T03:21:29.000Z" itemprop="datePublished">2022年1月16日</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Front-end/">Front-end</a>
        </span>
        
        
        
    </div>
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>Same site 跟 same origin 雖然看起來有點像，但其實差別不小，而這個差別也會影響到瀏覽器如何看待這兩個網站的關係還有給予的權限。</p>
<p>這篇文章將會談到：</p>
<ol>
<li>Origin 是什麼？怎樣是 same origin？</li>
<li>Site 是什麼？怎樣是 same site？</li>
<li>same origin 跟 same site 的差別是什麼？</li>
<li>如何把 same site 變成 same origin？</li>
</ol>
<p>事不宜遲，就讓我們開始吧！</p>
<p>（開始之前先回答一個疑問。是的，標題的靈感來自於忍者哈特利）</p>
<p>2022-01-20：修改「細究 same site」段落，補充 scheme 相關歷史，感謝 <a target="_blank" rel="noopener" href="https://twitter.com/littlegoodjack">@littlegoodjack</a></p>
<span id="more"></span>

<h2><span id="初探-origin-與-site">初探 origin 與 site</span></h2><p>先提供一下簡單好懂但有些許錯誤的解釋，待會我們再來一個個修正。</p>
<p>Origin 的話就是：scheme + port + host，三者加起來就是 origin。</p>
<p>假設有個 URL 是 <code>https://huli.tw/abc</code>，各個組成分別是：</p>
<ul>
<li>scheme：https</li>
<li>port：443（https 的預設 port）</li>
<li>host：huli.tw</li>
</ul>
<p>因此它的 origin 就是 <code>https://huli.tw</code>，可以看到 path 的部分 <code>/abc</code> 並不影響 origin，而 port 的部份 https 已經蘊含預設就是 443 port 了。</p>
<p>而 same origin 就是兩個 URL 的 origin 要是一樣的，舉例來說：</p>
<ol>
<li><code>https://huli.tw/abc</code> 跟 <code>https://huli.tw/hello/yo</code> 是 same origin，因為 scheme、port 跟 host 都一樣，path 不影響結果</li>
<li><code>https://huli.tw</code> 跟 <code>http://huli.tw</code> 不是 same origin，因為 scheme 不一樣</li>
<li><code>http://huli.tw</code> 跟 <code>http://huli.tw:8080</code> 不是 same origin，因為 port 不一樣</li>
<li><code>https://huli.tw</code> 跟 <code>https://blog.huli.tw</code> 不是 same origin，因為 host 不一樣</li>
</ol>
<p>從上面幾個範例可以看出 same origin 的條件相當嚴苛，基本上除了 path 以外的部分都要一樣，才能叫做 same origin。</p>
<p>接著我們看一下 site，site 的話看的東西比 origin 少，只看 scheme 跟 host，所以不看 port。而兩個 URL 是 same site 的定義也更寬鬆了，host 的部分不用完全相同，只要是 subdomain 也算是 same site。</p>
<p>舉例來說，</p>
<ol>
<li><code>https://huli.tw/abc</code> 跟 <code>https://huli.tw/hello/yo</code> 是 same site，因為 scheme 跟 host 都一樣</li>
<li><code>https://huli.tw</code> 跟 <code>http://huli.tw</code> 不是 same site，因為 scheme 不一樣</li>
<li><code>http://huli.tw</code> 跟 <code>http://huli.tw:8080</code> 是 same site，因為 port 不影響結果</li>
<li><code>https://huli.tw</code> 跟 <code>https://blog.huli.tw</code> 是 same site，因為 huli.tw 跟 blog.huli.tw 都在同一個 domain huli.tw 底下</li>
<li><code>https://abc.huli.tw</code> 跟 <code>https://blog.huli.tw</code> 也是 same site，因為 abc.huli.tw 跟 blog.huli.tw 都在同一個 domain huli.tw 底下</li>
</ol>
<p>跟 same origin 比起來，same site 顯然更為寬鬆，port 不同也是 same site，host 的部分只要隸屬於同個 parent domain 基本上也是 same site。</p>
<p>但就如同我開頭說的，上面的定義雖然在大多數情況下都正確，但其實並不精確，底下我們直接來看 spec，看看有哪些狀況例外。</p>
<h2><span id="細究-same-origin">細究 same origin</span></h2><p>在 <a href="https://blog.huli.tw/2021/02/19/cors-guide-1/">CORS 完全手冊（一）：為什麼會發生 CORS 錯誤？</a>一文中我有提過 origin 的定義，在 HTML 規範中的 <a target="_blank" rel="noopener" href="https://html.spec.whatwg.org/multipage/origin.html#origin">7.5 Origin</a> 章節裡面可以看到完整的定義，先來看一下規範裡面對 origin 的說明：</p>
<blockquote>
<p>Origins are the fundamental currency of the web’s security model. Two actors in the web platform that share an origin are assumed to trust each other and to have the same authority. Actors with differing origins are considered potentially hostile versus each other, and are isolated from each other to varying degrees.</p>
</blockquote>
<p>這邊寫得很清楚，開宗明義就講了如果兩個網站有著相同的 origin，就意味著這兩個網站信任彼此，但如果是不同的 origin，就會被隔離開來而且受到限制。</p>
<p>接著規範裡把 origin 分成兩種，一種是 <code>An opaque origin</code>，另一種是 <code>A tuple origin</code>。</p>
<p>Opaque origin 可以想成是在特殊狀況下才會出現的 origin，例如說我在本機開啟一個網頁，網址會是 <code>file:///...</code>，這時候在網頁內發送 request，origin 就會是 opaque origin，也就是 <code>null</code>。</p>
<p>Tuple origin 則是比較常見而且我們也比較關心的 origin，文件寫說 tuple 內包含了：</p>
<ol>
<li>scheme (an ASCII string).</li>
<li>host (a host).</li>
<li>port (null or a 16-bit unsigned integer).</li>
<li>domain (null or a domain). Null unless stated otherwise.</li>
</ol>
<p>你可能會好奇為什麼又有 host 又有 domain，這個我們晚點會提到。</p>
<p>接著，在規範裡面也有講到判斷 A 跟 B 兩個 origin 是否是 same origin 的演算法：</p>
<ol>
<li>If A and B are the same opaque origin, then return true.</li>
<li>If A and B are both tuple origins and their schemes, hosts, and port are identical, then return true.</li>
<li>Return false.</li>
</ol>
<p>要嘛兩個是一樣的 opaque origin，否則的話要 scheme、host 跟 port 三者都相等，才是 same origin。除了 same origin 以外，你還會在 spec 裡面看到另外一個詞叫做「same origin-domain」，這個我們之後也會提到。</p>
<p>如同我前面說的，same origin 是很嚴格的限制，以 <code>https://huli.tw/api</code> 這個網址來說，因為 origin 不看 path，所以它的 origin 會是 <code>https://huli.tw</code>，也就是說，跟它同源的網站的網址一定都是 <code>https://huli.tw/*</code>，才會是同源的。</p>
<p><code>https://huli.tw</code> 跟 <code>https://blog.huli.tw</code> 雖然只是網域跟子網域的關係，但也不是同源的，因為 host 不一樣。</p>
<p>記住這點，這很重要。</p>
<p>這邊仔細探究的 origin 跟 same origin 的定義跟開頭所說的「不精確的說法」比起來，差別在於多了一個 opaque origin 以及 same origin-domain，還有 origin tuple 中多了一個我們剛剛都沒用到的「domain」。</p>
<p>最後再提一個東西，當我說「<code>https://huli.tw/api</code> 的 origin 是 <code>https://huli.tw</code>」的時候，更精確的說法是：「<code>https://huli.tw/api</code> 的 origin 序列化（serialization）過的結果是 <code>https://huli.tw</code>」</p>
<p>這是因為前面有提到 origin 其實是個 tuple，表示起來會像這樣：<code>(https, huli.tw, null, null)</code>，而 tuple 變成字串後才會是 <code>https://huli.tw</code>。tuple 的表示法跟序列化過後的字串比起來，我認為後者比較好讀，因此當兩者能表現出的資訊類似時，我會採用後者那種做法</p>
<h2><span id="細究-same-site">細究 same site</span></h2><p>site 的定義也在同一份 spec 裡面，寫說：</p>
<blockquote>
<p>A site is an opaque origin or a scheme-and-host.</p>
</blockquote>
<p>所以 site 可以是 opaque origin，或者是 scheme-and-host。</p>
<p>在 spec 中可以發現除了 same site 以外，還有另外一個名詞叫做「schemelessly same site」，這兩個的差別也很明顯，same site 會看 scheme，而 schemelessly same site 則不看 scheme。</p>
<p>因此，在判斷兩個 origin A 跟 B 是否是 same site 時，演算法是這樣的：</p>
<blockquote>
<p>Two origins, A and B, are said to be same site if both of the following statements are true:</p>
<ul>
<li>A and B are schemelessly same site  </li>
<li>A and B are either both opaque origins, or both tuple origins with the same scheme</li>
</ul>
</blockquote>
<p>如果 A 跟 B 是 same site，要嘛他們都是 opaque origin，要嘛兩個有著同樣的 scheme 而且兩個是 schemelessly same site。</p>
<p>所以 same site 是會看 scheme 的，http 跟 https 的兩個網址絕對不會是 same site，但有可能是 schemelessly same site。</p>
<p>這邊其實有一小段歷史，那就是 same site 剛出來的時候，其實是不看 scheme 的，是到後來才把 scheme 納入考量。</p>
<p>在這份 2016 的 <a target="_blank" rel="noopener" href="https://datatracker.ietf.org/doc/html/draft-west-first-party-cookies-07#section-2.1">RFC: Same-site Cookies</a> 中，可以看到對於 same site 的判斷並沒有 scheme，所以那時候 <code>https://huli.tw</code> 跟 <code>http://huli.tw</code> 是 same site。</p>
<p>一直到 2019 年 6 月的時候，才開始在討論是否要把 scheme 列入考量，詳情可參考：<a target="_blank" rel="noopener" href="https://github.com/w3c/webappsec-fetch-metadata/issues/34">Treat http://foo.com -> https://foo.com requests as Sec-Fetch-Site: cross-site. #34</a>。</p>
<p>那時 same site 的 spec 並不是定義在我們今天看的 HTML spec 裡面，而是另外一份 URL spec，所以後來討論被移到那邊去：<a target="_blank" rel="noopener" href="https://github.com/whatwg/url/issues/448">Consider introducing a “same-site” concept that includes scheme. #448</a>，接著在 2019 年 9 月，就有了這個 PR：<a target="_blank" rel="noopener" href="https://github.com/whatwg/url/pull/449">Tighten ‘same site’ checks to include ‘scheme’. #449</a>，才正式在規格中把 scheme 列入考量，將 same site 定義成「會看 scheme」，而不看 scheme 的則引入了一個新的名詞：schemelessly same site。</p>
<p>接著過了兩個月，相關的 spec 從 URL 移到 HTML，可參考這兩個 PR：<a target="_blank" rel="noopener" href="https://github.com/whatwg/url/pull/457">Let HTML handle the “same site” definition #457</a>、<a target="_blank" rel="noopener" href="https://github.com/whatwg/html/pull/5076">Define (schemelessly) same site for origins #5076</a></p>
<p>Spec 歸 spec，有時候規格修正不代表瀏覽器就會馬上跟上，那瀏覽器目前的實作為何呢？</p>
<p>Chrome 在 2020 年 11 月時有寫了一篇文章：<a target="_blank" rel="noopener" href="https://web.dev/schemeful-samesite/">Schemeful Same-Site</a>，看來在那時瀏覽器還是把不同 scheme 也當作是 same site，但從 <a target="_blank" rel="noopener" href="https://chromestatus.com/feature/5096179480133632">Chrome platform status:  Feature: Schemeful same-site</a> 中我們可以得知，Chrome 從 89 以後就把 scheme 也列入考慮了。</p>
<p>至於 Firefox 的話，從這個 issue：<a target="_blank" rel="noopener" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1651119">[meta] Enable cookie sameSite schemeful</a> 的狀態看來，似乎還沒有把這個行為當作是預設值，如果沒有特別調整設定，scheme 不同也會被看作是 same site。</p>
<p>看完了歷史，接著就來看一下最重要的 schemelessly same site 是如何判斷的：</p>
<p><img src="/img/same-site-to-same-origin/p1-schemelessly-same-site.png" alt="schemelessly same site"></p>
<p>Opaque 的部份我們就先不說了，上面的重點很顯然是一個新的名詞：「registrable domain」，在判斷兩個 host 是否是 same site 時，會用這個來做比較。</p>
<p>這個 registrable domain 的定義在另外一份 <a target="_blank" rel="noopener" href="https://url.spec.whatwg.org/#host-registrable-domain">URL 的 spec</a> 中：</p>
<blockquote>
<p>A host’s registrable domain is a domain formed by the most specific public suffix, along with the domain label immediately preceding it, if any</p>
</blockquote>
<p>這邊又提到一個新的詞：「public suffix」，這個東西我們在<a href="https://blog.huli.tw/2021/07/10/cookie-bomb/">利用 Cookie 特性進行的 DoS 攻擊：Cookie 炸彈</a>時就有提到過。</p>
<p>先舉個例子會比較好懂，<code>blog.huli.tw</code> 的 registrable domain 會是 <code>huli.tw</code>，而 <code>huli.tw</code> 的 registrable domain 也是 <code>huli.tw</code>。</p>
<p>但是 <code>bob.github.io</code> 的 registrable domain 不是 <code>github.io</code>，而是 <code>bob.github.io</code>。</p>
<p>這是為什麼呢？底下我簡單解釋一下。</p>
<p>如果沒有「registrable domain」以及「public suffix」這兩個概念的話，那 same site 的定義就是開頭所講的，<code>huli.tw</code> 跟 <code>blog.huli.tw</code> 是 same site，這沒什麼問題。</p>
<p>但如果是這樣的話，<code>bob.github.io</code> 跟 <code>alice.github.io</code> 也是 same site 了。</p>
<p>咦，這樣不好嗎？</p>
<p>不好，因為 <code>github.io</code> 是 GitHub pages 的服務，每一個 GitHub 的使用者都會有自己專屬的 subdomain 可以用，但 GitHub 不希望 <code>bob.github.io</code> 能干擾到 <code>alice.github.io</code>，因為它們其實就是完全獨立的兩個網站，並不像 <code>huli.tw</code> 跟 <code>blog.huli.tw</code> 一樣，擁有者都是我。</p>
<p>因此，public suffix 的概念就出現了，這是一個人工維護的清單，裡面有著這些「不想被當作是同個網站的列表」，我舉幾個例子：</p>
<ol>
<li>github.io</li>
<li>com.tw</li>
<li>s3.amazonaws.com</li>
<li>azurestaticapps.net</li>
<li>herokuapp.com</li>
</ol>
<p>所以瀏覽器參照這張表之後，就會認定 <code>bob.github.io</code> 跟 <code>alice.github.io</code> 其實並沒有關係，不是 same site。這也有個專有名詞叫做 eTLD，細節可參考：<a target="_blank" rel="noopener" href="https://blog.kalan.dev/2021-11-09-url-and-samesite/">如何判斷兩個網域的擁有者是否相同？</a></p>
<p>如上所述，因為 <code>github.io</code> 存在於 public suffix list 裡面，所以 <code>bob.github.io</code> 的 registrable domain 是 <code>bob.github.io</code>，而 <code>alice.github.io</code> 的 registrable domain 則是 <code>alice.github.io</code>。</p>
<p>所以呢，我們一開始講的 same site 的定義並不正確，兩個 host 看起來很像是隸屬於同一個 parent domain，並不代表就一定是 same site，還要看有沒有在 public suffix list 裡面。</p>
<p>而 <code>bob.github.io</code> 跟 <code>alice.github.io</code> 不是 same site，因為他們的 registrable domain 不一樣。</p>
<p><code>blog.huli.tw</code> 跟 <code>huli.tw</code> 還有 <code>test.huli.tw</code> 這三個 host 都是 same site，因為 registrable domain 都是 <code>huli.tw</code>。</p>
<p>spec 中有附上一張更清楚的表格，大家可以仔細看一下：</p>
<p><img src="/img/same-site-to-same-origin/p2-table.png" alt="registrable domain table"></p>
<p>最後，為 same site 做個總結：</p>
<ol>
<li>有 same site 跟 schemelessly same site，較常用的是前者</li>
<li>要比較兩個 host 是否為 same site 時，要看 registrable domain</li>
<li>要決定 registrable domain 是什麼，要看 public suffix list</li>
<li>兩個 host 僅管看起來隸屬於同個 parent domain，但因為有 public suffix 的存在，不一定是 same site</li>
<li>same site 不看 port，所以 <code>http://blog.huli.tw:8888</code> 跟 <code>http://huli.tw</code> 是 same site</li>
</ol>
<h2><span id="same-origin-與-same-site">Same origin 與 same site</span></h2><p>Same origin 看的是：</p>
<ol>
<li>scheme</li>
<li>port</li>
<li>host</li>
</ol>
<p>而 same site 看的是：</p>
<ol>
<li>scheme</li>
<li>host(registrable domain)</li>
</ol>
<p>如果兩個網站是 same origin，那就一定是 same site，因為 same origin 的判斷標準更為嚴苛。</p>
<p>兩者最大的差別就在於：</p>
<ol>
<li>same origin 看 port，same site 不看</li>
<li>same origin 看 host，same site 看 registrable domain</li>
</ol>
<p>底下舉幾個例子：</p>
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>same origin</th>
<th>same site</th>
<th>說明</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="http://huli.tw:8080/">http://huli.tw:8080</a></td>
<td><a target="_blank" rel="noopener" href="http://huli.tw/">http://huli.tw</a></td>
<td>X</td>
<td>O</td>
<td>same site 不看 port</td>
</tr>
<tr>
<td><a href="https://blog.huli.tw/">https://blog.huli.tw</a></td>
<td><a target="_blank" rel="noopener" href="https://huli.tw/">https://huli.tw</a></td>
<td>X</td>
<td>O</td>
<td>registrable domain 相同</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://alice.github.io/">https://alice.github.io</a></td>
<td><a target="_blank" rel="noopener" href="https://github.io/">https://github.io</a></td>
<td>X</td>
<td>X</td>
<td>github.io 在 public suffix 裡面</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://a.alice.github.io/">https://a.alice.github.io</a></td>
<td><a target="_blank" rel="noopener" href="https://b.alice.github.io/">https://b.alice.github.io</a></td>
<td>X</td>
<td>O</td>
<td>registrable domain 相同</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://bob.github.io/page1">https://bob.github.io/page1</a></td>
<td><a target="_blank" rel="noopener" href="https://bob.github.io/about">https://bob.github.io/about</a></td>
<td>O</td>
<td>O</td>
<td>不管 path</td>
</tr>
</tbody></table>
<h2><span id="神奇的-documentdomain">神奇的 document.domain</span></h2><p>幫 same origin 跟 same site 鋪陳了這麼多，總算來到了一開始想講的主題，也就是標題所說的東西。</p>
<p>在看 origin 的 spec 時，就有提到一個神奇的「domain」屬性，不知道要幹嘛，甚至還有「same origin-domain」這個東西，在 origin 的 spec 中其實有一段綠底的 note，直接破題：</p>
<p><img src="/img/same-site-to-same-origin/p3-note.png" alt="same origin note"></p>
<p>寫說 origin 除了 domain 這個屬性以外都是不可變的，而這屬性可以透過 <code>document.domain</code> 來改變。在 spec 中有一個章節 <a target="_blank" rel="noopener" href="https://html.spec.whatwg.org/multipage/origin.html#relaxing-the-same-origin-restriction">7.5.2 Relaxing the same-origin restriction</a>，就是在講這件事情，我節錄一小段：</p>
<blockquote>
<p>(document.domain) can be set to a value that removes subdomains, to change the origin’s domain to allow pages on other subdomains of the same domain (if they do the same thing) to access each other. This enables pages on different hosts of a domain to synchronously access each other’s DOMs.</p>
</blockquote>
<p>為了方便大家理解，直接來個 demo。</p>
<p>我改了本機的 <code>/etc/hosts</code>，內容如下：</p>
<pre class="line-numbers language-none"><code class="language-none">127.0.0.1   alice.example.com
127.0.0.1   bob.example.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>如此一來，這兩個網址都會連到 local，接著我開了一個簡單的 HTTP server，寫了一個簡單的 HTML，讓它跑在 localhost:5555</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'alice'</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>load alice iframe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'bob'</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>load bob iframe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">access</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>access iframe content<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>update domain<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">const</span> name <span class="token operator">=</span> document<span class="token punctuation">.</span>domain<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'.example.com'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> name
    document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'h2'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> iframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span>
      iframe<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'http://'</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'.example.com:5555'</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">function</span> <span class="token function">access</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> win <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contentWindow
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'secret:'</span> <span class="token operator">+</span> win<span class="token punctuation">.</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'h2'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">)</span>    
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      document<span class="token punctuation">.</span>domain <span class="token operator">=</span> <span class="token string">'example.com'</span>
    <span class="token punctuation">&#125;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>頁面上有三個功能：</p>
<ol>
<li>載入 iframe</li>
<li>讀取 iframe 內 DOM 的資料</li>
<li>改變 document.domain</li>
</ol>
<p>我們先開啟 <code>http://alice.example.com:5555</code>，然後載入 <code>http://bob.example.com:5555</code> 的 iframe，接著按下 alice 頁面中的「access iframe content」：</p>
<p><img src="/img/same-site-to-same-origin/p4-error.png" alt="exception"></p>
<p>你會在 console 看到錯誤訊息，寫說：</p>
<blockquote>
<p>Uncaught DOMException: Blocked a frame with origin “<a target="_blank" rel="noopener" href="http://alice.example.com:5555/">http://alice.example.com:5555</a>“ from accessing a cross-origin frame.</p>
</blockquote>
<p>因為 alice 跟 bob 雖然是 same site，但是並不是 same origin，而 iframe 如果要存取到 DOM 的內容，必須是 same origin 才行。</p>
<p>接著我們雙雙按下 alice 跟 bob 頁面中的「update domain」，按完以後再按一次「access iframe content」：</p>
<p><img src="/img/same-site-to-same-origin/p5-success.png" alt="success"></p>
<p>你會看到這一次，我們順便取得了 bob 頁面中的資料，成功把  <code>http://alice.example.com:5555</code> 跟 <code>http://bob.example.com:5555</code> 從 cross origin 變成了 same origin，這就是忍術，same site 變成 same origin 之術！</p>
<p>這一招並不是任意兩個網頁都可以使用的，基本上只有 same site 的網站可以，而且在設置時還會做很多檢查：</p>
<p><img src="/img/same-site-to-same-origin/p6-detail.png" alt="check"></p>
<p>以 github.io 為例，如果 <code>alice.github.io</code> 執行了 <code>document.domain = &#39;github.io&#39;</code>，console 就會跳出錯誤：</p>
<blockquote>
<p>Uncaught DOMException: Failed to set the ‘domain’ property on ‘Document’: ‘github.io’ is a top-level domain.</p>
</blockquote>
<p>為什麼改變 <code>document.domain</code> 後，兩個頁面就會變成是 same origin 呢？其實嚴格來說不是 same origin，而是 same origin-domain，在 <a target="_blank" rel="noopener" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-bcc-content-document">docuemnt</a> 相關的 spec 中有寫到，有些檢查是看 same origin-domain，而不是 same origin。</p>
<p>那怎麼看兩個 origin 是不是 same origin-domain 呢？一起來看看 spec 怎麼說：</p>
<blockquote>
<ol>
<li>If A and B are the same opaque origin, then return true.  </li>
<li>If A and B are both tuple origins, run these substeps:</li>
</ol>
<ul>
<li>If A and B’s schemes are identical, and their domains are identical and non-null, then return true.  </li>
<li>Otherwise, if A and B are same origin and their domains are identical and null, then return true.</li>
</ul>
<ol start="3">
<li>Return false.</li>
</ol>
</blockquote>
<p>如果 A 跟 B 的 scheme 一樣，而且 domain 屬性也一樣而且不是 null 的話，就回傳 true，否則的話檢查 A 跟 B 是不是 same origin 而且 domain 都是 null，成立才回傳 true。</p>
<p>這邊可以看到幾個有趣的地方：</p>
<ol>
<li>一定要兩個網頁都沒有設置 domain 或是都有設置，才有可能回傳 true（這很重要）</li>
<li>如果有設置 domain 的話，same origin-domain 就不檢查 port 了</li>
</ol>
<p><code>document.domain</code> 就是改變 origin tuple 中 domain 這個屬性用的。</p>
<p>在上面的範例中，我們兩個網頁 <code>http://alice.example.com:5555</code> 跟 <code>http://bob.example.com:5555</code> 都將自己的 domain 改成 <code>example.com</code>，所以是 same origin-domain。</p>
<p>底下我們來看看三個有趣的案例。</p>
<h3><span id="案例一單方面改變">案例一：單方面改變</span></h3><p>如果 <code>https://alice.example.com</code> 執行了 <code>document.domain = &#39;example.com&#39;</code>，接著把 <code>https://example.com</code> 嵌入在 iframe 裡面，它們兩個「依舊不是 same origin-domain」，因為 alice 頁面有 domain 屬性，但是 <code>example.com</code> 頁面沒有 domain 屬性。</p>
<p><code>example.com</code> 也要執行 <code>document.domain = &#39;example.com&#39;</code>，兩者才會是 same origin-domain。</p>
<h3><span id="案例二消失的-port">案例二：消失的 port</span></h3><p><code>http://alice.example.com:1234</code> 跟 <code>http://alice.example.com:4567</code>，因為 port 不一樣，所以是 cross origin，但如果兩個頁面都執行了 <code>document.domain = &#39;alice.example.com&#39;</code> 的話，就會變成 same origin-domain，可以存取彼此的 DOM，因為它不看 port。</p>
<h3><span id="案例三我不是原來的我">案例三：我不是原來的我</span></h3><p>假設 <code>http://alice.example.com</code> 把自己嵌入在 iframe 裡面，那 iframe 跟原本的頁面顯然是 same origin，可以存取彼此的 DOM。</p>
<p>但是呢，如果我在頁面上執行了 <code>document.domain = &#39;alice.example.com&#39;</code>，這頁面就會被設置 domain 屬性，而 iframe 裡的頁面並沒有設置 domain 屬性，所以它們就變得不是 same origin-domain 了。</p>
<h2><span id="documentdomain-的淡出及退場">document.domain 的淡出及退場</span></h2><p>用這一招來放寬 same origin 的限制應該滿早就有了，而到現在還沒有拔除掉就是為了相容早期的行為，我猜在早期的時候很多網頁都會用這招，才能夠去存取 same site 但是 cross origin 的頁面。</p>
<p>但這樣做顯然是有風險的，例如說假設某個 subdomain 有 XSS 漏洞，就有機會利用這個方式擴大影響範圍，在 2016 年由 <a target="_blank" rel="noopener" href="https://twitter.com/fin1te">@fin1te</a> 所寫的一篇文章 <a target="_blank" rel="noopener" href="https://whitton.io/articles/xss-on-facebook-via-png-content-types/">An XSS on Facebook via PNGs &amp; Wonky Content Types</a> 中，就利用了這個手法，成功從 subdomain 繞到 <code>www.facebook.com</code> 進行 XSS，提升漏洞的影響力。 </p>
<p>也因為安全性的問題，Chrome 在 2022 年 1 月 11 日於部落格發布了一篇文章：<a target="_blank" rel="noopener" href="https://developer.chrome.com/blog/immutable-document-domain/">Chrome will disable modifying document.domain to relax the same-origin policy</a>，文中說明了最快從 Chrome 101 版開始，就會停止支援更改 <code>document.domain</code>。</p>
<p>原本的行為可以用 <code>postMessage</code> 或是 <code>Channel Messaging API</code> 來取代，只是要多寫一些程式碼就是了，畢竟沒辦法像原本直接操作 DOM 這麼方便。</p>
<p>而如果有網頁想繼續使用這個修改 document.domain 的功能，需要在 response header 裡面帶上 <code>Origin-Agent-Cluster: ?0</code>，才能繼續使用。</p>
<p>文中也有附上關於這個改動的相關討論串：<a target="_blank" rel="noopener" href="https://github.com/w3ctag/design-reviews/issues/564">Deprecating document.domain setter. #564</a></p>
<h2><span id="結語">結語</span></h2><p>我似乎是兩三年以前知道這招的，知道可以透過改變 <code>document.domain</code> 讓兩個網站從 cross origin 變成 same origin，但我自己在實務上是還沒看過有人這樣用就是了。</p>
<p>這次會想寫這篇，就是因為前幾天看到了文末附的文章，得知了在不久後的未來，這一招將會被 Chrome 預設停用。雖然說出發點只是為了寫這個行為，但其實花更多時間在 origin 以及 site 的定義，在看 spec 的過程中也注意到一些以前沒注意到的盲點，像是 same site 會看 public suffix 之類的。</p>
<p>關於 origin，其實還有更多細節可以談，例如說到底什麼是 opaque origin？但一方面再講下去就太長，另一方面我也還沒仔細研究，先留下一些參考資料，未來有機會再把這個坑補完：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://github.com/w3c/wpub/issues/321">What is an “opaque origin” and why do we care? #321</a></li>
<li><a target="_blank" rel="noopener" href="https://chromium.googlesource.com/chromium/src/+/HEAD/url/origin.h">chromium&#x2F;src&#x2F;+&#x2F;HEAD&#x2F;url&#x2F;origin.h</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy#file_origins">File origins</a></li>
</ol>
<p>最後，希望這篇有讓大家更理解什麼是 same origin，什麼又是 same site，以及更細節的 same origin-domain 還有 schemelessly same site。</p>
<p>參考資料：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://html.spec.whatwg.org/multipage/origin.html#origin">HTML spec</a></li>
<li><a target="_blank" rel="noopener" href="https://url.spec.whatwg.org/#host-registrable-domain">URL spec</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.kalan.dev/2021-11-09-url-and-samesite/">如何判斷兩個網域的擁有者是否相同？</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.chrome.com/blog/immutable-document-domain/">Chrome will disable modifying document.domain to relax the same-origin policy</a></li>
</ol>

    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/Front-end/">#Front-end</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/JavaScript/">#JavaScript</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/2022/01/19/sql-injection-in-action/">SQL injection 實戰：在限制底下提升速度</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/2022/01/15/js-history/">從歷史開始認識 JavaScript</a>
            
        </span>
    </div>
    
</article>




<div class="comments">
    <h3 class="title is-4">評論</h3>
    <script src="https://utteranc.es/client.js"
        repo="aszx87410/huli-blog"
        issue-term="title"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>

    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2024 Huli&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow" title="GitHub" target="_blank" rel="noopener" href="https://github.com/ppoffice/hexo-theme-minos">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
<div class="column is-narrow has-text-centered">
    <div class="dropdown is-up is-right is-hoverable" style="margin-top: -0.2em;">
        <div class="dropdown-trigger">
            <button class="button is-small" aria-haspopup="true">
                <span class="icon">
                    <i class="fas fa-globe"></i>
                </span>
                <span>繁體中文</span>
                <span class="icon is-small">
            <i class="fas fa-angle-down" aria-hidden="true"></i>
          </span>
            </button>
        </div>
        <div class="dropdown-menu has-text-left" role="menu" style="top:100%">
            <div class="dropdown-content">
            <!-- NOTE: 永遠回到首頁 -->
            
                <a href="/2022/01/16/en/same-site-to-same-origin-document-domain/" class="dropdown-item">
                    English
                </a>
            
            </div>
        </div>
    </div>
</div>

        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>



    
    
    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    



<script src="/js/script.js?v=3.js"></script>


    
</body>
</html>