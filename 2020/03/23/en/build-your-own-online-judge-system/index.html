<!DOCTYPE html>
<html class="has-navbar-fixed-top" lang="en">
<head>
    <meta charset="utf-8">
<title>How to Build Your Own Online Judge System - Huli&#39;s blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1">


            
<link href="https://blog.huli.tw/2020/03/23/build-your-own-online-judge-system/" rel="alternate" hreflang="zh-TW" />
            
    




    
<link rel="canonical" href="https://blog.huli.tw/2020/03/23/en/build-your-own-online-judge-system/">
    





    <meta name="description" content="IntroductionFirst, let’s briefly introduce what an Online Judge (OJ) system is. Simply put, it is a system like LeetCode that allows you to submit code for problem-solving and then lets the system che">
<meta property="og:type" content="article">
<meta property="og:title" content="How to Build Your Own Online Judge System">
<meta property="og:url" content="https://blog.huli.tw/2020/03/23/en/build-your-own-online-judge-system/index.html">
<meta property="og:site_name" content="Huli&#39;s blog">
<meta property="og:description" content="IntroductionFirst, let’s briefly introduce what an Online Judge (OJ) system is. Simply put, it is a system like LeetCode that allows you to submit code for problem-solving and then lets the system che">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://blog.huli.tw/img/build-your-own-online-judge-system/cover-en.png">
<meta property="article:published_time" content="2020-03-23T14:58:31.000Z">
<meta property="article:modified_time" content="2023-06-20T05:46:56.899Z">
<meta property="article:author" content="Huli">
<meta property="article:tag" content="Others">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://blog.huli.tw/img/build-your-own-online-judge-system/cover-en.png">



<link rel="alternative" href="/atom.xml" title="How to Build Your Own Online Judge System" type="application/atom+xml">



<link rel="icon" href="/img/lidemy_logo.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">


<link rel="stylesheet" href="/css/bulma.css?v=2.css">



<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" />


<link rel="stylesheet" href="/css/style.css?v=4.css">





    
    
    
    
    
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1393J2EVCZ"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1393J2EVCZ');
</script>


    


<meta name="generator" content="Hexo 6.3.0"></head>
<body>
    <script>
        if (localStorage.getItem('dark-mode')) {
            if (localStorage.getItem('dark-mode') === 'true') {
                document.body.classList.add('dark-mode')
            }
        } else {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark-mode')
            }
        }
    </script>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/en">
                
                    
                    Huli&#39;s blog
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/en/archives">Archive</a>
            
            <a class="navbar-item "
               href="/en/categories">Categories</a>
            
            <a class="navbar-item "
               href="/en/about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            
            <div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc">
                <a class="navbar-item" title="Table of Contents">
                    Table of Contents
                </a>
                <div class="navbar-dropdown">
                    
                    
                    
                    
                    <a class="navbar-item" href="#introduction">1&nbsp;&nbsp;<b>Introduction</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#open-source-oj-systems">2&nbsp;&nbsp;<b>Open Source OJ Systems</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#dmoj">2.1&nbsp;&nbsp;DMOJ</a>
                    
                    
                    
                    <a class="navbar-item" href="#noj">2.2&nbsp;&nbsp;NOJ</a>
                    
                    
                    
                    <a class="navbar-item" href="#qduoj">2.3&nbsp;&nbsp;QDUOJ</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#further-study-of-qduoj">3&nbsp;&nbsp;<b>Further Study of QDUOJ</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#writing-your-own-oj">4&nbsp;&nbsp;<b>Writing your own OJ</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#conclusion">5&nbsp;&nbsp;<b>Conclusion</b></a>
                    
                </div>
            </div>
            
            
            <a class="navbar-item" target="_blank" title="Twitter" href="https://twitter.com/aszx87410">
                
                <i class="fab fa-twitter"></i>
                
            </a>
               
            <a class="navbar-item" target="_blank" title="RSS" href="/atom-en.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
               
            
            <a class="navbar-item btn-dark-mode" title="dark-mode" href="#">
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="15" height="15" viewBox="0 0 256 256" xml:space="preserve">
                    <defs>
                    </defs>
                    <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)" >
                        <path d="M 87.823 60.7 c -0.463 -0.423 -1.142 -0.506 -1.695 -0.214 c -15.834 8.398 -35.266 2.812 -44.232 -12.718 c -8.966 -15.53 -4.09 -35.149 11.101 -44.665 c 0.531 -0.332 0.796 -0.963 0.661 -1.574 c -0.134 -0.612 -0.638 -1.074 -1.259 -1.153 c -9.843 -1.265 -19.59 0.692 -28.193 5.66 C 13.8 12.041 6.356 21.743 3.246 33.35 S 1.732 57.08 7.741 67.487 c 6.008 10.407 15.709 17.851 27.316 20.961 C 38.933 89.486 42.866 90 46.774 90 c 7.795 0 15.489 -2.044 22.42 -6.046 c 8.601 -4.966 15.171 -12.43 18.997 -21.586 C 88.433 61.79 88.285 61.123 87.823 60.7 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: #ffa716; fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                    </g>
                    </svg>
                </div>
            </a>
            
               <a class="navbar-item" href="/2020/03/23/build-your-own-online-judge-system/">中文</a>
            
            

        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
      
      <div data-nosnippet class="self-notice">
        If you have any thoughts on my blog or articles and you want to let me know, you can either post a comment below(public) or tell me via this <a href="https://forms.gle/SjJZ4cnNs6NnjXQG8" target="_blank">feedback form</a>
      </div>
      
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            How to Build Your Own Online Judge System
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2020-03-23T14:58:31.000Z" itemprop="datePublished">23 March 2020</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/en/categories/Others/">Others</a>
        </span>
        
        
        
        <spen data-nosnippet class="column is-narrow">(Translated by ChatGPT)</span>
        
    </div>
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2><span id="introduction">Introduction</span></h2><p>First, let’s briefly introduce what an Online Judge (OJ) system is. Simply put, it is a system like LeetCode that allows you to submit code for problem-solving and then lets the system check it and give you the final result. Below is a screenshot of LeetCode:</p>
<p><img src="https://static.coderbridge.com/img/aszx87410/47ea051cb4244849908286177e42a38f.png" alt="LeetCode interface"></p>
<p>Before LeetCode became popular, the most well-known OJ was probably <a target="_blank" rel="noopener" href="https://onlinejudge.org/">UVa Online Judge</a>, also known as ACM. In Taiwan, <a target="_blank" rel="noopener" href="https://zerojudge.tw/">ZeroJudge</a> is more famous.</p>
<p>If you happen to have a need and want to build your own OJ, what should you do?</p>
<span id="more"></span>

<h2><span id="open-source-oj-systems">Open Source OJ Systems</span></h2><p>A search on the internet will reveal several open-source OJ systems, among which the following three have more stars and appear to be more stable:</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://github.com/DMOJ/online-judge">DMOJ</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/ZsgsDesign/NOJ">NOJ</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/QingdaoU/OnlineJudge">QDUOJ</a></li>
</ol>
<h3><span id="dmoj">DMOJ</span></h3><p><img src="https://static.coderbridge.com/img/aszx87410/0664ed7eeb6b478db132935202dee433.png"></p>
<p>This system appears to have the most complete and feature-rich functionality, and supports the most languages, up to 60 or so! It also supports third-party logins such as Google, Facebook, and Github. The backend is written in Python and is continuously maintained, with fairly complete <a target="_blank" rel="noopener" href="https://docs.dmoj.ca/#/site/installation">documentation</a>.</p>
<p>The only drawback is that the interface is a bit plain and not as appealing.</p>
<h3><span id="noj">NOJ</span></h3><p><img src="https://static.coderbridge.com/img/aszx87410/950d37d94365471ab8cf0b1f5f820d31.png"></p>
<p>This system was developed by the Nanjing University of Posts and Telecommunications in China and is written in Laravel. The interface uses Material UI and looks more modern, but the documentation is less complete.</p>
<h3><span id="qduoj">QDUOJ</span></h3><p>This system was developed by Qingdao University in China. The backend is written in Python + Django, the frontend is in Vue, and it is deployed using Docker, making it simple and fast. The supported programming languages are C, C++, Java, and Python. The interface uses Ant Design.</p>
<p><img src="https://static.coderbridge.com/img/aszx87410/8d236caa632b42c6bde5c33c06f2ef3f.png"></p>
<p>Which one to choose depends on your needs. If the documentation provided on GitHub is complete, just follow the instructions. If it is incomplete, you can ask questions through Issues. You don’t need to worry too much if you don’t speak English well, as these three repositories can be communicated in Chinese.</p>
<p>I chose the last one, the OJ system open-sourced by Qingdao University, because I really like the interface and it is the easiest to deploy among the three.</p>
<p>The deployment process is here: <a target="_blank" rel="noopener" href="https://github.com/QingdaoU/OnlineJudgeDeploy/tree/2.0">https://github.com/QingdaoU/OnlineJudgeDeploy/tree/2.0</a>. Since it is deployed using Docker, it is really easy. Basically, just download the docker-compose.yml file and run a command to finish it.</p>
<p>Let’s take a look at the contents of docker-compose.yml:</p>
<pre class="line-numbers language-none"><code class="language-none">version: &quot;3&quot;
services:

  oj-redis:
    image: redis:4.0-alpine
    container_name: oj-redis
    restart: always
    volumes:
      - .&#x2F;data&#x2F;redis:&#x2F;data
  
  oj-postgres:
    image: postgres:10-alpine
    container_name: oj-postgres
    restart: always
    volumes:
      - .&#x2F;data&#x2F;postgres:&#x2F;var&#x2F;lib&#x2F;postgresql&#x2F;data
    environment:
      - POSTGRES_DB&#x3D;onlinejudge
      - POSTGRES_USER&#x3D;onlinejudge
      - POSTGRES_PASSWORD&#x3D;onlinejudge

  judge-server:
    image: registry.cn-hangzhou.aliyuncs.com&#x2F;onlinejudge&#x2F;judge_server
    container_name: judge-server
    restart: always
    read_only: true
    cap_drop:
      - SETPCAP
      - MKNOD
      - NET_BIND_SERVICE
      - SYS_CHROOT
      - SETFCAP
      - FSETID
    tmpfs:
      - &#x2F;tmp
    volumes:
      - .&#x2F;data&#x2F;backend&#x2F;test_case:&#x2F;test_case:ro
      - .&#x2F;data&#x2F;judge_server&#x2F;log:&#x2F;log
      - .&#x2F;data&#x2F;judge_server&#x2F;run:&#x2F;judger
    environment:
      - SERVICE_URL&#x3D;http:&#x2F;&#x2F;judge-server:8080
      - BACKEND_URL&#x3D;http:&#x2F;&#x2F;oj-backend:8000&#x2F;api&#x2F;judge_server_heartbeat&#x2F;
      - TOKEN&#x3D;CHANGE_THIS
      # - judger_debug&#x3D;1
  
  oj-backend:
    image: registry.cn-hangzhou.aliyuncs.com&#x2F;onlinejudge&#x2F;oj_backend
    container_name: oj-backend
    restart: always
    depends_on:
      - oj-redis
      - oj-postgres
      - judge-server
    volumes:
      - .&#x2F;data&#x2F;backend:&#x2F;data
    environment:
      - POSTGRES_DB&#x3D;onlinejudge
      - POSTGRES_USER&#x3D;onlinejudge
      - POSTGRES_PASSWORD&#x3D;onlinejudge
      - JUDGE_SERVER_TOKEN&#x3D;CHANGE_THIS
      # - FORCE_HTTPS&#x3D;1
      # - STATIC_CDN_HOST&#x3D;cdn.oj.com
    ports:
      - &quot;0.0.0.0:80:8000&quot;
      - &quot;0.0.0.0:443:1443&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>You can see that it is divided into four services: Redis, Postgres, judge-server, and oj-backend.</p>
<p>However, I had one more requirement at the time, which was to support JavaScript. To achieve this goal, it was not enough to just deploy it. I also had to study how it worked.</p>
<h2><span id="further-study-of-qduoj">Further Study of QDUOJ</span></h2><p>First, let’s take a look at the architecture of this system. According to the documentation on GitHub, it is divided into several modules:</p>
<ol>
<li>Backend(Django): <a target="_blank" rel="noopener" href="https://github.com/QingdaoU/OnlineJudge">https://github.com/QingdaoU/OnlineJudge</a></li>
<li>Frontend(Vue): <a target="_blank" rel="noopener" href="https://github.com/QingdaoU/OnlineJudgeFE">https://github.com/QingdaoU/OnlineJudgeFE</a></li>
<li>Judger Sandbox(Seccomp): <a target="_blank" rel="noopener" href="https://github.com/QingdaoU/Judger">https://github.com/QingdaoU/Judger</a></li>
<li>JudgeServer(A wrapper for Judger): <a target="_blank" rel="noopener" href="https://github.com/QingdaoU/JudgeServer">https://github.com/QingdaoU/JudgeServer</a></li>
</ol>
<p>The issue that we are most concerned about (how to add a new language) has already been raised in an issue: <a target="_blank" rel="noopener" href="https://github.com/QingdaoU/OnlineJudge/issues/149">How to add more language support, such as Ruby</a>.</p>
<p>It is mentioned that modifying this file is enough: <a target="_blank" rel="noopener" href="https://github.com/QingdaoU/OnlineJudge/blob/master/judge/languages.py">https://github.com/QingdaoU/OnlineJudge/blob/master/judge/languages.py</a>.</p>
<p>This file is a configuration file, and you can guess what the Judge Server will do here. Here, the configuration of each language will have <code>compile_command</code> and <code>command</code>. The former is used to obtain the compilation command, and the latter is used to obtain the command to run the program. Since the input and output of this OJ are all through <code>stdin</code>&#x2F;<code>stdout</code>, when you want to add a new programming language, you just need to tell the system how to execute it.</p>
<p>On the contrary, some OJs use functions to fill in the blanks, such as LeetCode mentioned at the beginning. At this time, if you want to add a new language, it will be more troublesome because you need to provide a function template additionally.</p>
<p>In theory, we just need to add such settings:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">js_lang_config <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
   <span class="token string">"run"</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
       <span class="token string">"exe_name"</span><span class="token punctuation">:</span> <span class="token string">"solution.js"</span><span class="token punctuation">,</span>
       <span class="token string">"command"</span><span class="token punctuation">:</span> <span class="token string">"/usr/bin/nodejs &#123;exe_path&#125;"</span><span class="token punctuation">,</span>
       <span class="token string">"seccomp_rule"</span><span class="token punctuation">:</span> <span class="token string">"general"</span><span class="token punctuation">,</span>
   <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>But if you run it like this, you will find a problem. Someone has already reported it: <a target="_blank" rel="noopener" href="https://github.com/QingdaoU/JudgeServer/issues/16">problem with adding js to language configs</a>. The solution is to set <code>seccomp_rule</code> to <code>None</code>.</p>
<p>What is <code>seccomp</code>? This is related to the principle of OJ! You can think carefully about the most important question in OJ:</p>
<blockquote>
<p>How to safely execute user-submitted code?</p>
</blockquote>
<p>If you don’t know what this question is asking, you can imagine the following situations:</p>
<ol>
<li>What if someone writes a code that restarts the computer?</li>
<li>What if someone writes an infinite loop?</li>
<li>What if someone writes a program that sends the host account password to an external server?</li>
</ol>
<p>From this, it can be seen that executing code is not that simple, and this is also the core part of OJ.</p>
<p>The QDUOJ Judger source code is here: <a target="_blank" rel="noopener" href="https://github.com/QingdaoU/Judger/tree/newnew/src">https://github.com/QingdaoU/Judger/tree/newnew/src</a>.</p>
<p>It is written in C, forks a new process, sets some rules, and then uses <a target="_blank" rel="noopener" href="https://github.com/QingdaoU/Judger/blob/newnew/src/child.c#L163">execve</a> to execute the command. In the <a target="_blank" rel="noopener" href="https://github.com/QingdaoU/Judger/blob/b6414e7a6715eb013b1ffeb7cfb04626a3ff5b4e/src/rules/general.c">code</a>, it can also be seen that <a target="_blank" rel="noopener" href="https://blog.betamao.me/2019/01/23/Linux%E6%B2%99%E7%AE%B1%E4%B9%8Bseccomp/">seccomp</a> is used to prevent the content mentioned above.</p>
<p>In short, QDUOJ is well-layered, and the execution process is roughly as follows:</p>
<ol>
<li>Enter the front-end page made by Vue.</li>
<li>Submit the code and call the back-end API (Python).</li>
<li>The back-end API then calls the Judge Server API (Go).</li>
<li>The Judge Server API calls the Judger to execute the command (C, execve + seccomp execution).</li>
</ol>
<p>So each project is responsible for its own tasks.</p>
<p>Going back to the issue of adding JavaScript mentioned earlier, even if <code>seccomp_rule</code> is set to <code>None</code>, there will still be errors when executing JavaScript. After studying for a day or two, I found that the problem was that the memory limit of the problem was too small. I guess that Node.js will consume more memory when it is executed, so as long as the memory is increased (for example, to 1024MB), it will be solved.</p>
<p>However, it is not over yet. There is one last problem, which is that the Node.js version on Ubuntu 16.04 is quite old, and a new version is needed to use ES6 syntax. The solution is to modify the <a target="_blank" rel="noopener" href="https://github.com/Lidemy/JudgeServer/commit/9a98532f0f3504da20d13bd0aec4f4279a2a1fd2">Dockerfile</a> of the JudgeServer and add a command to install the new version of Node.js.</p>
<p>After all the changes are made, you can deploy your own version! Just build the docker image first, and then modify the docker-compose file that we operated at the beginning.</p>
<p>In summary, if you don’t want to make any changes and just want to deploy, I highly recommend QDUOJ. It’s easy to deploy and has a nice interface.</p>
<h2><span id="writing-your-own-oj">Writing your own OJ</span></h2><p>I once tried to write my own OJ, but it was a very basic version: <a target="_blank" rel="noopener" href="https://lidemy-oj.netlify.com/problems">https://lidemy-oj.netlify.com/problems</a></p>
<p><img src="https://static.coderbridge.com/img/aszx87410/016853899af54a40b11801d3e1d5f8d7.png"></p>
<p>At that time, I didn’t think of using Linux commands to run it. Instead, I found the library <a target="_blank" rel="noopener" href="https://github.com/patriksimek/vm2">VM2</a> and thought it would be useful, so I had the idea of writing this simple OJ.</p>
<p>This simple OJ only supports JavaScript and uses the function writing method like LeetCode instead of standard input and output. I spent some time writing the prototype of the Judger:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">&#123;</span><span class="token constant">VM</span><span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vm2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> lodash <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token constant">RESULT_CODE</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token constant">AC</span><span class="token operator">:</span> <span class="token string">'AC'</span><span class="token punctuation">,</span>
  <span class="token constant">WA</span><span class="token operator">:</span> <span class="token string">'WA'</span><span class="token punctuation">,</span>
  <span class="token constant">CE</span><span class="token operator">:</span> <span class="token string">'CE'</span><span class="token punctuation">,</span>
  <span class="token constant">RE</span><span class="token operator">:</span> <span class="token string">'RE'</span><span class="token punctuation">,</span>
  <span class="token constant">TLE</span><span class="token operator">:</span> <span class="token string">'TLE'</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Judge</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">schema<span class="token punctuation">,</span> functionCode<span class="token punctuation">,</span> timeout <span class="token operator">=</span> <span class="token number">3000</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>schema <span class="token operator">=</span> schema
    <span class="token keyword">this</span><span class="token punctuation">.</span>functionCode <span class="token operator">=</span> functionCode
    <span class="token keyword">this</span><span class="token punctuation">.</span>vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VM</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        timeout<span class="token punctuation">,</span>
        <span class="token literal-property property">sandbox</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token literal-property property">__equal</span><span class="token operator">:</span> lodash<span class="token punctuation">.</span>isEqual
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">t</span><span class="token punctuation">(</span><span class="token parameter">any</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>any<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">addWrapper</span><span class="token punctuation">(</span><span class="token parameter">schema<span class="token punctuation">,</span> code<span class="token punctuation">,</span> testCase</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>code<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">
      (() => __equal(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>schema<span class="token punctuation">.</span>funcName<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">.apply(null, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">t</span><span class="token punctuation">(</span>testCase<span class="token punctuation">.</span>input<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">), </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">t</span><span class="token punctuation">(</span>testCase<span class="token punctuation">.</span>output<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">))()
    </span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">runTest</span><span class="token punctuation">(</span><span class="token parameter">testCase</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>functionCode<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token constant">RESULT_CODE</span><span class="token punctuation">.</span><span class="token constant">RE</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">const</span> wrapperedCode <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addWrapper</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>functionCode<span class="token punctuation">,</span> testCase<span class="token punctuation">)</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>wrapperedCode<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token constant">RESULT_CODE</span><span class="token punctuation">.</span><span class="token constant">AC</span><span class="token operator">:</span> <span class="token constant">RESULT_CODE</span><span class="token punctuation">.</span><span class="token constant">WA</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> e<span class="token punctuation">.</span>message <span class="token operator">===</span> <span class="token string">'Script execution timed out.'</span> <span class="token operator">?</span> <span class="token constant">RESULT_CODE</span><span class="token punctuation">.</span><span class="token constant">TLE</span> <span class="token operator">:</span> <span class="token constant">RESULT_CODE</span><span class="token punctuation">.</span><span class="token constant">WA</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'err'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> testCases <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>testCases
    <span class="token keyword">const</span> testResult <span class="token operator">=</span> testCases<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">testCase</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">runTest</span><span class="token punctuation">(</span>testCase<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> correctCount <span class="token operator">=</span> testResult<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sum<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> sum <span class="token operator">+</span> <span class="token punctuation">(</span>res <span class="token operator">===</span> <span class="token string">'AC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">score</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>correctCount <span class="token operator">*</span> <span class="token punctuation">(</span> <span class="token number">100</span> <span class="token operator">/</span> testResult<span class="token punctuation">.</span>length <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">result</span><span class="token operator">:</span> testResult
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> test1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token number">3</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> test2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token number">6</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> problemSchema <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">funcName</span><span class="token operator">:</span> <span class="token string">'add'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">testCases</span><span class="token operator">:</span> <span class="token punctuation">[</span>test1<span class="token punctuation">,</span> test2<span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">function add(a, b)&#123;
    return 3
  &#125;</span><span class="token template-punctuation string">`</span></span>

<span class="token keyword">const</span> judge <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Judge</span><span class="token punctuation">(</span>problemSchema<span class="token punctuation">,</span> input<span class="token punctuation">)</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> judge<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>The key code is <code>addWrapper</code> and <code>runTest</code>. In <code>addWrapper</code>, the function code passed in is executed, and the result is compared with the output to return true or false, indicating whether the match is successful or failed, and whether the answer is correct.</p>
<p>Then <code>problemSchema</code> is the format of the problem, which needs to have a <code>funcName</code> and <code>testCases</code>, and each test case has an <code>input</code> and <code>output</code>. With the above code, a super simple JS function-based Judger can be implemented.</p>
<p>However, this Judger has many shortcomings and cannot be compared with the execution method mentioned above.</p>
<p>Later, when I was researching, I found some good open-source solutions that can be referred to if someone wants to write their own OJ in the future.</p>
<p>The first is the sandbox <a target="_blank" rel="noopener" href="https://github.com/ioi/isolate">isolate</a> open-sourced by IOI, which can safely execute commands.</p>
<p>The second is even more amazing, it directly gives you the Judge API, and it’s free: <a target="_blank" rel="noopener" href="https://github.com/judge0/api">Judge0 API</a>. As long as you pass in the input according to its format, it will tell you the judging result, so you don’t even need to make your own Judge Server.</p>
<h2><span id="conclusion">Conclusion</span></h2><p>I wanted to build an OJ before, so I looked for a lot of information, and the biggest problem I encountered was: “I want an OJ that supports JavaScript”, because many of them don’t support it. Later, I had to write my own, which is the little toy written in JS mentioned above. Although it is still usable, many functions are incomplete, and it only supports the simplest answering.</p>
<p>Until January of this year, I wanted to create a real OJ. I originally considered whether to write it myself, but later thought it was too troublesome and decided to find an existing one to modify and add JS support. Although I still encountered some problems, fortunately, I succeeded in the end.</p>
<p>The final result is here: <a target="_blank" rel="noopener" href="https://oj.lidemy.com/">https://oj.lidemy.com/</a></p>
<p>This OJ is designed to accompany my latest free online course: <a target="_blank" rel="noopener" href="https://lidemy.com/p/alg101-leetcode">[ALG101] Don’t rush to write LeetCode</a>, which is a course for beginners. I hope to lay a solid foundation through a series of simple problems and cultivate programming thinking ability. Interested friends can take a look.</p>

    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/en/tags/Others/">#Others</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/2020/03/24/en/console-log-bug/">Console.log Issues You Need to Pay Attention to</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/2020/02/20/en/let-vs-var-bytecode/">Exploring the Performance Issues of let and var from V8 bytecode</a>
            
        </span>
    </div>
    
</article>




<div class="comments">
    <h3 class="title is-4">Comments</h3>
    <script src="https://utteranc.es/client.js"
        repo="aszx87410/huli-blog"
        issue-term="title"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>

    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2025 Huli&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow" title="GitHub" target="_blank" rel="noopener" href="https://github.com/ppoffice/hexo-theme-minos">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
<div class="column is-narrow has-text-centered">
    <div class="dropdown is-up is-right is-hoverable" style="margin-top: -0.2em;">
        <div class="dropdown-trigger">
            <button class="button is-small" aria-haspopup="true">
                <span class="icon">
                    <i class="fas fa-globe"></i>
                </span>
                <span>English</span>
                <span class="icon is-small">
            <i class="fas fa-angle-down" aria-hidden="true"></i>
          </span>
            </button>
        </div>
        <div class="dropdown-menu has-text-left" role="menu" style="top:100%">
            <div class="dropdown-content">
            <!-- NOTE: 永遠回到首頁 -->
            
                <a href="/2020/03/23/build-your-own-online-judge-system/" class="dropdown-item">
                    繁體中文
                </a>
            
            </div>
        </div>
    </div>
</div>

        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>



    
    
    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    



<script src="/js/script.js?v=3.js"></script>


    
</body>
</html>