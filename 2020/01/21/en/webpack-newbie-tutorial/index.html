<!DOCTYPE html>
<html class="has-navbar-fixed-top" lang="en">
<head>
    <meta charset="utf-8">
<title>Introduction to webpack and snowpack for beginners - Huli&#39;s blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1">



            
<link href="https://blog.huli.tw/2020/01/21/webpack-newbie-tutorial/" rel="alternate" hreflang="zh-TW" />
            
    




    
<link rel="canonical" href="https://blog.huli.tw/2020/01/21/en/webpack-newbie-tutorial/">
    





    <meta name="description" content="IntroductionIn my blog, there are actually few tool-related tutorial articles. One reason is that these tool-related articles are all similar, and the other reason is that I am lazy and many step-by-s">
<meta property="og:type" content="article">
<meta property="og:title" content="Introduction to webpack and snowpack for beginners">
<meta property="og:url" content="https://blog.huli.tw/2020/01/21/en/webpack-newbie-tutorial/index.html">
<meta property="og:site_name" content="Huli&#39;s blog">
<meta property="og:description" content="IntroductionIn my blog, there are actually few tool-related tutorial articles. One reason is that these tool-related articles are all similar, and the other reason is that I am lazy and many step-by-s">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://blog.huli.tw/img/webpack-newbie-tutorial/cover-en.png">
<meta property="article:published_time" content="2020-01-21T08:41:17.000Z">
<meta property="article:modified_time" content="2023-06-20T05:46:56.932Z">
<meta property="article:author" content="Huli">
<meta property="article:tag" content="webpack">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://blog.huli.tw/img/webpack-newbie-tutorial/cover-en.png">



<link rel="alternative" href="/atom.xml" title="Introduction to webpack and snowpack for beginners" type="application/atom+xml">



<link rel="icon" href="/img/lidemy_logo.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">


<link rel="stylesheet" href="/css/bulma.css?v=2.css">



<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" />


<link rel="stylesheet" href="/css/style.css?v=3.css">





    
    
    
    
    
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1393J2EVCZ"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1393J2EVCZ');
</script>


    


<meta name="generator" content="Hexo 6.3.0"></head>
<body>
    <script>
        if (localStorage.getItem('dark-mode')) {
            if (localStorage.getItem('dark-mode') === 'true') {
                document.body.classList.add('dark-mode')
            }
        } else {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark-mode')
            }
        }
    </script>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/en">
                
                    
                    Huli&#39;s blog
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/en/archives">Archive</a>
            
            <a class="navbar-item "
               href="/en/categories">Categories</a>
            
            <a class="navbar-item "
               href="/en/about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            
            <div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc">
                <a class="navbar-item" title="Table of Contents">
                    Table of Contents
                </a>
                <div class="navbar-dropdown">
                    
                    
                    
                    
                    <a class="navbar-item" href="#introduction">1&nbsp;&nbsp;<b>Introduction</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#modularity">2&nbsp;&nbsp;<b>Modularity</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#nodejs-modules">3&nbsp;&nbsp;<b>Node.js Modules</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#manually-adding-commonjs-support">4&nbsp;&nbsp;<b>Manually adding CommonJS support</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#introduction-to-browserify">5&nbsp;&nbsp;<b>Introduction to Browserify</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#exploring-webpack">6&nbsp;&nbsp;<b>Exploring Webpack</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#standardization-of-es6-modules">7&nbsp;&nbsp;<b>Standardization of ES6 modules</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#exploring-webpack-again">8&nbsp;&nbsp;<b>Exploring webpack again</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#snowpack">9&nbsp;&nbsp;<b>Snowpack</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#conclusion">10&nbsp;&nbsp;<b>Conclusion</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#q-why-do-many-projects-such-as-react-need-to-be-built-before-deployment-what-is-this-step-doing">10.1&nbsp;&nbsp;Q: Why do many projects (such as React) need to be built before deployment? What is this step doing?</a>
                    
                    
                    
                    <a class="navbar-item" href="#q-do-you-know-the-difference-between-requiremoduleexports-and-importexport">10.2&nbsp;&nbsp;Q: Do you know the difference between require/module.exports and import/export?</a>
                    
                    
                    
                    <a class="navbar-item" href="#q-do-you-know-that-these-two-syntaxes-importexport-cannot-be-used-casually-on-browsers">10.3&nbsp;&nbsp;Q: Do you know that these two syntaxes import/export cannot be used casually on browsers?</a>
                    
                    
                    
                    <a class="navbar-item" href="#q-do-you-know-why-you-need-to-use-webpack">10.4&nbsp;&nbsp;Q: Do you know why you need to use webpack?</a>
                    
                    
                    
                    <a class="navbar-item" href="#q-do-you-know-why-webpack-needs-a-loader">10.5&nbsp;&nbsp;Q: Do you know why webpack needs a loader?</a>
                    
                </div>
            </div>
            
            
            <a class="navbar-item" target="_blank" title="Twitter" href="https://twitter.com/aszx87410">
                
                <i class="fab fa-twitter"></i>
                
            </a>
               
            <a class="navbar-item" target="_blank" title="RSS" href="/atom.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
               
            
            <a class="navbar-item btn-dark-mode" title="dark-mode" href="#">
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="15" height="15" viewBox="0 0 256 256" xml:space="preserve">
                    <defs>
                    </defs>
                    <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)" >
                        <path d="M 87.823 60.7 c -0.463 -0.423 -1.142 -0.506 -1.695 -0.214 c -15.834 8.398 -35.266 2.812 -44.232 -12.718 c -8.966 -15.53 -4.09 -35.149 11.101 -44.665 c 0.531 -0.332 0.796 -0.963 0.661 -1.574 c -0.134 -0.612 -0.638 -1.074 -1.259 -1.153 c -9.843 -1.265 -19.59 0.692 -28.193 5.66 C 13.8 12.041 6.356 21.743 3.246 33.35 S 1.732 57.08 7.741 67.487 c 6.008 10.407 15.709 17.851 27.316 20.961 C 38.933 89.486 42.866 90 46.774 90 c 7.795 0 15.489 -2.044 22.42 -6.046 c 8.601 -4.966 15.171 -12.43 18.997 -21.586 C 88.433 61.79 88.285 61.123 87.823 60.7 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: #ffa716; fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                    </g>
                    </svg>
                </div>
            </a>
            
               <a class="navbar-item" href="/2020/01/21/webpack-newbie-tutorial/">中文</a>
            
            

        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
      
      <div data-nosnippet class="self-notice">
        If you have any thoughts on my blog or articles and you want to let me know, you can either post a comment below(public) or tell me via this <a href="https://forms.gle/SjJZ4cnNs6NnjXQG8" target="_blank">feedback form</a>
      </div>
      
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            Introduction to webpack and snowpack for beginners
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2020-01-21T08:41:17.000Z" itemprop="datePublished">21 January 2020</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/en/categories/Front-end/">Front-end</a>
        </span>
        
        
        
        <spen data-nosnippet class="column is-narrow">(Translated by ChatGPT)</span>
        
    </div>
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2><span id="introduction">Introduction</span></h2><p>In my blog, there are actually few tool-related tutorial articles. One reason is that these tool-related articles are all similar, and the other reason is that I am lazy and many step-by-step tutorials require detailed descriptions and rich screenshots, which is not suitable for me.</p>
<p>But this time I decided to write this topic because I think webpack is a tool that beginners are not easy to understand, and even if they understand it, they may not really understand it. In other words, it is a tool that is often misunderstood.</p>
<p>This is not a problem with webpack itself, but many beginners now start with React or Vue directly in front-end development, and they all use the CLI tools provided by them. When they need to customize some settings, they will notice: “Oh, there is a thing called webpack.”</p>
<p>CLI tools bring convenience, and the advantage is that beginners can quickly get started without worrying about those cumbersome settings; the disadvantage is that if beginners are not aware of the tools behind them, when the tools are broken, cannot be used, or need to be modified somewhere, it will be the beginning of a nightmare.</p>
<p>In order to reduce this situation, I decided to write this article, hoping to introduce everyone to the concept of webpack and modularity from the source. You must first know what a module is to understand what webpack is.</p>
<p>At the beginning, I want to let everyone think about their familiarity with modularity and webpack through a few questions:</p>
<ol>
<li>Why do many projects (such as React) need to be built before deployment? What is this step doing?</li>
<li>Do you know the difference between <code>require/module.exports</code> and <code>import/export</code>?</li>
<li>Do you know that these two syntaxes of import and export cannot be used casually on the browser?</li>
<li>Do you know why to use webpack?</li>
<li>Do you know why webpack needs a loader?</li>
</ol>
<p>These questions should inspire you a little bit while reading this article, and I will answer them for you at the end.</p>
<span id="more"></span>

<h2><span id="modularity">Modularity</span></h2><p>I believe everyone should have heard of the term module. This is a simple example.</p>
<p>For example, your mobile phone, if the screen is broken, you can only replace the screen, if the camera is broken, you can only replace the camera, and if the battery is broken, you can only replace the battery. You may say, “Oh, what about it?”</p>
<p>Have you ever thought about why you can replace it like this? Because the screen and the camera are two completely independent functions, they do not interfere with each other and have no dependencies, so replacing the screen will not break the camera function, and vice versa. This is actually the concept of modularity. The screen is a module that is only responsible for displaying information, and the camera is another module that is responsible for taking pictures. Through the software of the mobile phone, the screen and the camera are integrated to display the picture captured by the camera on the screen.</p>
<p>If there is no concept of modularity, the entire mobile phone is really a whole, and each function is bound to each other. If the camera is broken, you have to replace the entire mobile phone, and you cannot replace only the camera.</p>
<p>If we talk about code, it will probably look like this:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> 相機
<span class="token keyword">import</span> 螢幕
<span class="token keyword">import</span> <span class="token constant">AA</span>電池
<span class="token keyword">import</span> sim卡

Phone<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>相機<span class="token punctuation">,</span> 螢幕<span class="token punctuation">,</span> <span class="token constant">AA</span>電池<span class="token punctuation">,</span> sim卡<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>One of the benefits of modularity is convenience. If you want to use someone else’s battery today, just change the battery part, and other parts don’t need to be changed:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> 相機
<span class="token keyword">import</span> 螢幕
<span class="token keyword">import</span> <span class="token constant">BB</span> 電池
<span class="token keyword">import</span> sim卡

Phone<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>相機<span class="token punctuation">,</span> 螢幕<span class="token punctuation">,</span> <span class="token constant">BB</span> 電池<span class="token punctuation">,</span> sim卡<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>When writing code, it is also like this. We often use many built-in modules or modules written by others. Taking Node.js as an example, you can use the built-in <code>os</code> module to obtain operating system-related information, such as which platform the operating system is:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> os <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">platform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// darwin</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>Here we use <code>require</code> to import the built-in os module and call <code>os.platform()</code> to get information.</p>
<p>This is the most basic use of modules in the program. After understanding this concept, we can narrow the scope and talk about how modularity works in Node.js. (I think it is important to have a basic understanding of Node.js to understand the concept of modularity. If you don’t know anything about it, it is highly recommended to learn a little bit, at least know what it is doing.)</p>
<h2><span id="nodejs-modules">Node.js Modules</span></h2><p>It has been mentioned before that we can use <code>require</code> in Node.js to import built-in modules. What if we want to make a module ourselves? Use the <code>module.exports</code> syntax.</p>
<p>For example, we have a <code>utils.js</code>, which contains a frequently used function <code>calculate</code> for calculating prices:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// utils.js</span>
<span class="token keyword">function</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token number">20</span> <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">3</span>  <span class="token comment">// 計算價格公式</span>
<span class="token punctuation">&#125;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> calculate <span class="token comment">// 把這個函式 export 出去</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Then we can use the <code>require</code> syntax in another file <code>main.js</code> to import:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// main.js</span>
<span class="token keyword">var</span> calculate <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./utils'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">calculate</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 9</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>What we <code>module.exports</code> in <code>utils.js</code> will be imported with <code>require(&#39;./utils&#39;)</code> elsewhere. So you can think of <code>var calculate = require(&#39;./utils&#39;)</code> as <code>var calculate = (module.exports in utils.js)</code>.</p>
<p>Let’s take another example where we change the output of <code>utils.js</code> to an object:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token number">20</span> <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">3</span>  <span class="token comment">// 計算價格公式</span>
<span class="token punctuation">&#125;</span>
  
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">cal</span><span class="token operator">:</span> calculate<span class="token punctuation">,</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'hello'</span>
<span class="token punctuation">&#125;</span> <span class="token comment">// 把這個物件 export 出去</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>In <code>main.js</code>, we can still get this object in the same way:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./utils'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">cal</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 9</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// hello</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>This is the basic concept of module usage in Node.js, using <code>module.exports</code> to export things and <code>require</code> to import modules.</p>
<p>This module mechanism is not actually part of the JavaScript specification, but rather a standard called “CommonJS”.</p>
<p>Some people may be confused by this. Let’s imagine a scenario.</p>
<p>Before the emergence of ES6, JavaScript itself did not specify any mechanism related to modules.</p>
<p>At this time, everyone can come up with their own ideas. For example, A may think it’s better to write it like this:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// utils.js</span>
<span class="token keyword">function</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token number">20</span> <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">3</span>  <span class="token comment">// 計算價格公式</span>
<span class="token punctuation">&#125;</span>
  
out <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">cal</span><span class="token operator">:</span> calculate<span class="token punctuation">,</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'hello'</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// main.js</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token function">include</span><span class="token punctuation">(</span><span class="token string">'./utils'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">cal</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 9</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// hello</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Use <code>out</code> to output modules and <code>include</code> to import them.</p>
<p>And B may say it’s better like this:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// utils.js</span>
<span class="token keyword">function</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token number">20</span> <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">3</span>  <span class="token comment">// 計算價格公式</span>
<span class="token punctuation">&#125;</span>
  
<span class="token constant">EXP</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">cal</span><span class="token operator">:</span> calculate<span class="token punctuation">,</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'hello'</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// main.js</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">in</span><span class="token punctuation">(</span><span class="token string">'./utils'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">cal</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 9</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// hello</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Use <code>EXP</code> to output modules and <code>in</code> to import them.</p>
<p>So A’s standard is called A standard, and B’s is called B standard. Both of these standards can achieve modularity, but the syntax and implementation behind them are different. CommonJS is just one of these standards, which uses <code>module.exports</code> to export modules and <code>require</code> to import them.</p>
<p>Later, Node.js adopted this CommonJS standard, which is why we see this form now.</p>
<p>Have you noticed that we have been talking about Node.js all the time?</p>
<p>What about browsers? Sorry, browsers do not natively support this. So you can’t use <code>module.exports</code> or <code>require</code> in the browser.</p>
<p>Some people may say, “You’re lying! Why can my company’s project use these and still run in the browser?” Well, I’m not lying. It’s true that browsers don’t natively support it, but you can use other tools to achieve this (yes, you now know why you need to use webpack).</p>
<p>But before introducing the tools, let’s try to solve this problem ourselves.</p>
<h2><span id="manually-adding-commonjs-support">Manually adding CommonJS support</span></h2><p>In the CommonJS module standard, the two most important things are:</p>
<ol>
<li><code>module.exports</code></li>
<li><code>require</code></li>
</ol>
<p>As mentioned earlier:</p>
<p>Whatever we export in <code>utils.js</code>, we can import it with <code>require(&#39;./utils&#39;)</code>. So you can think of <code>var calculate = require(&#39;./utils&#39;)</code> as <code>var calculate = (what is exported in utils.js) module.exports</code>.</p>
<p>Therefore, we can try to add some code to make <code>require(&#39;./utils.js)</code> return what is exported in <code>utils.js</code>, and we’re done.</p>
<p>First, wrap the original content of <code>main.js</code> in a function called <code>main</code> and pass in <code>require</code>:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter">require</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./utils'</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">cal</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 9</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// hello</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Then wrap the content of <code>utils.js</code> in a function, and since <code>utils.js</code> does not use <code>require</code>, we change it to pass in a parameter called <code>module</code>, like this:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter">require</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./utils'</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">cal</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
  
<span class="token keyword">function</span> <span class="token function">utils</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">function</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token number">20</span> <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">3</span>
  <span class="token punctuation">&#125;</span>
    
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">cal</span><span class="token operator">:</span> calculate<span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'hello'</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>The above just wraps the two files with two functions and passes in parameters.</p>
<p>Next, we can declare a variable <code>m</code> outside and pass it into <code>utils</code>, then call it:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter">require</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./utils'</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">cal</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
  
<span class="token keyword">function</span> <span class="token function">utils</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">function</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token number">20</span> <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">3</span>
  <span class="token punctuation">&#125;</span>
    
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">cal</span><span class="token operator">:</span> calculate<span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'hello'</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
  
<span class="token comment">// 加入這兩行</span>
<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token function">utils</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>After calling the <code>utils</code> function, <code>m.exports</code> will be what we exported in the <code>utils</code> function, which should be returned when <code>require(&#39;utils.js&#39;)</code> is called in <code>main</code>.</p>
<p>So the final step is to call the <code>main</code> function and pass in a <code>require</code> parameter:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter">require</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./utils'</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">cal</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">utils</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">function</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token number">20</span> <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">3</span>
  <span class="token punctuation">&#125;</span>
    
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">cal</span><span class="token operator">:</span> calculate<span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'hello'</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token function">utils</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
  
<span class="token comment">// 加入底下這幾行</span>
<span class="token keyword">function</span> <span class="token function">r</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 回傳我們所需要的 m.exports</span>
  <span class="token keyword">return</span> m<span class="token punctuation">.</span>exports
<span class="token punctuation">&#125;</span>
<span class="token function">main</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>That’s it! We can now pass <code>module.exports</code> from <code>utils</code> to <code>main</code> and return it when <code>require(&#39;utils.js&#39;)</code> is called. You can copy and paste the entire code above into the browser, and it should run smoothly!</p>
<p>The above code is just a rough demonstration of the principle. The basic principle is:</p>
<ol>
<li>Wrap the file into a function and receive parameters such as <code>module</code> and <code>require</code>.</li>
<li>Call the function outside and pass in an object and the <code>require</code> function.</li>
</ol>
<p>However, in reality, it is not that simple because there are still many problems to solve, such as:</p>
<ol>
<li>Dependency, for example, A depends on B, and B depends on C, so the loading order must be: C-&gt;B-&gt;A.</li>
<li>Loading multiple modules, the function we passed to main only returns the module.exports of utils, but it should support multiple requires, so what to return should be determined based on the parameter in require.</li>
<li>Caching, when a module is loaded multiple times, it should be cached.</li>
</ol>
<p>After understanding the principle, let’s see how to use existing tools.</p>
<h2><span id="introduction-to-browserify">Introduction to Browserify</span></h2><p>The world of front-end development is simple, in a nutshell:</p>
<blockquote>
<p>If something is not supported, write a tool to support it.</p>
</blockquote>
<p>Babel, webpack, and PostCSS are all tools that implement functions that are not natively supported by browsers.</p>
<p>In 2011, <a target="_blank" rel="noopener" href="http://browserify.org/">browserify</a> was introduced. The first sentence on its official website describes its purpose:</p>
<blockquote>
<p>Browserify lets you require(‘modules’) in the browser by bundling up all of your dependencies.</p>
</blockquote>
<p>In short, it allows you to use require in the browser.</p>
<p>You can use the following command in the terminal to package the two files main.js and utils.js we just created:</p>
<pre class="line-numbers language-none"><code class="language-none">npx browserify main.js -o bundle.js<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>The first parameter passed in is the so-called entry point, which represents the main file to be executed. For example, when we demonstrated earlier, we used <code>node main.js</code> to execute, which means that the file to be executed is actually main.js, so main.js is the entry point.</p>
<p>Then the generated bundle.js content is as follows:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">(</span>
  <span class="token keyword">function</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token parameter">t<span class="token punctuation">,</span> n<span class="token punctuation">,</span> r</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">function</span> <span class="token function">s</span><span class="token punctuation">(</span><span class="token parameter">o<span class="token punctuation">,</span> u</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>n<span class="token punctuation">[</span>o<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>t<span class="token punctuation">[</span>o<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">typeof</span> require <span class="token operator">==</span> <span class="token string">"function"</span> <span class="token operator">&amp;&amp;</span> require<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>u <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">a</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">i</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">var</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Cannot find module '"</span> <span class="token operator">+</span> o <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">throw</span> f<span class="token punctuation">.</span>code <span class="token operator">=</span> <span class="token string">"MODULE_NOT_FOUND"</span><span class="token punctuation">,</span> f
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">var</span> l <span class="token operator">=</span> n<span class="token punctuation">[</span>o<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
          <span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        t<span class="token punctuation">[</span>o<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>l<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">var</span> n <span class="token operator">=</span> t<span class="token punctuation">[</span>o<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>e<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token function">s</span><span class="token punctuation">(</span>n <span class="token operator">?</span> n <span class="token operator">:</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> l<span class="token punctuation">,</span> l<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> e<span class="token punctuation">,</span> t<span class="token punctuation">,</span> n<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
      <span class="token keyword">return</span> n<span class="token punctuation">[</span>o<span class="token punctuation">]</span><span class="token punctuation">.</span>exports
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token keyword">typeof</span> require <span class="token operator">==</span> <span class="token string">"function"</span> <span class="token operator">&amp;&amp;</span> require<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> o <span class="token operator">&lt;</span> r<span class="token punctuation">.</span>length<span class="token punctuation">;</span> o<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token function">s</span><span class="token punctuation">(</span>r<span class="token punctuation">[</span>o<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> s
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">function</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token number">20</span> <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">3</span> <span class="token comment">// 計算價格公式</span>
    <span class="token punctuation">&#125;</span>

    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">cal</span><span class="token operator">:</span> calculate<span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'hello'</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">// 把這個物件 export 出去</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token number">2</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./utils'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">cal</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 9</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// hello</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    <span class="token string-property property">"./utils"</span><span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>It is normal if you cannot understand it because this is the compressed version. But the core concept is: “Wrap your code in a function and provide a function called require and an object called module for you to use.” It is similar to what we did above, but more rigorous.</p>
<p>If you really want to understand what is going on, I refer to the source code: <a target="_blank" rel="noopener" href="https://github.com/browserify/browser-pack/blob/master/prelude.js">browser-pack&#x2F;prelude.js</a>, and restore the packaged code and add comments. For readability, I also changed the order and removed some additional checks and functions.</p>
<p>The result is as follows (please note that for teaching purposes, only the most core functions are left below, and the rest of the code is removed):</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 跟我們做的事情一樣，把檔案包成一個 function，傳入 require, modules</span>
<span class="token keyword">function</span> <span class="token function">utils</span><span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">function</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token number">20</span> <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">3</span>
  <span class="token punctuation">&#125;</span>
  
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">cal</span><span class="token operator">:</span> calculate<span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'hello'</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
  
<span class="token comment">// 跟我們做的事情一樣，把檔案包成一個 function，傳入 require, modules</span>
<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./utils'</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">cal</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span> 
<span class="token punctuation">&#125;</span>
  
<span class="token comment">/*
  定義一個叫做 modules 的物件，裡面把 module 換成數字編號
  陣列的第一個參數就是上面包好的 function，第二個參數則是相依性需要的 module 以及編號
  例如說： &#123;
    "./utils": 1
  &#125;
  代表說當我呼叫 require("./utils") 的時候，其實就是要載入編號為 1 的 module
*/</span>
<span class="token keyword">var</span> modules <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">[</span>utils<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token number">2</span><span class="token operator">:</span> <span class="token punctuation">[</span>main<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    <span class="token string-property property">"./utils"</span><span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/*
  函式詳細內容可以見底下，第一個參數就是 modules
  第二個參數是 cache（先不管）
  第三個參數則是入口點，就像是 C 語言裡面的 main function 那樣
  以我們的範例來說，就是 main.js 這個檔案，也就是編號為 2 的 module
*/</span>
<span class="token function">outer</span><span class="token punctuation">(</span>modules<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
 
<span class="token comment">/* 
  底下程式碼來自：https://github.com/browserify/browser-pack/blob/master/prelude.js
  為了方便理解核心功能，有經過刪改
*/</span>
<span class="token keyword">function</span> <span class="token function">outer</span><span class="token punctuation">(</span><span class="token parameter">modules<span class="token punctuation">,</span> cache<span class="token punctuation">,</span> entry</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">/*
    順序執行 entry，在我們的例子 entry 只有一個
    所以可以簡單想成是：newRequire(2)
  */</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> entry<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">newRequire</span><span class="token punctuation">(</span>entry<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token comment">/*
    核心程式碼在下面
    以我們的例子而言，name 會是 2
  */</span>
  <span class="token keyword">function</span> <span class="token function">newRequire</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//先從 cache 裡面找這個 module 的內容，找不到的話載入 module 並且放入 cache</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cache<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 找不到要載入的 module，拋出錯誤</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>modules<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">var</span> err <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Cannot find module \''</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'\''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        err<span class="token punctuation">.</span>code <span class="token operator">=</span> <span class="token string">'MODULE_NOT_FOUND'</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>

      <span class="token comment">/*
        宣告一個物件來儲存 module export 出來的東西
        並且一併放到 cache 裡面
      */</span>
      <span class="token keyword">var</span> m <span class="token operator">=</span> cache<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">exports</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

      <span class="token comment">/*
        核心功能就是底下這四行
        呼叫我們最前面定義的那個包好的 function，並且傳入 require 以及 module
        在 require 裡面會根據 modules 的內容找到要引入的 id
        以 require('./utils') 為例
        modules[2][1]['./utils'] 是 1，就會去載入 id 為 1 的 module 並且回傳
      */</span>
      modules<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
          <span class="token keyword">var</span> id <span class="token operator">=</span> modules<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token comment">// 載入 module 並且回傳</span>
          <span class="token keyword">return</span> <span class="token function">newRequire</span><span class="token punctuation">(</span>id <span class="token operator">?</span> id <span class="token operator">:</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 找到的話就直接回傳 module.exports</span>
    <span class="token keyword">return</span> cache<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span>exports
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>The original code is more complicated because it needs to consider many other situations, and only the core module function is left, which looks like the one above. It’s okay if you don’t understand it, after all, this is a more beginner-friendly article, just take a quick look.</p>
<p>You only need to know one key point:</p>
<blockquote>
<p>CommonJS (require and module.exports) is not natively supported by browsers, and tools must be used to use them in browsers.</p>
</blockquote>
<p>The “tool” mentioned above, we have introduced browserify, but there is another more famous one.</p>
<p>Yes, it’s webpack!</p>
<h2><span id="exploring-webpack">Exploring Webpack</span></h2><p>When we used browserify just now, we used this command to specify the entry point and the name of the packaged file:</p>
<pre class="line-numbers language-none"><code class="language-none">npx browserify main.js -o bundle.js<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Webpack is essentially similar to browserify, but these need to be turned into configuration files. We can add a <code>webpack.config.js</code>:</p>
<pre class="line-numbers language-none"><code class="language-none">module.exports &#x3D; &#123;
  entry: &#39;.&#x2F;main.js&#39;,
  output: &#123;
    path: __dirname,
    filename: &#39;webpack_bundle.js&#39;
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Careful observation will reveal that this is actually the same as the options that need to be set when using browserify, the entry point, the output file name, and the path (__dirname represents the same directory as the config file).</p>
<p>Then execute these few commands in the terminal, which is basically to install webpack and then execute webpack:</p>
<pre class="line-numbers language-none"><code class="language-none">npm init -y
npm install webpack webpack-cli --save-dev
npx webpack --config webpack.config.js<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="/img/mods/webpack.png"></p>
<p>Then you will see a <code>webpack_bundle.js</code> in the directory, and the content is also something that cannot be understood at all. This is because webpack has two modes, production and development, and the default is the former. Production means that it will automatically compress and optimize for use in production environments.</p>
<p>During development, the development mode is usually used, and the packaging speed is faster. The way to change it is very simple, just change the configuration file:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">'./main.js'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> __dirname<span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'webpack_bundle.js'</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>After saving, execute <code>npx webpack --config webpack.config.js</code> again, and the result is as follows:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/******/</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// webpackBootstrap</span>
<span class="token comment">/******/</span> 	<span class="token comment">// The module cache</span>
<span class="token comment">/******/</span> 	<span class="token keyword">var</span> installedModules <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// The require function</span>
<span class="token comment">/******/</span> 	<span class="token keyword">function</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 		<span class="token comment">// Check if module is in cache</span>
<span class="token comment">/******/</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span>installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">/******/</span> 			<span class="token keyword">return</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token punctuation">&#125;</span>
<span class="token comment">/******/</span> 		<span class="token comment">// Create a new module (and put it into the cache)</span>
<span class="token comment">/******/</span> 		<span class="token keyword">var</span> module <span class="token operator">=</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
<span class="token comment">/******/</span> 			<span class="token literal-property property">i</span><span class="token operator">:</span> moduleId<span class="token punctuation">,</span>
<span class="token comment">/******/</span> 			<span class="token literal-property property">l</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token comment">/******/</span> 			<span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token comment">/******/</span> 		<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 		<span class="token comment">// Execute the module function</span>
<span class="token comment">/******/</span> 		modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 		<span class="token comment">// Flag the module as loaded</span>
<span class="token comment">/******/</span> 		module<span class="token punctuation">.</span>l <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 		<span class="token comment">// Return the exports of the module</span>
<span class="token comment">/******/</span> 		<span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
<span class="token comment">/******/</span> 	<span class="token punctuation">&#125;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// expose the modules object (__webpack_modules__)</span>
<span class="token comment">/******/</span> 	__webpack_require__<span class="token punctuation">.</span>m <span class="token operator">=</span> modules<span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// expose the module cache</span>
<span class="token comment">/******/</span> 	__webpack_require__<span class="token punctuation">.</span>c <span class="token operator">=</span> installedModules<span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// define getter function for harmony exports</span>
<span class="token comment">/******/</span> 	__webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">d</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> name<span class="token punctuation">,</span> getter</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">/******/</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>__webpack_require__<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">/******/</span> 			Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">get</span><span class="token operator">:</span> getter <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token punctuation">&#125;</span>
<span class="token comment">/******/</span> 	<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// define __esModule on exports</span>
<span class="token comment">/******/</span> 	__webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">r</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">/******/</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> Symbol <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">/******/</span> 			Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'Module'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token punctuation">&#125;</span>
<span class="token comment">/******/</span> 		Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'__esModule'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 	<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// create a fake namespace object</span>
<span class="token comment">/******/</span> 	<span class="token comment">// mode &amp; 1: value is a module id, require it</span>
<span class="token comment">/******/</span> 	<span class="token comment">// mode &amp; 2: merge all properties of value into the ns</span>
<span class="token comment">/******/</span> 	<span class="token comment">// mode &amp; 4: return value when already ns object</span>
<span class="token comment">/******/</span> 	<span class="token comment">// mode &amp; 8|1: behave like require</span>
<span class="token comment">/******/</span> 	__webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">t</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> mode</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">/******/</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> value <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> value <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">.</span>__esModule<span class="token punctuation">)</span> <span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token keyword">var</span> ns <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		__webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>ns<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>ns<span class="token punctuation">,</span> <span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> value <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> value <span class="token operator">!=</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> value<span class="token punctuation">)</span> __webpack_require__<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>ns<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> value<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token keyword">return</span> ns<span class="token punctuation">;</span>
<span class="token comment">/******/</span> 	<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// getDefaultExport function for compatibility with non-harmony modules</span>
<span class="token comment">/******/</span> 	__webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">n</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">/******/</span> 		<span class="token keyword">var</span> getter <span class="token operator">=</span> module <span class="token operator">&amp;&amp;</span> module<span class="token punctuation">.</span>__esModule <span class="token operator">?</span>
<span class="token comment">/******/</span> 			<span class="token keyword">function</span> <span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> module<span class="token punctuation">[</span><span class="token string">'default'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token operator">:</span>
<span class="token comment">/******/</span> 			<span class="token keyword">function</span> <span class="token function">getModuleExports</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> module<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		__webpack_require__<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>getter<span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> getter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token keyword">return</span> getter<span class="token punctuation">;</span>
<span class="token comment">/******/</span> 	<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// Object.prototype.hasOwnProperty.call</span>
<span class="token comment">/******/</span> 	__webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">o</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">object<span class="token punctuation">,</span> property</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> property<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// __webpack_public_path__</span>
<span class="token comment">/******/</span> 	__webpack_require__<span class="token punctuation">.</span>p <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 	<span class="token comment">// Load entry module and return exports</span>
<span class="token comment">/******/</span> 	<span class="token keyword">return</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span>s <span class="token operator">=</span> <span class="token string">"./main.js"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment">/************************************************************************/</span>
<span class="token comment">/******/</span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>

<span class="token comment">/***/</span> <span class="token string">"./main.js"</span><span class="token operator">:</span>
<span class="token comment">/*!*****************!*\
  !*** ./main.js ***!
  \*****************/</span>
<span class="token comment">/*! no static exports found */</span>
<span class="token comment">/***/</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

<span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"var obj = __webpack_require__(/*! ./utils */ \"./utils.js\")\nconsole.log(obj.cal(30)) // 9\nconsole.log(obj.name) // hello\n\n\n//# sourceURL=webpack:///./main.js?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/***/</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

<span class="token comment">/***/</span> <span class="token string">"./utils.js"</span><span class="token operator">:</span>
<span class="token comment">/*!******************!*\
  !*** ./utils.js ***!
  \******************/</span>
<span class="token comment">/*! no static exports found */</span>
<span class="token comment">/***/</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

<span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"function calculate(n) &#123; \n  return ((n * 100 + 20 - 4)) % 10 + 3  // 計算價格公式\n&#125;\n  \nmodule.exports = &#123;\n  cal: calculate,\n  name: 'hello'\n&#125; // 把這個物件 export 出去\n\n//# sourceURL=webpack:///./utils.js?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/***/</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment">/******/</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Like browserify, you can paste the entire string above into the browser console and execute it normally to output the result. Although you don’t need to look closely at the code above, you will notice that many things are similar to the code packaged by browserify.</p>
<p>Okay, I believe everyone has learned two key points here:</p>
<ol>
<li>webpack is similar to browserify</li>
<li>To use the CommonJS module mechanism on the browser, you must use a tool to package the code first.</li>
</ol>
<p>And the second point is the reason why webpack is necessary.</p>
<p>At this point, you may have a question:</p>
<blockquote>
<p>But our company doesn’t use <code>require</code>, we use ES6’s <code>import</code> and <code>export</code>, isn’t the browser already supporting it? Then why do we need webpack?</p>
</blockquote>
<p>That’s a good question. Take a break and get a drink of water, the second half is about to begin.</p>
<h2><span id="standardization-of-es6-modules">Standardization of ES6 modules</span></h2><p>As mentioned earlier, before ES6 appeared, JavaScript did not have a standard module specification. Node.js supports CommonJS, so you can use <code>require</code> and <code>module.exports</code>, but the browser does not natively support it, so tools like browserify and webpack are needed.</p>
<p>After ES6 came out, there was finally a formal specification, which is the <code>import</code> and <code>export</code> that we often see. We can change the previous <code>main.js</code> and <code>utils.js</code> to the form of <code>import</code> and <code>export</code>:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// main.js</span>
<span class="token keyword">import</span> obj <span class="token keyword">from</span> <span class="token string">'./utils'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">cal</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span>

<span class="token comment">//utils.js</span>
<span class="token keyword">function</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token number">20</span> <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">3</span>  <span class="token comment">// 計算價格公式</span>
<span class="token punctuation">&#125;</span>
  
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">cal</span><span class="token operator">:</span> calculate<span class="token punctuation">,</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'hello'</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Although this is the ES6 standard, the support is not very good.</p>
<p>If you try to execute <code>node main.js</code> on Node.js, it will give you a <code>SyntaxError: Unexpected identifier</code> error directly because Node.js does not recognize the <code>import</code> syntax.</p>
<p>There are two ways to use <code>import</code> and <code>export</code> on Node.js. The first method is to change the file extension from <code>.js</code> to <code>.mjs</code>, and then add a flag when using node: <code>node --experimental-modules main.mjs</code>.</p>
<p><img src="/img/mods/es.png"></p>
<p>By the way, this is the situation when the Node.js version is less than 13. If it is the latest version 13 or above, just change the file name to <code>mjs</code>. For details, please refer to: <a target="_blank" rel="noopener" href="https://nodejs.org/dist/latest-v13.x/docs/api/esm.html#esm_enabling">Node.js v13.7.0 Documentation: ECMAScript Modules</a>.</p>
<p>The second method is the famous babel, which relies on babel to convert ES6 syntax to ES5, and can be used directly on the <a target="_blank" rel="noopener" href="https://babeljs.io/repl#?browsers=&build=&builtIns=false&spec=false&loose=false&code_lz=JYWwDg9gTgLgBBARgKzgMyhEcDkA6AegFcZgAbAZxwCgBjCAOwojIFM8yIBzACiWTy0AhmR4BmAAwBKKXUbM2HbnxR4GQkK1lA&debug=false&forceAllTransforms=false&shippedProposals=false&circleciRepo=&evaluate=true&fileSize=false&timeTravel=false&sourceType=module&lineWrap=false&presets=es2015%2Creact%2Cstage-2&prettier=false&targets=&version=7.8.3&externalPlugins=">simple online converter</a> provided by babel. Convert the content of <code>main.js</code> from <code>import</code> to <code>require</code>:</p>
<p><img src="/img/mods/babel.png"></p>
<p>The above is about Node.js. What about the browser?</p>
<p>You can try not to change anything first, just <code>main.js</code> and <code>utils.js</code>, and then add an <code>index.html</code>, the content is as follows:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./main.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>After opening it, you will see that the devtool console spits out such an error:</p>
<p><code>Uncaught SyntaxError: Cannot use import statement outside a module</code></p>
<p>Similar to Node.js, if you want to use <code>import</code> and <code>export</code>, you must execute it in the form of a module, so you need to add a type to the script tag:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./main.js<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Then, when you reopen the page, you will find another error:</p>
<pre class="line-numbers language-none"><code class="language-none">Access to script at &#39;file:&#x2F;&#x2F;&#x2F;Users&#x2F;huli&#x2F;w_test&#x2F;main.js&#39; from origin &#39;null&#39;
has been blocked by CORS policy: Cross origin requests are only supported for protocol schemes:
http, data, chrome, chrome-extension, https.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>Currently, I am opening index.html by double-clicking it, so it is just opening the file, and the URL will start with <code>file:///</code>. If you want to use import, you must open it in a server. You can enter this command in the same directory to run a file server:</p>
<pre class="line-numbers language-none"><code class="language-none">python -m SimpleHTTPServer 8080<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Then you can open it: <a target="_blank" rel="noopener" href="http://localhost:8080/">http://localhost:8080</a>.</p>
<p>Unfortunately, another error occurred this time: <code>GET http://localhost:8080/utils net::ERR_ABORTED 404 (File not found)</code></p>
<p>You need to change <code>import obj from &#39;./utils&#39;</code> in main.js to <code>import obj from &#39;./utils.js&#39;</code> to explicitly specify that you want to import the .js file.</p>
<p>After changing it, refresh the page, and you can see the correct result on the console! Below is the complete code, with only three files:</p>
<p>main.js</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> obj <span class="token keyword">from</span> <span class="token string">'./utils.js'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">cal</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>utils.js</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token number">20</span> <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">3</span>  <span class="token comment">// 計算價格公式</span>
<span class="token punctuation">&#125;</span>
  
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">cal</span><span class="token operator">:</span> calculate<span class="token punctuation">,</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'hello'</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>index.html</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>html<span class="token operator">></span>
<span class="token operator">&lt;</span>head<span class="token operator">></span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"./main.js"</span> type<span class="token operator">=</span><span class="token string">"module"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span>
<span class="token operator">&lt;</span>body<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>So far, everything seems to be going smoothly, and there doesn’t seem to be any problems. You can run it on the webpage by adding the <code>type=&quot;module&quot;</code> attribute to the import tag, which is great.</p>
<p>However, things are not that simple.</p>
<p>The first problem is browser support.</p>
<p>This problem can be big or small depending on whether your company needs to support IE, because all major browsers support import and export, but IE does not.</p>
<p>The second problem is, what if I want to use packages written by others on npm?</p>
<p>There is no problem with this in Node.js because you must first install <code>node_modules</code> in the folder, but what about the webpage? Do you have to upload the entire <code>node_modules</code> folder?</p>
<p>Another problem is how to write the path when importing? Do you have to write it explicitly like <code>import pad from &#39;./node_modules/pad-left/index.js&#39;</code>? This is a very poorly maintainable way of writing, and if the entry point of the module changes, you have to rewrite all the import statements.</p>
<p>This problem is actually quite troublesome because during development, you usually use modules written by others. If you cannot easily support importing these modules, it will cause a lot of inconvenience.</p>
<p>Do you remember what I said before?</p>
<p>“The world of front-end is simple. If something is not supported, write a tool to support it.” Here we need to modify it a bit to “The world of front-end is simple. If something is not supported or has poor support, write a tool to support it.”</p>
<p>It is because the native module mechanism of the browser will encounter many problems (compatibility, inability to be compatible with npm, etc.), so we need an additional tool.</p>
<p>And this tool is webpack.</p>
<h2><span id="exploring-webpack-again">Exploring webpack again</span></h2><p>To experience the power of webpack, let’s install a package first:</p>
<pre class="line-numbers language-none"><code class="language-none">npm install pad-left<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Then import and use the package in main.js:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> obj <span class="token keyword">from</span> <span class="token string">'./utils.js'</span>
<span class="token keyword">import</span> pad <span class="token keyword">from</span> <span class="token string">'pad-left'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">cal</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">pad</span><span class="token punctuation">(</span><span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>Then follow the previous process to package the file. The config file has been written before, so just enter the command:</p>
<pre class="line-numbers language-none"><code class="language-none">npx webpack --config webpack.config.js<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Then open index.html and change the imported script. You don’t need <code>type=module</code> because of webpack:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./webpack_bundle.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Finally, open index.html, and if you see the output of 9 and 0004 on the console, it means that the packaging was successful.</p>
<p>One of the benefits of using webpack is that we can package the modules installed using npm together, just like packaging the modules we wrote ourselves, without doing anything else. This is something that native browsers cannot do.</p>
<p>The reason we need webpack is that the native browser module function and support are not that complete.</p>
<p>However, the power of webpack is not just that. When you open the <a target="_blank" rel="noopener" href="https://webpack.js.org/">webpack official website</a>, you will see this picture:</p>
<p><img src="/img/mods/web.png"></p>
<p>The most powerful thing about webpack is that it extends the concept of “modularity”. When we were discussing modularity just now, we only talked about JavaScript and program modules. But webpack regards “any resource” as a module.</p>
<p>Images and CSS are modules, so you can <code>import Image from &#39;./assets/banner.png&#39;</code> and <code>import styles from &#39;style.css&#39;</code>. You can import any resource and use it.</p>
<p>This has nothing to do with JavaScript or ES6. It is entirely an extension of webpack. You cannot use it in a browser.</p>
<p>To support this functionality, webpack defines many loaders for different resources. These loaders process the resources to load them. This is where webpack’s power lies.</p>
<p>For example, you can use the scss loader to load scss files, and it will compile them into CSS when you import them. You don’t have to do it yourself. The same goes for JS. You can write the latest and greatest syntax and use the babel-loader to convert ES10 syntax to ES5 when you load it.</p>
<p>This resource loading and conversion is where webpack is most powerful.</p>
<p>Do you remember when you were writing React and importing images and CSS like it was nothing? This is because webpack is handling it for you. It is not something that browsers natively support, but rather something that webpack’s module system does for you.</p>
<p>Furthermore, once you have mastered the basics of resource bundling, webpack can do more interesting things with loaders and plugins, such as:</p>
<ol>
<li>Uglifying JS when loading it</li>
<li>Minifying CSS when loading it</li>
<li>Adding a hash to the packaged file name</li>
<li>Packaging different files for different pages so that you don’t have to load all JS at once</li>
<li>Supporting dynamic JS imports, loading only when needed</li>
</ol>
<p>That’s the end of the webpack tutorial. I don’t intend to go deeper into it, as it would be more about tool usage. The main purpose of this article is to let you know:</p>
<ol>
<li>Why use webpack?</li>
<li>What happens if you don’t use webpack?</li>
<li>What is the difference between webpack and the standard module defined by ES6?</li>
<li>The most basic usage of webpack (writing configuration files and packaging JS)</li>
</ol>
<h2><span id="snowpack">Snowpack</span></h2><p>As we mentioned earlier, one of the reasons for using webpack is that native browsers cannot package npm-installed modules. In addition to solving this problem, webpack also extends the definition of “modules” so that any resource can be treated as a module. With a powerful loader and plugin system, webpack can do more interesting things.</p>
<p>Recently, another library called <a target="_blank" rel="noopener" href="https://www.snowpack.dev/">Snowpack</a> was released, which claims to be able to run in browsers without packaging. The principle is simple: it organizes the modules installed in <code>node_modules</code> and puts them in another folder called <code>web_modules</code>. When you need to import them, you can import them from there.</p>
<p>However, not every module can be used this way. The module itself must support the standard ESM module. For example, <code>pad-left</code> that we used earlier does not support it, so we cannot use it with Snowpack. Therefore, we will install a supported <code>mathjs</code> later to try it out.</p>
<p>Let’s try it out. First, install Snowpack and mathjs:</p>
<pre class="line-numbers language-none"><code class="language-none">npm install --save-dev snowpack
npm install mathjs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>Then run Snowpack to organize the modules:</p>
<pre class="line-numbers language-none"><code class="language-none">npx snowpack<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>After running it, you will see a new folder called <code>web_modules</code> with two files: <code>import-map.json</code> and <code>mathjs.js</code>.</p>
<p>Next, update main.js:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> obj <span class="token keyword">from</span> <span class="token string">'./utils.js'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span>pi<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./web_modules/mathjs.js'</span> <span class="token comment">// 從 web_modules 資料夾引入</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">cal</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pi<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>Then update index.html:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./main.js<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Finally, run a server with the command: <code>python -m SimpleHTTPServer 8080</code></p>
<p>You will see <code>3.141592653589793</code> in the console, indicating that we can use the npm-installed module successfully!</p>
<p>Snowpack is easy to use, and the problem it solves is simple. It only solves the problem of “importing third-party modules,” and does not manage anything else.</p>
<p>Can it import images and CSS like webpack? No, and the official website suggests that you use the old methods:</p>
<p><img src="/img/mods/snowpack.png"></p>
<p>The website also has a section on who should use Snowpack and who should not. For example, if you want to support IE11 or need to use a library that does not support ESM, you should not use Snowpack.</p>
<p>Snowpack is still new, and there are still many issues to be resolved if you want to use it in production. I specifically mention it here to show you another solution besides webpack.</p>
<p>You may have heard of Parcel or Rollup, which are just other tools for packaging. You can choose a tool to familiarize yourself with, but the key is to understand why you need these tools before that.</p>
<h2><span id="conclusion">Conclusion</span></h2><p>Let’s answer the questions at the beginning:</p>
<h4><span id="q-why-do-many-projects-such-as-react-need-to-be-built-before-deployment-what-is-this-step-doing">Q: Why do many projects (such as React) need to be built before deployment? What is this step doing?</span></h4><p>Because the source code cannot be directly placed on the browser (it will not be able to execute), it must be processed by webpack packaging, and the packaged file can be executed by the browser.</p>
<h4><span id="q-do-you-know-the-difference-between-requiremoduleexports-and-importexport">Q: Do you know the difference between <code>require/module.exports</code> and <code>import/export</code>?</span></h4><p><code>require/module.exports</code> is a specification called CommonJS, which is supported by Node.js but not by browsers.</p>
<p><code>import/export</code> is a specification of ES6, which is partially supported by Node.js and browsers.</p>
<h4><span id="q-do-you-know-that-these-two-syntaxes-importexport-cannot-be-used-casually-on-browsers">Q: Do you know that these two syntaxes <code>import/export</code> cannot be used casually on browsers?</span></h4><p>There are usage restrictions, such as adding <code>type=module</code>, and you cannot directly import modules in npm. The browser support is also a consideration, and IE11 does not support this syntax.</p>
<h4><span id="q-do-you-know-why-you-need-to-use-webpack">Q: Do you know why you need to use webpack?</span></h4><p>There are many reasons, such as:</p>
<ol>
<li>I want to use third-party modules on npm</li>
<li>I want to import images as resources</li>
<li>I want to import CSS as resources</li>
<li>I want to handle uglify and minify in one place</li>
</ol>
<p>However, the key is actually the first one, because the native ES6 module support of the browser is not so high, especially when importing third-party modules, so we need webpack or other packaging tools to help us handle this part.</p>
<h4><span id="q-do-you-know-why-webpack-needs-a-loader">Q: Do you know why webpack needs a loader?</span></h4><p>Because importing images or CSS as resources is not a formal specification, but a definition extended by webpack itself. In order to support these resources, a special loader must be written to load them, otherwise the default loader can only load JavaScript.</p>
<hr>
<p>When I first came into contact with webpack, I was also very confused. I didn’t know why I needed webpack, and I didn’t know what magic it did.</p>
<p>It wasn’t until later that I slowly explored and found that I was wrong from the beginning, and I shouldn’t start with webpack. If you don’t understand the concept of modularization, don’t even know that you can’t use require on the browser, how can you understand what webpack is doing?</p>
<p>And some students I recently met, even though they have work experience or have used webpack, they still have only a vague understanding of this part. In my opinion, the reason is that the understanding of modularization is insufficient, the understanding of historical context is not enough, and the distinction between “executing JS on the browser” and “executing JS on the computer using Node.js” is not clear enough, so many things are mixed together and treated as the same.</p>
<p>So although this article is called “webpack beginner’s tutorial”, it talks more about modularization and the reasons for using webpack, and does not really elaborate on “how to use webpack”. One reason is that I think that understanding the principles and reasons will greatly reduce the threshold for using tools; the other is that if I continue to write, it will never end. If you really want to talk about webpack, you can write another article.</p>
<p>In fact, there are many things about modularization that I deliberately did not mention, such as other specifications such as AMD&#x2F;UMD and the tool RequireJS. I think it is good for this article to ignore these contents selectively, because once they are mentioned, things will become more complicated, so these contents are selectively ignored.</p>
<p>When writing, choosing what to say and what not to say is also a skill, and maybe I can write another article to make up for these parts that have not been mentioned in the future.</p>
<p>Finally, I hope that after reading this article, you can really understand the problems that the native ES6 module will encounter on the browser, and you will know why you need to use webpack.</p>
<p>If there are any errors, please feel free to correct them. Thank you!</p>
<p>Reference:</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/articles/10191478">What? We actually have 3 standards? - Have you heard of CommonJS? (Day9)</a></li>
</ol>

    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/en/tags/webpack/">#webpack</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/2020/02/20/en/let-vs-var-bytecode/">Exploring the Performance Issues of let and var from V8 bytecode</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/2019/12/26/en/nand2tetris-introduction/">From Nand To Tetris: Understanding Computer Operations by Building One</a>
            
        </span>
    </div>
    
</article>




<div class="comments">
    <h3 class="title is-4">Comments</h3>
    <script src="https://utteranc.es/client.js"
        repo="aszx87410/huli-blog"
        issue-term="title"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>

    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2023 Huli&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow" title="GitHub" target="_blank" rel="noopener" href="https://github.com/ppoffice/hexo-theme-minos">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
<div class="column is-narrow has-text-centered">
    <div class="dropdown is-up is-right is-hoverable" style="margin-top: -0.2em;">
        <div class="dropdown-trigger">
            <button class="button is-small" aria-haspopup="true">
                <span class="icon">
                    <i class="fas fa-globe"></i>
                </span>
                <span>English</span>
                <span class="icon is-small">
            <i class="fas fa-angle-down" aria-hidden="true"></i>
          </span>
            </button>
        </div>
        <div class="dropdown-menu has-text-left" role="menu" style="top:100%">
            <div class="dropdown-content">
            <!-- NOTE: 永遠回到首頁 -->
            
                <a href="/2020/01/21/webpack-newbie-tutorial/" class="dropdown-item">
                    繁體中文
                </a>
            
            </div>
        </div>
    </div>
</div>

        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>



    
    
    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    



<script src="/js/script.js?v=3.js"></script>


    
</body>
</html>